{"version":3,"sources":["../src/lok-bindings.ts","../src/types.ts","../src/editor/base.ts","../src/editor/writer.ts","../src/editor/calc.ts","../src/editor/impress.ts","../src/editor/draw.ts","../src/editor/index.ts","../src/browser-worker.ts"],"names":["getCallbackTypeName","type","LOK_CLASS","DOC_CLASS","textEncoder","textDecoder","LOKBindings","module","verbose","args","str","bytes","ptr","heap","end","slice","addr","installPath","pathPtr","hook","errPtr","lokClassPtr","getErrorPtr","path","fileUrl","startTime","docPtr","documentLoadPtr","error","options","optsPtr","loadWithOptsPtr","outputPath","format","filterOptions","urlPtr","formatPtr","result","docClassPtr","saveAsPtr","destroyPtr","part","sizePtr","width","height","canvasWidth","canvasHeight","tilePosX","tilePosY","tileWidth","tileHeight","bufferSize","bufferPtr","pageIndex","docType","currentPart","docSize","pageRectsStr","pageRect","aspectRatio","outputWidth","outputHeight","data","mimeType","mimePtr","usedMimePtr","resultPtr","x","y","count","buttons","modifier","charCode","keyCode","command","notifyWhenFinished","cmdPtr","argsPtr","dataPtr","dataSize","tilePixelWidth","tilePixelHeight","tileTwipWidth","tileTwipHeight","viewId","enabled","colPtr","rowPtr","col","row","mode","optionsPtr","payloadBuffer","payloadLengthPtr","eventType","payloadLength","payload","len","events","event","hasShim","states","eqIndex","key","value","text","rectanglesStr","s","rect","parts","OUTPUT_FORMAT_TO_LOK","FORMAT_FILTER_OPTIONS","OfficeEditor","lok","afterMode","searchArgs","selection","hasMatch","find","replace","_selection","suggestion","truncation","content","maxChars","limit","original","truncated","lastSpace","items","itemToString","charCount","includedCount","item","itemStr","a1","match","colStr","rowStr","c","remainder","ref","WriterEditor","paragraphs","paragraphInfos","index","truncResult","p","structure","w","start","insertIndex","textArgs","styleName","styleArgs","oldText","findReplaceArgs","deletedText","_position","_start","_end","_range","boldState","italicState","underlineState","fontSizeState","size","fontNameState","existingStates","allText","CalcEditor","_options","numSheets","sheets","i","name","dataArea","names","cell","sheet","address","formula","range","startRow","startCol","endRow","endCol","cells","r","rowData","cellData","cellStr","sum","oldValue","valueStr","newValue","expectedStr","calculatedValue","values","cellsUpdated","rowValues","rangeStr","cellsCleared","afterRow","afterCol","colNum","newName","num","hex","ImpressEditor","numSlides","slides","slideData","textFrames","f","newIndex","fromIndex","toIndex","title","oldTitle","body","oldBody","notes","layout","frames","titleFrame","para","idx","layoutId","DrawEditor","numPages","pages","pageInfo","shapes","pageData","shapeType","bounds","shapeCommand","boundsArgs","colorArgs","widthArgs","shapeIndex","newPosition","newSize","LOK_DOCTYPE_TEXT","LOK_DOCTYPE_SPREADSHEET","LOK_DOCTYPE_PRESENTATION","LOK_DOCTYPE_DRAWING","createEditor","PHASE_WEIGHTS","phaseProgress","currentInitRequestId","lastEmittedPercent","calculateTotalProgress","total","phase","percent","formatBytes","emitDownloadProgress","loaded","weight","phasePercent","newProgress","message","emitProgress","emitPhaseProgress","progress","installProgressInterceptors","originalFetch","input","init","url","response","contentLength","reader","stream","controller","done","OriginalXHR","ProgressXMLHttpRequest","xhr","requestUrl","originalOpen","method","originalSend","downloadPhase","e","lokBindings","initialized","cachedDoc","editorSessions","sessionCounter","hashInput","hash","step","getDocumentPageCount","pageRects","getOrLoadDocument","inputData","inputExt","inputHash","closeCachedDocument","filePath","pageCount","postResponse","postProgress","id","handleInit","msg","sofficeJs","sofficeWasm","sofficeData","sofficeWorkerJs","scriptDir","resolve","reject","checkReady","orig","mod","fs","flags","err","IMAGE_FORMATS","handleConvert","outputFormat","password","isImageFormat","inPath","outPath","outputFiles","lokFormat","baseOpts","pageFiles","docWidth","docHeight","exportWidth","exportHeight","pageOutPath","pageOpts","pageCopy","zipData","createSimpleZip","opts","sharedResult","files","chunks","centralDirectory","offset","file","nameBytes","localHeader","view","crc32","cdEntry","cdView","cdOffset","cdSize","entry","eocd","eocdView","totalSize","chunk","pos","crc","byte","j","handleGetPageCount","handleRenderPreviews","maxWidth","previews","rendered","dataCopy","transfers","handleRenderSinglePage","preview","errorMsg","handleRenderPageViaConvert","filterOpts","pngData","pngCopy","handleGetDocumentInfo","docTypeOutputFormats","documentInfo","handleGetLokInfo","pageRectangles","documentSize","partInfo","a11yFocusedParagraph","a11yCaretPosition","editMode","newViewId","parsedPartInfo","parsedA11yParagraph","lokInfo","handleEditText","findText","replaceText","insertText","operationResult","searchErr","results","pasteResult","insertArgs","ext","saveFormat","modifiedData","modifiedCopy","editResult","saveError","errorObj","moduleAny","exMsg","handleRenderPageRectangles","parsedRects","transferBuffers","handleTestLokOperations","selectedText","textLength","selType","selTypeAfterReset","selectedBeforeDelete","textAfterUndo","textAfterRedo","selectedForBold","selectedForItalic","existingCount","countAfterSel","hasEvents","stateChanges","formatInfo","bold","italic","underline","fontName","fontSize","color","coordSelectedText","summary","handleOpenDocument","sessionId","editor","documentType","handleEditorOperation","editorMethod","editorArgs","session","serializedData","handleCloseDocument","handleDestroy"],"mappings":"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","file":"browser.worker.global.js","sourcesContent":["/**\n * LibreOfficeKit Low-Level Bindings\n *\n * This module provides direct access to the LibreOfficeKit C API\n * through the WASM module using the stable lok_* shim exports.\n *\n * Shim functions (C side) should be defined as:\n *   - lok_documentLoad(pKit, pPath)\n *   - lok_documentLoadWithOptions(pKit, pPath, pOptions)\n *   - lok_documentSaveAs(pDoc, pUrl, pFormat, pFilterOptions)\n *   - lok_documentDestroy(pDoc)\n *   - lok_getError(pKit)\n *   - lok_destroy(pKit)          <-- RECOMMENDED to add\n */\n\nimport type { EmscriptenModule } from './types.js';\n\n// Extended module type with our LOK shim exports\ninterface LOKModule extends EmscriptenModule {\n  _lok_documentLoad?: (lok: number, path: number) => number;\n  _lok_documentLoadWithOptions?: (lok: number, path: number, options: number) => number;\n  _lok_documentSaveAs?: (doc: number, url: number, format: number, opts: number) => number;\n  _lok_documentDestroy?: (doc: number) => void;\n  _lok_getError?: (lok: number) => number;\n  _lok_destroy?: (lok: number) => void;\n  // Page rendering shims\n  _lok_documentGetParts?: (doc: number) => number;\n  _lok_documentGetPart?: (doc: number) => number;\n  _lok_documentSetPart?: (doc: number, part: number) => void;\n  _lok_documentGetDocumentType?: (doc: number) => number;\n  _lok_documentGetDocumentSize?: (doc: number, widthPtr: number, heightPtr: number) => void;\n  _lok_documentInitializeForRendering?: (doc: number, args: number) => void;\n  _lok_documentPaintTile?: (\n    doc: number,\n    buffer: number,\n    canvasWidth: number,\n    canvasHeight: number,\n    tilePosX: number,\n    tilePosY: number,\n    tileWidth: number,\n    tileHeight: number\n  ) => void;\n  _lok_documentGetTileMode?: (doc: number) => number;\n  // Text selection and content shims\n  _lok_documentGetTextSelection?: (doc: number, mimeType: number, usedMimeType: number) => number;\n  _lok_documentSetTextSelection?: (doc: number, type: number, x: number, y: number) => void;\n  _lok_documentGetSelectionType?: (doc: number) => number;\n  _lok_documentResetSelection?: (doc: number) => void;\n  // Mouse and keyboard event shims\n  _lok_documentPostMouseEvent?: (doc: number, type: number, x: number, y: number, count: number, buttons: number, modifier: number) => void;\n  _lok_documentPostKeyEvent?: (doc: number, type: number, charCode: number, keyCode: number) => void;\n  // UNO command shims\n  _lok_documentPostUnoCommand?: (doc: number, command: number, args: number, notifyWhenFinished: number) => void;\n  _lok_documentGetCommandValues?: (doc: number, command: number) => number;\n  // Page/Part information shims\n  _lok_documentGetPartPageRectangles?: (doc: number) => number;\n  _lok_documentGetPartInfo?: (doc: number, part: number) => number;\n  _lok_documentGetPartName?: (doc: number, part: number) => number;\n  // Clipboard shims\n  _lok_documentPaste?: (doc: number, mimeType: number, data: number, size: number) => number;\n  // View and zoom shims\n  _lok_documentSetClientZoom?: (doc: number, tilePixelWidth: number, tilePixelHeight: number, tileTwipWidth: number, tileTwipHeight: number) => void;\n  _lok_documentSetClientVisibleArea?: (doc: number, x: number, y: number, width: number, height: number) => void;\n  // Accessibility shims\n  _lok_documentGetA11yFocusedParagraph?: (doc: number) => number;\n  _lok_documentGetA11yCaretPosition?: (doc: number) => number;\n  _lok_documentSetAccessibilityState?: (doc: number, viewId: number, enabled: number) => void;\n  // Spreadsheet-specific shims\n  _lok_documentGetDataArea?: (doc: number, part: number, colPtr: number, rowPtr: number) => void;\n  // Edit mode shim\n  _lok_documentGetEditMode?: (doc: number) => number;\n  _lok_documentSetEditMode?: (doc: number, mode: number) => void;\n  // View management shims\n  _lok_documentCreateView?: (doc: number) => number;\n  _lok_documentCreateViewWithOptions?: (doc: number, options: number) => number;\n  _lok_documentDestroyView?: (doc: number, viewId: number) => void;\n  _lok_documentSetView?: (doc: number, viewId: number) => void;\n  _lok_documentGetView?: (doc: number) => number;\n  _lok_documentGetViewsCount?: (doc: number) => number;\n  // Event loop and callback shims\n  _lok_enableSyncEvents?: () => void;\n  _lok_disableSyncEvents?: () => void;\n  _lok_runLoop?: (lok: number, pollCallback: number, wakeCallback: number, data: number) => void;\n  // Callback queue shims\n  _lok_documentRegisterCallback?: (doc: number) => void;\n  _lok_documentUnregisterCallback?: (doc: number) => void;\n  _lok_hasCallbackEvents?: () => number;\n  _lok_getCallbackEventCount?: () => number;\n  _lok_pollCallback?: (payloadBuffer: number, bufferSize: number, payloadLengthPtr: number) => number;\n  _lok_clearCallbackQueue?: () => void;\n  _lok_flushCallbacks?: (doc: number) => void;\n}\n\n// LOK Mouse Event Types\nexport const LOK_MOUSEEVENT_BUTTONDOWN = 0;\nexport const LOK_MOUSEEVENT_BUTTONUP = 1;\nexport const LOK_MOUSEEVENT_MOVE = 2;\n\n// LOK Key Event Types\nexport const LOK_KEYEVENT_KEYINPUT = 0;\nexport const LOK_KEYEVENT_KEYUP = 1;\n\n// LOK Selection Types\nexport const LOK_SELTYPE_NONE = 0;\nexport const LOK_SELTYPE_TEXT = 1;\nexport const LOK_SELTYPE_CELL = 2;\n\n// LOK Text Selection Types\nexport const LOK_SETTEXTSELECTION_START = 0;\nexport const LOK_SETTEXTSELECTION_END = 1;\nexport const LOK_SETTEXTSELECTION_RESET = 2;\n\n// LOK Document Types\nexport const LOK_DOCTYPE_TEXT = 0;\nexport const LOK_DOCTYPE_SPREADSHEET = 1;\nexport const LOK_DOCTYPE_PRESENTATION = 2;\nexport const LOK_DOCTYPE_DRAWING = 3;\nexport const LOK_DOCTYPE_OTHER = 4;\n\n// LOK Callback Types (from LibreOfficeKitEnums.h)\nexport const LOK_CALLBACK_INVALIDATE_TILES = 0;\nexport const LOK_CALLBACK_INVALIDATE_VISIBLE_CURSOR = 1;\nexport const LOK_CALLBACK_TEXT_SELECTION = 2;\nexport const LOK_CALLBACK_TEXT_SELECTION_START = 3;\nexport const LOK_CALLBACK_TEXT_SELECTION_END = 4;\nexport const LOK_CALLBACK_CURSOR_VISIBLE = 5;\nexport const LOK_CALLBACK_GRAPHIC_SELECTION = 6;\nexport const LOK_CALLBACK_HYPERLINK_CLICKED = 7;\nexport const LOK_CALLBACK_STATE_CHANGED = 8;\nexport const LOK_CALLBACK_STATUS_INDICATOR_START = 9;\nexport const LOK_CALLBACK_STATUS_INDICATOR_SET_VALUE = 10;\nexport const LOK_CALLBACK_STATUS_INDICATOR_FINISH = 11;\nexport const LOK_CALLBACK_SEARCH_NOT_FOUND = 12;\nexport const LOK_CALLBACK_DOCUMENT_SIZE_CHANGED = 13;\nexport const LOK_CALLBACK_SET_PART = 14;\nexport const LOK_CALLBACK_SEARCH_RESULT_SELECTION = 15;\nexport const LOK_CALLBACK_UNO_COMMAND_RESULT = 16;\nexport const LOK_CALLBACK_CELL_CURSOR = 17;\nexport const LOK_CALLBACK_MOUSE_POINTER = 18;\nexport const LOK_CALLBACK_CELL_FORMULA = 19;\nexport const LOK_CALLBACK_DOCUMENT_PASSWORD = 20;\nexport const LOK_CALLBACK_DOCUMENT_PASSWORD_TO_MODIFY = 21;\nexport const LOK_CALLBACK_CONTEXT_MENU = 22;\nexport const LOK_CALLBACK_INVALIDATE_VIEW_CURSOR = 23;\nexport const LOK_CALLBACK_TEXT_VIEW_SELECTION = 24;\nexport const LOK_CALLBACK_CELL_VIEW_CURSOR = 25;\nexport const LOK_CALLBACK_GRAPHIC_VIEW_SELECTION = 26;\nexport const LOK_CALLBACK_VIEW_CURSOR_VISIBLE = 27;\nexport const LOK_CALLBACK_VIEW_LOCK = 28;\nexport const LOK_CALLBACK_REDLINE_TABLE_SIZE_CHANGED = 29;\nexport const LOK_CALLBACK_REDLINE_TABLE_ENTRY_MODIFIED = 30;\nexport const LOK_CALLBACK_COMMENT = 31;\nexport const LOK_CALLBACK_INVALIDATE_HEADER = 32;\nexport const LOK_CALLBACK_CELL_ADDRESS = 33;\n\n// Callback event interface\nexport interface LOKCallbackEvent {\n  type: number;\n  typeName: string;\n  payload: string;\n}\n\n// Map callback type to name\nexport function getCallbackTypeName(type: number): string {\n  const names: Record<number, string> = {\n    [LOK_CALLBACK_INVALIDATE_TILES]: 'INVALIDATE_TILES',\n    [LOK_CALLBACK_INVALIDATE_VISIBLE_CURSOR]: 'INVALIDATE_VISIBLE_CURSOR',\n    [LOK_CALLBACK_TEXT_SELECTION]: 'TEXT_SELECTION',\n    [LOK_CALLBACK_TEXT_SELECTION_START]: 'TEXT_SELECTION_START',\n    [LOK_CALLBACK_TEXT_SELECTION_END]: 'TEXT_SELECTION_END',\n    [LOK_CALLBACK_CURSOR_VISIBLE]: 'CURSOR_VISIBLE',\n    [LOK_CALLBACK_GRAPHIC_SELECTION]: 'GRAPHIC_SELECTION',\n    [LOK_CALLBACK_HYPERLINK_CLICKED]: 'HYPERLINK_CLICKED',\n    [LOK_CALLBACK_STATE_CHANGED]: 'STATE_CHANGED',\n    [LOK_CALLBACK_STATUS_INDICATOR_START]: 'STATUS_INDICATOR_START',\n    [LOK_CALLBACK_STATUS_INDICATOR_SET_VALUE]: 'STATUS_INDICATOR_SET_VALUE',\n    [LOK_CALLBACK_STATUS_INDICATOR_FINISH]: 'STATUS_INDICATOR_FINISH',\n    [LOK_CALLBACK_SEARCH_NOT_FOUND]: 'SEARCH_NOT_FOUND',\n    [LOK_CALLBACK_DOCUMENT_SIZE_CHANGED]: 'DOCUMENT_SIZE_CHANGED',\n    [LOK_CALLBACK_SET_PART]: 'SET_PART',\n    [LOK_CALLBACK_SEARCH_RESULT_SELECTION]: 'SEARCH_RESULT_SELECTION',\n    [LOK_CALLBACK_UNO_COMMAND_RESULT]: 'UNO_COMMAND_RESULT',\n    [LOK_CALLBACK_CELL_CURSOR]: 'CELL_CURSOR',\n    [LOK_CALLBACK_MOUSE_POINTER]: 'MOUSE_POINTER',\n    [LOK_CALLBACK_CELL_FORMULA]: 'CELL_FORMULA',\n    [LOK_CALLBACK_DOCUMENT_PASSWORD]: 'DOCUMENT_PASSWORD',\n    [LOK_CALLBACK_DOCUMENT_PASSWORD_TO_MODIFY]: 'DOCUMENT_PASSWORD_TO_MODIFY',\n    [LOK_CALLBACK_CONTEXT_MENU]: 'CONTEXT_MENU',\n    [LOK_CALLBACK_INVALIDATE_VIEW_CURSOR]: 'INVALIDATE_VIEW_CURSOR',\n    [LOK_CALLBACK_TEXT_VIEW_SELECTION]: 'TEXT_VIEW_SELECTION',\n    [LOK_CALLBACK_CELL_VIEW_CURSOR]: 'CELL_VIEW_CURSOR',\n    [LOK_CALLBACK_GRAPHIC_VIEW_SELECTION]: 'GRAPHIC_VIEW_SELECTION',\n    [LOK_CALLBACK_VIEW_CURSOR_VISIBLE]: 'VIEW_CURSOR_VISIBLE',\n    [LOK_CALLBACK_VIEW_LOCK]: 'VIEW_LOCK',\n    [LOK_CALLBACK_REDLINE_TABLE_SIZE_CHANGED]: 'REDLINE_TABLE_SIZE_CHANGED',\n    [LOK_CALLBACK_REDLINE_TABLE_ENTRY_MODIFIED]: 'REDLINE_TABLE_ENTRY_MODIFIED',\n    [LOK_CALLBACK_COMMENT]: 'COMMENT',\n    [LOK_CALLBACK_INVALIDATE_HEADER]: 'INVALIDATE_HEADER',\n    [LOK_CALLBACK_CELL_ADDRESS]: 'CELL_ADDRESS',\n  };\n  return names[type] || `UNKNOWN(${type})`;\n}\n\n// Fallback offsets for WASM32 (4-byte pointers) if shims not available\nconst LOK_CLASS = {\n  nSize: 0,\n  destroy: 4,\n  documentLoad: 8,\n  getError: 12,\n  documentLoadWithOptions: 16,\n  freeError: 20,\n};\n\nconst DOC_CLASS = {\n  nSize: 0,\n  destroy: 4,\n  saveAs: 8,\n};\n\n// Reuse encoder/decoder\nconst textEncoder = new TextEncoder();\nconst textDecoder = new TextDecoder();\n\nexport class LOKBindings {\n  private module: LOKModule;\n  private lokPtr = 0;\n  private verbose: boolean;\n  private useShims: boolean;\n\n  constructor(module: EmscriptenModule, verbose = false) {\n    this.module = module as LOKModule;\n    this.verbose = verbose;\n\n    this.useShims = typeof this.module._lok_documentLoad === 'function';\n    if (this.useShims) {\n      this.log('Using direct LOK shim exports');\n    } else {\n      this.log('Using vtable traversal (shims not available)');\n    }\n  }\n\n  private log(...args: unknown[]): void {\n    if (this.verbose) {\n      console.log('[LOK]', ...args);\n    }\n  }\n\n  /**\n   * Get fresh heap views (important after memory growth!)\n   */\n  private get HEAPU8(): Uint8Array {\n    return this.module.HEAPU8;\n  }\n\n  private get HEAPU32(): Uint32Array {\n    return this.module.HEAPU32;\n  }\n\n  private get HEAP32(): Int32Array {\n    return this.module.HEAP32;\n  }\n\n  /**\n   * Allocate a null-terminated string in WASM memory\n   */\n  allocString(str: string): number {\n    const bytes = textEncoder.encode(str + '\\0');\n    const ptr = this.module._malloc(bytes.length);\n    // Always get fresh heap view after malloc (might have grown memory)\n    this.HEAPU8.set(bytes, ptr);\n    return ptr;\n  }\n\n  /**\n   * Read a null-terminated string from WASM memory\n   */\n  readString(ptr: number): string | null {\n    if (ptr === 0) return null;\n    // Always get fresh heap view\n    const heap = this.HEAPU8;\n    let end = ptr;\n    while (heap[end] !== 0) end++;\n    // Copy the data to avoid SharedArrayBuffer issues in browsers\n    // TextDecoder.decode() doesn't accept SharedArrayBuffer views in some browsers\n    const slice = heap.slice(ptr, end);\n    return textDecoder.decode(slice);\n  }\n\n  /**\n   * Read a 32-bit pointer from memory (unsigned)\n   */\n  readPtr(addr: number): number {\n    // Always get fresh heap view\n    return this.HEAPU32[addr >> 2] || 0;\n  }\n\n  /**\n   * Get a function from the WASM table (fallback for vtable traversal)\n   */\n  private getFunc<T>(ptr: number): T {\n    const wasmTable = this.module.wasmTable as WebAssembly.Table;\n    return wasmTable.get(ptr) as T;\n  }\n\n  /**\n   * Initialize LibreOfficeKit\n   */\n  initialize(installPath: string = '/instdir/program'): void {\n    this.log('Initializing with path:', installPath);\n    const pathPtr = this.allocString(installPath);\n\n    try {\n      const hook = (this.module as any)._libreofficekit_hook as\n        | ((pathPtr: number) => number)\n        | undefined;\n\n      if (typeof hook !== 'function') {\n        throw new Error('libreofficekit_hook export not found on module');\n      }\n\n      this.lokPtr = hook(pathPtr);\n\n      if (this.lokPtr === 0) {\n        throw new Error('Failed to initialize LibreOfficeKit');\n      }\n\n      this.log('LOK initialized, ptr:', this.lokPtr);\n    } finally {\n      this.module._free(pathPtr);\n    }\n  }\n\n  /**\n   * Get the last error message\n   */\n  getError(): string | null {\n    if (this.lokPtr === 0) return null;\n\n    // Prefer shim\n    if (this.useShims && this.module._lok_getError) {\n      const errPtr = this.module._lok_getError(this.lokPtr);\n      return this.readString(errPtr);\n    }\n\n    // Fallback: vtable traversal\n    const lokClassPtr = this.readPtr(this.lokPtr);\n    const getErrorPtr = this.readPtr(lokClassPtr + LOK_CLASS.getError);\n    if (getErrorPtr === 0) return null;\n\n    const getError = this.getFunc<(lok: number) => number>(getErrorPtr);\n    const errPtr = getError(this.lokPtr);\n    return this.readString(errPtr);\n  }\n\n  /**\n   * Get version info\n   */\n  getVersionInfo(): string | null {\n    return 'LibreOffice WASM';\n  }\n\n  /**\n   * Convert a filesystem path to a file:// URL\n   * Required by LibreOffice's getAbsoluteURL() which uses rtl::Uri::convertRelToAbs()\n   */\n  private toFileUrl(path: string): string {\n    if (path.startsWith('file://')) return path;\n    const absolutePath = path.startsWith('/') ? path : '/' + path;\n    return 'file://' + absolutePath;\n  }\n\n  /**\n   * Load a document from the virtual filesystem\n   */\n  documentLoad(path: string): number {\n    if (this.lokPtr === 0) {\n      throw new Error('LOK not initialized');\n    }\n\n    const fileUrl = this.toFileUrl(path);\n    this.log('Loading document:', path, '->', fileUrl);\n    const pathPtr = this.allocString(fileUrl);\n\n    try {\n      const startTime = Date.now();\n      let docPtr: number;\n\n      if (this.useShims && this.module._lok_documentLoad) {\n        // Use direct shim export\n        docPtr = this.module._lok_documentLoad(this.lokPtr, pathPtr);\n      } else {\n        // Fallback: vtable traversal\n        const lokClassPtr = this.readPtr(this.lokPtr);\n        const documentLoadPtr = this.readPtr(lokClassPtr + LOK_CLASS.documentLoad);\n        const documentLoad = this.getFunc<(lok: number, path: number) => number>(documentLoadPtr);\n        docPtr = documentLoad(this.lokPtr, pathPtr);\n      }\n\n      this.log('Document loaded in', Date.now() - startTime, 'ms, ptr:', docPtr);\n\n      if (docPtr === 0) {\n        const error = this.getError();\n        throw new Error(`Failed to load document: ${error || 'unknown error'}`);\n      }\n\n      return docPtr;\n    } finally {\n      this.module._free(pathPtr);\n    }\n  }\n\n  /**\n   * Load a document with options\n   */\n  documentLoadWithOptions(path: string, options: string): number {\n    if (this.lokPtr === 0) {\n      throw new Error('LOK not initialized');\n    }\n\n    const fileUrl = this.toFileUrl(path);\n    this.log('Loading document with options:', path, '->', fileUrl, options);\n    const pathPtr = this.allocString(fileUrl);\n    const optsPtr = this.allocString(options);\n\n    try {\n      let docPtr: number;\n\n      if (this.useShims && this.module._lok_documentLoadWithOptions) {\n        // Use direct shim export\n        docPtr = this.module._lok_documentLoadWithOptions(this.lokPtr, pathPtr, optsPtr);\n      } else {\n        // Fallback: vtable traversal\n        const lokClassPtr = this.readPtr(this.lokPtr);\n        const loadWithOptsPtr = this.readPtr(lokClassPtr + LOK_CLASS.documentLoadWithOptions);\n\n        if (loadWithOptsPtr === 0) {\n          // No special method - fall back to plain load\n          return this.documentLoad(path);\n        }\n\n        const loadWithOpts = this.getFunc<\n          (lok: number, path: number, opts: number) => number\n        >(loadWithOptsPtr);\n        docPtr = loadWithOpts(this.lokPtr, pathPtr, optsPtr);\n      }\n\n      if (docPtr === 0) {\n        const error = this.getError();\n        throw new Error(`Failed to load document: ${error || 'unknown error'}`);\n      }\n\n      this.log('Document loaded, ptr:', docPtr);\n      return docPtr;\n    } finally {\n      this.module._free(pathPtr);\n      this.module._free(optsPtr);\n    }\n  }\n\n  /**\n   * Save a document to a different format\n   */\n  documentSaveAs(\n    docPtr: number,\n    outputPath: string,\n    format: string,\n    filterOptions: string = ''\n  ): void {\n    if (docPtr === 0) {\n      throw new Error('Invalid document pointer');\n    }\n\n    const fileUrl = this.toFileUrl(outputPath);\n    this.log('Saving document to:', outputPath, '->', fileUrl, 'format:', format);\n\n    const urlPtr = this.allocString(fileUrl);\n    const formatPtr = this.allocString(format);\n    const optsPtr = this.allocString(filterOptions);\n\n    try {\n      let result: number;\n\n      if (this.useShims && this.module._lok_documentSaveAs) {\n        // Use direct shim export\n        result = this.module._lok_documentSaveAs(docPtr, urlPtr, formatPtr, optsPtr);\n      } else {\n        // Fallback: vtable traversal\n        const docClassPtr = this.readPtr(docPtr);\n        const saveAsPtr = this.readPtr(docClassPtr + DOC_CLASS.saveAs);\n        const saveAs = this.getFunc<\n          (doc: number, url: number, format: number, opts: number) => number\n        >(saveAsPtr);\n        result = saveAs(docPtr, urlPtr, formatPtr, optsPtr);\n      }\n\n      this.log('Save result:', result);\n\n      if (result === 0) {\n        throw new Error('Failed to save document');\n      }\n    } finally {\n      this.module._free(urlPtr);\n      this.module._free(formatPtr);\n      this.module._free(optsPtr);\n    }\n  }\n\n  /**\n   * Destroy a document\n   */\n  documentDestroy(docPtr: number): void {\n    if (docPtr === 0) return;\n\n    if (this.useShims && this.module._lok_documentDestroy) {\n      // Use direct shim export\n      this.module._lok_documentDestroy(docPtr);\n      this.log('Document destroyed (via shim)');\n      return;\n    }\n\n    // Fallback: vtable traversal\n    const docClassPtr = this.readPtr(docPtr);\n    const destroyPtr = this.readPtr(docClassPtr + DOC_CLASS.destroy);\n\n    if (destroyPtr !== 0) {\n      const destroy = this.getFunc<(doc: number) => void>(destroyPtr);\n      destroy(docPtr);\n      this.log('Document destroyed (via vtable)');\n    }\n  }\n\n  /**\n   * Destroy the LOK instance\n   */\n  destroy(): void {\n    if (this.lokPtr === 0) return;\n\n    try {\n      // Prefer C shim if available\n      if (this.useShims && this.module._lok_destroy) {\n        this.module._lok_destroy(this.lokPtr);\n        this.log('LOK destroyed (via shim)');\n      } else {\n        // Fallback: vtable traversal\n        const lokClassPtr = this.readPtr(this.lokPtr);\n        const destroyPtr = this.readPtr(lokClassPtr + LOK_CLASS.destroy);\n\n        if (destroyPtr !== 0) {\n          const destroy = this.getFunc<(lok: number) => void>(destroyPtr);\n          destroy(this.lokPtr);\n          this.log('LOK destroyed (via vtable)');\n        }\n      }\n    } catch (error) {\n      this.log('LOK destroy error (ignored):', error);\n    }\n\n    this.lokPtr = 0;\n  }\n\n  /**\n   * Check if LOK is initialized\n   */\n  isInitialized(): boolean {\n    return this.lokPtr !== 0;\n  }\n\n  /**\n   * Check if using direct shim exports\n   */\n  isUsingShims(): boolean {\n    return this.useShims;\n  }\n\n  // ==========================================\n  // Page Rendering Methods\n  // ==========================================\n\n  /**\n   * Get the number of parts (pages/slides) in a document\n   */\n  documentGetParts(docPtr: number): number {\n    if (docPtr === 0) {\n      throw new Error('Invalid document pointer');\n    }\n\n    if (this.useShims && this.module._lok_documentGetParts) {\n      return this.module._lok_documentGetParts(docPtr);\n    }\n\n    // Fallback not implemented - would need vtable offsets\n    this.log('documentGetParts: shim not available');\n    return 0;\n  }\n\n  /**\n   * Get the current part (page/slide) index\n   */\n  documentGetPart(docPtr: number): number {\n    if (docPtr === 0) {\n      throw new Error('Invalid document pointer');\n    }\n\n    if (this.useShims && this.module._lok_documentGetPart) {\n      return this.module._lok_documentGetPart(docPtr);\n    }\n\n    this.log('documentGetPart: shim not available');\n    return 0;\n  }\n\n  /**\n   * Set the current part (page/slide) index\n   */\n  documentSetPart(docPtr: number, part: number): void {\n    if (docPtr === 0) {\n      throw new Error('Invalid document pointer');\n    }\n\n    if (this.useShims && this.module._lok_documentSetPart) {\n      this.module._lok_documentSetPart(docPtr, part);\n      return;\n    }\n\n    this.log('documentSetPart: shim not available');\n  }\n\n  /**\n   * Get document type (0=text, 1=spreadsheet, 2=presentation, 3=drawing)\n   */\n  documentGetDocumentType(docPtr: number): number {\n    if (docPtr === 0) {\n      throw new Error('Invalid document pointer');\n    }\n\n    if (this.useShims && this.module._lok_documentGetDocumentType) {\n      return this.module._lok_documentGetDocumentType(docPtr);\n    }\n\n    this.log('documentGetDocumentType: shim not available');\n    return 0;\n  }\n\n  /**\n   * Get document size in twips (1/1440 inch)\n   */\n  documentGetDocumentSize(docPtr: number): { width: number; height: number } {\n    this.log(`documentGetDocumentSize called with docPtr: ${docPtr}`);\n    if (docPtr === 0) {\n      throw new Error('Invalid document pointer');\n    }\n\n    if (this.useShims && this.module._lok_documentGetDocumentSize) {\n      // Allocate space for two longs (32-bit on WASM)\n      const sizePtr = this.module._malloc(8);\n      try {\n        this.module._lok_documentGetDocumentSize(docPtr, sizePtr, sizePtr + 4);\n        const width = this.HEAP32[sizePtr >> 2] ?? 0;\n        const height = this.HEAP32[(sizePtr + 4) >> 2] ?? 0;\n        this.log(`documentGetDocumentSize: ${width}x${height} twips`);\n        return { width, height };\n      } finally {\n        this.module._free(sizePtr);\n      }\n    }\n\n    this.log('documentGetDocumentSize: shim not available');\n    return { width: 0, height: 0 };\n  }\n\n  /**\n   * Initialize document for rendering\n   */\n  documentInitializeForRendering(docPtr: number, options: string = ''): void {\n    if (docPtr === 0) {\n      throw new Error('Invalid document pointer');\n    }\n\n    if (this.useShims && this.module._lok_documentInitializeForRendering) {\n      const optsPtr = this.allocString(options);\n      try {\n        this.module._lok_documentInitializeForRendering(docPtr, optsPtr);\n      } finally {\n        this.module._free(optsPtr);\n      }\n      return;\n    }\n\n    this.log('documentInitializeForRendering: shim not available');\n  }\n\n  /**\n   * Paint a tile of the document to a buffer\n   * @param docPtr Document pointer\n   * @param canvasWidth Output width in pixels\n   * @param canvasHeight Output height in pixels\n   * @param tilePosX X position in twips\n   * @param tilePosY Y position in twips\n   * @param tileWidth Width in twips\n   * @param tileHeight Height in twips\n   * @returns RGBA pixel data\n   */\n  documentPaintTile(\n    docPtr: number,\n    canvasWidth: number,\n    canvasHeight: number,\n    tilePosX: number,\n    tilePosY: number,\n    tileWidth: number,\n    tileHeight: number\n  ): Uint8Array {\n    if (docPtr === 0) {\n      throw new Error('Invalid document pointer');\n    }\n\n    if (this.useShims && this.module._lok_documentPaintTile) {\n      // Allocate RGBA buffer (4 bytes per pixel)\n      const bufferSize = canvasWidth * canvasHeight * 4;\n      const bufferPtr = this.module._malloc(bufferSize);\n\n      if (bufferPtr === 0) {\n        throw new Error(`Failed to allocate ${bufferSize} bytes for tile buffer`);\n      }\n\n      try {\n        this.module._lok_documentPaintTile(\n          docPtr,\n          bufferPtr,\n          canvasWidth,\n          canvasHeight,\n          tilePosX,\n          tilePosY,\n          tileWidth,\n          tileHeight\n        );\n\n        // Copy data out of WASM memory\n        const result = new Uint8Array(bufferSize);\n        result.set(this.HEAPU8.subarray(bufferPtr, bufferPtr + bufferSize));\n        return result;\n      } finally {\n        this.module._free(bufferPtr);\n      }\n    }\n\n    this.log('documentPaintTile: shim not available');\n    return new Uint8Array(0);\n  }\n\n  /**\n   * Get tile mode (0=RGBA, 1=BGRA)\n   */\n  documentGetTileMode(docPtr: number): number {\n    if (docPtr === 0) {\n      throw new Error('Invalid document pointer');\n    }\n\n    if (this.useShims && this.module._lok_documentGetTileMode) {\n      return this.module._lok_documentGetTileMode(docPtr);\n    }\n\n    this.log('documentGetTileMode: shim not available');\n    return 0; // Default to RGBA\n  }\n\n  /**\n   * Render a page/slide to an image\n   * @param docPtr Document pointer\n   * @param pageIndex Page/slide index (0-based)\n   * @param width Output width in pixels\n   * @param height Output height in pixels (0 = auto based on aspect ratio)\n   * @returns RGBA pixel data and dimensions\n   */\n  renderPage(\n    docPtr: number,\n    pageIndex: number,\n    width: number,\n    height: number = 0\n  ): { data: Uint8Array; width: number; height: number } {\n    // Initialize for rendering if not already done\n    this.documentInitializeForRendering(docPtr);\n\n    // Get document type to determine rendering strategy\n    const docType = this.documentGetDocumentType(docPtr);\n    \n    // For presentations and drawings, use setPart to select the slide/page\n    // For text documents, we need to use page rectangles\n    if (docType === 2 || docType === 3) { // PRESENTATION or DRAWING\n      console.log(`[LOK] Setting part to ${pageIndex} for presentation/drawing`);\n      this.documentSetPart(docPtr, pageIndex);\n      const currentPart = this.documentGetPart(docPtr);\n      console.log(`[LOK] Current part after setPart: ${currentPart}`);\n    }\n\n    // Get document/page size in twips\n    const docSize = this.documentGetDocumentSize(docPtr);\n    this.log('Document size (twips):', docSize);\n\n    if (docSize.width === 0 || docSize.height === 0) {\n      throw new Error('Failed to get document size');\n    }\n\n    // For text documents, get page rectangles to find the specific page\n    let tilePosX = 0;\n    let tilePosY = 0;\n    let tileWidth = docSize.width;\n    let tileHeight = docSize.height;\n\n    if (docType === 0 || docType === 1) { // TEXT or SPREADSHEET\n      // Get page rectangles to find the Y offset for this page\n      const pageRectsStr = this.getPartPageRectangles(docPtr);\n      if (pageRectsStr) {\n        const pageRects = this.parsePageRectangles(pageRectsStr);\n        const pageRect = pageRects[pageIndex];\n        if (pageRect) {\n          tilePosX = pageRect.x;\n          tilePosY = pageRect.y;\n          tileWidth = pageRect.width;\n          tileHeight = pageRect.height;\n          this.log(`Page ${pageIndex} rectangle:`, pageRect);\n        }\n      }\n    }\n\n    // Calculate output dimensions maintaining aspect ratio\n    const aspectRatio = tileHeight / tileWidth;\n    const outputWidth = width;\n    const outputHeight = height > 0 ? height : Math.round(width * aspectRatio);\n\n    console.log(`[LOK] Calling paintTile: ${outputWidth}x${outputHeight} from tile pos (${tilePosX}, ${tilePosY}) size (${tileWidth}x${tileHeight})`);\n\n    // Paint the tile for this specific page\n    const data = this.documentPaintTile(\n      docPtr,\n      outputWidth,\n      outputHeight,\n      tilePosX,\n      tilePosY,\n      tileWidth,\n      tileHeight\n    );\n\n    console.log(`[LOK] paintTile returned ${data.length} bytes`);\n    return { data, width: outputWidth, height: outputHeight };\n  }\n\n  // ==========================================\n  // Text Selection and Content Methods\n  // ==========================================\n\n  /**\n   * Get currently selected text\n   * @param docPtr Document pointer\n   * @param mimeType Desired MIME type. Must include charset, e.g., 'text/plain;charset=utf-8'\n   *                 Note: 'text/plain' without charset is NOT supported by LOK\n   * @returns Selected text or null\n   */\n  getTextSelection(docPtr: number, mimeType: string = 'text/plain;charset=utf-8'): string | null {\n    if (docPtr === 0) throw new Error('Invalid document pointer');\n\n    if (this.useShims && this.module._lok_documentGetTextSelection) {\n      const mimePtr = this.allocString(mimeType);\n      const usedMimePtr = this.module._malloc(4); // pointer to char*\n      try {\n        const resultPtr = this.module._lok_documentGetTextSelection(docPtr, mimePtr, usedMimePtr);\n        if (resultPtr === 0) return null;\n        const result = this.readString(resultPtr);\n        this.module._free(resultPtr);\n        return result;\n      } finally {\n        this.module._free(mimePtr);\n        this.module._free(usedMimePtr);\n      }\n    }\n\n    this.log('getTextSelection: shim not available');\n    return null;\n  }\n\n  /**\n   * Set text selection at coordinates\n   * @param docPtr Document pointer\n   * @param type Selection type (LOK_SETTEXTSELECTION_START, END, or RESET)\n   * @param x X coordinate in twips\n   * @param y Y coordinate in twips\n   */\n  setTextSelection(docPtr: number, type: number, x: number, y: number): void {\n    if (docPtr === 0) throw new Error('Invalid document pointer');\n\n    if (this.useShims && this.module._lok_documentSetTextSelection) {\n      this.module._lok_documentSetTextSelection(docPtr, type, x, y);\n      return;\n    }\n\n    this.log('setTextSelection: shim not available');\n  }\n\n  /**\n   * Get current selection type\n   * @param docPtr Document pointer\n   * @returns Selection type (LOK_SELTYPE_NONE, TEXT, or CELL)\n   */\n  getSelectionType(docPtr: number): number {\n    if (docPtr === 0) throw new Error('Invalid document pointer');\n\n    if (this.useShims && this.module._lok_documentGetSelectionType) {\n      return this.module._lok_documentGetSelectionType(docPtr);\n    }\n\n    this.log('getSelectionType: shim not available');\n    return 0;\n  }\n\n  /**\n   * Reset/clear current selection\n   * @param docPtr Document pointer\n   */\n  resetSelection(docPtr: number): void {\n    if (docPtr === 0) throw new Error('Invalid document pointer');\n\n    if (this.useShims && this.module._lok_documentResetSelection) {\n      this.module._lok_documentResetSelection(docPtr);\n      return;\n    }\n\n    this.log('resetSelection: shim not available');\n  }\n\n  // ==========================================\n  // Mouse and Keyboard Event Methods\n  // ==========================================\n\n  /**\n   * Post a mouse event to the document\n   * @param docPtr Document pointer\n   * @param type Event type (LOK_MOUSEEVENT_BUTTONDOWN, BUTTONUP, MOVE)\n   * @param x X coordinate in twips\n   * @param y Y coordinate in twips\n   * @param count Click count (1 for single, 2 for double click)\n   * @param buttons Button mask (1=left, 2=middle, 4=right)\n   * @param modifier Modifier keys mask\n   */\n  postMouseEvent(\n    docPtr: number,\n    type: number,\n    x: number,\n    y: number,\n    count: number = 1,\n    buttons: number = 1,\n    modifier: number = 0\n  ): void {\n    if (docPtr === 0) throw new Error('Invalid document pointer');\n\n    if (this.useShims && this.module._lok_documentPostMouseEvent) {\n      this.module._lok_documentPostMouseEvent(docPtr, type, x, y, count, buttons, modifier);\n      return;\n    }\n\n    this.log('postMouseEvent: shim not available');\n  }\n\n  /**\n   * Post a keyboard event to the document\n   * @param docPtr Document pointer\n   * @param type Event type (LOK_KEYEVENT_KEYINPUT, KEYUP)\n   * @param charCode Character code\n   * @param keyCode Key code\n   */\n  postKeyEvent(docPtr: number, type: number, charCode: number, keyCode: number): void {\n    if (docPtr === 0) throw new Error('Invalid document pointer');\n\n    if (this.useShims && this.module._lok_documentPostKeyEvent) {\n      this.module._lok_documentPostKeyEvent(docPtr, type, charCode, keyCode);\n      return;\n    }\n\n    this.log('postKeyEvent: shim not available');\n  }\n\n  // ==========================================\n  // UNO Command Methods\n  // ==========================================\n\n  /**\n   * Execute a UNO command\n   * @param docPtr Document pointer\n   * @param command UNO command (e.g., '.uno:SelectAll', '.uno:Copy')\n   * @param args JSON arguments string\n   * @param notifyWhenFinished Whether to notify when command completes\n   */\n  postUnoCommand(\n    docPtr: number,\n    command: string,\n    args: string = '{}',\n    notifyWhenFinished: boolean = false\n  ): void {\n    if (docPtr === 0) throw new Error('Invalid document pointer');\n\n    if (this.useShims && this.module._lok_documentPostUnoCommand) {\n      const cmdPtr = this.allocString(command);\n      const argsPtr = this.allocString(args);\n      try {\n        this.module._lok_documentPostUnoCommand(docPtr, cmdPtr, argsPtr, notifyWhenFinished ? 1 : 0);\n      } finally {\n        this.module._free(cmdPtr);\n        this.module._free(argsPtr);\n      }\n      return;\n    }\n\n    this.log('postUnoCommand: shim not available');\n  }\n\n  /**\n   * Get command values (query document state)\n   * @param docPtr Document pointer\n   * @param command Command to query (e.g., '.uno:CharFontName')\n   * @returns JSON string with command values\n   */\n  getCommandValues(docPtr: number, command: string): string | null {\n    if (docPtr === 0) throw new Error('Invalid document pointer');\n\n    if (this.useShims && this.module._lok_documentGetCommandValues) {\n      const cmdPtr = this.allocString(command);\n      try {\n        const resultPtr = this.module._lok_documentGetCommandValues(docPtr, cmdPtr);\n        if (resultPtr === 0) return null;\n        const result = this.readString(resultPtr);\n        this.module._free(resultPtr);\n        return result;\n      } finally {\n        this.module._free(cmdPtr);\n      }\n    }\n\n    this.log('getCommandValues: shim not available');\n    return null;\n  }\n\n  // ==========================================\n  // Page/Part Information Methods\n  // ==========================================\n\n  /**\n   * Get bounding rectangles for all pages\n   * @param docPtr Document pointer\n   * @returns String with rectangles \"x,y,width,height;x,y,width,height;...\"\n   */\n  getPartPageRectangles(docPtr: number): string | null {\n    this.log(`getPartPageRectangles called with docPtr: ${docPtr}`);\n    if (docPtr === 0) throw new Error('Invalid document pointer');\n\n    if (this.useShims && this.module._lok_documentGetPartPageRectangles) {\n      this.log('getPartPageRectangles: using shim');\n      const resultPtr = this.module._lok_documentGetPartPageRectangles(docPtr);\n      this.log(`getPartPageRectangles: resultPtr=${resultPtr}`);\n      if (resultPtr === 0) return null;\n      const result = this.readString(resultPtr);\n      this.log(`getPartPageRectangles: result=\"${result?.slice(0, 100)}...\"`);\n      this.module._free(resultPtr);\n      return result;\n    }\n\n    this.log('getPartPageRectangles: shim not available');\n    return null;\n  }\n\n  /**\n   * Get information about a page/slide\n   * @param docPtr Document pointer\n   * @param part Part index\n   * @returns JSON string with part info\n   */\n  getPartInfo(docPtr: number, part: number): string | null {\n    if (docPtr === 0) throw new Error('Invalid document pointer');\n\n    if (this.useShims && this.module._lok_documentGetPartInfo) {\n      const resultPtr = this.module._lok_documentGetPartInfo(docPtr, part);\n      if (resultPtr === 0) return null;\n      const result = this.readString(resultPtr);\n      this.module._free(resultPtr);\n      return result;\n    }\n\n    this.log('getPartInfo: shim not available');\n    return null;\n  }\n\n  /**\n   * Get name of a page/slide\n   * @param docPtr Document pointer\n   * @param part Part index\n   * @returns Part name\n   */\n  getPartName(docPtr: number, part: number): string | null {\n    if (docPtr === 0) throw new Error('Invalid document pointer');\n\n    if (this.useShims && this.module._lok_documentGetPartName) {\n      const resultPtr = this.module._lok_documentGetPartName(docPtr, part);\n      if (resultPtr === 0) return null;\n      const result = this.readString(resultPtr);\n      this.module._free(resultPtr);\n      return result;\n    }\n\n    this.log('getPartName: shim not available');\n    return null;\n  }\n\n  // ==========================================\n  // Clipboard Methods\n  // ==========================================\n\n  /**\n   * Paste content at current cursor position\n   * @param docPtr Document pointer\n   * @param mimeType MIME type of data\n   * @param data Data to paste\n   * @returns true if successful\n   */\n  paste(docPtr: number, mimeType: string, data: string | Uint8Array): boolean {\n    if (docPtr === 0) throw new Error('Invalid document pointer');\n\n    if (this.useShims && this.module._lok_documentPaste) {\n      const mimePtr = this.allocString(mimeType);\n      let dataPtr: number;\n      let dataSize: number;\n\n      if (typeof data === 'string') {\n        const bytes = new TextEncoder().encode(data);\n        dataSize = bytes.length;\n        dataPtr = this.module._malloc(dataSize);\n        this.HEAPU8.set(bytes, dataPtr);\n      } else {\n        dataSize = data.length;\n        dataPtr = this.module._malloc(dataSize);\n        this.HEAPU8.set(data, dataPtr);\n      }\n\n      try {\n        return this.module._lok_documentPaste(docPtr, mimePtr, dataPtr, dataSize) !== 0;\n      } finally {\n        this.module._free(mimePtr);\n        this.module._free(dataPtr);\n      }\n    }\n\n    this.log('paste: shim not available');\n    return false;\n  }\n\n  // ==========================================\n  // View and Zoom Methods\n  // ==========================================\n\n  /**\n   * Set client zoom level\n   * @param docPtr Document pointer\n   * @param tilePixelWidth Tile width in pixels\n   * @param tilePixelHeight Tile height in pixels\n   * @param tileTwipWidth Tile width in twips\n   * @param tileTwipHeight Tile height in twips\n   */\n  setClientZoom(\n    docPtr: number,\n    tilePixelWidth: number,\n    tilePixelHeight: number,\n    tileTwipWidth: number,\n    tileTwipHeight: number\n  ): void {\n    if (docPtr === 0) throw new Error('Invalid document pointer');\n\n    if (this.useShims && this.module._lok_documentSetClientZoom) {\n      this.module._lok_documentSetClientZoom(docPtr, tilePixelWidth, tilePixelHeight, tileTwipWidth, tileTwipHeight);\n      return;\n    }\n\n    this.log('setClientZoom: shim not available');\n  }\n\n  /**\n   * Set visible area for the client\n   * @param docPtr Document pointer\n   * @param x X position in twips\n   * @param y Y position in twips\n   * @param width Width in twips\n   * @param height Height in twips\n   */\n  setClientVisibleArea(docPtr: number, x: number, y: number, width: number, height: number): void {\n    if (docPtr === 0) throw new Error('Invalid document pointer');\n\n    if (this.useShims && this.module._lok_documentSetClientVisibleArea) {\n      this.module._lok_documentSetClientVisibleArea(docPtr, x, y, width, height);\n      return;\n    }\n\n    this.log('setClientVisibleArea: shim not available');\n  }\n\n  // ==========================================\n  // Accessibility Methods\n  // ==========================================\n\n  /**\n   * Get the currently focused paragraph text\n   * @param docPtr Document pointer\n   * @returns Focused paragraph text\n   */\n  getA11yFocusedParagraph(docPtr: number): string | null {\n    if (docPtr === 0) throw new Error('Invalid document pointer');\n\n    if (this.useShims && this.module._lok_documentGetA11yFocusedParagraph) {\n      const resultPtr = this.module._lok_documentGetA11yFocusedParagraph(docPtr);\n      if (resultPtr === 0) return null;\n      const result = this.readString(resultPtr);\n      this.module._free(resultPtr);\n      return result;\n    }\n\n    this.log('getA11yFocusedParagraph: shim not available');\n    return null;\n  }\n\n  /**\n   * Get caret position in focused paragraph\n   * @param docPtr Document pointer\n   * @returns Caret position or -1\n   */\n  getA11yCaretPosition(docPtr: number): number {\n    if (docPtr === 0) throw new Error('Invalid document pointer');\n\n    if (this.useShims && this.module._lok_documentGetA11yCaretPosition) {\n      return this.module._lok_documentGetA11yCaretPosition(docPtr);\n    }\n\n    this.log('getA11yCaretPosition: shim not available');\n    return -1;\n  }\n\n  /**\n   * Enable/disable accessibility features\n   * @param docPtr Document pointer\n   * @param viewId View ID\n   * @param enabled Whether to enable accessibility\n   */\n  setAccessibilityState(docPtr: number, viewId: number, enabled: boolean): void {\n    if (docPtr === 0) throw new Error('Invalid document pointer');\n\n    if (this.useShims && this.module._lok_documentSetAccessibilityState) {\n      this.module._lok_documentSetAccessibilityState(docPtr, viewId, enabled ? 1 : 0);\n      return;\n    }\n\n    this.log('setAccessibilityState: shim not available');\n  }\n\n  // ==========================================\n  // Spreadsheet-Specific Methods\n  // ==========================================\n\n  /**\n   * Get data area for a spreadsheet (last used row/column)\n   * @param docPtr Document pointer\n   * @param part Sheet index\n   * @returns Object with col and row counts\n   */\n  getDataArea(docPtr: number, part: number): { col: number; row: number } {\n    if (docPtr === 0) throw new Error('Invalid document pointer');\n\n    if (this.useShims && this.module._lok_documentGetDataArea) {\n      const colPtr = this.module._malloc(8);\n      const rowPtr = this.module._malloc(8);\n      try {\n        this.module._lok_documentGetDataArea(docPtr, part, colPtr, rowPtr);\n        const col = this.HEAP32[colPtr >> 2] ?? 0;\n        const row = this.HEAP32[rowPtr >> 2] ?? 0;\n        return { col, row };\n      } finally {\n        this.module._free(colPtr);\n        this.module._free(rowPtr);\n      }\n    }\n\n    this.log('getDataArea: shim not available');\n    return { col: 0, row: 0 };\n  }\n\n  // ==========================================\n  // Edit Mode Methods\n  // ==========================================\n\n  /**\n   * Get current edit mode\n   * @param docPtr Document pointer\n   * @returns Edit mode value\n   */\n  getEditMode(docPtr: number): number {\n    if (docPtr === 0) throw new Error('Invalid document pointer');\n\n    if (this.useShims && this.module._lok_documentGetEditMode) {\n      return this.module._lok_documentGetEditMode(docPtr);\n    }\n\n    this.log('getEditMode: shim not available');\n    return 0;\n  }\n\n  /**\n   * Set edit mode for the document\n   * @param docPtr Document pointer\n   * @param mode 0 for view mode, 1 for edit mode\n   */\n  setEditMode(docPtr: number, mode: number): void {\n    if (docPtr === 0) throw new Error('Invalid document pointer');\n\n    if (this.useShims && this.module._lok_documentSetEditMode) {\n      this.log(`setEditMode: setting mode to ${mode}`);\n      this.module._lok_documentSetEditMode(docPtr, mode);\n      return;\n    }\n\n    this.log('setEditMode: shim not available');\n  }\n\n  // ==========================================\n  // View Management Methods\n  // ==========================================\n\n  /**\n   * Create a new view for the document\n   * @param docPtr Document pointer\n   * @returns View ID\n   */\n  createView(docPtr: number): number {\n    if (docPtr === 0) throw new Error('Invalid document pointer');\n\n    if (this.useShims && this.module._lok_documentCreateView) {\n      const viewId = this.module._lok_documentCreateView(docPtr);\n      this.log(`createView: created view ${viewId}`);\n      return viewId;\n    }\n\n    this.log('createView: shim not available');\n    return -1;\n  }\n\n  /**\n   * Create a new view with options\n   * @param docPtr Document pointer\n   * @param options Options string (JSON)\n   * @returns View ID\n   */\n  createViewWithOptions(docPtr: number, options: string): number {\n    if (docPtr === 0) throw new Error('Invalid document pointer');\n\n    if (this.useShims && this.module._lok_documentCreateViewWithOptions) {\n      const optionsPtr = this.allocString(options);\n      try {\n        const viewId = this.module._lok_documentCreateViewWithOptions(docPtr, optionsPtr);\n        this.log(`createViewWithOptions: created view ${viewId}`);\n        return viewId;\n      } finally {\n        this.module._free(optionsPtr);\n      }\n    }\n\n    this.log('createViewWithOptions: shim not available');\n    return -1;\n  }\n\n  /**\n   * Destroy a view\n   * @param docPtr Document pointer\n   * @param viewId View ID to destroy\n   */\n  destroyView(docPtr: number, viewId: number): void {\n    if (docPtr === 0) throw new Error('Invalid document pointer');\n\n    if (this.useShims && this.module._lok_documentDestroyView) {\n      this.log(`destroyView: destroying view ${viewId}`);\n      this.module._lok_documentDestroyView(docPtr, viewId);\n      return;\n    }\n\n    this.log('destroyView: shim not available');\n  }\n\n  /**\n   * Set the current active view\n   * @param docPtr Document pointer\n   * @param viewId View ID to make active\n   */\n  setView(docPtr: number, viewId: number): void {\n    if (docPtr === 0) throw new Error('Invalid document pointer');\n\n    if (this.useShims && this.module._lok_documentSetView) {\n      this.log(`setView: setting active view to ${viewId}`);\n      this.module._lok_documentSetView(docPtr, viewId);\n      return;\n    }\n\n    this.log('setView: shim not available');\n  }\n\n  /**\n   * Get the current active view ID\n   * @param docPtr Document pointer\n   * @returns Current view ID\n   */\n  getView(docPtr: number): number {\n    if (docPtr === 0) throw new Error('Invalid document pointer');\n\n    if (this.useShims && this.module._lok_documentGetView) {\n      return this.module._lok_documentGetView(docPtr);\n    }\n\n    this.log('getView: shim not available');\n    return -1;\n  }\n\n  /**\n   * Get the number of views\n   * @param docPtr Document pointer\n   * @returns Number of views\n   */\n  getViewsCount(docPtr: number): number {\n    if (docPtr === 0) throw new Error('Invalid document pointer');\n\n    if (this.useShims && this.module._lok_documentGetViewsCount) {\n      return this.module._lok_documentGetViewsCount(docPtr);\n    }\n\n    this.log('getViewsCount: shim not available');\n    return 0;\n  }\n\n  // ==========================================\n  // Event Loop and Callback Methods\n  // ==========================================\n\n  /**\n   * Enable synchronous event dispatch (Unipoll mode).\n   * This must be called before using postKeyEvent, postMouseEvent, etc.\n   * to ensure events are processed immediately instead of being queued.\n   *\n   * Without this, events posted via postKeyEvent/postMouseEvent are queued\n   * via Application::PostUserEvent() and never processed in headless mode.\n   */\n  enableSyncEvents(): void {\n    if (this.useShims && this.module._lok_enableSyncEvents) {\n      this.module._lok_enableSyncEvents();\n      this.log('enableSyncEvents: Unipoll mode enabled');\n    } else {\n      this.log('enableSyncEvents: shim not available');\n    }\n  }\n\n  /**\n   * Disable synchronous event dispatch.\n   * Call this when done with event-based operations.\n   */\n  disableSyncEvents(): void {\n    if (this.useShims && this.module._lok_disableSyncEvents) {\n      this.module._lok_disableSyncEvents();\n      this.log('disableSyncEvents: Unipoll mode disabled');\n    } else {\n      this.log('disableSyncEvents: shim not available');\n    }\n  }\n\n  // ==========================================\n  // Callback Queue Methods\n  // ==========================================\n\n  /**\n   * Register a callback handler for the document.\n   * Events are queued and can be retrieved via pollCallback().\n   * @param docPtr Document pointer\n   */\n  registerCallback(docPtr: number): void {\n    if (docPtr === 0) throw new Error('Invalid document pointer');\n\n    if (this.useShims && this.module._lok_documentRegisterCallback) {\n      this.module._lok_documentRegisterCallback(docPtr);\n      this.log('registerCallback: callback registered');\n    } else {\n      this.log('registerCallback: shim not available');\n    }\n  }\n\n  /**\n   * Unregister the callback handler for the document.\n   * @param docPtr Document pointer\n   */\n  unregisterCallback(docPtr: number): void {\n    if (docPtr === 0) throw new Error('Invalid document pointer');\n\n    if (this.useShims && this.module._lok_documentUnregisterCallback) {\n      this.module._lok_documentUnregisterCallback(docPtr);\n      this.log('unregisterCallback: callback unregistered');\n    } else {\n      this.log('unregisterCallback: shim not available');\n    }\n  }\n\n  /**\n   * Check if there are any pending callback events.\n   * @returns true if events are pending\n   */\n  hasCallbackEvents(): boolean {\n    if (this.useShims && this.module._lok_hasCallbackEvents) {\n      return this.module._lok_hasCallbackEvents() !== 0;\n    }\n    return false;\n  }\n\n  /**\n   * Get the number of pending callback events.\n   * @returns Number of events in the queue\n   */\n  getCallbackEventCount(): number {\n    if (this.useShims && this.module._lok_getCallbackEventCount) {\n      return this.module._lok_getCallbackEventCount();\n    }\n    return 0;\n  }\n\n  /**\n   * Poll and retrieve the next callback event from the queue.\n   * @returns The next event, or null if queue is empty\n   */\n  pollCallback(): LOKCallbackEvent | null {\n    if (!this.useShims || !this.module._lok_pollCallback) {\n      return null;\n    }\n\n    const bufferSize = 4096;\n    const payloadBuffer = this.module._malloc(bufferSize);\n    const payloadLengthPtr = this.module._malloc(4);\n\n    try {\n      const eventType = this.module._lok_pollCallback(payloadBuffer, bufferSize, payloadLengthPtr);\n\n      if (eventType === -1) {\n        return null; // Queue is empty\n      }\n\n      // Read the payload length\n      const payloadLength = this.module.HEAP32[payloadLengthPtr >> 2] ?? 0;\n\n      // Read the payload string\n      let payload = '';\n      if (payloadLength > 0) {\n        // Copy bytes from HEAPU8 to avoid SharedArrayBuffer issues in browsers\n        // TextDecoder.decode() doesn't accept SharedArrayBuffer views in some browsers\n        const len = Math.min(payloadLength, bufferSize - 1);\n        const bytes = this.module.HEAPU8.slice(payloadBuffer, payloadBuffer + len);\n        payload = textDecoder.decode(bytes);\n      }\n\n      return {\n        type: eventType,\n        typeName: getCallbackTypeName(eventType),\n        payload,\n      };\n    } finally {\n      this.module._free(payloadBuffer);\n      this.module._free(payloadLengthPtr);\n    }\n  }\n\n  /**\n   * Poll all pending callback events.\n   * @returns Array of all pending events\n   */\n  pollAllCallbacks(): LOKCallbackEvent[] {\n    const events: LOKCallbackEvent[] = [];\n    let event = this.pollCallback();\n    while (event !== null) {\n      events.push(event);\n      event = this.pollCallback();\n    }\n    return events;\n  }\n\n  /**\n   * Clear all pending callback events.\n   */\n  clearCallbackQueue(): void {\n    if (this.useShims && this.module._lok_clearCallbackQueue) {\n      this.module._lok_clearCallbackQueue();\n      this.log('clearCallbackQueue: queue cleared');\n    }\n  }\n\n  /**\n   * Force flush pending LOK callbacks for a document.\n   * This is needed in WASM because callbacks are queued via PostUserEvent\n   * but the event loop doesn't run automatically.\n   * Call this after operations that trigger callbacks (e.g., postUnoCommand)\n   * to ensure the callback queue is populated.\n   * @param docPtr Document pointer\n   */\n  flushCallbacks(docPtr: number): void {\n    if (docPtr === 0) throw new Error('Invalid document pointer');\n\n    const hasShim = !!this.module._lok_flushCallbacks;\n    this.log(`flushCallbacks: useShims=${this.useShims}, _lok_flushCallbacks exists=${hasShim}`);\n\n    if (this.useShims && this.module._lok_flushCallbacks) {\n      this.module._lok_flushCallbacks(docPtr);\n      this.log('flushCallbacks: callbacks flushed');\n    } else {\n      this.log('flushCallbacks: shim not available');\n    }\n  }\n\n  /**\n   * Poll for STATE_CHANGED callbacks and parse them into a map.\n   * STATE_CHANGED payloads are in format: \".uno:CommandName=value\"\n   * @returns Map of command names to values\n   */\n  pollStateChanges(): Map<string, string> {\n    const states = new Map<string, string>();\n    const events = this.pollAllCallbacks();\n\n    for (const event of events) {\n      if (event.type === LOK_CALLBACK_STATE_CHANGED) {\n        // Parse \".uno:Bold=true\" format\n        const eqIndex = event.payload.indexOf('=');\n        if (eqIndex !== -1) {\n          const key = event.payload.substring(0, eqIndex);\n          const value = event.payload.substring(eqIndex + 1);\n          states.set(key, value);\n        } else {\n          // Some state changes are just the command name (enabled/disabled toggle)\n          states.set(event.payload, '');\n        }\n      }\n    }\n\n    return states;\n  }\n\n  // ==========================================\n  // High-Level Convenience Methods\n  // ==========================================\n\n  /**\n   * Click at a position and get text at that location\n   * @param docPtr Document pointer\n   * @param x X coordinate in twips\n   * @param y Y coordinate in twips\n   * @returns Text at the clicked position\n   */\n  clickAndGetText(docPtr: number, x: number, y: number): string | null {\n    // Click down and up to select\n    this.postMouseEvent(docPtr, LOK_MOUSEEVENT_BUTTONDOWN, x, y, 1, 1, 0);\n    this.postMouseEvent(docPtr, LOK_MOUSEEVENT_BUTTONUP, x, y, 1, 1, 0);\n    \n    // Get selected text\n    return this.getTextSelection(docPtr, 'text/plain');\n  }\n\n  /**\n   * Double-click to select a word and get it\n   * @param docPtr Document pointer\n   * @param x X coordinate in twips\n   * @param y Y coordinate in twips\n   * @returns Selected word\n   */\n  doubleClickAndGetWord(docPtr: number, x: number, y: number): string | null {\n    // Double click to select word\n    this.postMouseEvent(docPtr, LOK_MOUSEEVENT_BUTTONDOWN, x, y, 2, 1, 0);\n    this.postMouseEvent(docPtr, LOK_MOUSEEVENT_BUTTONUP, x, y, 2, 1, 0);\n    \n    // Get selected text\n    return this.getTextSelection(docPtr, 'text/plain');\n  }\n\n  /**\n   * Select all content in the document\n   * @param docPtr Document pointer\n   */\n  selectAll(docPtr: number): void {\n    this.postUnoCommand(docPtr, '.uno:SelectAll');\n  }\n\n  /**\n   * Get all text content from the document\n   * @param docPtr Document pointer\n   * @returns All text content\n   */\n  getAllText(docPtr: number): string | null {\n    this.log(`getAllText called with docPtr: ${docPtr}`);\n    this.selectAll(docPtr);\n    const text = this.getTextSelection(docPtr, 'text/plain');\n    this.log(`getAllText: text=\"${text?.slice(0, 100)}...\"`);\n    this.resetSelection(docPtr);\n    return text;\n  }\n\n  /**\n   * Parse page rectangles string into array of objects\n   * @param rectanglesStr String from getPartPageRectangles\n   * @returns Array of rectangle objects\n   */\n  parsePageRectangles(rectanglesStr: string): Array<{ x: number; y: number; width: number; height: number }> {\n    if (!rectanglesStr) return [];\n    \n    return rectanglesStr.split(';').filter(s => s.trim()).map(rect => {\n      const parts = rect.split(',').map(Number);\n      return { \n        x: parts[0] ?? 0, \n        y: parts[1] ?? 0, \n        width: parts[2] ?? 0, \n        height: parts[3] ?? 0 \n      };\n    });\n  }\n}\n","/**\n * LibreOffice WASM Document Conversion Types\n * Headless document format conversion toolkit\n */\n\n/**\n * Supported input document formats\n */\nexport type InputFormat =\n  // Microsoft Office formats\n  | 'doc'\n  | 'docx'\n  | 'xls'\n  | 'xlsx'\n  | 'ppt'\n  | 'pptx'\n  // OpenDocument formats\n  | 'odt'\n  | 'ods'\n  | 'odp'\n  | 'odg'\n  | 'odf'\n  // Other formats\n  | 'rtf'\n  | 'txt'\n  | 'html'\n  | 'htm'\n  | 'csv'\n  | 'xml'\n  | 'epub'\n  | 'pdf';\n\n/**\n * Supported output document formats\n */\nexport type OutputFormat =\n  | 'pdf'\n  | 'docx'\n  | 'doc'\n  | 'odt'\n  | 'rtf'\n  | 'txt'\n  | 'html'\n  | 'xlsx'\n  | 'xls'\n  | 'ods'\n  | 'csv'\n  | 'pptx'\n  | 'ppt'\n  | 'odp'\n  | 'png'\n  | 'jpg'\n  | 'svg';\n\n/**\n * Document conversion options\n */\nexport interface ConversionOptions {\n  /**\n   * Output format for the conversion\n   */\n  outputFormat: OutputFormat;\n\n  /**\n   * Input format hint (auto-detected if not provided)\n   */\n  inputFormat?: InputFormat;\n\n  /**\n   * PDF-specific options\n   */\n  pdf?: PdfOptions;\n\n  /**\n   * Image output options (for png, jpg, svg)\n   */\n  image?: ImageOptions;\n\n  /**\n   * Password for encrypted documents\n   */\n  password?: string;\n}\n\n/**\n * PDF-specific conversion options\n */\nexport interface PdfOptions {\n  /**\n   * PDF/A conformance level\n   */\n  pdfaLevel?: 'PDF/A-1b' | 'PDF/A-2b' | 'PDF/A-3b';\n\n  /**\n   * PDF quality (0-100, affects image compression)\n   * @default 90\n   */\n  quality?: number;\n}\n\n/**\n * Image output options\n */\nexport interface ImageOptions {\n  /**\n   * Image width in pixels\n   */\n  width?: number;\n\n  /**\n   * Image height in pixels\n   */\n  height?: number;\n\n  /**\n   * DPI for rendering\n   * @default 150\n   */\n  dpi?: number;\n}\n\n/**\n * Result of a document conversion\n */\nexport interface ConversionResult {\n  /**\n   * The converted document data\n   */\n  data: Uint8Array;\n\n  /**\n   * MIME type of the output\n   */\n  mimeType: string;\n\n  /**\n   * Suggested filename with new extension\n   */\n  filename: string;\n\n  /**\n   * Conversion duration in milliseconds\n   */\n  duration: number;\n}\n\n/**\n * LibreOffice WASM module initialization options (Node.js)\n */\nexport interface LibreOfficeWasmOptions {\n  /**\n   * Path to WASM files directory\n   * @default './wasm'\n   */\n  wasmPath?: string;\n\n  /**\n   * Enable verbose logging\n   * @default false\n   */\n  verbose?: boolean;\n\n  /**\n   * Called when WASM module is ready\n   */\n  onReady?: () => void;\n\n  /**\n   * Called on initialization error\n   */\n  onError?: (error: Error) => void;\n\n  /**\n   * Called with progress updates during initialization\n   */\n  onProgress?: (progress: ProgressInfo) => void;\n}\n\n/**\n * Explicit paths to WASM files (Browser)\n * Users must configure each path explicitly - no assumptions about file locations\n */\nexport interface BrowserWasmPaths {\n  /** URL to soffice.js - the main Emscripten loader script */\n  sofficeJs: string;\n  /** URL to soffice.wasm - the WebAssembly binary (~112MB) */\n  sofficeWasm: string;\n  /** URL to soffice.data - the virtual filesystem image (~80MB) */\n  sofficeData: string;\n  /** URL to soffice.worker.js - the Emscripten pthread worker */\n  sofficeWorkerJs: string;\n}\n\n/**\n * Browser converter initialization options\n * Requires explicit paths to all WASM files\n */\nexport interface BrowserConverterOptions extends BrowserWasmPaths {\n  /**\n   * Enable verbose logging\n   * @default false\n   */\n  verbose?: boolean;\n\n  /**\n   * Called when WASM module is ready\n   */\n  onReady?: () => void;\n\n  /**\n   * Called on initialization error\n   */\n  onError?: (error: Error) => void;\n\n  /**\n   * Called with progress updates during initialization\n   */\n  onProgress?: (progress: ProgressInfo) => void;\n}\n\n/**\n * Worker browser converter initialization options\n * Requires explicit paths to all WASM files plus the library worker\n */\nexport interface WorkerBrowserConverterOptions extends BrowserConverterOptions {\n  /** URL to browser-worker.js - the library's Web Worker script */\n  browserWorkerJs: string;\n}\n\n/**\n * Create WASM file paths from a base URL\n * Convenience helper for users who keep all WASM files in one directory\n *\n * @param baseUrl - Base URL ending with '/' (e.g., '/libreoffice/', 'https://cdn.example.com/wasm/')\n * @returns Object with all WASM file paths\n *\n * @example\n * ```typescript\n * const converter = new WorkerBrowserConverter({\n *   ...createWasmPaths('/libreoffice/'),\n *   browserWorkerJs: '/workers/browser-worker.js',\n * });\n * ```\n */\nexport function createWasmPaths(baseUrl: string): BrowserWasmPaths {\n  // Ensure baseUrl ends with /\n  const base = baseUrl.endsWith('/') ? baseUrl : `${baseUrl}/`;\n  return {\n    sofficeJs: `${base}soffice.js`,\n    sofficeWasm: `${base}soffice.wasm`,\n    sofficeData: `${base}soffice.data`,\n    sofficeWorkerJs: `${base}soffice.worker.js`,\n  };\n}\n\n/**\n * Loading phases for WASM initialization\n * Used to track detailed progress during the ~80 second browser startup\n */\nexport type WasmLoadPhase =\n  | 'download-wasm'    // Downloading soffice.wasm (~142MB)\n  | 'download-data'    // Downloading soffice.data (~96MB)\n  | 'compile'          // WebAssembly compilation\n  | 'filesystem'       // Emscripten filesystem setup\n  | 'lok-init'         // LibreOfficeKit initialization\n  | 'ready';           // Complete\n\n/**\n * Extended progress information with download details\n * Backward compatible - existing code using percent/message continues to work\n */\nexport interface WasmLoadProgress {\n  /** Overall progress 0-100 */\n  percent: number;\n  /** Human-readable status message */\n  message: string;\n  /** Current loading phase */\n  phase: WasmLoadPhase;\n  /** Bytes downloaded (present during download phases) */\n  bytesLoaded?: number;\n  /** Total bytes to download (present during download phases) */\n  bytesTotal?: number;\n}\n\n/**\n * Progress information\n * @deprecated Use WasmLoadProgress for richer progress data\n */\nexport interface ProgressInfo {\n  phase: 'loading' | 'initializing' | 'converting' | 'complete';\n  percent: number;\n  message: string;\n}\n\n/**\n * Error codes for conversion failures\n */\nexport enum ConversionErrorCode {\n  UNKNOWN = 'UNKNOWN',\n  INVALID_INPUT = 'INVALID_INPUT',\n  UNSUPPORTED_FORMAT = 'UNSUPPORTED_FORMAT',\n  CORRUPTED_DOCUMENT = 'CORRUPTED_DOCUMENT',\n  PASSWORD_REQUIRED = 'PASSWORD_REQUIRED',\n  WASM_NOT_INITIALIZED = 'WASM_NOT_INITIALIZED',\n  CONVERSION_FAILED = 'CONVERSION_FAILED',\n  LOAD_FAILED = 'LOAD_FAILED',\n}\n\n/**\n * Custom error class for conversion errors\n */\nexport class ConversionError extends Error {\n  public readonly code: ConversionErrorCode;\n  public readonly details?: string;\n\n  constructor(code: ConversionErrorCode, message: string, details?: string) {\n    super(message);\n    this.name = 'ConversionError';\n    this.code = code;\n    this.details = details;\n  }\n}\n\n/**\n * Emscripten Module interface\n */\nexport interface EmscriptenModule {\n  // Core Emscripten functions\n  ccall: (\n    name: string,\n    returnType: string | null,\n    argTypes: string[],\n    args: unknown[]\n  ) => unknown;\n  cwrap: (\n    name: string,\n    returnType: string | null,\n    argTypes: string[]\n  ) => (...args: unknown[]) => unknown;\n\n  // Memory management\n  _malloc: (size: number) => number;\n  _free: (ptr: number) => void;\n  HEAPU8: Uint8Array;\n  HEAP32: Int32Array;\n  HEAPU32: Uint32Array;\n\n  // File system\n  FS: EmscriptenFS;\n\n  // Lifecycle\n  onRuntimeInitialized?: () => void;\n  calledRun?: boolean;\n\n  // LibreOfficeKit hooks (exported C functions)\n  _lok_preinit?: (path: number, args: number) => number;\n  _lok_preinit_2?: (path: number, args: number, callback: number) => number;\n  _libreofficekit_hook?: (path: number) => number;\n  _libreofficekit_hook_2?: (path: number, userProfile: number) => number;\n  _main?: (argc: number, argv: number) => number;\n\n  // WebAssembly function table for indirect calls\n  wasmTable?: WebAssembly.Table;\n\n  // Module locator\n  locateFile?: (path: string) => string;\n  print?: (text: string) => void;\n  printErr?: (text: string) => void;\n\n  // Runtime ready promise (some builds)\n  ready?: Promise<EmscriptenModule>;\n}\n\n/**\n * Emscripten virtual filesystem\n */\nexport interface EmscriptenFS {\n  mkdir: (path: string) => void;\n  writeFile: (path: string, data: Uint8Array | string, opts?: { encoding?: string }) => void;\n  readFile: (path: string, opts?: { encoding?: string }) => Uint8Array | string;\n  unlink: (path: string) => void;\n  readdir: (path: string) => string[];\n  stat: (path: string) => { size: number; isDirectory: () => boolean };\n  rmdir: (path: string) => void;\n  rename: (oldPath: string, newPath: string) => void;\n}\n\n/**\n * Filter name mapping for LibreOffice export\n * Note: For image exports, use getFilterForDocType() instead as filters are document-type specific\n */\nexport const FORMAT_FILTERS: Record<OutputFormat, string> = {\n  pdf: 'writer_pdf_Export',\n  docx: 'MS Word 2007 XML',\n  doc: 'MS Word 97',\n  odt: 'writer8',\n  rtf: 'Rich Text Format',\n  txt: 'Text',\n  html: 'HTML (StarWriter)',\n  xlsx: 'Calc MS Excel 2007 XML',\n  xls: 'MS Excel 97',\n  ods: 'calc8',\n  csv: 'Text - txt - csv (StarCalc)',\n  pptx: 'Impress MS PowerPoint 2007 XML',\n  ppt: 'MS PowerPoint 97',\n  odp: 'impress8',\n  png: 'writer_png_Export',\n  jpg: 'writer_jpg_Export',\n  svg: 'writer_svg_Export',\n};\n\n/**\n * LibreOfficeKit document types (from LibreOfficeKitEnums.h)\n */\nexport enum LOKDocumentType {\n  TEXT = 0,\n  SPREADSHEET = 1,\n  PRESENTATION = 2,\n  DRAWING = 3,\n  OTHER = 4,\n}\n\n/**\n * Document-type-specific filters for image and PDF exports\n * Each document type (Writer, Calc, Impress, Draw) has its own export filters\n */\nexport const DOC_TYPE_FILTERS: Record<LOKDocumentType, Partial<Record<OutputFormat, string>>> = {\n  [LOKDocumentType.TEXT]: {\n    pdf: 'writer_pdf_Export',\n    png: 'writer_png_Export',\n    jpg: 'writer_jpg_Export',\n    svg: 'writer_svg_Export',\n    html: 'HTML (StarWriter)',\n  },\n  [LOKDocumentType.SPREADSHEET]: {\n    pdf: 'calc_pdf_Export',\n    png: 'calc_png_Export',\n    jpg: 'calc_jpg_Export',\n    svg: 'calc_svg_Export',\n    html: 'HTML (StarCalc)',\n  },\n  [LOKDocumentType.PRESENTATION]: {\n    pdf: 'impress_pdf_Export',\n    png: 'impress_png_Export',\n    jpg: 'impress_jpg_Export',\n    svg: 'impress_svg_Export',\n    html: 'impress_html_Export',\n  },\n  [LOKDocumentType.DRAWING]: {\n    pdf: 'draw_pdf_Export',\n    png: 'draw_png_Export',\n    jpg: 'draw_jpg_Export',\n    svg: 'draw_svg_Export',\n    html: 'draw_html_Export',\n  },\n  [LOKDocumentType.OTHER]: {\n    pdf: 'writer_pdf_Export',\n    png: 'writer_png_Export',\n    jpg: 'writer_jpg_Export',\n    svg: 'writer_svg_Export',\n  },\n};\n\n/**\n * Get the correct export filter for a given output format and document type\n * @param outputFormat The desired output format\n * @param docType The LibreOfficeKit document type (use documentGetDocumentType())\n * @returns The filter name to use for saveAs\n */\nexport function getFilterForDocType(outputFormat: OutputFormat, docType: LOKDocumentType | number): string {\n  // Check if there's a document-type-specific filter\n  const docTypeFilters = DOC_TYPE_FILTERS[docType as LOKDocumentType];\n  if (docTypeFilters && docTypeFilters[outputFormat]) {\n    return docTypeFilters[outputFormat]!;\n  }\n  \n  // Fall back to the default filter\n  return FORMAT_FILTERS[outputFormat];\n}\n\n/**\n * MIME types for output formats\n */\nexport const FORMAT_MIME_TYPES: Record<OutputFormat, string> = {\n  pdf: 'application/pdf',\n  docx: 'application/vnd.openxmlformats-officedocument.wordprocessingml.document',\n  doc: 'application/msword',\n  odt: 'application/vnd.oasis.opendocument.text',\n  rtf: 'application/rtf',\n  txt: 'text/plain',\n  html: 'text/html',\n  xlsx: 'application/vnd.openxmlformats-officedocument.spreadsheetml.sheet',\n  xls: 'application/vnd.ms-excel',\n  ods: 'application/vnd.oasis.opendocument.spreadsheet',\n  csv: 'text/csv',\n  pptx: 'application/vnd.openxmlformats-officedocument.presentationml.presentation',\n  ppt: 'application/vnd.ms-powerpoint',\n  odp: 'application/vnd.oasis.opendocument.presentation',\n  png: 'image/png',\n  jpg: 'image/jpeg',\n  svg: 'image/svg+xml',\n};\n\n/**\n * File extension to format mapping\n */\nexport const EXTENSION_TO_FORMAT: Record<string, InputFormat> = {\n  doc: 'doc',\n  docx: 'docx',\n  xls: 'xls',\n  xlsx: 'xlsx',\n  ppt: 'ppt',\n  pptx: 'pptx',\n  odt: 'odt',\n  ods: 'ods',\n  odp: 'odp',\n  odg: 'odg',\n  odf: 'odf',\n  rtf: 'rtf',\n  txt: 'txt',\n  html: 'html',\n  htm: 'html',\n  csv: 'csv',\n  xml: 'xml',\n  epub: 'epub',\n  pdf: 'pdf',\n};\n\n/**\n * Map LOK document type to valid output formats\n * This is based on LibreOffice's actual extension maps in desktop/source/lib/init.cxx\n * \n * IMPORTANT: These are the formats that LibreOffice's saveAs() actually supports.\n * The extension maps in init.cxx determine what filters are available per document type.\n * \n * Writer (TEXT): doc, docx, odt, pdf, rtf, txt, html, png, epub\n * Calc (SPREADSHEET): csv, ods, pdf, xls, xlsx, html, png\n * Impress (PRESENTATION): odp, pdf, ppt, pptx, svg, html, png\n * Draw (DRAWING): odg, pdf, svg, html, png\n * \n * NOTE: jpg is NOT in any extension map! Only png is supported for image export.\n * NOTE: svg is only supported for Impress and Draw, not Writer or Calc.\n */\nexport const LOK_DOCTYPE_OUTPUT_FORMATS: Record<LOKDocumentType, OutputFormat[]> = {\n  [LOKDocumentType.TEXT]: ['pdf', 'docx', 'doc', 'odt', 'rtf', 'txt', 'html', 'png'],\n  [LOKDocumentType.SPREADSHEET]: ['pdf', 'xlsx', 'xls', 'ods', 'csv', 'html', 'png'],\n  [LOKDocumentType.PRESENTATION]: ['pdf', 'pptx', 'ppt', 'odp', 'png', 'svg', 'html'],\n  [LOKDocumentType.DRAWING]: ['pdf', 'png', 'svg', 'html'],\n  [LOKDocumentType.OTHER]: ['pdf'],\n};\n\n/**\n * Get valid output formats for a LOK document type\n * Use this after loading a document to get accurate conversion options\n * @param docType The LOK document type (from documentGetDocumentType)\n * @returns Array of valid output formats\n */\nexport function getOutputFormatsForDocType(docType: LOKDocumentType | number): OutputFormat[] {\n  return LOK_DOCTYPE_OUTPUT_FORMATS[docType as LOKDocumentType] || ['pdf'];\n}\n\n/**\n * Map output format to LOK format string\n * These are the format names used by LibreOfficeKit's saveAs\n */\nexport const OUTPUT_FORMAT_TO_LOK: Record<OutputFormat, string> = {\n  pdf: 'pdf',\n  docx: 'docx',\n  doc: 'doc',\n  odt: 'odt',\n  rtf: 'rtf',\n  txt: 'txt',\n  html: 'html',\n  xlsx: 'xlsx',\n  xls: 'xls',\n  ods: 'ods',\n  csv: 'csv',\n  pptx: 'pptx',\n  ppt: 'ppt',\n  odp: 'odp',\n  png: 'png',\n  jpg: 'jpg',\n  svg: 'svg',\n};\n\n/**\n * Filter options for specific format conversions\n * These are passed to LibreOfficeKit's saveAs as the filterOptions parameter\n */\nexport const FORMAT_FILTER_OPTIONS: Partial<Record<OutputFormat, string>> = {\n  // PDF options can include things like:\n  // - SelectPdfVersion (0=PDF 1.4, 1=PDF/A-1, 2=PDF/A-2, 3=PDF/A-3)\n  // - UseLosslessCompression\n  // - Quality\n  pdf: '',\n  // CSV can specify separator, encoding, etc.\n  csv: '44,34,76,1,,0,false,true,false,false,false,-1',\n  // Text encoding\n  txt: 'UTF8',\n};\n\n/**\n * Document type categories for determining valid conversions\n */\nexport type DocumentCategory = 'text' | 'spreadsheet' | 'presentation' | 'drawing' | 'other';\n\n/**\n * Map input formats to their document category\n * This determines which output formats are valid\n */\nexport const INPUT_FORMAT_CATEGORY: Record<InputFormat, DocumentCategory> = {\n  // Text/Writer documents\n  doc: 'text',\n  docx: 'text',\n  odt: 'text',\n  rtf: 'text',\n  txt: 'text',\n  html: 'text',\n  htm: 'text',\n  epub: 'text',\n  xml: 'text',\n  // Spreadsheet/Calc documents\n  xls: 'spreadsheet',\n  xlsx: 'spreadsheet',\n  ods: 'spreadsheet',\n  csv: 'spreadsheet',\n  // Presentation/Impress documents\n  ppt: 'presentation',\n  pptx: 'presentation',\n  odp: 'presentation',\n  // Drawing/Draw documents (PDF imports as Draw)\n  odg: 'drawing',\n  odf: 'drawing',\n  pdf: 'drawing', // PDFs are imported as Draw documents\n};\n\n/**\n * Valid output formats for each document category\n * Based on LibreOffice's actual filter capabilities\n */\nexport const CATEGORY_OUTPUT_FORMATS: Record<DocumentCategory, OutputFormat[]> = {\n  // Writer documents can export to (based on aWriterExtensionMap in init.cxx):\n  // NOTE: jpg and svg are NOT supported for Writer - only png for images\n  text: ['pdf', 'docx', 'doc', 'odt', 'rtf', 'txt', 'html', 'png'],\n  // Calc documents can export to (based on aCalcExtensionMap in init.cxx):\n  // NOTE: jpg and svg are NOT supported for Calc - only png for images\n  spreadsheet: ['pdf', 'xlsx', 'xls', 'ods', 'csv', 'html', 'png'],\n  // Impress documents can export to (based on aImpressExtensionMap in init.cxx):\n  // NOTE: jpg is NOT supported - only png and svg for images\n  presentation: ['pdf', 'pptx', 'ppt', 'odp', 'png', 'svg', 'html'],\n  // Draw documents (including imported PDFs) can export to (based on aDrawExtensionMap in init.cxx):\n  // NOTE: jpg is NOT supported - only png and svg for images\n  drawing: ['pdf', 'png', 'svg', 'html'],\n  // Other/unknown - try PDF only\n  other: ['pdf'],\n};\n\n/**\n * Get valid output formats for a given input format\n * @param inputFormat The input document format\n * @returns Array of valid output formats\n */\nexport function getValidOutputFormats(inputFormat: InputFormat | string): OutputFormat[] {\n  const format = inputFormat.toLowerCase() as InputFormat;\n  const category = INPUT_FORMAT_CATEGORY[format];\n  \n  if (!category) {\n    // Unknown format - allow PDF as a safe default\n    return ['pdf'];\n  }\n  \n  return CATEGORY_OUTPUT_FORMATS[category];\n}\n\n/**\n * Check if a conversion from input format to output format is valid\n * @param inputFormat The input document format\n * @param outputFormat The desired output format\n * @returns true if the conversion is supported\n */\nexport function isConversionValid(\n  inputFormat: InputFormat | string,\n  outputFormat: OutputFormat | string\n): boolean {\n  const validOutputs = getValidOutputFormats(inputFormat);\n  return validOutputs.includes(outputFormat.toLowerCase() as OutputFormat);\n}\n\n/**\n * Get a human-readable error message for invalid conversions\n * @param inputFormat The input document format\n * @param outputFormat The desired output format\n * @returns Error message explaining why the conversion is not supported\n */\nexport function getConversionErrorMessage(\n  inputFormat: InputFormat | string,\n  outputFormat: OutputFormat | string\n): string {\n  const input = inputFormat.toLowerCase();\n  const output = outputFormat.toLowerCase();\n  const validOutputs = getValidOutputFormats(input as InputFormat);\n  \n  const category = INPUT_FORMAT_CATEGORY[input as InputFormat] || 'unknown';\n  \n  let reason = '';\n  if (category === 'drawing' && ['docx', 'doc', 'xlsx', 'xls', 'pptx', 'ppt'].includes(output)) {\n    reason = `PDF files are imported as Draw documents and cannot be exported to Office formats. `;\n  } else if (category === 'spreadsheet' && ['docx', 'doc', 'pptx', 'ppt'].includes(output)) {\n    reason = `Spreadsheet documents cannot be converted to word processing or presentation formats. `;\n  } else if (category === 'presentation' && ['docx', 'doc', 'xlsx', 'xls'].includes(output)) {\n    reason = `Presentation documents cannot be converted to word processing or spreadsheet formats. `;\n  } else if (category === 'text' && ['xlsx', 'xls', 'pptx', 'ppt'].includes(output)) {\n    reason = `Text documents cannot be converted to spreadsheet or presentation formats. `;\n  }\n  \n  return `Cannot convert ${input.toUpperCase()} to ${output.toUpperCase()}. ${reason}Valid output formats for ${input.toUpperCase()}: ${validOutputs.join(', ')}`;\n}\n","// src/editor/base.ts\nimport type { LOKBindings } from '../lok-bindings.js';\nimport type { OutputFormat } from '../types.js';\nimport type {\n  OperationResult,\n  DocumentStructure,\n  OpenDocumentOptions,\n  SelectionRange,\n  FindOptions,\n  Position,\n  TruncationInfo,\n  CellRef,\n} from './types.js';\n\n/**\n * Abstract base class for all document editors\n */\nexport abstract class OfficeEditor {\n  protected lok: LOKBindings;\n  protected docPtr: number;\n  protected options: Required<Pick<OpenDocumentOptions, 'maxResponseChars'>> & OpenDocumentOptions;\n  protected inputPath: string = '';\n\n  constructor(lok: LOKBindings, docPtr: number, options: OpenDocumentOptions = {}) {\n    this.lok = lok;\n    this.docPtr = docPtr;\n    this.options = {\n      maxResponseChars: options.maxResponseChars ?? 8000,\n      ...options,\n    };\n  }\n\n  // ============================================\n  // Abstract methods (implemented by subclasses)\n  // ============================================\n\n  abstract getStructure(options?: { maxResponseChars?: number }): OperationResult<DocumentStructure>;\n  abstract getDocumentType(): 'writer' | 'calc' | 'impress' | 'draw';\n\n  // ============================================\n  // Accessor methods\n  // ============================================\n\n  /**\n   * Get the document pointer for low-level LOK operations\n   */\n  getDocPtr(): number {\n    return this.docPtr;\n  }\n\n  /**\n   * Get the LOK bindings for low-level operations\n   */\n  getLokBindings(): LOKBindings {\n    return this.lok;\n  }\n\n  // ============================================\n  // Lifecycle methods\n  // ============================================\n\n  save(): OperationResult<{ path: string }> {\n    try {\n      // Save to the original path\n      if (!this.inputPath) {\n        return this.createErrorResult('No input path set', 'Use saveAs() to specify a path');\n      }\n      // LibreOffice auto-saves on document operations, but we can force it\n      this.lok.postUnoCommand(this.docPtr, '.uno:Save');\n      return this.createResult({ path: this.inputPath });\n    } catch (error) {\n      return this.createErrorResult(`Save failed: ${error}`);\n    }\n  }\n\n  saveAs(path: string, format: OutputFormat): OperationResult<{ path: string }> {\n    try {\n      this.lok.documentSaveAs(this.docPtr, path, format, '');\n      return this.createResult({ path });\n    } catch (error) {\n      return this.createErrorResult(`SaveAs failed: ${error}`);\n    }\n  }\n\n  close(): OperationResult<void> {\n    try {\n      this.lok.documentDestroy(this.docPtr);\n      this.docPtr = 0;\n      return this.createResult(undefined);\n    } catch (error) {\n      return this.createErrorResult(`Close failed: ${error}`);\n    }\n  }\n\n  /**\n   * Get the current edit mode of the document\n   * @returns 0 = view mode, 1 = edit mode\n   */\n  getEditMode(): number {\n    return this.lok.getEditMode(this.docPtr);\n  }\n\n  /**\n   * Attempt to enable edit mode for the document\n   * @returns OperationResult with success and verified fields\n   */\n  enableEditMode(): OperationResult<{ editMode: number }> {\n    try {\n      const beforeMode = this.lok.getEditMode(this.docPtr);\n      if (beforeMode === 1) {\n        // Already in edit mode\n        return this.createResult({ editMode: 1 });\n      }\n\n      // Try .uno:Edit command to switch to edit mode\n      this.lok.postUnoCommand(this.docPtr, '.uno:Edit');\n\n      const afterMode = this.lok.getEditMode(this.docPtr);\n      return {\n        success: true,\n        verified: afterMode === 1,\n        data: { editMode: afterMode },\n      };\n    } catch (error) {\n      return this.createErrorResult(`Failed to enable edit mode: ${error}`);\n    }\n  }\n\n  // ============================================\n  // History methods\n  // ============================================\n\n  undo(): OperationResult<void> {\n    try {\n      this.lok.postUnoCommand(this.docPtr, '.uno:Undo');\n      return this.createResult(undefined);\n    } catch (error) {\n      return this.createErrorResult(`Undo failed: ${error}`);\n    }\n  }\n\n  redo(): OperationResult<void> {\n    try {\n      this.lok.postUnoCommand(this.docPtr, '.uno:Redo');\n      return this.createResult(undefined);\n    } catch (error) {\n      return this.createErrorResult(`Redo failed: ${error}`);\n    }\n  }\n\n  // ============================================\n  // Search methods\n  // ============================================\n\n  find(text: string, options?: FindOptions): OperationResult<{ matches: number; firstMatch?: Position }> {\n    try {\n      const searchArgs = JSON.stringify({\n        'SearchItem.SearchString': { type: 'string', value: text },\n        'SearchItem.Backward': { type: 'boolean', value: false },\n        'SearchItem.SearchAll': { type: 'boolean', value: true },\n        'SearchItem.MatchCase': { type: 'boolean', value: options?.caseSensitive ?? false },\n        'SearchItem.WordOnly': { type: 'boolean', value: options?.wholeWord ?? false },\n      });\n\n      this.lok.postUnoCommand(this.docPtr, '.uno:ExecuteSearch', searchArgs);\n\n      // Get search results - this is approximate as LOK doesn't return match count directly\n      const selection = this.lok.getTextSelection(this.docPtr, 'text/plain');\n      const hasMatch = selection !== null && selection.length > 0;\n\n      return this.createResult({\n        matches: hasMatch ? 1 : 0, // LOK doesn't provide count, we report if found\n        firstMatch: hasMatch ? { x: 0, y: 0 } : undefined,\n      });\n    } catch (error) {\n      return this.createErrorResult(`Find failed: ${error}`);\n    }\n  }\n\n  findAndReplaceAll(find: string, replace: string, options?: FindOptions): OperationResult<{ replacements: number }> {\n    try {\n      const searchArgs = JSON.stringify({\n        'SearchItem.SearchString': { type: 'string', value: find },\n        'SearchItem.ReplaceString': { type: 'string', value: replace },\n        'SearchItem.Command': { type: 'long', value: 3 }, // Replace All\n        'SearchItem.MatchCase': { type: 'boolean', value: options?.caseSensitive ?? false },\n        'SearchItem.WordOnly': { type: 'boolean', value: options?.wholeWord ?? false },\n      });\n\n      this.lok.postUnoCommand(this.docPtr, '.uno:ExecuteSearch', searchArgs);\n\n      // LOK doesn't return replacement count, we assume success\n      return this.createResult({ replacements: -1 }); // -1 indicates unknown count\n    } catch (error) {\n      return this.createErrorResult(`Replace failed: ${error}`);\n    }\n  }\n\n  // ============================================\n  // Callback-based state retrieval\n  // ============================================\n\n  /**\n   * Poll all STATE_CHANGED callback events and return as a map.\n   *\n   * LOK sends STATE_CHANGED events when formatting state changes (e.g., when\n   * the cursor moves over bold text, `.uno:Bold=true` is emitted).\n   *\n   * Pattern for getting current format state:\n   * 1. clearCallbackQueue() - clear any stale events\n   * 2. Perform action that triggers state change (e.g., SelectWord)\n   * 3. flushCallbacks(docPtr) - force LOK to process callbacks\n   * 4. pollStateChanges() - retrieve the events\n   *\n   * @returns Map of UNO command names to their state values\n   *          e.g., Map { '.uno:Bold' => 'true', '.uno:Italic' => 'false' }\n   */\n  getStateChanges(): OperationResult<Map<string, string>> {\n    try {\n      const states = this.lok.pollStateChanges();\n      return this.createResult(states);\n    } catch (error) {\n      return this.createErrorResult(`Failed to poll state changes: ${error}`);\n    }\n  }\n\n  /**\n   * Flush pending LOK callbacks and then poll for state changes.\n   * Convenience method that combines flushCallbacks + pollStateChanges.\n   *\n   * @returns Map of UNO command names to their state values\n   */\n  flushAndPollState(): OperationResult<Map<string, string>> {\n    try {\n      this.lok.flushCallbacks(this.docPtr);\n      const states = this.lok.pollStateChanges();\n      return this.createResult(states);\n    } catch (error) {\n      return this.createErrorResult(`Failed to flush and poll state: ${error}`);\n    }\n  }\n\n  /**\n   * Clear the callback queue, useful before performing operations\n   * where you want to capture only new state changes.\n   */\n  clearCallbackQueue(): void {\n    this.lok.clearCallbackQueue();\n  }\n\n  // ============================================\n  // Selection methods\n  // ============================================\n\n  select(_selection: SelectionRange): OperationResult<{ selected: string }> {\n    try {\n      // Implementation depends on selection type - subclasses may override\n      // Base implementation just returns current selection\n      const text = this.lok.getTextSelection(this.docPtr, 'text/plain');\n      return this.createResult({ selected: text || '' });\n    } catch (error) {\n      return this.createErrorResult(`Select failed: ${error}`);\n    }\n  }\n\n  getSelection(): OperationResult<{ text: string; range: SelectionRange }> {\n    try {\n      const text = this.lok.getTextSelection(this.docPtr, 'text/plain');\n      return this.createResult({\n        text: text || '',\n        range: { type: 'text', start: { paragraph: 0, character: 0 } },\n      });\n    } catch (error) {\n      return this.createErrorResult(`GetSelection failed: ${error}`);\n    }\n  }\n\n  clearSelection(): OperationResult<void> {\n    try {\n      this.lok.resetSelection(this.docPtr);\n      return this.createResult(undefined);\n    } catch (error) {\n      return this.createErrorResult(`ClearSelection failed: ${error}`);\n    }\n  }\n\n  // ============================================\n  // Protected helper methods\n  // ============================================\n\n  protected createResult<T>(data: T): OperationResult<T> {\n    return {\n      success: true,\n      verified: true,\n      data,\n    };\n  }\n\n  protected createErrorResult<T>(error: string, suggestion?: string): OperationResult<T> {\n    return {\n      success: false,\n      verified: false,\n      error,\n      suggestion,\n    };\n  }\n\n  protected createResultWithTruncation<T>(data: T, truncation?: TruncationInfo): OperationResult<T> {\n    return {\n      success: true,\n      verified: true,\n      data,\n      truncated: truncation,\n    };\n  }\n\n  protected truncateContent(content: string, maxChars?: number): {\n    content: string;\n    truncated: boolean;\n    original: number;\n    returned: number;\n  } {\n    const limit = maxChars ?? this.options.maxResponseChars;\n    const original = content.length;\n\n    if (original <= limit) {\n      return { content, truncated: false, original, returned: original };\n    }\n\n    // Truncate at a word boundary if possible\n    let truncated = content.slice(0, limit);\n    const lastSpace = truncated.lastIndexOf(' ');\n    if (lastSpace > limit * 0.8) {\n      truncated = truncated.slice(0, lastSpace);\n    }\n\n    return {\n      content: truncated,\n      truncated: true,\n      original,\n      returned: truncated.length,\n    };\n  }\n\n  protected truncateArray<T>(items: T[], maxChars: number, itemToString: (item: T) => string): {\n    items: T[];\n    truncated: boolean;\n    original: number;\n    returned: number;\n  } {\n    const original = items.length;\n    let charCount = 0;\n    let includedCount = 0;\n\n    for (const item of items) {\n      const itemStr = itemToString(item);\n      if (charCount + itemStr.length > maxChars) {\n        break;\n      }\n      charCount += itemStr.length;\n      includedCount++;\n    }\n\n    return {\n      items: items.slice(0, includedCount),\n      truncated: includedCount < original,\n      original,\n      returned: includedCount,\n    };\n  }\n\n  // ============================================\n  // Cell address helpers\n  // ============================================\n\n  protected a1ToRowCol(a1: string): { row: number; col: number } {\n    const match = a1.match(/^([A-Z]+)(\\d+)$/i);\n    if (!match) {\n      throw new Error(`Invalid A1 notation: ${a1}`);\n    }\n\n    const colStr = match[1]!.toUpperCase();\n    const rowStr = match[2]!;\n\n    let col = 0;\n    for (let i = 0; i < colStr.length; i++) {\n      col = col * 26 + (colStr.charCodeAt(i) - 64);\n    }\n    col -= 1; // 0-indexed\n\n    const row = parseInt(rowStr, 10) - 1; // 0-indexed\n\n    return { row, col };\n  }\n\n  protected rowColToA1(row: number, col: number): string {\n    let colStr = '';\n    let c = col + 1; // 1-indexed for conversion\n\n    while (c > 0) {\n      const remainder = (c - 1) % 26;\n      colStr = String.fromCharCode(65 + remainder) + colStr;\n      c = Math.floor((c - 1) / 26);\n    }\n\n    return `${colStr}${row + 1}`;\n  }\n\n  protected normalizeCellRef(ref: CellRef): { row: number; col: number } {\n    if (typeof ref === 'string') {\n      return this.a1ToRowCol(ref);\n    }\n    return ref;\n  }\n\n  // ============================================\n  // Internal state\n  // ============================================\n\n  setInputPath(path: string): void {\n    this.inputPath = path;\n  }\n\n  isOpen(): boolean {\n    return this.docPtr !== 0;\n  }\n}\n","// src/editor/writer.ts\nimport { OfficeEditor } from './base.js';\nimport type {\n  OperationResult,\n  WriterStructure,\n  Paragraph,\n  TextPosition,\n  TextRange,\n  TextFormat,\n} from './types.js';\n\n/**\n * Editor for Writer (text) documents\n */\nexport class WriterEditor extends OfficeEditor {\n  private cachedParagraphs: string[] | null = null;\n\n  getDocumentType(): 'writer' {\n    return 'writer';\n  }\n\n  getStructure(options?: { maxResponseChars?: number }): OperationResult<WriterStructure> {\n    try {\n      const paragraphs = this.getParagraphsInternal();\n      const maxChars = options?.maxResponseChars ?? this.options.maxResponseChars;\n\n      const paragraphInfos = paragraphs.map((text, index) => ({\n        index,\n        preview: text.slice(0, 100) + (text.length > 100 ? '...' : ''),\n        style: 'Normal', // Would need UNO query to get actual style\n        charCount: text.length,\n      }));\n\n      // Truncate if needed\n      const truncResult = this.truncateArray(\n        paragraphInfos,\n        maxChars,\n        (p) => JSON.stringify(p)\n      );\n\n      const structure: WriterStructure = {\n        type: 'writer',\n        paragraphs: truncResult.items,\n        pageCount: this.lok.documentGetParts(this.docPtr),\n        wordCount: paragraphs.join(' ').split(/\\s+/).filter(w => w.length > 0).length,\n      };\n\n      if (truncResult.truncated) {\n        return this.createResultWithTruncation(structure, {\n          original: truncResult.original,\n          returned: truncResult.returned,\n          message: `Showing ${truncResult.returned} of ${truncResult.original} paragraphs. Use getParagraphs(start, count) to paginate.`,\n        });\n      }\n\n      return this.createResult(structure);\n    } catch (error) {\n      return this.createErrorResult(`Failed to get structure: ${error}`);\n    }\n  }\n\n  getParagraph(index: number): OperationResult<Paragraph> {\n    try {\n      const paragraphs = this.getParagraphsInternal();\n\n      if (index < 0 || index >= paragraphs.length) {\n        return this.createErrorResult(\n          `Paragraph index ${index} out of range (0-${paragraphs.length - 1})`,\n          `Use getStructure() to see available paragraphs`\n        );\n      }\n\n      const text = paragraphs[index]!;\n      return this.createResult({\n        index,\n        text,\n        style: 'Normal',\n        charCount: text.length,\n      });\n    } catch (error) {\n      return this.createErrorResult(`Failed to get paragraph: ${error}`);\n    }\n  }\n\n  getParagraphs(start: number, count: number): OperationResult<Paragraph[]> {\n    try {\n      const paragraphs = this.getParagraphsInternal();\n\n      if (start < 0 || start >= paragraphs.length) {\n        return this.createErrorResult(\n          `Start index ${start} out of range`,\n          `Valid range: 0-${paragraphs.length - 1}`\n        );\n      }\n\n      const end = Math.min(start + count, paragraphs.length);\n      const result = paragraphs.slice(start, end).map((text, i) => ({\n        index: start + i,\n        text,\n        style: 'Normal',\n        charCount: text.length,\n      }));\n\n      return this.createResult(result);\n    } catch (error) {\n      return this.createErrorResult(`Failed to get paragraphs: ${error}`);\n    }\n  }\n\n  insertParagraph(text: string, options?: {\n    afterIndex?: number;\n    style?: 'Normal' | 'Heading 1' | 'Heading 2' | 'Heading 3' | 'List';\n  }): OperationResult<{ index: number }> {\n    try {\n      const paragraphs = this.getParagraphsInternal();\n      const insertIndex = options?.afterIndex !== undefined\n        ? options.afterIndex + 1\n        : paragraphs.length;\n\n      // Move to end of target paragraph or document end\n      if (insertIndex > 0 && insertIndex <= paragraphs.length) {\n        // Navigate to position\n        this.lok.postUnoCommand(this.docPtr, '.uno:GoToEndOfDoc');\n      }\n\n      // Insert paragraph break and text\n      this.lok.postUnoCommand(this.docPtr, '.uno:InsertPara');\n\n      // Insert the text\n      const textArgs = JSON.stringify({\n        Text: { type: 'string', value: text },\n      });\n      this.lok.postUnoCommand(this.docPtr, '.uno:InsertText', textArgs);\n\n      // Apply style if specified\n      if (options?.style && options.style !== 'Normal') {\n        const styleMap: Record<string, string> = {\n          'Heading 1': 'Heading 1',\n          'Heading 2': 'Heading 2',\n          'Heading 3': 'Heading 3',\n          'List': 'List',\n        };\n        const styleName = styleMap[options.style];\n        if (styleName) {\n          const styleArgs = JSON.stringify({\n            Template: { type: 'string', value: styleName },\n            Family: { type: 'short', value: 2 }, // Paragraph styles\n          });\n          this.lok.postUnoCommand(this.docPtr, '.uno:StyleApply', styleArgs);\n        }\n      }\n\n      // Invalidate cache\n      this.cachedParagraphs = null;\n\n      // Verify by re-reading\n      const newParagraphs = this.getParagraphsInternal();\n      const verified = newParagraphs.length > paragraphs.length;\n\n      return {\n        success: true,\n        verified,\n        data: { index: insertIndex },\n      };\n    } catch (error) {\n      return this.createErrorResult(`Failed to insert paragraph: ${error}`);\n    }\n  }\n\n  replaceParagraph(index: number, text: string): OperationResult<{ oldText: string }> {\n    try {\n      const paragraphs = this.getParagraphsInternal();\n\n      if (index < 0 || index >= paragraphs.length) {\n        return this.createErrorResult(\n          `Paragraph index ${index} out of range`,\n          `Valid range: 0-${paragraphs.length - 1}`\n        );\n      }\n\n      const oldText = paragraphs[index]!;\n\n      // Select the paragraph and replace\n      // This is a simplified implementation - full implementation would use cursor positioning\n      const findReplaceArgs = JSON.stringify({\n        'SearchItem.SearchString': { type: 'string', value: oldText },\n        'SearchItem.ReplaceString': { type: 'string', value: text },\n        'SearchItem.Command': { type: 'long', value: 2 }, // Replace\n      });\n      this.lok.postUnoCommand(this.docPtr, '.uno:ExecuteSearch', findReplaceArgs);\n\n      // Invalidate cache\n      this.cachedParagraphs = null;\n\n      return this.createResult({ oldText });\n    } catch (error) {\n      return this.createErrorResult(`Failed to replace paragraph: ${error}`);\n    }\n  }\n\n  deleteParagraph(index: number): OperationResult<{ deletedText: string }> {\n    try {\n      const paragraphs = this.getParagraphsInternal();\n\n      if (index < 0 || index >= paragraphs.length) {\n        return this.createErrorResult(\n          `Paragraph index ${index} out of range`,\n          `Valid range: 0-${paragraphs.length - 1}`\n        );\n      }\n\n      const deletedText = paragraphs[index]!;\n\n      // Replace with empty string\n      const result = this.replaceParagraph(index, '');\n      if (!result.success) {\n        return this.createErrorResult(result.error || 'Failed to delete');\n      }\n\n      return this.createResult({ deletedText });\n    } catch (error) {\n      return this.createErrorResult(`Failed to delete paragraph: ${error}`);\n    }\n  }\n\n  insertText(text: string, _position: TextPosition): OperationResult<void> {\n    try {\n      // TODO: Navigate to position using cursor before inserting\n      const textArgs = JSON.stringify({\n        Text: { type: 'string', value: text },\n      });\n      this.lok.postUnoCommand(this.docPtr, '.uno:InsertText', textArgs);\n\n      this.cachedParagraphs = null;\n      return this.createResult(undefined);\n    } catch (error) {\n      return this.createErrorResult(`Failed to insert text: ${error}`);\n    }\n  }\n\n  deleteText(_start: TextPosition, _end: TextPosition): OperationResult<{ deleted: string }> {\n    try {\n      // TODO: Use start/end to select text range before deleting\n      // Get current selection\n      const selection = this.lok.getTextSelection(this.docPtr, 'text/plain');\n\n      // Delete selection\n      this.lok.postUnoCommand(this.docPtr, '.uno:Delete');\n\n      this.cachedParagraphs = null;\n      return this.createResult({ deleted: selection || '' });\n    } catch (error) {\n      return this.createErrorResult(`Failed to delete text: ${error}`);\n    }\n  }\n\n  replaceText(find: string, replace: string, options?: {\n    paragraph?: number;\n    all?: boolean;\n  }): OperationResult<{ replacements: number }> {\n    try {\n      const command = options?.all ? 3 : 2; // 3 = Replace All, 2 = Replace\n\n      const searchArgs = JSON.stringify({\n        'SearchItem.SearchString': { type: 'string', value: find },\n        'SearchItem.ReplaceString': { type: 'string', value: replace },\n        'SearchItem.Command': { type: 'long', value: command },\n      });\n\n      this.lok.postUnoCommand(this.docPtr, '.uno:ExecuteSearch', searchArgs);\n\n      this.cachedParagraphs = null;\n\n      // LOK doesn't return count, we indicate success\n      return this.createResult({ replacements: -1 });\n    } catch (error) {\n      return this.createErrorResult(`Failed to replace text: ${error}`);\n    }\n  }\n\n  formatText(_range: TextRange, format: TextFormat): OperationResult<void> {\n    try {\n      // TODO: Use range to select text before applying format\n      // Apply formatting commands\n      if (format.bold !== undefined) {\n        this.lok.postUnoCommand(this.docPtr, '.uno:Bold');\n      }\n      if (format.italic !== undefined) {\n        this.lok.postUnoCommand(this.docPtr, '.uno:Italic');\n      }\n      if (format.underline !== undefined) {\n        this.lok.postUnoCommand(this.docPtr, '.uno:Underline');\n      }\n      if (format.fontSize !== undefined) {\n        const args = JSON.stringify({\n          FontHeight: { type: 'float', value: format.fontSize },\n        });\n        this.lok.postUnoCommand(this.docPtr, '.uno:FontHeight', args);\n      }\n      if (format.fontName !== undefined) {\n        const args = JSON.stringify({\n          CharFontName: { type: 'string', value: format.fontName },\n        });\n        this.lok.postUnoCommand(this.docPtr, '.uno:CharFontName', args);\n      }\n\n      return this.createResult(undefined);\n    } catch (error) {\n      return this.createErrorResult(`Failed to format text: ${error}`);\n    }\n  }\n\n  /**\n   * Get the text formatting at the current selection or cursor position.\n   *\n   * Uses LOK callback mechanism to retrieve STATE_CHANGED events which contain\n   * formatting state like `.uno:Bold=true`, `.uno:Italic=false`, etc.\n   *\n   * @param _position - Text position (currently unused, uses current selection)\n   * @returns TextFormat with bold, italic, underline, fontSize, fontName properties\n   */\n  getFormat(_position?: TextPosition): OperationResult<TextFormat> {\n    try {\n      // Clear any existing callback events\n      this.lok.clearCallbackQueue();\n\n      // Trigger a selection change to get current formatting state\n      // Moving cursor slightly and back triggers STATE_CHANGED callbacks\n      this.lok.postUnoCommand(this.docPtr, '.uno:CharRightSel');\n      this.lok.flushCallbacks(this.docPtr);\n      this.lok.postUnoCommand(this.docPtr, '.uno:CharLeft');\n      this.lok.flushCallbacks(this.docPtr);\n\n      // Poll STATE_CHANGED events to get formatting state\n      const states = this.lok.pollStateChanges();\n\n      // Parse the state values into TextFormat\n      const format: TextFormat = {};\n\n      // Bold: .uno:Bold=true or .uno:Bold=false\n      const boldState = states.get('.uno:Bold');\n      if (boldState !== undefined) {\n        format.bold = boldState === 'true';\n      }\n\n      // Italic: .uno:Italic=true or .uno:Italic=false\n      const italicState = states.get('.uno:Italic');\n      if (italicState !== undefined) {\n        format.italic = italicState === 'true';\n      }\n\n      // Underline: .uno:Underline=true or .uno:Underline=false\n      const underlineState = states.get('.uno:Underline');\n      if (underlineState !== undefined) {\n        format.underline = underlineState === 'true';\n      }\n\n      // Font size: .uno:FontHeight=12\n      const fontSizeState = states.get('.uno:FontHeight');\n      if (fontSizeState !== undefined) {\n        const size = parseFloat(fontSizeState);\n        if (!isNaN(size)) {\n          format.fontSize = size;\n        }\n      }\n\n      // Font name: .uno:CharFontName=Arial\n      const fontNameState = states.get('.uno:CharFontName');\n      if (fontNameState !== undefined && fontNameState.length > 0) {\n        format.fontName = fontNameState;\n      }\n\n      return this.createResult(format);\n    } catch (error) {\n      return this.createErrorResult(`Failed to get format: ${error}`);\n    }\n  }\n\n  /**\n   * Get formatting state for the current selection using the callback mechanism.\n   * This is the preferred way to get character formatting as it uses LOK's\n   * STATE_CHANGED callback events.\n   *\n   * @returns Map of UNO command names to their state values\n   */\n  getSelectionFormat(): OperationResult<Map<string, string>> {\n    try {\n      // Poll any existing STATE_CHANGED events (from previous operations)\n      const existingStates = this.lok.pollStateChanges();\n\n      if (existingStates.size === 0) {\n        // No existing states, trigger a selection to get current format\n        this.lok.clearCallbackQueue();\n        this.lok.postUnoCommand(this.docPtr, '.uno:SelectWord');\n        this.lok.flushCallbacks(this.docPtr);\n        const states = this.lok.pollStateChanges();\n        return this.createResult(states);\n      }\n\n      return this.createResult(existingStates);\n    } catch (error) {\n      return this.createErrorResult(`Failed to get selection format: ${error}`);\n    }\n  }\n\n  // ============================================\n  // Private helpers\n  // ============================================\n\n  private getParagraphsInternal(): string[] {\n    if (this.cachedParagraphs) {\n      return this.cachedParagraphs;\n    }\n\n    const allText = this.lok.getAllText(this.docPtr);\n    if (!allText) {\n      return [];\n    }\n\n    // Split by double newlines (paragraph breaks) or single newlines\n    this.cachedParagraphs = allText\n      .split(/\\n\\n|\\r\\n\\r\\n/)\n      .map(p => p.trim())\n      .filter(p => p.length > 0);\n\n    return this.cachedParagraphs;\n  }\n}\n","// src/editor/calc.ts\nimport { OfficeEditor } from './base.js';\nimport type {\n  OperationResult,\n  CalcStructure,\n  CellRef,\n  RangeRef,\n  SheetRef,\n  ColRef,\n  CellData,\n  CellValue,\n  CellFormat,\n  SheetInfo,\n} from './types.js';\n\n/**\n * Editor for Calc (spreadsheet) documents\n */\nexport class CalcEditor extends OfficeEditor {\n  getDocumentType(): 'calc' {\n    return 'calc';\n  }\n\n  getStructure(_options?: { maxResponseChars?: number }): OperationResult<CalcStructure> {\n    try {\n      const numSheets = this.lok.documentGetParts(this.docPtr);\n      const sheets: SheetInfo[] = [];\n\n      for (let i = 0; i < numSheets; i++) {\n        const name = this.lok.getPartName(this.docPtr, i) || `Sheet${i + 1}`;\n        const dataArea = this.lok.getDataArea(this.docPtr, i);\n\n        sheets.push({\n          index: i,\n          name,\n          usedRange: dataArea.col > 0 && dataArea.row > 0\n            ? `A1:${this.rowColToA1(dataArea.row - 1, dataArea.col - 1)}`\n            : 'A1',\n          rowCount: dataArea.row,\n          colCount: dataArea.col,\n        });\n      }\n\n      const structure: CalcStructure = {\n        type: 'calc',\n        sheets,\n      };\n\n      return this.createResult(structure);\n    } catch (error) {\n      return this.createErrorResult(`Failed to get structure: ${error}`);\n    }\n  }\n\n  getSheetNames(): OperationResult<string[]> {\n    try {\n      const numSheets = this.lok.documentGetParts(this.docPtr);\n      const names: string[] = [];\n\n      for (let i = 0; i < numSheets; i++) {\n        const name = this.lok.getPartName(this.docPtr, i) || `Sheet${i + 1}`;\n        names.push(name);\n      }\n\n      return this.createResult(names);\n    } catch (error) {\n      return this.createErrorResult(`Failed to get sheet names: ${error}`);\n    }\n  }\n\n  // ============================================\n  // Cell reading\n  // ============================================\n\n  getCell(cell: CellRef, sheet?: SheetRef): OperationResult<CellData> {\n    try {\n      this.selectSheet(sheet);\n      const { row, col } = this.normalizeCellRef(cell);\n      const address = this.rowColToA1(row, col);\n\n      // Navigate to cell\n      this.goToCell(address);\n\n      // Get value\n      const value = this.getCellValueInternal();\n      const formula = this.getCellFormulaInternal();\n\n      return this.createResult({\n        address,\n        value,\n        formula: formula || undefined,\n      });\n    } catch (error) {\n      return this.createErrorResult(`Failed to get cell: ${error}`);\n    }\n  }\n\n  getCells(range: RangeRef, sheet?: SheetRef, options?: {\n    maxResponseChars?: number;\n  }): OperationResult<CellData[][]> {\n    try {\n      this.selectSheet(sheet);\n      const { startRow, startCol, endRow, endCol } = this.normalizeRangeRef(range);\n      const maxChars = options?.maxResponseChars ?? this.options.maxResponseChars;\n\n      const cells: CellData[][] = [];\n      let charCount = 0;\n      let truncated = false;\n\n      for (let r = startRow; r <= endRow && !truncated; r++) {\n        const rowData: CellData[] = [];\n\n        for (let c = startCol; c <= endCol && !truncated; c++) {\n          const address = this.rowColToA1(r, c);\n          this.goToCell(address);\n\n          const value = this.getCellValueInternal();\n          const cellData: CellData = { address, value };\n\n          const cellStr = JSON.stringify(cellData);\n          if (charCount + cellStr.length > maxChars) {\n            truncated = true;\n            break;\n          }\n\n          charCount += cellStr.length;\n          rowData.push(cellData);\n        }\n\n        if (rowData.length > 0) {\n          cells.push(rowData);\n        }\n      }\n\n      if (truncated) {\n        return this.createResultWithTruncation(cells, {\n          original: (endRow - startRow + 1) * (endCol - startCol + 1),\n          returned: cells.reduce((sum, row) => sum + row.length, 0),\n          message: 'Range truncated due to size. Use smaller ranges to paginate.',\n        });\n      }\n\n      return this.createResult(cells);\n    } catch (error) {\n      return this.createErrorResult(`Failed to get cells: ${error}`);\n    }\n  }\n\n  // ============================================\n  // Cell writing\n  // ============================================\n\n  setCellValue(cell: CellRef, value: string | number, sheet?: SheetRef): OperationResult<{\n    oldValue: CellValue;\n    newValue: CellValue;\n  }> {\n    try {\n      this.selectSheet(sheet);\n      const { row, col } = this.normalizeCellRef(cell);\n      const address = this.rowColToA1(row, col);\n\n      // Get old value first\n      this.goToCell(address);\n      const oldValue = this.getCellValueInternal();\n\n      // Enter the new value\n      const valueStr = typeof value === 'number' ? value.toString() : value;\n      const args = JSON.stringify({\n        StringName: { type: 'string', value: valueStr },\n      });\n      this.lok.postUnoCommand(this.docPtr, '.uno:EnterString', args);\n\n      // Verify by re-reading the cell\n      const newValue = this.getCellValueInternal();\n      const expectedStr = typeof value === 'number' ? value.toString() : value;\n      const verified = newValue === expectedStr || newValue === value;\n\n      return {\n        success: true,\n        verified,\n        data: { oldValue, newValue },\n      };\n    } catch (error) {\n      return this.createErrorResult(`Failed to set cell value: ${error}`);\n    }\n  }\n\n  setCellFormula(cell: CellRef, formula: string, sheet?: SheetRef): OperationResult<{\n    calculatedValue: CellValue;\n  }> {\n    try {\n      this.selectSheet(sheet);\n      const { row, col } = this.normalizeCellRef(cell);\n      const address = this.rowColToA1(row, col);\n\n      // Navigate and enter formula\n      this.goToCell(address);\n\n      const args = JSON.stringify({\n        StringName: { type: 'string', value: formula },\n      });\n      this.lok.postUnoCommand(this.docPtr, '.uno:EnterString', args);\n\n      // Get calculated value\n      const calculatedValue = this.getCellValueInternal();\n\n      return this.createResult({ calculatedValue });\n    } catch (error) {\n      return this.createErrorResult(`Failed to set formula: ${error}`);\n    }\n  }\n\n  setCells(range: RangeRef, values: CellValue[][], sheet?: SheetRef): OperationResult<{\n    cellsUpdated: number;\n  }> {\n    try {\n      this.selectSheet(sheet);\n      const { startRow, startCol } = this.normalizeRangeRef(range);\n      let cellsUpdated = 0;\n\n      for (let r = 0; r < values.length; r++) {\n        const rowValues = values[r];\n        if (!rowValues) continue;\n\n        for (let c = 0; c < rowValues.length; c++) {\n          const value = rowValues[c];\n          if (value === null || value === undefined) continue;\n\n          const address = this.rowColToA1(startRow + r, startCol + c);\n          this.goToCell(address);\n\n          const valueStr = typeof value === 'number' ? value.toString() : String(value);\n          const args = JSON.stringify({\n            StringName: { type: 'string', value: valueStr },\n          });\n          this.lok.postUnoCommand(this.docPtr, '.uno:EnterString', args);\n          cellsUpdated++;\n        }\n      }\n\n      return this.createResult({ cellsUpdated });\n    } catch (error) {\n      return this.createErrorResult(`Failed to set cells: ${error}`);\n    }\n  }\n\n  // ============================================\n  // Clear operations\n  // ============================================\n\n  clearCell(cell: CellRef, sheet?: SheetRef): OperationResult<{ oldValue: CellValue }> {\n    try {\n      this.selectSheet(sheet);\n      const { row, col } = this.normalizeCellRef(cell);\n      const address = this.rowColToA1(row, col);\n\n      this.goToCell(address);\n      const oldValue = this.getCellValueInternal();\n\n      this.lok.postUnoCommand(this.docPtr, '.uno:ClearContents');\n\n      return this.createResult({ oldValue });\n    } catch (error) {\n      return this.createErrorResult(`Failed to clear cell: ${error}`);\n    }\n  }\n\n  clearRange(range: RangeRef, sheet?: SheetRef): OperationResult<{ cellsCleared: number }> {\n    try {\n      this.selectSheet(sheet);\n      const rangeStr = this.normalizeRangeToString(range);\n\n      // Select range and clear\n      this.goToCell(rangeStr);\n      this.lok.postUnoCommand(this.docPtr, '.uno:ClearContents');\n\n      // Count is approximate\n      const { startRow, startCol, endRow, endCol } = this.normalizeRangeRef(range);\n      const cellsCleared = (endRow - startRow + 1) * (endCol - startCol + 1);\n\n      return this.createResult({ cellsCleared });\n    } catch (error) {\n      return this.createErrorResult(`Failed to clear range: ${error}`);\n    }\n  }\n\n  // ============================================\n  // Row/Column operations\n  // ============================================\n\n  insertRow(afterRow: number, sheet?: SheetRef): OperationResult<void> {\n    try {\n      this.selectSheet(sheet);\n      this.goToCell(this.rowColToA1(afterRow + 1, 0));\n      this.lok.postUnoCommand(this.docPtr, '.uno:InsertRows');\n      return this.createResult(undefined);\n    } catch (error) {\n      return this.createErrorResult(`Failed to insert row: ${error}`);\n    }\n  }\n\n  insertColumn(afterCol: ColRef, sheet?: SheetRef): OperationResult<void> {\n    try {\n      this.selectSheet(sheet);\n      const colNum = typeof afterCol === 'string'\n        ? this.a1ToRowCol(afterCol + '1').col + 1\n        : afterCol + 1;\n\n      this.goToCell(this.rowColToA1(0, colNum));\n      this.lok.postUnoCommand(this.docPtr, '.uno:InsertColumns');\n      return this.createResult(undefined);\n    } catch (error) {\n      return this.createErrorResult(`Failed to insert column: ${error}`);\n    }\n  }\n\n  deleteRow(row: number, sheet?: SheetRef): OperationResult<void> {\n    try {\n      this.selectSheet(sheet);\n      this.goToCell(this.rowColToA1(row, 0));\n      this.lok.postUnoCommand(this.docPtr, '.uno:DeleteRows');\n      return this.createResult(undefined);\n    } catch (error) {\n      return this.createErrorResult(`Failed to delete row: ${error}`);\n    }\n  }\n\n  deleteColumn(col: ColRef, sheet?: SheetRef): OperationResult<void> {\n    try {\n      this.selectSheet(sheet);\n      const colNum = typeof col === 'string'\n        ? this.a1ToRowCol(col + '1').col\n        : col;\n\n      this.goToCell(this.rowColToA1(0, colNum));\n      this.lok.postUnoCommand(this.docPtr, '.uno:DeleteColumns');\n      return this.createResult(undefined);\n    } catch (error) {\n      return this.createErrorResult(`Failed to delete column: ${error}`);\n    }\n  }\n\n  // ============================================\n  // Formatting\n  // ============================================\n\n  formatCells(range: RangeRef, format: CellFormat, sheet?: SheetRef): OperationResult<void> {\n    try {\n      this.selectSheet(sheet);\n      const rangeStr = this.normalizeRangeToString(range);\n      this.goToCell(rangeStr);\n\n      if (format.bold !== undefined) {\n        this.lok.postUnoCommand(this.docPtr, '.uno:Bold');\n      }\n      if (format.numberFormat !== undefined) {\n        const args = JSON.stringify({\n          NumberFormatValue: { type: 'string', value: format.numberFormat },\n        });\n        this.lok.postUnoCommand(this.docPtr, '.uno:NumberFormatValue', args);\n      }\n      if (format.backgroundColor !== undefined) {\n        const args = JSON.stringify({\n          BackgroundColor: { type: 'long', value: this.hexToNumber(format.backgroundColor) },\n        });\n        this.lok.postUnoCommand(this.docPtr, '.uno:BackgroundColor', args);\n      }\n\n      return this.createResult(undefined);\n    } catch (error) {\n      return this.createErrorResult(`Failed to format cells: ${error}`);\n    }\n  }\n\n  // ============================================\n  // Sheet management\n  // ============================================\n\n  addSheet(name: string): OperationResult<{ index: number }> {\n    try {\n      const args = JSON.stringify({\n        Name: { type: 'string', value: name },\n      });\n      this.lok.postUnoCommand(this.docPtr, '.uno:Insert', args);\n\n      const numSheets = this.lok.documentGetParts(this.docPtr);\n      return this.createResult({ index: numSheets - 1 });\n    } catch (error) {\n      return this.createErrorResult(`Failed to add sheet: ${error}`);\n    }\n  }\n\n  renameSheet(sheet: SheetRef, newName: string): OperationResult<void> {\n    try {\n      this.selectSheet(sheet);\n      const args = JSON.stringify({\n        Name: { type: 'string', value: newName },\n      });\n      this.lok.postUnoCommand(this.docPtr, '.uno:RenameTable', args);\n      return this.createResult(undefined);\n    } catch (error) {\n      return this.createErrorResult(`Failed to rename sheet: ${error}`);\n    }\n  }\n\n  deleteSheet(sheet: SheetRef): OperationResult<void> {\n    try {\n      this.selectSheet(sheet);\n      this.lok.postUnoCommand(this.docPtr, '.uno:Remove');\n      return this.createResult(undefined);\n    } catch (error) {\n      return this.createErrorResult(`Failed to delete sheet: ${error}`);\n    }\n  }\n\n  // ============================================\n  // Private helpers\n  // ============================================\n\n  private selectSheet(sheet?: SheetRef): void {\n    if (sheet === undefined) return;\n\n    const index = typeof sheet === 'number'\n      ? sheet\n      : this.getSheetIndexByName(sheet);\n\n    if (index >= 0) {\n      this.lok.documentSetPart(this.docPtr, index);\n    }\n  }\n\n  private getSheetIndexByName(name: string): number {\n    const numSheets = this.lok.documentGetParts(this.docPtr);\n    for (let i = 0; i < numSheets; i++) {\n      if (this.lok.getPartName(this.docPtr, i) === name) {\n        return i;\n      }\n    }\n    return -1;\n  }\n\n  private goToCell(address: string): void {\n    const args = JSON.stringify({\n      ToPoint: { type: 'string', value: address },\n    });\n    this.lok.postUnoCommand(this.docPtr, '.uno:GoToCell', args);\n  }\n\n  private getCellValueInternal(): CellValue {\n    const text = this.lok.getTextSelection(this.docPtr, 'text/plain');\n    if (!text) return null;\n\n    // Try to parse as number\n    const num = parseFloat(text);\n    if (!isNaN(num) && text.trim() === num.toString()) {\n      return num;\n    }\n\n    // Check for boolean\n    if (text.toLowerCase() === 'true') return true;\n    if (text.toLowerCase() === 'false') return false;\n\n    return text;\n  }\n\n  private getCellFormulaInternal(): string | null {\n    const result = this.lok.getCommandValues(this.docPtr, '.uno:GetFormulaBarText');\n    if (!result) return null;\n\n    try {\n      const parsed = JSON.parse(result);\n      return parsed.value || null;\n    } catch {\n      return null;\n    }\n  }\n\n  private normalizeRangeRef(range: RangeRef): {\n    startRow: number;\n    startCol: number;\n    endRow: number;\n    endCol: number;\n  } {\n    if (typeof range === 'string') {\n      const parts = range.split(':');\n      const start = this.a1ToRowCol(parts[0]!);\n      const end = parts[1] ? this.a1ToRowCol(parts[1]) : start;\n      return {\n        startRow: start.row,\n        startCol: start.col,\n        endRow: end.row,\n        endCol: end.col,\n      };\n    }\n\n    const start = this.normalizeCellRef(range.start);\n    const end = this.normalizeCellRef(range.end);\n    return {\n      startRow: start.row,\n      startCol: start.col,\n      endRow: end.row,\n      endCol: end.col,\n    };\n  }\n\n  private normalizeRangeToString(range: RangeRef): string {\n    if (typeof range === 'string') return range;\n\n    const start = this.normalizeCellRef(range.start);\n    const end = this.normalizeCellRef(range.end);\n    return `${this.rowColToA1(start.row, start.col)}:${this.rowColToA1(end.row, end.col)}`;\n  }\n\n  private hexToNumber(hex: string): number {\n    return parseInt(hex.replace('#', ''), 16);\n  }\n}\n","// src/editor/impress.ts\nimport { OfficeEditor } from './base.js';\nimport type {\n  OperationResult,\n  ImpressStructure,\n  SlideData,\n  SlideInfo,\n  SlideLayout,\n  TextFrame,\n} from './types.js';\n\n/**\n * Editor for Impress (presentation) documents\n */\nexport class ImpressEditor extends OfficeEditor {\n  getDocumentType(): 'impress' {\n    return 'impress';\n  }\n\n  getStructure(_options?: { maxResponseChars?: number }): OperationResult<ImpressStructure> {\n    try {\n      const numSlides = this.lok.documentGetParts(this.docPtr);\n      const slides: SlideInfo[] = [];\n\n      for (let i = 0; i < numSlides; i++) {\n        const slideData = this.getSlideInfoInternal(i);\n        slides.push(slideData);\n      }\n\n      const structure: ImpressStructure = {\n        type: 'impress',\n        slides,\n        slideCount: numSlides,\n      };\n\n      return this.createResult(structure);\n    } catch (error) {\n      return this.createErrorResult(`Failed to get structure: ${error}`);\n    }\n  }\n\n  // ============================================\n  // Slide reading\n  // ============================================\n\n  getSlide(index: number): OperationResult<SlideData> {\n    try {\n      const numSlides = this.lok.documentGetParts(this.docPtr);\n\n      if (index < 0 || index >= numSlides) {\n        return this.createErrorResult(\n          `Invalid slide index: ${index}. Valid range: 0-${numSlides - 1}`,\n          'Use getStructure() to see available slides'\n        );\n      }\n\n      this.lok.documentSetPart(this.docPtr, index);\n      const text = this.lok.getAllText(this.docPtr) || '';\n      const textFrames = this.parseTextFrames(text);\n\n      const slideData: SlideData = {\n        index,\n        title: textFrames.find(f => f.type === 'title')?.text,\n        textFrames,\n        hasNotes: false, // Could detect from LOK if available\n      };\n\n      return this.createResult(slideData);\n    } catch (error) {\n      return this.createErrorResult(`Failed to get slide: ${error}`);\n    }\n  }\n\n  getSlideCount(): OperationResult<number> {\n    try {\n      const count = this.lok.documentGetParts(this.docPtr);\n      return this.createResult(count);\n    } catch (error) {\n      return this.createErrorResult(`Failed to get slide count: ${error}`);\n    }\n  }\n\n  // ============================================\n  // Slide management\n  // ============================================\n\n  addSlide(options?: { afterSlide?: number; layout?: SlideLayout }): OperationResult<{ index: number }> {\n    try {\n      const numSlides = this.lok.documentGetParts(this.docPtr);\n\n      // Navigate to position if specified\n      if (options?.afterSlide !== undefined) {\n        this.lok.documentSetPart(this.docPtr, options.afterSlide);\n      } else {\n        // Go to last slide\n        this.lok.documentSetPart(this.docPtr, numSlides - 1);\n      }\n\n      // Insert new slide\n      this.lok.postUnoCommand(this.docPtr, '.uno:InsertPage');\n\n      // Apply layout if specified\n      if (options?.layout) {\n        this.applySlideLayout(options.layout);\n      }\n\n      const newIndex = options?.afterSlide !== undefined\n        ? options.afterSlide + 1\n        : numSlides;\n\n      // Verify by checking slide count increased\n      const newNumSlides = this.lok.documentGetParts(this.docPtr);\n      const verified = newNumSlides > numSlides;\n\n      return {\n        success: true,\n        verified,\n        data: { index: newIndex },\n      };\n    } catch (error) {\n      return this.createErrorResult(`Failed to add slide: ${error}`);\n    }\n  }\n\n  deleteSlide(index: number): OperationResult<void> {\n    try {\n      const numSlides = this.lok.documentGetParts(this.docPtr);\n\n      if (numSlides <= 1) {\n        return this.createErrorResult(\n          'Cannot delete the last slide',\n          'A presentation must have at least one slide'\n        );\n      }\n\n      if (index < 0 || index >= numSlides) {\n        return this.createErrorResult(\n          `Invalid slide index: ${index}`,\n          `Valid range: 0-${numSlides - 1}`\n        );\n      }\n\n      this.lok.documentSetPart(this.docPtr, index);\n      this.lok.postUnoCommand(this.docPtr, '.uno:DeletePage');\n\n      return this.createResult(undefined);\n    } catch (error) {\n      return this.createErrorResult(`Failed to delete slide: ${error}`);\n    }\n  }\n\n  duplicateSlide(index: number): OperationResult<{ newIndex: number }> {\n    try {\n      const numSlides = this.lok.documentGetParts(this.docPtr);\n\n      if (index < 0 || index >= numSlides) {\n        return this.createErrorResult(\n          `Invalid slide index: ${index}`,\n          `Valid range: 0-${numSlides - 1}`\n        );\n      }\n\n      this.lok.documentSetPart(this.docPtr, index);\n      this.lok.postUnoCommand(this.docPtr, '.uno:DuplicatePage');\n\n      return this.createResult({ newIndex: index + 1 });\n    } catch (error) {\n      return this.createErrorResult(`Failed to duplicate slide: ${error}`);\n    }\n  }\n\n  moveSlide(fromIndex: number, toIndex: number): OperationResult<void> {\n    try {\n      const numSlides = this.lok.documentGetParts(this.docPtr);\n\n      if (fromIndex < 0 || fromIndex >= numSlides || toIndex < 0 || toIndex >= numSlides) {\n        return this.createErrorResult(\n          `Invalid slide indices. Valid range: 0-${numSlides - 1}`,\n          'Check slide indices are within bounds'\n        );\n      }\n\n      if (fromIndex === toIndex) {\n        return this.createErrorResult(\n          'Source and destination are the same',\n          'Provide different indices to move'\n        );\n      }\n\n      // LOK doesn't have direct slide move - we simulate via cut/paste\n      this.lok.documentSetPart(this.docPtr, fromIndex);\n\n      const args = JSON.stringify({\n        Position: { type: 'long', value: toIndex },\n      });\n      this.lok.postUnoCommand(this.docPtr, '.uno:MovePageFirst', args);\n\n      return this.createResult(undefined);\n    } catch (error) {\n      return this.createErrorResult(`Failed to move slide: ${error}`);\n    }\n  }\n\n  // ============================================\n  // Slide content editing\n  // ============================================\n\n  setSlideTitle(index: number, title: string): OperationResult<{ oldTitle?: string }> {\n    try {\n      const numSlides = this.lok.documentGetParts(this.docPtr);\n\n      if (index < 0 || index >= numSlides) {\n        return this.createErrorResult(`Invalid slide index: ${index}`);\n      }\n\n      this.lok.documentSetPart(this.docPtr, index);\n\n      // Get current title\n      const text = this.lok.getAllText(this.docPtr) || '';\n      const frames = this.parseTextFrames(text);\n      const oldTitle = frames.find(f => f.type === 'title')?.text;\n\n      // Select title placeholder and replace\n      this.lok.postUnoCommand(this.docPtr, '.uno:SelectAll');\n\n      // Enter title text (this replaces first text frame typically)\n      const args = JSON.stringify({\n        Text: { type: 'string', value: title },\n      });\n      this.lok.postUnoCommand(this.docPtr, '.uno:InsertText', args);\n\n      return this.createResult({ oldTitle });\n    } catch (error) {\n      return this.createErrorResult(`Failed to set slide title: ${error}`);\n    }\n  }\n\n  setSlideBody(index: number, body: string): OperationResult<{ oldBody?: string }> {\n    try {\n      const numSlides = this.lok.documentGetParts(this.docPtr);\n\n      if (index < 0 || index >= numSlides) {\n        return this.createErrorResult(`Invalid slide index: ${index}`);\n      }\n\n      this.lok.documentSetPart(this.docPtr, index);\n\n      // Get current body\n      const text = this.lok.getAllText(this.docPtr) || '';\n      const frames = this.parseTextFrames(text);\n      const oldBody = frames.find(f => f.type === 'body')?.text;\n\n      // Navigate to body and replace\n      // Using Tab to move from title to body placeholder\n      this.lok.postUnoCommand(this.docPtr, '.uno:NextObject');\n\n      const args = JSON.stringify({\n        Text: { type: 'string', value: body },\n      });\n      this.lok.postUnoCommand(this.docPtr, '.uno:InsertText', args);\n\n      return this.createResult({ oldBody });\n    } catch (error) {\n      return this.createErrorResult(`Failed to set slide body: ${error}`);\n    }\n  }\n\n  setSlideNotes(index: number, notes: string): OperationResult<void> {\n    try {\n      const numSlides = this.lok.documentGetParts(this.docPtr);\n\n      if (index < 0 || index >= numSlides) {\n        return this.createErrorResult(`Invalid slide index: ${index}`);\n      }\n\n      this.lok.documentSetPart(this.docPtr, index);\n\n      // Switch to notes view and insert text\n      this.lok.postUnoCommand(this.docPtr, '.uno:NotesMode');\n\n      const args = JSON.stringify({\n        Text: { type: 'string', value: notes },\n      });\n      this.lok.postUnoCommand(this.docPtr, '.uno:InsertText', args);\n\n      // Switch back to normal view\n      this.lok.postUnoCommand(this.docPtr, '.uno:NormalViewMode');\n\n      return this.createResult(undefined);\n    } catch (error) {\n      return this.createErrorResult(`Failed to set slide notes: ${error}`);\n    }\n  }\n\n  // ============================================\n  // Slide layout\n  // ============================================\n\n  setSlideLayout(index: number, layout: SlideLayout): OperationResult<void> {\n    try {\n      const numSlides = this.lok.documentGetParts(this.docPtr);\n\n      if (index < 0 || index >= numSlides) {\n        return this.createErrorResult(`Invalid slide index: ${index}`);\n      }\n\n      this.lok.documentSetPart(this.docPtr, index);\n      this.applySlideLayout(layout);\n\n      return this.createResult(undefined);\n    } catch (error) {\n      return this.createErrorResult(`Failed to set slide layout: ${error}`);\n    }\n  }\n\n  // ============================================\n  // Private helpers\n  // ============================================\n\n  private getSlideInfoInternal(index: number): SlideInfo {\n    this.lok.documentSetPart(this.docPtr, index);\n\n    const text = this.lok.getAllText(this.docPtr) || '';\n    const frames = this.parseTextFrames(text);\n    const titleFrame = frames.find(f => f.type === 'title');\n\n    return {\n      index,\n      title: titleFrame?.text,\n      layout: this.detectLayout(frames),\n      textFrameCount: frames.length,\n    };\n  }\n\n  private parseTextFrames(text: string): TextFrame[] {\n    // Parse text content into frames\n    // In Impress, text is typically separated by paragraph breaks\n    const paragraphs = text.split(/\\n\\n+/).filter(p => p.trim());\n    const frames: TextFrame[] = [];\n\n    paragraphs.forEach((para, idx) => {\n      const type = idx === 0 ? 'title' : (idx === 1 ? 'body' : 'other');\n      frames.push({\n        index: idx,\n        type: type as TextFrame['type'],\n        text: para.trim(),\n        bounds: { x: 0, y: 0, width: 0, height: 0 }, // Would need LOK API for actual bounds\n      });\n    });\n\n    return frames;\n  }\n\n  private detectLayout(frames: TextFrame[]): SlideLayout {\n    if (frames.length === 0) return 'blank';\n    if (frames.length === 1 && frames[0]?.type === 'title') return 'title';\n    if (frames.length >= 2) return 'titleContent';\n    return 'blank';\n  }\n\n  private applySlideLayout(layout: SlideLayout): void {\n    // Map layout names to LOK layout IDs\n    const layoutMap: Record<SlideLayout, number> = {\n      blank: 0,\n      title: 1,\n      titleContent: 2,\n      twoColumn: 3,\n    };\n\n    const layoutId = layoutMap[layout] ?? 0;\n    const args = JSON.stringify({\n      WhatLayout: { type: 'long', value: layoutId },\n    });\n    this.lok.postUnoCommand(this.docPtr, '.uno:AssignLayout', args);\n  }\n}\n","// src/editor/draw.ts\nimport { OfficeEditor } from './base.js';\nimport type {\n  OperationResult,\n  DrawStructure,\n  PageData,\n  PageInfo,\n  ShapeData,\n  ShapeType,\n  Rectangle,\n  Size,\n  Position,\n} from './types.js';\n\n/**\n * Editor for Draw (vector graphics) documents\n * Also handles imported PDFs opened for editing\n */\nexport class DrawEditor extends OfficeEditor {\n  private isImportedPdf: boolean = false;\n\n  getDocumentType(): 'draw' {\n    return 'draw';\n  }\n\n  setImportedPdf(value: boolean): void {\n    this.isImportedPdf = value;\n  }\n\n  getStructure(_options?: { maxResponseChars?: number }): OperationResult<DrawStructure> {\n    try {\n      const numPages = this.lok.documentGetParts(this.docPtr);\n      const pages: PageInfo[] = [];\n\n      for (let i = 0; i < numPages; i++) {\n        const pageInfo = this.getPageInfoInternal(i);\n        pages.push(pageInfo);\n      }\n\n      const structure: DrawStructure = {\n        type: 'draw',\n        pages,\n        pageCount: numPages,\n        isImportedPdf: this.isImportedPdf,\n      };\n\n      return this.createResult(structure);\n    } catch (error) {\n      return this.createErrorResult(`Failed to get structure: ${error}`);\n    }\n  }\n\n  // ============================================\n  // Page reading\n  // ============================================\n\n  getPage(index: number): OperationResult<PageData> {\n    try {\n      const numPages = this.lok.documentGetParts(this.docPtr);\n\n      if (index < 0 || index >= numPages) {\n        return this.createErrorResult(\n          `Invalid page index: ${index}. Valid range: 0-${numPages - 1}`,\n          'Use getStructure() to see available pages'\n        );\n      }\n\n      this.lok.documentSetPart(this.docPtr, index);\n      const size = this.lok.documentGetDocumentSize(this.docPtr);\n      const shapes = this.getShapesOnPage();\n\n      const pageData: PageData = {\n        index,\n        shapes,\n        size: { width: size.width, height: size.height },\n      };\n\n      return this.createResult(pageData);\n    } catch (error) {\n      return this.createErrorResult(`Failed to get page: ${error}`);\n    }\n  }\n\n  getPageCount(): OperationResult<number> {\n    try {\n      const count = this.lok.documentGetParts(this.docPtr);\n      return this.createResult(count);\n    } catch (error) {\n      return this.createErrorResult(`Failed to get page count: ${error}`);\n    }\n  }\n\n  // ============================================\n  // Page management\n  // ============================================\n\n  addPage(options?: { afterPage?: number }): OperationResult<{ index: number }> {\n    try {\n      const numPages = this.lok.documentGetParts(this.docPtr);\n\n      // Navigate to position\n      if (options?.afterPage !== undefined) {\n        this.lok.documentSetPart(this.docPtr, options.afterPage);\n      } else {\n        this.lok.documentSetPart(this.docPtr, numPages - 1);\n      }\n\n      // Insert new page\n      this.lok.postUnoCommand(this.docPtr, '.uno:InsertPage');\n\n      const newIndex = options?.afterPage !== undefined\n        ? options.afterPage + 1\n        : numPages;\n\n      return this.createResult({ index: newIndex });\n    } catch (error) {\n      return this.createErrorResult(`Failed to add page: ${error}`);\n    }\n  }\n\n  deletePage(index: number): OperationResult<void> {\n    try {\n      const numPages = this.lok.documentGetParts(this.docPtr);\n\n      if (numPages <= 1) {\n        return this.createErrorResult(\n          'Cannot delete the last page',\n          'A drawing document must have at least one page'\n        );\n      }\n\n      if (index < 0 || index >= numPages) {\n        return this.createErrorResult(\n          `Invalid page index: ${index}`,\n          `Valid range: 0-${numPages - 1}`\n        );\n      }\n\n      this.lok.documentSetPart(this.docPtr, index);\n      this.lok.postUnoCommand(this.docPtr, '.uno:DeletePage');\n\n      return this.createResult(undefined);\n    } catch (error) {\n      return this.createErrorResult(`Failed to delete page: ${error}`);\n    }\n  }\n\n  duplicatePage(index: number): OperationResult<{ newIndex: number }> {\n    try {\n      const numPages = this.lok.documentGetParts(this.docPtr);\n\n      if (index < 0 || index >= numPages) {\n        return this.createErrorResult(\n          `Invalid page index: ${index}`,\n          `Valid range: 0-${numPages - 1}`\n        );\n      }\n\n      this.lok.documentSetPart(this.docPtr, index);\n      this.lok.postUnoCommand(this.docPtr, '.uno:DuplicatePage');\n\n      return this.createResult({ newIndex: index + 1 });\n    } catch (error) {\n      return this.createErrorResult(`Failed to duplicate page: ${error}`);\n    }\n  }\n\n  // ============================================\n  // Shape operations\n  // ============================================\n\n  addShape(\n    pageIndex: number,\n    shapeType: ShapeType,\n    bounds: Rectangle,\n    options?: { text?: string; fillColor?: string; lineColor?: string }\n  ): OperationResult<{ shapeIndex: number }> {\n    try {\n      const numPages = this.lok.documentGetParts(this.docPtr);\n\n      if (pageIndex < 0 || pageIndex >= numPages) {\n        return this.createErrorResult(`Invalid page index: ${pageIndex}`);\n      }\n\n      this.lok.documentSetPart(this.docPtr, pageIndex);\n\n      // Map shape type to UNO command\n      const shapeCommand = this.getShapeCommand(shapeType);\n\n      // Set shape bounds\n      const boundsArgs = JSON.stringify({\n        X: { type: 'long', value: bounds.x },\n        Y: { type: 'long', value: bounds.y },\n        Width: { type: 'long', value: bounds.width },\n        Height: { type: 'long', value: bounds.height },\n      });\n\n      this.lok.postUnoCommand(this.docPtr, shapeCommand, boundsArgs);\n\n      // Set optional properties\n      if (options?.text) {\n        const textArgs = JSON.stringify({\n          Text: { type: 'string', value: options.text },\n        });\n        this.lok.postUnoCommand(this.docPtr, '.uno:InsertText', textArgs);\n      }\n\n      if (options?.fillColor) {\n        const colorArgs = JSON.stringify({\n          FillColor: { type: 'long', value: this.hexToNumber(options.fillColor) },\n        });\n        this.lok.postUnoCommand(this.docPtr, '.uno:FillColor', colorArgs);\n      }\n\n      if (options?.lineColor) {\n        const colorArgs = JSON.stringify({\n          LineColor: { type: 'long', value: this.hexToNumber(options.lineColor) },\n        });\n        this.lok.postUnoCommand(this.docPtr, '.uno:XLineColor', colorArgs);\n      }\n\n      // Return approximate index (would need LOK API to get actual)\n      return this.createResult({ shapeIndex: 0 });\n    } catch (error) {\n      return this.createErrorResult(`Failed to add shape: ${error}`);\n    }\n  }\n\n  addLine(\n    pageIndex: number,\n    start: Position,\n    end: Position,\n    options?: { lineColor?: string; lineWidth?: number }\n  ): OperationResult<{ shapeIndex: number }> {\n    try {\n      const numPages = this.lok.documentGetParts(this.docPtr);\n\n      if (pageIndex < 0 || pageIndex >= numPages) {\n        return this.createErrorResult(`Invalid page index: ${pageIndex}`);\n      }\n\n      this.lok.documentSetPart(this.docPtr, pageIndex);\n\n      const args = JSON.stringify({\n        StartX: { type: 'long', value: start.x },\n        StartY: { type: 'long', value: start.y },\n        EndX: { type: 'long', value: end.x },\n        EndY: { type: 'long', value: end.y },\n      });\n\n      this.lok.postUnoCommand(this.docPtr, '.uno:Line', args);\n\n      if (options?.lineColor) {\n        const colorArgs = JSON.stringify({\n          LineColor: { type: 'long', value: this.hexToNumber(options.lineColor) },\n        });\n        this.lok.postUnoCommand(this.docPtr, '.uno:XLineColor', colorArgs);\n      }\n\n      if (options?.lineWidth) {\n        const widthArgs = JSON.stringify({\n          LineWidth: { type: 'long', value: options.lineWidth },\n        });\n        this.lok.postUnoCommand(this.docPtr, '.uno:LineWidth', widthArgs);\n      }\n\n      return this.createResult({ shapeIndex: 0 });\n    } catch (error) {\n      return this.createErrorResult(`Failed to add line: ${error}`);\n    }\n  }\n\n  deleteShape(pageIndex: number, shapeIndex: number): OperationResult<void> {\n    try {\n      this.lok.documentSetPart(this.docPtr, pageIndex);\n\n      // Select shape by index (simplified - real impl would use object selection)\n      this.selectShape(shapeIndex);\n      this.lok.postUnoCommand(this.docPtr, '.uno:Delete');\n\n      return this.createResult(undefined);\n    } catch (error) {\n      return this.createErrorResult(`Failed to delete shape: ${error}`);\n    }\n  }\n\n  setShapeText(pageIndex: number, shapeIndex: number, text: string): OperationResult<void> {\n    try {\n      this.lok.documentSetPart(this.docPtr, pageIndex);\n      this.selectShape(shapeIndex);\n\n      // Enter edit mode for the shape\n      this.lok.postUnoCommand(this.docPtr, '.uno:EnterGroup');\n\n      // Replace text\n      this.lok.postUnoCommand(this.docPtr, '.uno:SelectAll');\n      const args = JSON.stringify({\n        Text: { type: 'string', value: text },\n      });\n      this.lok.postUnoCommand(this.docPtr, '.uno:InsertText', args);\n\n      // Exit edit mode\n      this.lok.postUnoCommand(this.docPtr, '.uno:LeaveGroup');\n\n      return this.createResult(undefined);\n    } catch (error) {\n      return this.createErrorResult(`Failed to set shape text: ${error}`);\n    }\n  }\n\n  moveShape(pageIndex: number, shapeIndex: number, newPosition: Position): OperationResult<void> {\n    try {\n      this.lok.documentSetPart(this.docPtr, pageIndex);\n      this.selectShape(shapeIndex);\n\n      const args = JSON.stringify({\n        X: { type: 'long', value: newPosition.x },\n        Y: { type: 'long', value: newPosition.y },\n      });\n      this.lok.postUnoCommand(this.docPtr, '.uno:SetObjectPosition', args);\n\n      return this.createResult(undefined);\n    } catch (error) {\n      return this.createErrorResult(`Failed to move shape: ${error}`);\n    }\n  }\n\n  resizeShape(pageIndex: number, shapeIndex: number, newSize: Size): OperationResult<void> {\n    try {\n      this.lok.documentSetPart(this.docPtr, pageIndex);\n      this.selectShape(shapeIndex);\n\n      const args = JSON.stringify({\n        Width: { type: 'long', value: newSize.width },\n        Height: { type: 'long', value: newSize.height },\n      });\n      this.lok.postUnoCommand(this.docPtr, '.uno:Size', args);\n\n      return this.createResult(undefined);\n    } catch (error) {\n      return this.createErrorResult(`Failed to resize shape: ${error}`);\n    }\n  }\n\n  // ============================================\n  // Private helpers\n  // ============================================\n\n  private getPageInfoInternal(index: number): PageInfo {\n    this.lok.documentSetPart(this.docPtr, index);\n    const size = this.lok.documentGetDocumentSize(this.docPtr);\n    const shapes = this.getShapesOnPage();\n\n    return {\n      index,\n      shapeCount: shapes.length,\n      size: { width: size.width, height: size.height },\n    };\n  }\n\n  private getShapesOnPage(): ShapeData[] {\n    // In a real implementation, we'd enumerate shapes via LOK\n    // For now, we parse text content as a simple proxy\n    const text = this.lok.getAllText(this.docPtr) || '';\n\n    if (!text.trim()) {\n      return [];\n    }\n\n    // Return a single text shape if there's content\n    return [{\n      index: 0,\n      type: 'text',\n      text,\n      bounds: { x: 0, y: 0, width: 0, height: 0 },\n    }];\n  }\n\n  private selectShape(shapeIndex: number): void {\n    // Navigate to shape - simplified implementation\n    // Real implementation would use object enumeration\n    const args = JSON.stringify({\n      Index: { type: 'long', value: shapeIndex },\n    });\n    this.lok.postUnoCommand(this.docPtr, '.uno:SelectObject', args);\n  }\n\n  private getShapeCommand(shapeType: ShapeType): string {\n    const commands: Record<ShapeType, string> = {\n      rectangle: '.uno:Rect',\n      ellipse: '.uno:Ellipse',\n      line: '.uno:Line',\n      text: '.uno:Text',\n      image: '.uno:InsertGraphic',\n      group: '.uno:FormatGroup',\n      other: '.uno:Rect', // Default to rectangle\n    };\n    return commands[shapeType];\n  }\n\n  private hexToNumber(hex: string): number {\n    return parseInt(hex.replace('#', ''), 16);\n  }\n}\n","// src/editor/index.ts\nimport type { LOKBindings } from '../lok-bindings.js';\nimport { OfficeEditor } from './base.js';\nimport { WriterEditor } from './writer.js';\nimport { CalcEditor } from './calc.js';\nimport { ImpressEditor } from './impress.js';\nimport { DrawEditor } from './draw.js';\nimport type { OpenDocumentOptions } from './types.js';\n\n// LOK document type constants (from LibreOfficeKit)\nconst LOK_DOCTYPE_TEXT = 0;\nconst LOK_DOCTYPE_SPREADSHEET = 1;\nconst LOK_DOCTYPE_PRESENTATION = 2;\nconst LOK_DOCTYPE_DRAWING = 3;\n\n/**\n * Factory function to create the appropriate editor based on document type\n *\n * @param lok - LibreOfficeKit bindings instance\n * @param docPtr - Document pointer from lok.documentLoad()\n * @param options - Editor options (maxResponseChars, etc.)\n * @returns Typed editor instance (WriterEditor, CalcEditor, ImpressEditor, or DrawEditor)\n * @throws Error if document type is unsupported\n *\n * @example\n * ```typescript\n * const docPtr = lok.documentLoad('/tmp/document.docx');\n * const editor = createEditor(lok, docPtr);\n *\n * if (isWriterEditor(editor)) {\n *   // TypeScript knows editor has WriterEditor methods\n *   const result = editor.insertParagraph('Hello World');\n * }\n * ```\n */\nexport function createEditor(\n  lok: LOKBindings,\n  docPtr: number,\n  options?: OpenDocumentOptions\n): OfficeEditor {\n  const docType = lok.documentGetDocumentType(docPtr);\n\n  switch (docType) {\n    case LOK_DOCTYPE_TEXT:\n      return new WriterEditor(lok, docPtr, options);\n\n    case LOK_DOCTYPE_SPREADSHEET:\n      return new CalcEditor(lok, docPtr, options);\n\n    case LOK_DOCTYPE_PRESENTATION:\n      return new ImpressEditor(lok, docPtr, options);\n\n    case LOK_DOCTYPE_DRAWING:\n      return new DrawEditor(lok, docPtr, options);\n\n    default:\n      throw new Error(`Unsupported document type: ${docType}`);\n  }\n}\n\n// ============================================\n// Type Guards\n// ============================================\n\n/**\n * Type guard for WriterEditor\n */\nexport function isWriterEditor(editor: OfficeEditor): editor is WriterEditor {\n  return editor.getDocumentType() === 'writer';\n}\n\n/**\n * Type guard for CalcEditor\n */\nexport function isCalcEditor(editor: OfficeEditor): editor is CalcEditor {\n  return editor.getDocumentType() === 'calc';\n}\n\n/**\n * Type guard for ImpressEditor\n */\nexport function isImpressEditor(editor: OfficeEditor): editor is ImpressEditor {\n  return editor.getDocumentType() === 'impress';\n}\n\n/**\n * Type guard for DrawEditor\n */\nexport function isDrawEditor(editor: OfficeEditor): editor is DrawEditor {\n  return editor.getDocumentType() === 'draw';\n}\n\n// ============================================\n// Re-exports\n// ============================================\n\n// Export all types\nexport type {\n  OperationResult,\n  TruncationInfo,\n  OpenDocumentOptions,\n  TextPosition,\n  TextRange,\n  TextFormat,\n  Paragraph,\n  WriterStructure,\n  CellRef,\n  RangeRef,\n  ColRef,\n  SheetRef,\n  CellValue,\n  CellData,\n  CellFormat,\n  SheetInfo,\n  CalcStructure,\n  SlideLayout,\n  TextFrame,\n  SlideData,\n  SlideInfo,\n  ImpressStructure,\n  ShapeType,\n  ShapeData,\n  PageData,\n  PageInfo,\n  DrawStructure,\n  Rectangle,\n  Size,\n  Position,\n  DocumentMetadata,\n  DocumentStructure,\n  DocumentType,\n  SelectionRange,\n  FindOptions,\n} from './types.js';\n\n// Export all editor classes\nexport { OfficeEditor } from './base.js';\nexport { WriterEditor } from './writer.js';\nexport { CalcEditor } from './calc.js';\nexport { ImpressEditor } from './impress.js';\nexport { DrawEditor } from './draw.js';\n","/**\n * Browser Web Worker for LibreOffice WASM conversions\n *\n * This worker runs the WASM module off the main thread to avoid blocking the UI.\n * Communication is via postMessage.\n */\n\nimport type { EmscriptenModule, WasmLoadPhase, WasmLoadProgress } from './types.js';\nimport { LOKBindings } from './lok-bindings.js';\nimport { FORMAT_FILTER_OPTIONS, OUTPUT_FORMAT_TO_LOK } from './types.js';\nimport { createEditor, OfficeEditor } from './editor/index.js';\nimport type { OperationResult } from './editor/types.js';\n\n// ============================================\n// WASM Loading Progress System\n// ============================================\n\n/**\n * Cumulative progress tracking - each step adds to the total\n * This ensures progress always increases even if events arrive out of order\n *\n * Weight distribution (sums to 100):\n * - download-wasm: 50 points (largest file ~142MB)\n * - download-data: 30 points (~96MB)\n * - compile: 5 points\n * - filesystem: 7 points\n * - lok-init: 7 points\n * - ready: 1 point (final)\n */\nconst PHASE_WEIGHTS: Record<WasmLoadPhase, number> = {\n  'download-wasm': 50,\n  'download-data': 30,\n  'compile': 5,\n  'filesystem': 7,\n  'lok-init': 7,\n  'ready': 1,\n};\n\n/** Track completed progress for each phase */\nconst phaseProgress: Record<WasmLoadPhase, number> = {\n  'download-wasm': 0,\n  'download-data': 0,\n  'compile': 0,\n  'filesystem': 0,\n  'lok-init': 0,\n  'ready': 0,\n};\n\n/** Current request ID for progress messages */\nlet currentInitRequestId: number = 0;\n\n/** Last emitted percentage - ensures monotonic progress */\nlet lastEmittedPercent: number = 0;\n\n/** Calculate total progress as sum of all phase progress */\nfunction calculateTotalProgress(): number {\n  let total = 0;\n  for (const phase of Object.keys(phaseProgress) as WasmLoadPhase[]) {\n    total += phaseProgress[phase];\n  }\n  const percent = Math.min(100, Math.round(total));\n  // Ensure we never emit a lower percentage than before\n  if (percent > lastEmittedPercent) {\n    lastEmittedPercent = percent;\n  }\n  return lastEmittedPercent;\n}\n\n/** Format bytes as human-readable MB */\nfunction formatBytes(bytes: number): string {\n  const mb = bytes / (1024 * 1024);\n  return `${mb.toFixed(1)} MB`;\n}\n\n/** Emit download progress with bytes info */\nfunction emitDownloadProgress(phase: WasmLoadPhase, loaded: number, total: number) {\n  const weight = PHASE_WEIGHTS[phase];\n  const phasePercent = total > 0 ? loaded / total : 0;\n  const newProgress = weight * phasePercent;\n\n  // Only update if progress increased (never go backwards)\n  if (newProgress > phaseProgress[phase]) {\n    phaseProgress[phase] = newProgress;\n  }\n\n  const message = phase === 'download-wasm'\n    ? `Downloading WebAssembly... ${formatBytes(loaded)} / ${formatBytes(total)}`\n    : `Downloading filesystem... ${formatBytes(loaded)} / ${formatBytes(total)}`;\n\n  emitProgress({ percent: calculateTotalProgress(), message, phase, bytesLoaded: loaded, bytesTotal: total });\n}\n\n/** Emit phase progress (marks phase as complete) */\nfunction emitPhaseProgress(phase: WasmLoadPhase, message: string) {\n  // Only update if this is an increase\n  const newProgress = PHASE_WEIGHTS[phase];\n  if (newProgress > phaseProgress[phase]) {\n    phaseProgress[phase] = newProgress;\n  }\n  emitProgress({ percent: calculateTotalProgress(), message, phase });\n}\n\n/** Send progress to main thread */\nfunction emitProgress(progress: WasmLoadProgress) {\n  self.postMessage({ type: 'progress', id: currentInitRequestId, progress });\n}\n\n/**\n * Install fetch interceptor to track WASM file downloads\n * Must be called BEFORE importScripts() loads Emscripten\n *\n * Modern Emscripten uses fetch() API for downloading .wasm and .data files\n */\nfunction installProgressInterceptors() {\n  const originalFetch = self.fetch;\n\n  // Intercept fetch for progress tracking\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\n  (self as any).fetch = async function(input: RequestInfo | URL, init?: RequestInit): Promise<Response> {\n    const url = typeof input === 'string' ? input : input instanceof URL ? input.href : input.url;\n\n    // Identify which file is being downloaded\n    let phase: WasmLoadPhase | null = null;\n    if (url.includes('soffice.wasm')) {\n      phase = 'download-wasm';\n      console.log('[Worker] Starting fetch download: soffice.wasm');\n    } else if (url.includes('soffice.data')) {\n      phase = 'download-data';\n      console.log('[Worker] Starting fetch download: soffice.data');\n    }\n\n    const response = await originalFetch(input, init);\n\n    // If not a tracked file, return original response\n    if (!phase) {\n      return response;\n    }\n\n    // Get content length for progress calculation\n    const contentLength = response.headers.get('Content-Length');\n    const total = contentLength ? parseInt(contentLength, 10) : 0;\n\n    // If no content length or no body, return original response\n    if (!total || !response.body) {\n      console.log(`[Worker] No content-length for ${url}, skipping progress tracking`);\n      return response;\n    }\n\n    // Create a new response with progress tracking\n    const reader = response.body.getReader();\n    let loaded = 0;\n\n    const stream = new ReadableStream({\n      async start(controller) {\n        while (true) {\n          const { done, value } = await reader.read();\n\n          if (done) {\n            console.log(`[Worker] Finished fetch download: ${phase === 'download-wasm' ? 'soffice.wasm' : 'soffice.data'}`);\n            controller.close();\n            break;\n          }\n\n          loaded += value.length;\n          emitDownloadProgress(phase!, loaded, total);\n          controller.enqueue(value);\n        }\n      }\n    });\n\n    return new Response(stream, {\n      headers: response.headers,\n      status: response.status,\n      statusText: response.statusText\n    });\n  };\n\n  console.log('[Worker] Installed progress-tracking fetch interceptor');\n\n  // Also intercept XHR as fallback (some Emscripten configurations use it)\n  const OriginalXHR = self.XMLHttpRequest;\n\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\n  const ProgressXMLHttpRequest = function(this: XMLHttpRequest) {\n    const xhr = new OriginalXHR();\n    let requestUrl = '';\n\n    const originalOpen = xhr.open.bind(xhr);\n    // eslint-disable-next-line @typescript-eslint/no-explicit-any\n    (xhr as any).open = function(method: string, url: string | URL, ...args: any[]) {\n      requestUrl = String(url);\n      return originalOpen(method, url, ...args);\n    };\n\n    const originalSend = xhr.send.bind(xhr);\n    // eslint-disable-next-line @typescript-eslint/no-explicit-any\n    (xhr as any).send = function(body?: any) {\n      let phase: WasmLoadPhase | null = null;\n      if (requestUrl.includes('soffice.wasm')) {\n        phase = 'download-wasm';\n        console.log('[Worker] Starting XHR download: soffice.wasm');\n      } else if (requestUrl.includes('soffice.data')) {\n        phase = 'download-data';\n        console.log('[Worker] Starting XHR download: soffice.data');\n      }\n\n      if (phase) {\n        const downloadPhase = phase;\n        xhr.addEventListener('progress', (e: ProgressEvent) => {\n          if (e.lengthComputable) {\n            emitDownloadProgress(downloadPhase, e.loaded, e.total);\n          }\n        });\n\n        xhr.addEventListener('load', () => {\n          console.log(`[Worker] Finished XHR download: ${downloadPhase === 'download-wasm' ? 'soffice.wasm' : 'soffice.data'}`);\n        });\n      }\n\n      return originalSend(body);\n    };\n\n    return xhr;\n  };\n\n  Object.defineProperty(ProgressXMLHttpRequest, 'prototype', {\n    value: OriginalXHR.prototype,\n    writable: false,\n  });\n\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\n  (self as any).XMLHttpRequest = ProgressXMLHttpRequest;\n\n  console.log('[Worker] Installed progress-tracking XHR interceptor');\n}\n\ninterface WorkerMessage {\n  type: 'init' | 'convert' | 'destroy' | 'getPageCount' | 'renderPreviews' | 'renderSinglePage' | 'renderPageViaConvert' | 'getDocumentInfo' | 'getLokInfo' | 'editText' | 'renderPageRectangles' | 'testLokOperations' | 'openDocument' | 'editorOperation' | 'closeDocument';\n  id: number;\n  // Explicit WASM file paths (required for init)\n  sofficeJs?: string;\n  sofficeWasm?: string;\n  sofficeData?: string;\n  sofficeWorkerJs?: string;\n  verbose?: boolean;\n  inputData?: Uint8Array;\n  inputExt?: string;\n  outputFormat?: string;\n  filterOptions?: string;\n  password?: string;\n  maxWidth?: number;\n  pageIndex?: number; // For renderSinglePage / renderPageViaConvert\n  // Text editing parameters\n  findText?: string;      // Text to find for replacement\n  replaceText?: string;   // Text to replace with\n  insertText?: string;    // Text to insert at cursor\n  // LOK operations testing\n  operations?: string[];  // List of operations to test\n  // Editor session parameters\n  sessionId?: string;\n  editorMethod?: string;\n  editorArgs?: unknown[];\n}\n\ninterface PagePreview {\n  page: number;\n  data: Uint8Array;\n  width: number;\n  height: number;\n}\n\ninterface DocumentInfo {\n  documentType: number;\n  documentTypeName: string;\n  validOutputFormats: string[];\n  pageCount: number;\n}\n\ninterface PartInfo {\n  visible: string;\n  selected: string;\n  masterPageCount?: string;\n  mode: string;\n}\n\ninterface A11yFocusedParagraph {\n  content: string;\n  position: string;\n  start: string;\n  end: string;\n}\n\ninterface LokInfo {\n  pageRectangles: string | null;\n  documentSize: { width: number; height: number };\n  partInfo: PartInfo | null;\n  a11yFocusedParagraph: A11yFocusedParagraph | null;\n  a11yCaretPosition: number;\n  editMode: number;\n  allText: string | null;\n}\n\ninterface EditResult {\n  success: boolean;\n  editMode: number;\n  message: string;\n  modifiedDocument?: Uint8Array;  // The modified document as a new file\n}\n\ninterface PageRectangle {\n  index: number;\n  x: number;      // X position in twips\n  y: number;      // Y position in twips\n  width: number;  // Width in twips\n  height: number; // Height in twips\n  imageData: Uint8Array;  // RGBA pixel data\n  imageWidth: number;     // Rendered width in pixels\n  imageHeight: number;    // Rendered height in pixels\n}\n\ninterface LokOperationResult {\n  operation: string;\n  success: boolean;\n  result?: unknown;\n  error?: string;\n}\n\ninterface TestLokOperationsResult {\n  operations: LokOperationResult[];\n  summary: string;\n}\n\n// Editor session info returned from openDocument\ninterface EditorSessionInfo {\n  sessionId: string;\n  documentType: 'writer' | 'calc' | 'impress' | 'draw';\n  pageCount: number;\n}\n\n// Editor operation result\ninterface EditorOperationResult {\n  success: boolean;\n  verified?: boolean;\n  data?: unknown;\n  error?: string;\n  suggestion?: string;\n}\n\ninterface WorkerResponse {\n  type: 'ready' | 'progress' | 'result' | 'error' | 'pageCount' | 'previews' | 'singlePagePreview' | 'documentInfo' | 'lokInfo' | 'editResult' | 'pageRectangles' | 'testLokOperations' | 'editorSession' | 'editorOperationResult' | 'documentClosed';\n  id: number;\n  data?: Uint8Array;\n  error?: string;\n  progress?: { percent: number; message: string };\n  pageCount?: number;\n  previews?: PagePreview[];\n  preview?: PagePreview; // Single page preview\n  documentInfo?: DocumentInfo;\n  lokInfo?: LokInfo;\n  editResult?: EditResult;\n  pageRectangles?: PageRectangle[];\n  testLokOperationsResult?: TestLokOperationsResult;\n  editorSession?: EditorSessionInfo;\n  editorOperationResult?: EditorOperationResult;\n}\n\n// eslint-disable-next-line @typescript-eslint/no-explicit-any\ndeclare const self: any;\ndeclare function importScripts(...urls: string[]): void;\n\nlet module: EmscriptenModule | null = null;\nlet lokBindings: LOKBindings | null = null;\nlet initialized = false;\n\n// Document cache for efficient multi-page rendering\nlet cachedDoc: {\n  docPtr: number;\n  inputHash: string;\n  filePath: string;\n  pageCount: number;  // Cache page count since getting it requires a view\n} | null = null;\n\n// Editor session storage - keeps documents open for editing\ninterface EditorSession {\n  sessionId: string;\n  docPtr: number;\n  filePath: string;\n  editor: OfficeEditor;\n  documentType: 'writer' | 'calc' | 'impress' | 'draw';\n}\n\nconst editorSessions = new Map<string, EditorSession>();\nlet sessionCounter = 0;\n\n// Simple hash function for input data\nfunction hashInput(data: Uint8Array): string {\n  let hash = 0;\n  const step = Math.max(1, Math.floor(data.length / 1000)); // Sample ~1000 bytes\n  for (let i = 0; i < data.length; i += step) {\n    hash = ((hash << 5) - hash + data[i]) | 0;\n  }\n  return `${hash}_${data.length}`;\n}\n\n// Get page count for a document, handling different document types correctly\nfunction getDocumentPageCount(docPtr: number): number {\n  const docType = lokBindings!.documentGetDocumentType(docPtr);\n\n  // For Text Documents (type 0), getParts returns 0 or 1 (representing \"parts\" not pages)\n  // We need to use getPartPageRectangles to get actual page count\n  if (docType === 0) { // TEXT document\n    const pageRectsStr = lokBindings!.getPartPageRectangles(docPtr);\n    if (pageRectsStr) {\n      const pageRects = lokBindings!.parsePageRectangles(pageRectsStr);\n      console.log(`[Worker] getDocumentPageCount: TEXT doc has ${pageRects.length} pages from rectangles`);\n      return pageRects.length;\n    }\n    // Fallback: if no page rectangles, assume at least 1 page\n    console.log(`[Worker] getDocumentPageCount: TEXT doc has no page rectangles, assuming 1 page`);\n    return 1;\n  }\n\n  // For Presentations, Drawings, Spreadsheets - getParts returns slide/page/sheet count\n  const parts = lokBindings!.documentGetParts(docPtr);\n  console.log(`[Worker] getDocumentPageCount: docType=${docType} has ${parts} parts`);\n  return parts;\n}\n\n// Get or load a document (reuses cached document if same input)\nfunction getOrLoadDocument(inputData: Uint8Array, inputExt: string): { docPtr: number; pageCount: number } {\n  const inputHash = hashInput(inputData);\n\n  // Check if we already have this document loaded\n  if (cachedDoc && cachedDoc.inputHash === inputHash && lokBindings) {\n    console.log(`[Worker] getOrLoadDocument: reusing cached doc ptr=${cachedDoc.docPtr}, pageCount=${cachedDoc.pageCount}`);\n    return { docPtr: cachedDoc.docPtr, pageCount: cachedDoc.pageCount };\n  }\n\n  // Close previous document if any\n  console.log(`[Worker] getOrLoadDocument: loading new document (hash=${inputHash})`);\n  closeCachedDocument();\n\n  // Load new document\n  const filePath = `/tmp/input/cached_doc.${inputExt || 'docx'}`;\n  module!.FS.writeFile(filePath, inputData);\n  const docPtr = lokBindings!.documentLoad(filePath);\n\n  if (docPtr === 0) {\n    const error = lokBindings!.getError();\n    throw new Error(error || 'Failed to load document');\n  }\n\n  const pageCount = getDocumentPageCount(docPtr);\n  console.log(`[Worker] getOrLoadDocument: loaded doc ptr=${docPtr}, pageCount=${pageCount}`);\n\n  // Cache the document with page count (page count requires a view to calculate correctly,\n  // so we cache it here when the document is first loaded)\n  cachedDoc = { docPtr, inputHash, filePath, pageCount };\n\n  return { docPtr, pageCount };\n}\n\n// Close cached document\nfunction closeCachedDocument() {\n  if (cachedDoc && lokBindings && module) {\n    console.log(`[Worker] closeCachedDocument: closing cached doc ptr=${cachedDoc.docPtr}`);\n    try { lokBindings.documentDestroy(cachedDoc.docPtr); } catch { /* ignore */ }\n    try { module.FS.unlink(cachedDoc.filePath); } catch { /* ignore */ }\n    cachedDoc = null;\n  }\n}\n\nfunction postResponse(response: WorkerResponse) {\n  if (response.data) {\n    // Transfer the ArrayBuffer for efficiency\n    self.postMessage(response, [response.data.buffer]);\n  } else {\n    self.postMessage(response);\n  }\n}\n\nfunction postProgress(id: number, percent: number, message: string) {\n  postResponse({ type: 'progress', id, progress: { percent, message } });\n}\n\nasync function handleInit(msg: WorkerMessage) {\n  if (initialized) {\n    postResponse({ type: 'ready', id: msg.id });\n    return;\n  }\n\n  // Require explicit paths\n  const { sofficeJs, sofficeWasm, sofficeData, sofficeWorkerJs } = msg;\n  if (!sofficeJs || !sofficeWasm || !sofficeData || !sofficeWorkerJs) {\n    postResponse({ type: 'error', id: msg.id, error: 'Missing required WASM paths (sofficeJs, sofficeWasm, sofficeData, sofficeWorkerJs)' });\n    return;\n  }\n\n  const verbose = msg.verbose || false;\n\n  // Store request ID for progress emission\n  currentInitRequestId = msg.id;\n\n  // Reset progress tracking for fresh initialization\n  for (const phase of Object.keys(phaseProgress) as WasmLoadPhase[]) {\n    phaseProgress[phase] = 0;\n  }\n  lastEmittedPercent = 0;\n\n  // Install XHR interceptor BEFORE any Emscripten code loads\n  // This intercepts soffice.wasm and soffice.data downloads\n  installProgressInterceptors();\n\n  // Emit initial progress\n  emitPhaseProgress('download-wasm', 'Preparing to download WebAssembly...');\n\n  try {\n    // Configure global Module for Emscripten\n    console.log('[Worker] Setting up Module with explicit paths:', { sofficeJs, sofficeWasm, sofficeData, sofficeWorkerJs });\n    self.Module = {\n      // Tell pthread workers where to load the main module from\n      mainScriptUrlOrBlob: sofficeJs,\n      locateFile: (path: string, scriptDir: string) => {\n        let result: string;\n        if (path.endsWith('.wasm')) result = sofficeWasm;\n        else if (path.endsWith('.data')) result = sofficeData;\n        // Handle both .worker.js and .worker.cjs requests\n        else if (path.includes('.worker.')) result = sofficeWorkerJs;\n        else {\n          // Fallback: derive from sofficeJs path for any other files\n          const baseUrl = sofficeJs.substring(0, sofficeJs.lastIndexOf('/') + 1);\n          result = `${baseUrl}${path}`;\n        }\n        console.log('[Worker] locateFile called:', path, 'scriptDir:', scriptDir, '-> result:', result);\n        return result;\n      },\n      // Always print LibreOffice output to console for debugging\n      print: console.log,\n      printErr: console.error,\n    };\n\n    // Load the soffice.js script using importScripts\n    // This triggers the .wasm download (tracked by XHR interceptor)\n    importScripts(sofficeJs);\n\n    // Wait for runtime to be ready\n    // .data file download and WebAssembly compilation happen here\n    emitPhaseProgress('compile', 'Compiling WebAssembly module...');\n\n    await new Promise<void>((resolve, reject) => {\n      const checkReady = () => {\n        if (self.Module && self.Module.calledRun) {\n          resolve();\n        } else if (self.Module && self.Module.onRuntimeInitialized) {\n          // Already has a callback, chain it\n          const orig = self.Module.onRuntimeInitialized;\n          self.Module.onRuntimeInitialized = () => {\n            orig();\n            resolve();\n          };\n        } else {\n          self.Module.onRuntimeInitialized = resolve;\n        }\n\n        // Timeout\n        setTimeout(() => reject(new Error('WASM initialization timeout')), 120000);\n      };\n\n      // Check if already ready\n      if (self.Module && self.Module.calledRun) {\n        resolve();\n      } else {\n        checkReady();\n      }\n    });\n\n    module = self.Module as EmscriptenModule;\n    emitPhaseProgress('filesystem', 'Setting up filesystem...');\n\n    // Set SAL_LOG environment variable for LibreOffice logging\n    // Must be done before LOK initialization\n    // Options: +ALL (everything), +lok (LibreOfficeKit), +vcl (rendering), +lok.shim (our shims)\n    try {\n      const mod = module as unknown as { ENV?: Record<string, string> };\n      if (mod.ENV) {\n        mod.ENV['SAL_LOG'] = '+ALL';\n        mod.ENV['MAX_CONCURRENCY'] = '1';\n        console.log('[Worker] Set SAL_LOG to +ALL');\n      } else {\n        console.log('[Worker] ENV not available');\n      }\n    } catch (e) {\n      console.log('[Worker] Could not set SAL_LOG:', e);\n    }\n\n    // Setup filesystem\n    const fs = module.FS;\n\n    // Add FS tracking for debugging (sends logs to main thread)\n    if (verbose) {\n      const originalOpen = fs.open.bind(fs);\n      fs.open = (path: string, flags: unknown, mode?: unknown) => {\n        console.log('[FS OPEN CALL]', path);\n        try {\n          return originalOpen(path, flags, mode);\n        } catch (err: unknown) {\n          const error = err as { code?: string };\n          if (error?.code === 'ENOENT') {\n            console.log('[FS ENOENT]', path);\n          }\n          throw err;\n        }\n      };\n    }\n    try { fs.mkdir('/tmp'); } catch { /* exists */ }\n    try { fs.mkdir('/tmp/input'); } catch { /* exists */ }\n    try { fs.mkdir('/tmp/output'); } catch { /* exists */ }\n\n    emitPhaseProgress('lok-init', 'Initializing LibreOfficeKit...');\n\n    // Initialize LOK\n    lokBindings = new LOKBindings(module, verbose);\n    lokBindings.initialize('/instdir/program');\n\n    // Enable synchronous event dispatch (Unipoll mode) globally\n    // Without this, postKeyEvent/postMouseEvent events are queued but never processed\n    lokBindings.enableSyncEvents();\n    console.log('[LOK Worker] Enabled synchronous event dispatch (Unipoll mode)');\n\n    initialized = true;\n    emitPhaseProgress('ready', 'Ready');\n    postResponse({ type: 'ready', id: msg.id });\n\n  } catch (error) {\n    postResponse({\n      type: 'error',\n      id: msg.id,\n      error: error instanceof Error ? error.message : String(error)\n    });\n  }\n}\n\n// Image formats that need multi-page handling\nconst IMAGE_FORMATS = ['png', 'jpg', 'jpeg', 'svg'];\n\nasync function handleConvert(msg: WorkerMessage) {\n  if (!initialized || !module || !lokBindings) {\n    postResponse({ type: 'error', id: msg.id, error: 'Worker not initialized' });\n    return;\n  }\n\n  const { inputData, inputExt, outputFormat, filterOptions, password } = msg;\n\n  if (!inputData || !outputFormat) {\n    postResponse({ type: 'error', id: msg.id, error: 'Missing input data or output format' });\n    return;\n  }\n\n  // Check if this is an image format that might need multi-page export\n  const isImageFormat = IMAGE_FORMATS.includes(outputFormat.toLowerCase());\n\n  const inPath = `/tmp/input/doc.${inputExt || 'docx'}`;\n  const outPath = `/tmp/output/doc.${outputFormat}`;\n  let docPtr = 0;\n  const outputFiles: string[] = []; // Track files to clean up\n\n  try {\n    postProgress(msg.id, 10, 'Writing input file...');\n    module.FS.writeFile(inPath, inputData);\n\n    postProgress(msg.id, 30, 'Loading document...');\n    if (password) {\n      docPtr = lokBindings.documentLoadWithOptions(inPath, `,Password=${password}`);\n    } else {\n      docPtr = lokBindings.documentLoad(inPath);\n    }\n\n    if (docPtr === 0) {\n      const error = lokBindings.getError();\n      throw new Error(error || 'Failed to load document');\n    }\n\n    // Get page count for multi-page image export\n    const pageCount = lokBindings.documentGetParts(docPtr);\n    const docType = lokBindings.documentGetDocumentType(docPtr);\n\n    // For image formats with multiple pages, export each page separately and zip\n    if (isImageFormat && pageCount > 1) {\n      postProgress(msg.id, 40, `Exporting ${pageCount} pages as ${outputFormat.toUpperCase()}...`);\n\n      const lokFormat = OUTPUT_FORMAT_TO_LOK[outputFormat as keyof typeof OUTPUT_FORMAT_TO_LOK];\n      const baseOpts = filterOptions || FORMAT_FILTER_OPTIONS[outputFormat as keyof typeof FORMAT_FILTER_OPTIONS] || '';\n\n      // Export each page\n      const pageFiles: Array<{ name: string; data: Uint8Array }> = [];\n\n      // Get document size for calculating export dimensions (for image formats)\n      const { width: docWidth, height: docHeight } = lokBindings.documentGetDocumentSize(docPtr);\n      const aspectRatio = docHeight / docWidth;\n      const exportWidth = 1024; // High quality export\n      const exportHeight = Math.round(exportWidth * aspectRatio);\n\n      for (let i = 0; i < pageCount; i++) {\n        const progress = 40 + Math.round((i / pageCount) * 40);\n        postProgress(msg.id, progress, `Exporting page ${i + 1}/${pageCount}...`);\n\n        const pageOutPath = `/tmp/output/page_${i + 1}.${outputFormat}`;\n        outputFiles.push(pageOutPath);\n\n        // For presentations/drawings, we need to set the part AND use PixelWidth/PixelHeight\n        // for PNG/JPG export to work correctly (same approach as handleRenderPageViaConvert)\n        if (docType === 2 || docType === 3) { // PRESENTATION or DRAWING\n          lokBindings.documentSetPart(docPtr, i);\n\n          // For image formats, include pixel dimensions in filter options\n          let pageOpts = baseOpts;\n          if (outputFormat === 'png' || outputFormat === 'jpg' || outputFormat === 'jpeg') {\n            pageOpts = `PixelWidth=${exportWidth};PixelHeight=${exportHeight}`;\n            if (baseOpts) pageOpts = `${baseOpts};${pageOpts}`;\n          }\n\n          lokBindings.documentSaveAs(docPtr, pageOutPath, lokFormat, pageOpts);\n          console.log(`[Worker] Page ${i + 1} (presentation) exported with opts: ${pageOpts}`);\n        } else {\n          // For text documents, use PageRange filter option (1-indexed)\n          let pageOpts = `PageRange=${i + 1}-${i + 1}`;\n\n          // For image formats, also include pixel dimensions\n          if (outputFormat === 'png' || outputFormat === 'jpg' || outputFormat === 'jpeg') {\n            pageOpts += `;PixelWidth=${exportWidth};PixelHeight=${exportHeight}`;\n          }\n\n          if (baseOpts) pageOpts = `${baseOpts};${pageOpts}`;\n\n          lokBindings.documentSaveAs(docPtr, pageOutPath, lokFormat, pageOpts);\n          console.log(`[Worker] Page ${i + 1} (text) exported with opts: ${pageOpts}`);\n        }\n\n        const pageData = module.FS.readFile(pageOutPath) as Uint8Array;\n        console.log(`[Worker] Page ${i + 1} exported: ${pageData.length} bytes`);\n\n        if (pageData.length > 0) {\n          const pageCopy = new Uint8Array(pageData.length);\n          pageCopy.set(pageData);\n          pageFiles.push({ name: `page_${i + 1}.${outputFormat}`, data: pageCopy });\n        } else {\n          console.warn(`[Worker] Page ${i + 1} export produced empty file`);\n        }\n      }\n\n      postProgress(msg.id, 85, 'Creating ZIP archive...');\n\n      // Create a simple ZIP file (no compression for images)\n      const zipData = createSimpleZip(pageFiles);\n\n      postProgress(msg.id, 100, 'Complete');\n      postResponse({ type: 'result', id: msg.id, data: zipData });\n\n    } else {\n      // Single page or non-image format: standard export\n      postProgress(msg.id, 50, 'Converting...');\n\n      const lokFormat = OUTPUT_FORMAT_TO_LOK[outputFormat as keyof typeof OUTPUT_FORMAT_TO_LOK];\n      const opts = filterOptions || FORMAT_FILTER_OPTIONS[outputFormat as keyof typeof FORMAT_FILTER_OPTIONS] || '';\n\n      postProgress(msg.id, 70, 'Saving...');\n      lokBindings.documentSaveAs(docPtr, outPath, lokFormat, opts);\n      outputFiles.push(outPath);\n\n      postProgress(msg.id, 90, 'Reading output...');\n      const sharedResult = module.FS.readFile(outPath) as Uint8Array;\n\n      if (sharedResult.length === 0) {\n        throw new Error('Conversion produced empty output');\n      }\n\n      // Copy from SharedArrayBuffer to regular ArrayBuffer for transfer\n      const result = new Uint8Array(sharedResult.length);\n      result.set(sharedResult);\n\n      postProgress(msg.id, 100, 'Complete');\n      postResponse({ type: 'result', id: msg.id, data: result });\n    }\n\n  } catch (error) {\n    postResponse({\n      type: 'error',\n      id: msg.id,\n      error: error instanceof Error ? error.message : String(error)\n    });\n  } finally {\n    // Cleanup\n    if (docPtr !== 0) {\n      try { lokBindings.documentDestroy(docPtr); } catch { /* ignore */ }\n    }\n    try { module.FS.unlink(inPath); } catch { /* ignore */ }\n    for (const path of outputFiles) {\n      try { module.FS.unlink(path); } catch { /* ignore */ }\n    }\n  }\n}\n\n/**\n * Create a simple ZIP file from an array of files\n * This is a minimal ZIP implementation without compression (STORE method)\n */\nfunction createSimpleZip(files: Array<{ name: string; data: Uint8Array }>): Uint8Array {\n  const chunks: Uint8Array[] = [];\n  const centralDirectory: Uint8Array[] = [];\n  let offset = 0;\n\n  for (const file of files) {\n    const nameBytes = new TextEncoder().encode(file.name);\n\n    // Local file header\n    const localHeader = new Uint8Array(30 + nameBytes.length);\n    const view = new DataView(localHeader.buffer);\n\n    view.setUint32(0, 0x04034b50, true);  // Local file header signature\n    view.setUint16(4, 20, true);           // Version needed\n    view.setUint16(6, 0, true);            // General purpose flags\n    view.setUint16(8, 0, true);            // Compression method (STORE)\n    view.setUint16(10, 0, true);           // Mod time\n    view.setUint16(12, 0, true);           // Mod date\n    view.setUint32(14, crc32(file.data), true); // CRC-32\n    view.setUint32(18, file.data.length, true); // Compressed size\n    view.setUint32(22, file.data.length, true); // Uncompressed size\n    view.setUint16(26, nameBytes.length, true); // File name length\n    view.setUint16(28, 0, true);           // Extra field length\n    localHeader.set(nameBytes, 30);\n\n    chunks.push(localHeader);\n    chunks.push(file.data);\n\n    // Central directory entry\n    const cdEntry = new Uint8Array(46 + nameBytes.length);\n    const cdView = new DataView(cdEntry.buffer);\n\n    cdView.setUint32(0, 0x02014b50, true);  // Central directory signature\n    cdView.setUint16(4, 20, true);           // Version made by\n    cdView.setUint16(6, 20, true);           // Version needed\n    cdView.setUint16(8, 0, true);            // General purpose flags\n    cdView.setUint16(10, 0, true);           // Compression method\n    cdView.setUint16(12, 0, true);           // Mod time\n    cdView.setUint16(14, 0, true);           // Mod date\n    cdView.setUint32(16, crc32(file.data), true); // CRC-32\n    cdView.setUint32(20, file.data.length, true); // Compressed size\n    cdView.setUint32(24, file.data.length, true); // Uncompressed size\n    cdView.setUint16(28, nameBytes.length, true); // File name length\n    cdView.setUint16(30, 0, true);           // Extra field length\n    cdView.setUint16(32, 0, true);           // Comment length\n    cdView.setUint16(34, 0, true);           // Disk number start\n    cdView.setUint16(36, 0, true);           // Internal attributes\n    cdView.setUint32(38, 0, true);           // External attributes\n    cdView.setUint32(42, offset, true);      // Offset of local header\n    cdEntry.set(nameBytes, 46);\n\n    centralDirectory.push(cdEntry);\n    offset += localHeader.length + file.data.length;\n  }\n\n  const cdOffset = offset;\n  let cdSize = 0;\n  for (const entry of centralDirectory) {\n    chunks.push(entry);\n    cdSize += entry.length;\n  }\n\n  // End of central directory\n  const eocd = new Uint8Array(22);\n  const eocdView = new DataView(eocd.buffer);\n  eocdView.setUint32(0, 0x06054b50, true);  // EOCD signature\n  eocdView.setUint16(4, 0, true);            // Disk number\n  eocdView.setUint16(6, 0, true);            // Disk with CD\n  eocdView.setUint16(8, files.length, true); // Entries on this disk\n  eocdView.setUint16(10, files.length, true);// Total entries\n  eocdView.setUint32(12, cdSize, true);      // CD size\n  eocdView.setUint32(16, cdOffset, true);    // CD offset\n  eocdView.setUint16(20, 0, true);           // Comment length\n\n  chunks.push(eocd);\n\n  // Combine all chunks\n  const totalSize = chunks.reduce((sum, chunk) => sum + chunk.length, 0);\n  const result = new Uint8Array(totalSize);\n  let pos = 0;\n  for (const chunk of chunks) {\n    result.set(chunk, pos);\n    pos += chunk.length;\n  }\n\n  return result;\n}\n\n/**\n * CRC-32 calculation for ZIP files\n */\nfunction crc32(data: Uint8Array): number {\n  let crc = 0xFFFFFFFF;\n  for (let i = 0; i < data.length; i++) {\n    const byte = data[i]!;\n    crc ^= byte;\n    for (let j = 0; j < 8; j++) {\n      crc = (crc >>> 1) ^ (crc & 1 ? 0xEDB88320 : 0);\n    }\n  }\n  return (crc ^ 0xFFFFFFFF) >>> 0;\n}\n\nasync function handleGetPageCount(msg: WorkerMessage) {\n  if (!initialized || !module || !lokBindings) {\n    postResponse({ type: 'error', id: msg.id, error: 'Worker not initialized' });\n    return;\n  }\n\n  const { inputData, inputExt } = msg;\n\n  if (!inputData) {\n    postResponse({ type: 'error', id: msg.id, error: 'Missing input data' });\n    return;\n  }\n\n  try {\n    // Use cached document\n    const { pageCount } = getOrLoadDocument(inputData, inputExt || 'docx');\n    postResponse({ type: 'pageCount', id: msg.id, pageCount });\n    // Document stays cached\n\n  } catch (error) {\n    postResponse({\n      type: 'error',\n      id: msg.id,\n      error: error instanceof Error ? error.message : String(error)\n    });\n    closeCachedDocument();\n  }\n}\n\nasync function handleRenderPreviews(msg: WorkerMessage) {\n  if (!initialized || !module || !lokBindings) {\n    postResponse({ type: 'error', id: msg.id, error: 'Worker not initialized' });\n    return;\n  }\n\n  const { inputData, inputExt, maxWidth = 256 } = msg;\n\n  if (!inputData) {\n    postResponse({ type: 'error', id: msg.id, error: 'Missing input data' });\n    return;\n  }\n\n  try {\n    postProgress(msg.id, 10, 'Loading document for preview...');\n    \n    // Use cached document\n    const { docPtr, pageCount } = getOrLoadDocument(inputData, inputExt || 'docx');\n    postProgress(msg.id, 20, `Rendering ${pageCount} pages...`);\n\n    const previews: PagePreview[] = [];\n    \n    for (let i = 0; i < pageCount; i++) {\n      const progress = 20 + Math.round((i / pageCount) * 70);\n      postProgress(msg.id, progress, `Rendering page ${i + 1}/${pageCount}...`);\n      \n      // Render the page - let renderPage handle page selection and sizing\n      const rendered = lokBindings.renderPage(docPtr, i, maxWidth);\n      \n      // Copy from SharedArrayBuffer to regular ArrayBuffer\n      const dataCopy = new Uint8Array(rendered.data.length);\n      dataCopy.set(rendered.data);\n      \n      previews.push({\n        page: i + 1,\n        data: dataCopy,\n        width: rendered.width,\n        height: rendered.height\n      });\n    }\n\n    postProgress(msg.id, 100, 'Preview complete');\n    \n    // Transfer all preview buffers\n    const transfers = previews.map(p => p.data.buffer);\n    self.postMessage({ type: 'previews', id: msg.id, previews }, transfers);\n    // Document stays cached\n\n  } catch (error) {\n    postResponse({\n      type: 'error',\n      id: msg.id,\n      error: error instanceof Error ? error.message : String(error)\n    });\n    closeCachedDocument();\n  }\n}\n\n/**\n * Render a single page preview - reuses cached document for efficiency\n */\nasync function handleRenderSinglePage(msg: WorkerMessage) {\n  if (!initialized || !module || !lokBindings) {\n    postResponse({ type: 'error', id: msg.id, error: 'Worker not initialized' });\n    return;\n  }\n\n  const { inputData, inputExt, maxWidth = 256, pageIndex = 0 } = msg;\n\n  if (!inputData) {\n    postResponse({ type: 'error', id: msg.id, error: 'Missing input data' });\n    return;\n  }\n\n  let viewId = -1;\n  let docPtr = 0;\n\n  try {\n    // Get or reuse cached document\n    const result = getOrLoadDocument(inputData, inputExt || 'docx');\n    docPtr = result.docPtr;\n    const pageCount = result.pageCount;\n\n    if (pageIndex < 0 || pageIndex >= pageCount) {\n      throw new Error(`Page index ${pageIndex} out of range (0-${pageCount - 1})`);\n    }\n\n    // Create a view before rendering for all document types.\n    // Without a view, LOK returns empty page rectangles and incorrect document sizes,\n    // causing paintTile to crash with \"memory access out of bounds\".\n    // The warning \"No Frame-Controller created\" indicates no view exists.\n    const docType = lokBindings.documentGetDocumentType(docPtr);\n    const docTypeNames = ['TEXT', 'SPREADSHEET', 'PRESENTATION', 'DRAWING'];\n    console.log(`[Worker] handleRenderSinglePage: ${docTypeNames[docType] || 'UNKNOWN'} document - creating view for rendering`);\n    viewId = lokBindings.createView(docPtr);\n    if (viewId >= 0) {\n      lokBindings.setView(docPtr, viewId);\n      console.log(`[Worker] handleRenderSinglePage: Created and set view ${viewId}`);\n    }\n\n    // Render the page - let renderPage handle page-specific sizing\n    // We just pass maxWidth and let it calculate the correct height based on the page's aspect ratio\n    console.log(`[Worker] handleRenderSinglePage: calling renderPage for page ${pageIndex} at maxWidth=${maxWidth}...`);\n    const rendered = lokBindings.renderPage(docPtr, pageIndex, maxWidth);\n    console.log(`[Worker] handleRenderSinglePage: renderPage returned ${rendered.data.length} bytes (${rendered.width}x${rendered.height})`);\n    \n    // Copy from SharedArrayBuffer to regular ArrayBuffer\n    const dataCopy = new Uint8Array(rendered.data.length);\n    dataCopy.set(rendered.data);\n    \n    const preview: PagePreview = {\n      page: pageIndex + 1,\n      data: dataCopy,\n      width: rendered.width,\n      height: rendered.height\n    };\n\n    // Cleanup view if we created one (for Drawing documents)\n    if (viewId >= 0 && docPtr !== 0) {\n      try { lokBindings.destroyView(docPtr, viewId); } catch { /* ignore */ }\n      console.log(`[Worker] handleRenderSinglePage: Destroyed view ${viewId}`);\n    }\n\n    // Transfer the buffer\n    self.postMessage({ type: 'singlePagePreview', id: msg.id, preview }, [dataCopy.buffer]);\n\n  } catch (error) {\n    // Cleanup view if we created one (for Drawing documents)\n    if (viewId >= 0 && docPtr !== 0) {\n      try { lokBindings.destroyView(docPtr, viewId); } catch { /* ignore */ }\n      console.log(`[Worker] handleRenderSinglePage: Destroyed view ${viewId} (on error)`);\n    }\n\n    // Convert error message to a regular string (not SharedArrayBuffer-backed)\n    const errorMsg = error instanceof Error ? String(error.message) : String(error);\n    postResponse({\n      type: 'error',\n      id: msg.id,\n      error: errorMsg\n    });\n    // On error, close the cached document to allow retry\n    closeCachedDocument();\n  }\n  // Note: We don't close the document here - it stays cached for subsequent page renders\n}\n\n/**\n * Render a page preview by converting to PNG - fallback for Chrome/Edge\n * This uses the saveAs conversion path instead of paintTile which hangs in Chromium\n */\nasync function handleRenderPageViaConvert(msg: WorkerMessage) {\n  if (!initialized || !module || !lokBindings) {\n    postResponse({ type: 'error', id: msg.id, error: 'Worker not initialized' });\n    return;\n  }\n\n  const { inputData, inputExt, maxWidth = 256, pageIndex = 0 } = msg;\n\n  if (!inputData) {\n    postResponse({ type: 'error', id: msg.id, error: 'Missing input data' });\n    return;\n  }\n\n  const outPath = `/tmp/output/page_${pageIndex}.png`;\n\n  try {\n    // Use cached document\n    const { docPtr, pageCount } = getOrLoadDocument(inputData, inputExt || 'pdf');\n\n    // Get document type to determine how to handle page selection\n    const docType = lokBindings.documentGetDocumentType(docPtr);\n    \n    if (pageIndex < 0 || pageIndex >= pageCount) {\n      throw new Error(`Page index ${pageIndex} out of range (0-${pageCount - 1})`);\n    }\n\n    // For presentations/drawings, setPart works for page selection\n    // For text documents, we need to use PageRange filter option\n    if (docType === 2 || docType === 3) { // PRESENTATION or DRAWING\n      lokBindings.documentSetPart(docPtr, pageIndex);\n    }\n\n    // Get document size to calculate aspect ratio\n    const { width: docWidth, height: docHeight } = lokBindings.documentGetDocumentSize(docPtr);\n    const aspectRatio = docHeight / docWidth;\n    const outputWidth = Math.min(maxWidth, docWidth);\n    const outputHeight = Math.round(outputWidth * aspectRatio);\n\n    // Build filter options\n    // For Writer documents, use PageRange to export specific page (1-indexed)\n    // For presentations/drawings, the part is already set\n    let filterOpts = `PixelWidth=${outputWidth};PixelHeight=${outputHeight}`;\n    if (docType === 0) { // TEXT document\n      filterOpts += `;PageRange=${pageIndex + 1}-${pageIndex + 1}`;\n    }\n    \n    lokBindings.documentSaveAs(docPtr, outPath, 'png', filterOpts);\n\n    // Read the PNG file\n    const pngData = module.FS.readFile(outPath) as Uint8Array;\n    \n    if (pngData.length === 0) {\n      throw new Error('PNG export produced empty output');\n    }\n\n    // Copy from SharedArrayBuffer\n    const pngCopy = new Uint8Array(pngData.length);\n    pngCopy.set(pngData);\n\n    // Send as a special PNG preview (not RGBA like paintTile)\n    const preview = {\n      page: pageIndex + 1,\n      data: pngCopy,\n      width: outputWidth,\n      height: outputHeight,\n      format: 'png' as const\n    };\n\n    self.postMessage({ type: 'singlePagePreview', id: msg.id, preview, isPng: true }, [pngCopy.buffer]);\n    // Document stays cached\n\n    // Clean up output file only\n    try { module.FS.unlink(outPath); } catch { /* ignore */ }\n\n  } catch (error) {\n    postResponse({\n      type: 'error',\n      id: msg.id,\n      error: error instanceof Error ? error.message : String(error)\n    });\n    closeCachedDocument();\n    try { module.FS.unlink(outPath); } catch { /* ignore */ }\n  }\n}\n\nasync function handleGetDocumentInfo(msg: WorkerMessage) {\n  if (!initialized || !module || !lokBindings) {\n    postResponse({ type: 'error', id: msg.id, error: 'Worker not initialized' });\n    return;\n  }\n\n  const { inputData, inputExt } = msg;\n\n  if (!inputData) {\n    postResponse({ type: 'error', id: msg.id, error: 'Missing input data' });\n    return;\n  }\n\n  try {\n    // Use cached document - this will load it if not already loaded\n    const { docPtr, pageCount } = getOrLoadDocument(inputData, inputExt || 'docx');\n\n    const docType = lokBindings.documentGetDocumentType(docPtr);\n\n    // Map document type to valid output formats (based on LibreOffice capabilities)\n    const docTypeOutputFormats: Record<number, string[]> = {\n      0: ['pdf', 'docx', 'doc', 'odt', 'rtf', 'txt', 'html', 'png', 'jpg', 'svg'], // TEXT\n      1: ['pdf', 'xlsx', 'xls', 'ods', 'csv', 'html', 'png', 'jpg', 'svg'],        // SPREADSHEET\n      2: ['pdf', 'pptx', 'ppt', 'odp', 'png', 'jpg', 'svg', 'html'],              // PRESENTATION\n      3: ['pdf', 'png', 'jpg', 'svg', 'html'],                                     // DRAWING\n      4: ['pdf'],                                                                   // OTHER\n    };\n\n    const docTypeNames: Record<number, string> = {\n      0: 'Text Document',\n      1: 'Spreadsheet',\n      2: 'Presentation',\n      3: 'Drawing',\n      4: 'Other',\n    };\n\n    const documentInfo: DocumentInfo = {\n      documentType: docType,\n      documentTypeName: docTypeNames[docType] || 'Unknown',\n      validOutputFormats: docTypeOutputFormats[docType] || ['pdf'],\n      pageCount,\n    };\n\n    postResponse({ type: 'documentInfo', id: msg.id, documentInfo });\n    // Note: Document stays cached for subsequent operations\n\n  } catch (error) {\n    postResponse({\n      type: 'error',\n      id: msg.id,\n      error: error instanceof Error ? error.message : String(error)\n    });\n    // On error, close the cached document to allow retry\n    closeCachedDocument();\n  }\n}\n\n/**\n * Get LOK information about a loaded document - bounding boxes, positions, etc.\n */\nasync function handleGetLokInfo(msg: WorkerMessage) {\n  console.log('[LOK Worker] handleGetLokInfo called');\n  if (!initialized || !module || !lokBindings) {\n    postResponse({ type: 'error', id: msg.id, error: 'Worker not initialized' });\n    return;\n  }\n\n  const { inputData, inputExt } = msg;\n\n  if (!inputData) {\n    postResponse({ type: 'error', id: msg.id, error: 'Missing input data' });\n    return;\n  }\n\n  try {\n    // Use cached document\n    console.log('[LOK Worker] Getting or loading document...');\n    const { docPtr } = getOrLoadDocument(inputData, inputExt || 'docx');\n    console.log(`[LOK Worker] Got docPtr: ${docPtr}`);\n\n    // Get all available LOK read information\n    console.log('[LOK Worker] Calling LOK methods...');\n    const pageRectangles = lokBindings.getPartPageRectangles(docPtr);\n    console.log(`[LOK Worker] pageRectangles: ${pageRectangles}`);\n\n    const documentSize = lokBindings.documentGetDocumentSize(docPtr);\n    console.log(`[LOK Worker] documentSize: ${documentSize.width}x${documentSize.height}`);\n\n    const partInfo = lokBindings.getPartInfo(docPtr, 0);\n    console.log(`[LOK Worker] partInfo: ${partInfo}`);\n\n    const a11yFocusedParagraph = lokBindings.getA11yFocusedParagraph(docPtr);\n    console.log(`[LOK Worker] a11yFocusedParagraph: ${a11yFocusedParagraph}`);\n\n    const a11yCaretPosition = lokBindings.getA11yCaretPosition(docPtr);\n    console.log(`[LOK Worker] a11yCaretPosition: ${a11yCaretPosition}`);\n\n    let editMode = lokBindings.getEditMode(docPtr);\n    console.log(`[LOK Worker] editMode (initial): ${editMode}`);\n\n    // Try to enable edit mode for text extraction\n    let allText: string | null = null;\n    let viewId = -1;\n\n    // 1. Get the existing view created during document load\n    viewId = lokBindings.getView(docPtr);\n    console.log(`[LOK Worker] Got existing view: ${viewId}`);\n\n    // 2. Make it active with setActiveFrame (triggers setActiveFrame internally)\n    if (viewId >= 0) {\n      lokBindings.setView(docPtr, viewId);\n      console.log(`[LOK Worker] Set active view to ${viewId}`);\n    }\n\n    // 3. Now try creating a NEW view (this might work now with active frame set)\n    const newViewId = lokBindings.createView(docPtr);\n    console.log(`[LOK Worker] Created new view: ${newViewId}`);\n\n    if (newViewId >= 0) {\n      lokBindings.setView(docPtr, newViewId);\n      console.log(`[LOK Worker] Switched to new view: ${newViewId}`);\n    }\n\n    // Now enable edit mode\n    lokBindings.setEditMode(docPtr, 1);\n    editMode = lokBindings.getEditMode(docPtr);\n    console.log(`[LOK Worker] editMode (after setEditMode): ${editMode}`);\n\n    // Now try to get all text\n    allText = lokBindings.getAllText(docPtr);\n    console.log(`[LOK Worker] allText: ${allText?.slice(0, 100) || 'null'}`);\n\n    // Cleanup the new view we created\n    if (newViewId >= 0) {\n      lokBindings.destroyView(docPtr, newViewId);\n      console.log(`[LOK Worker] Destroyed view: ${newViewId}`);\n    }\n\n    // Parse JSON strings into objects\n    let parsedPartInfo: PartInfo | null = null;\n    if (partInfo) {\n      try {\n        parsedPartInfo = JSON.parse(partInfo) as PartInfo;\n      } catch {\n        console.warn('[LOK Worker] Failed to parse partInfo JSON:', partInfo);\n      }\n    }\n\n    let parsedA11yParagraph: A11yFocusedParagraph | null = null;\n    if (a11yFocusedParagraph) {\n      try {\n        parsedA11yParagraph = JSON.parse(a11yFocusedParagraph) as A11yFocusedParagraph;\n      } catch {\n        console.warn('[LOK Worker] Failed to parse a11yFocusedParagraph JSON:', a11yFocusedParagraph);\n      }\n    }\n\n    const lokInfo: LokInfo = {\n      pageRectangles,\n      documentSize,\n      partInfo: parsedPartInfo,\n      a11yFocusedParagraph: parsedA11yParagraph,\n      a11yCaretPosition,\n      editMode,\n      allText,\n    };\n\n    console.log('[LOK Worker] Posting lokInfo response');\n    postResponse({ type: 'lokInfo', id: msg.id, lokInfo });\n    // Document stays cached\n\n  } catch (error) {\n    console.error('[LOK Worker] Error in handleGetLokInfo:', error);\n    postResponse({\n      type: 'error',\n      id: msg.id,\n      error: error instanceof Error ? error.message : String(error)\n    });\n    closeCachedDocument();\n  }\n}\n\n/**\n * Handle text editing operations - find/replace or insert text\n */\nasync function handleEditText(msg: WorkerMessage) {\n  console.log('[LOK Worker] handleEditText called');\n  if (!initialized || !module || !lokBindings) {\n    postResponse({ type: 'error', id: msg.id, error: 'Worker not initialized' });\n    return;\n  }\n\n  const { inputData, inputExt, findText, replaceText, insertText } = msg;\n\n  if (!inputData) {\n    postResponse({ type: 'error', id: msg.id, error: 'Missing input data' });\n    return;\n  }\n\n  // Close any cached document since we need a fresh load for editing\n  closeCachedDocument();\n\n  const filePath = `/tmp/input/edit_doc.${inputExt || 'docx'}`;\n  const outputPath = `/tmp/output/edited_doc.${inputExt || 'docx'}`;\n  let docPtr = 0;\n  let viewId = -1;\n\n  try {\n    // Write file and load document\n    console.log('[LOK Worker] Writing input file...');\n    module.FS.writeFile(filePath, inputData);\n\n    console.log('[LOK Worker] Loading document for editing...');\n    docPtr = lokBindings.documentLoad(filePath);\n\n    if (docPtr === 0) {\n      const error = lokBindings.getError();\n      throw new Error(error || 'Failed to load document');\n    }\n    console.log(`[LOK Worker] Document loaded, docPtr=${docPtr}`);\n\n    // Initialize for rendering (required for some operations)\n    lokBindings.documentInitializeForRendering(docPtr);\n    console.log('[LOK Worker] Document initialized for rendering');\n\n    // 1. Get the existing view created during document load\n    viewId = lokBindings.getView(docPtr);\n    console.log(`[LOK Worker] Got existing view: ${viewId}`);\n\n    // 2. Make it active with setActiveFrame (triggers xDesktop->setActiveFrame() in C++)\n    if (viewId >= 0) {\n      lokBindings.setView(docPtr, viewId);\n      console.log(`[LOK Worker] Set active view to ${viewId}`);\n    }\n\n    // 3. Create a NEW view - this helps establish proper editing context\n    const newViewId = lokBindings.createView(docPtr);\n    console.log(`[LOK Worker] Created new view: ${newViewId}`);\n\n    if (newViewId >= 0) {\n      lokBindings.setView(docPtr, newViewId);\n      console.log(`[LOK Worker] Switched to new view: ${newViewId}`);\n      viewId = newViewId; // Track new view for cleanup\n    }\n\n    // Now enable edit mode\n    lokBindings.setEditMode(docPtr, 1);\n    const editMode = lokBindings.getEditMode(docPtr);\n    console.log(`[LOK Worker] Edit mode after setEditMode(1): ${editMode}`);\n\n    let operationResult = '';\n\n    // Perform the requested operation\n    if (findText && replaceText !== undefined) {\n      // Find and replace\n      console.log(`[LOK Worker] Attempting find/replace: \"${findText}\" -> \"${replaceText}\"`);\n\n      // Use .uno:ExecuteSearch for find/replace\n      // Note: Command type should be \"unsigned short\" with string value\n      const searchArgs = JSON.stringify({\n        'SearchItem.SearchString': { type: 'string', value: findText },\n        'SearchItem.ReplaceString': { type: 'string', value: replaceText },\n        'SearchItem.Command': { type: 'unsigned short', value: '3' }, // 3 = Replace All\n      });\n\n      try {\n        lokBindings.postUnoCommand(docPtr, '.uno:ExecuteSearch', searchArgs);\n        operationResult = `Attempted replace all \"${findText}\" with \"${replaceText}\"`;\n        console.log(`[LOK Worker] ${operationResult}`);\n      } catch (searchErr) {\n        console.error(`[LOK Worker] ExecuteSearch threw:`, searchErr);\n        operationResult = `ExecuteSearch failed: ${searchErr}`;\n      }\n    } else if (insertText) {\n      // Insert text at cursor\n      console.log(`[LOK Worker] Attempting to insert text: \"${insertText}\"`);\n      const results: string[] = [];\n\n      // First, click in the document to establish focus (position 1000, 1000 twips)\n      // LOK_MOUSEEVENT_BUTTONDOWN = 0, LOK_MOUSEEVENT_BUTTONUP = 1\n      try {\n        console.log(`[LOK Worker] Clicking in document to establish focus...`);\n        lokBindings.postMouseEvent(docPtr, 0, 1000, 1000, 1, 1, 0); // BUTTONDOWN\n        lokBindings.postMouseEvent(docPtr, 1, 1000, 1000, 1, 1, 0); // BUTTONUP\n        console.log(`[LOK Worker] Posted mouse events for focus`);\n        results.push('mouseEvents:ok');\n      } catch (e) {\n        console.error(`[LOK Worker] postMouseEvent threw:`, e);\n        results.push(`mouseEvents:err`);\n      }\n\n      // Go to end of document\n      try {\n        lokBindings.postUnoCommand(docPtr, '.uno:GoToEndOfDoc');\n        console.log(`[LOK Worker] Posted GoToEndOfDoc`);\n        results.push('GoToEndOfDoc:ok');\n      } catch (e) {\n        console.error(`[LOK Worker] GoToEndOfDoc threw:`, e);\n        results.push(`GoToEndOfDoc:err`);\n      }\n\n      // Approach 1: Try lok_documentPaste directly (bypasses event queue)\n      let pasteResult = false;\n      try {\n        console.log(`[LOK Worker] Trying paste() with text/plain...`);\n        pasteResult = lokBindings.paste(docPtr, 'text/plain;charset=utf-8', insertText);\n        console.log(`[LOK Worker] paste() returned: ${pasteResult}`);\n        results.push(`paste:${pasteResult}`);\n      } catch (e) {\n        console.error(`[LOK Worker] paste() threw:`, e);\n        results.push(`paste:err`);\n      }\n\n      // Approach 2: Try .uno:InsertText\n      try {\n        const insertArgs = JSON.stringify({\n          Text: { type: 'string', value: insertText },\n        });\n        lokBindings.postUnoCommand(docPtr, '.uno:InsertText', insertArgs);\n        console.log(`[LOK Worker] Posted InsertText`);\n        results.push('InsertText:ok');\n      } catch (e) {\n        console.error(`[LOK Worker] InsertText threw:`, e);\n        results.push(`InsertText:err`);\n      }\n\n      // Approach 3: Also try postKeyEvent to type each character\n      // LOK_KEYEVENT_KEYINPUT = 0, LOK_KEYEVENT_KEYUP = 1\n      try {\n        console.log(`[LOK Worker] Now trying postKeyEvent for each character...`);\n        for (let i = 0; i < insertText.length; i++) {\n          const charCode = insertText.charCodeAt(i);\n          lokBindings.postKeyEvent(docPtr, 0, charCode, 0); // KEY_PRESSED\n          lokBindings.postKeyEvent(docPtr, 1, charCode, 0); // KEY_RELEASED\n        }\n        console.log(`[LOK Worker] Posted ${insertText.length} key events`);\n        results.push(`keyEvents:${insertText.length}`);\n      } catch (e) {\n        console.error(`[LOK Worker] postKeyEvent threw:`, e);\n        results.push(`keyEvents:err`);\n      }\n\n      operationResult = `Insert attempts: ${results.join(', ')}`;\n      console.log(`[LOK Worker] ${operationResult}`);\n    } else {\n      operationResult = 'No edit operation specified (need findText+replaceText or insertText)';\n      console.log(`[LOK Worker] ${operationResult}`);\n    }\n\n    // Try to save the document back to a file\n    console.log('[LOK Worker] Attempting to save modified document...');\n\n    // Determine the format for saving\n    const ext = inputExt || 'docx';\n    const formatMap: Record<string, string> = {\n      'docx': 'docx',\n      'doc': 'doc',\n      'odt': 'odt',\n      'xlsx': 'xlsx',\n      'xls': 'xls',\n      'ods': 'ods',\n      'pptx': 'pptx',\n      'ppt': 'ppt',\n      'odp': 'odp',\n    };\n    const saveFormat = formatMap[ext] || ext;\n\n    try {\n      lokBindings.documentSaveAs(docPtr, outputPath, saveFormat, '');\n      console.log('[LOK Worker] Document saved');\n\n      // Read the modified document\n      const modifiedData = module.FS.readFile(outputPath) as Uint8Array;\n      console.log(`[LOK Worker] Modified document size: ${modifiedData.length} bytes`);\n\n      // Copy to regular ArrayBuffer\n      const modifiedCopy = new Uint8Array(modifiedData.length);\n      modifiedCopy.set(modifiedData);\n\n      const editResult: EditResult = {\n        success: true,\n        editMode,\n        message: operationResult + ` | Document saved (${modifiedCopy.length} bytes)`,\n        modifiedDocument: modifiedCopy,\n      };\n\n      // Transfer the buffer\n      self.postMessage({ type: 'editResult', id: msg.id, editResult }, [modifiedCopy.buffer]);\n\n    } catch (saveError) {\n      console.error('[LOK Worker] Save error:', saveError);\n\n      const editResult: EditResult = {\n        success: false,\n        editMode,\n        message: operationResult + ` | Save failed: ${saveError}`,\n      };\n\n      postResponse({ type: 'editResult', id: msg.id, editResult });\n    }\n\n  } catch (error) {\n    // Log detailed error info for debugging WASM/Emscripten exceptions\n    console.error('[LOK Worker] Error in handleEditText:', error);\n    if (error instanceof Error) {\n      console.error('[LOK Worker] Error name:', error.name);\n      console.error('[LOK Worker] Error message:', error.message);\n      console.error('[LOK Worker] Error stack:', error.stack);\n    }\n    // For Emscripten exceptions, try to get more details\n    const errorObj = error as Record<string, unknown>;\n    if (errorObj && typeof errorObj === 'object') {\n      console.error('[LOK Worker] Error keys:', Object.keys(errorObj));\n      for (const key of Object.keys(errorObj)) {\n        try {\n          console.error(`[LOK Worker] Error.${key}:`, errorObj[key]);\n        } catch { /* ignore */ }\n      }\n    }\n    // Check if this is a number (Emscripten exception pointer)\n    if (typeof error === 'number') {\n      console.error('[LOK Worker] Emscripten exception pointer:', error);\n      // Try to get exception message from Emscripten\n      const moduleAny = module as unknown as Record<string, unknown>;\n      if (moduleAny && typeof moduleAny.getExceptionMessage === 'function') {\n        try {\n          const exMsg = (moduleAny.getExceptionMessage as (ptr: number) => string)(error);\n          console.error('[LOK Worker] Emscripten exception message:', exMsg);\n        } catch { /* ignore */ }\n      }\n    }\n    postResponse({\n      type: 'error',\n      id: msg.id,\n      error: error instanceof Error ? error.message : String(error)\n    });\n  } finally {\n    // Cleanup - destroy the view we created\n    if (docPtr !== 0 && lokBindings) {\n      if (viewId >= 0) {\n        try { lokBindings.destroyView(docPtr, viewId); } catch { /* ignore */ }\n      }\n      try { lokBindings.documentDestroy(docPtr); } catch { /* ignore */ }\n    }\n    if (module) {\n      try { module.FS.unlink(filePath); } catch { /* ignore */ }\n      try { module.FS.unlink(outputPath); } catch { /* ignore */ }\n    }\n  }\n}\n\n/**\n * Render all page rectangles as individual screenshots\n * Returns the page rectangles with their rendered RGBA image data\n */\nasync function handleRenderPageRectangles(msg: WorkerMessage) {\n  console.log('[LOK Worker] handleRenderPageRectangles called');\n  if (!initialized || !module || !lokBindings) {\n    postResponse({ type: 'error', id: msg.id, error: 'Worker not initialized' });\n    return;\n  }\n\n  const { inputData, inputExt, maxWidth = 256 } = msg;\n\n  if (!inputData) {\n    postResponse({ type: 'error', id: msg.id, error: 'Missing input data' });\n    return;\n  }\n\n  try {\n    // Get or reuse cached document\n    const { docPtr } = getOrLoadDocument(inputData, inputExt || 'docx');\n\n    // Initialize for rendering\n    lokBindings.documentInitializeForRendering(docPtr);\n\n    // Get page rectangles string\n    const pageRectsStr = lokBindings.getPartPageRectangles(docPtr);\n    console.log(`[LOK Worker] Page rectangles string: ${pageRectsStr?.slice(0, 100) || 'null'}...`);\n\n    if (!pageRectsStr || pageRectsStr.length === 0) {\n      // No page rectangles - return empty array\n      postResponse({ type: 'pageRectangles', id: msg.id, pageRectangles: [] });\n      return;\n    }\n\n    // Parse page rectangles\n    const parsedRects = lokBindings.parsePageRectangles(pageRectsStr);\n    console.log(`[LOK Worker] Parsed ${parsedRects.length} page rectangles`);\n\n    const pageRectangles: PageRectangle[] = [];\n    const transferBuffers: ArrayBuffer[] = [];\n\n    for (let i = 0; i < parsedRects.length; i++) {\n      const rect = parsedRects[i]!;\n      console.log(`[LOK Worker] Rendering page ${i}: x=${rect.x}, y=${rect.y}, w=${rect.width}, h=${rect.height}`);\n\n      // Calculate output dimensions maintaining aspect ratio\n      const aspectRatio = rect.height / rect.width;\n      const outputWidth = maxWidth;\n      const outputHeight = Math.round(maxWidth * aspectRatio);\n\n      // Paint the tile for this specific rectangle\n      const data = lokBindings.documentPaintTile(\n        docPtr,\n        outputWidth,\n        outputHeight,\n        rect.x,\n        rect.y,\n        rect.width,\n        rect.height\n      );\n\n      // Copy from SharedArrayBuffer to regular ArrayBuffer\n      const dataCopy = new Uint8Array(data.length);\n      dataCopy.set(data);\n\n      pageRectangles.push({\n        index: i,\n        x: rect.x,\n        y: rect.y,\n        width: rect.width,\n        height: rect.height,\n        imageData: dataCopy,\n        imageWidth: outputWidth,\n        imageHeight: outputHeight,\n      });\n\n      transferBuffers.push(dataCopy.buffer);\n      console.log(`[LOK Worker] Rendered page ${i}: ${outputWidth}x${outputHeight}, ${dataCopy.length} bytes`);\n    }\n\n    // Transfer all buffers\n    self.postMessage({ type: 'pageRectangles', id: msg.id, pageRectangles }, transferBuffers);\n\n  } catch (error) {\n    console.error('[LOK Worker] Error in handleRenderPageRectangles:', error);\n    const errorMsg = error instanceof Error ? String(error.message) : String(error);\n    postResponse({\n      type: 'error',\n      id: msg.id,\n      error: errorMsg\n    });\n    closeCachedDocument();\n  }\n}\n\n/**\n * Test various LOK operations for debugging and verification\n * Tests: SelectAll, getTextSelection, Delete, Undo, Redo, Bold, Italic\n */\nasync function handleTestLokOperations(msg: WorkerMessage) {\n  console.log('[LOK Worker] handleTestLokOperations called');\n  if (!initialized || !module || !lokBindings) {\n    postResponse({ type: 'error', id: msg.id, error: 'Worker not initialized' });\n    return;\n  }\n\n  const { inputData, inputExt } = msg;\n\n  if (!inputData) {\n    postResponse({ type: 'error', id: msg.id, error: 'Missing input data' });\n    return;\n  }\n\n  // Close any cached document since we need a fresh load for testing\n  closeCachedDocument();\n\n  const filePath = `/tmp/input/test_ops_doc.${inputExt || 'docx'}`;\n  const outputPath = `/tmp/output/test_ops_doc.${inputExt || 'docx'}`;\n  let docPtr = 0;\n  let viewId = -1;\n\n  const results: LokOperationResult[] = [];\n\n  try {\n    // Write file and load document\n    console.log('[LOK Worker] Writing input file...');\n    module.FS.writeFile(filePath, inputData);\n\n    console.log('[LOK Worker] Loading document for LOK operations testing...');\n    docPtr = lokBindings.documentLoad(filePath);\n\n    if (docPtr === 0) {\n      const error = lokBindings.getError();\n      throw new Error(error || 'Failed to load document');\n    }\n    console.log(`[LOK Worker] Document loaded, docPtr=${docPtr}`);\n\n    // Initialize for rendering\n    lokBindings.documentInitializeForRendering(docPtr);\n    console.log('[LOK Worker] Document initialized for rendering');\n\n    // Set up view and edit mode\n    viewId = lokBindings.getView(docPtr);\n    console.log(`[LOK Worker] Got existing view: ${viewId}`);\n\n    if (viewId >= 0) {\n      lokBindings.setView(docPtr, viewId);\n    }\n\n    const newViewId = lokBindings.createView(docPtr);\n    console.log(`[LOK Worker] Created new view: ${newViewId}`);\n\n    if (newViewId >= 0) {\n      lokBindings.setView(docPtr, newViewId);\n      viewId = newViewId;\n    }\n\n    lokBindings.setEditMode(docPtr, 1);\n    const editMode = lokBindings.getEditMode(docPtr);\n    console.log(`[LOK Worker] Edit mode: ${editMode}`);\n\n    // Register callback to receive STATE_CHANGED events for formatting info\n    lokBindings.registerCallback(docPtr);\n    lokBindings.clearCallbackQueue(); // Clear any initial events\n    console.log('[LOK Worker] Callback registered for STATE_CHANGED events');\n\n    // Click to establish focus\n    try {\n      lokBindings.postMouseEvent(docPtr, 0, 1000, 1000, 1, 1, 0);\n      lokBindings.postMouseEvent(docPtr, 1, 1000, 1000, 1, 1, 0);\n      results.push({ operation: 'establishFocus', success: true, result: 'Mouse click events sent' });\n    } catch (e) {\n      results.push({ operation: 'establishFocus', success: false, error: String(e) });\n    }\n\n    // Test 1: SelectAll + getTextSelection (full text extraction)\n    console.log('[LOK Worker] Testing SelectAll + getTextSelection...');\n    try {\n      lokBindings.postUnoCommand(docPtr, '.uno:SelectAll');\n      const selectedText = lokBindings.getTextSelection(docPtr, 'text/plain;charset=utf-8');\n      const textLength = selectedText?.length || 0;\n      console.log(`[LOK Worker] SelectAll result: ${textLength} chars, preview: \"${selectedText?.slice(0, 100)}...\"`);\n      results.push({\n        operation: 'SelectAll+getTextSelection',\n        success: textLength > 0,\n        result: { textLength, preview: selectedText?.slice(0, 200) }\n      });\n    } catch (e) {\n      console.error('[LOK Worker] SelectAll error:', e);\n      results.push({ operation: 'SelectAll+getTextSelection', success: false, error: String(e) });\n    }\n\n    // Test 2: getSelectionType\n    console.log('[LOK Worker] Testing getSelectionType...');\n    try {\n      const selType = lokBindings.getSelectionType(docPtr);\n      console.log(`[LOK Worker] Selection type: ${selType}`);\n      results.push({\n        operation: 'getSelectionType',\n        success: true,\n        result: { selectionType: selType, meaning: selType === 0 ? 'NONE' : selType === 1 ? 'TEXT' : selType === 2 ? 'CELL' : 'UNKNOWN' }\n      });\n    } catch (e) {\n      console.error('[LOK Worker] getSelectionType error:', e);\n      results.push({ operation: 'getSelectionType', success: false, error: String(e) });\n    }\n\n    // Test 3: resetSelection\n    console.log('[LOK Worker] Testing resetSelection...');\n    try {\n      lokBindings.resetSelection(docPtr);\n      const selTypeAfterReset = lokBindings.getSelectionType(docPtr);\n      console.log(`[LOK Worker] Selection type after reset: ${selTypeAfterReset}`);\n      results.push({\n        operation: 'resetSelection',\n        success: true,\n        result: { selectionTypeAfterReset: selTypeAfterReset }\n      });\n    } catch (e) {\n      console.error('[LOK Worker] resetSelection error:', e);\n      results.push({ operation: 'resetSelection', success: false, error: String(e) });\n    }\n\n    // Test 4: Go to start, select some text, then delete it\n    console.log('[LOK Worker] Testing GoToStartOfDoc + selection + Delete...');\n    try {\n      // Go to start of document\n      lokBindings.postUnoCommand(docPtr, '.uno:GoToStartOfDoc');\n      console.log('[LOK Worker] Sent GoToStartOfDoc');\n\n      // Select word right (select first word)\n      lokBindings.postUnoCommand(docPtr, '.uno:WordRightSel');\n      console.log('[LOK Worker] Sent WordRightSel');\n\n      // Get selected text before delete\n      const selectedBeforeDelete = lokBindings.getTextSelection(docPtr, 'text/plain;charset=utf-8');\n      console.log(`[LOK Worker] Selected text before delete: \"${selectedBeforeDelete}\"`);\n\n      // Delete\n      lokBindings.postUnoCommand(docPtr, '.uno:Delete');\n      console.log('[LOK Worker] Sent Delete');\n\n      results.push({\n        operation: 'SelectWord+Delete',\n        success: true,\n        result: { deletedText: selectedBeforeDelete }\n      });\n    } catch (e) {\n      console.error('[LOK Worker] SelectWord+Delete error:', e);\n      results.push({ operation: 'SelectWord+Delete', success: false, error: String(e) });\n    }\n\n    // Test 5: Undo\n    console.log('[LOK Worker] Testing Undo...');\n    try {\n      lokBindings.postUnoCommand(docPtr, '.uno:Undo');\n      console.log('[LOK Worker] Sent Undo');\n\n      // Select all to verify undo restored the text\n      lokBindings.postUnoCommand(docPtr, '.uno:SelectAll');\n      const textAfterUndo = lokBindings.getTextSelection(docPtr, 'text/plain;charset=utf-8');\n      console.log(`[LOK Worker] Text after Undo: ${textAfterUndo?.length} chars`);\n\n      results.push({\n        operation: 'Undo',\n        success: true,\n        result: { textLengthAfterUndo: textAfterUndo?.length || 0 }\n      });\n    } catch (e) {\n      console.error('[LOK Worker] Undo error:', e);\n      results.push({ operation: 'Undo', success: false, error: String(e) });\n    }\n\n    // Test 6: Redo\n    console.log('[LOK Worker] Testing Redo...');\n    try {\n      lokBindings.postUnoCommand(docPtr, '.uno:Redo');\n      console.log('[LOK Worker] Sent Redo');\n\n      // Select all to verify redo re-applied the delete\n      lokBindings.postUnoCommand(docPtr, '.uno:SelectAll');\n      const textAfterRedo = lokBindings.getTextSelection(docPtr, 'text/plain;charset=utf-8');\n      console.log(`[LOK Worker] Text after Redo: ${textAfterRedo?.length} chars`);\n\n      results.push({\n        operation: 'Redo',\n        success: true,\n        result: { textLengthAfterRedo: textAfterRedo?.length || 0 }\n      });\n    } catch (e) {\n      console.error('[LOK Worker] Redo error:', e);\n      results.push({ operation: 'Redo', success: false, error: String(e) });\n    }\n\n    // Test 7: Undo again to restore, then test Bold\n    console.log('[LOK Worker] Testing Bold formatting...');\n    try {\n      // Undo the redo to restore text\n      lokBindings.postUnoCommand(docPtr, '.uno:Undo');\n\n      // Go to start, select a word\n      lokBindings.postUnoCommand(docPtr, '.uno:GoToStartOfDoc');\n      lokBindings.postUnoCommand(docPtr, '.uno:WordRightSel');\n\n      const selectedForBold = lokBindings.getTextSelection(docPtr, 'text/plain;charset=utf-8');\n      console.log(`[LOK Worker] Selected for bold: \"${selectedForBold}\"`);\n\n      // Apply bold\n      lokBindings.postUnoCommand(docPtr, '.uno:Bold');\n      console.log('[LOK Worker] Sent Bold');\n\n      // Check if Bold is active via getCommandValues\n      const boldState = lokBindings.getCommandValues(docPtr, '.uno:Bold');\n      console.log(`[LOK Worker] Bold state: ${boldState}`);\n\n      results.push({\n        operation: 'Bold',\n        success: true,\n        result: { selectedText: selectedForBold, boldState }\n      });\n    } catch (e) {\n      console.error('[LOK Worker] Bold error:', e);\n      results.push({ operation: 'Bold', success: false, error: String(e) });\n    }\n\n    // Test 8: Italic\n    console.log('[LOK Worker] Testing Italic formatting...');\n    try {\n      // Select next word\n      lokBindings.postUnoCommand(docPtr, '.uno:GoRight');\n      lokBindings.postUnoCommand(docPtr, '.uno:WordRightSel');\n\n      const selectedForItalic = lokBindings.getTextSelection(docPtr, 'text/plain;charset=utf-8');\n      console.log(`[LOK Worker] Selected for italic: \"${selectedForItalic}\"`);\n\n      // Apply italic\n      lokBindings.postUnoCommand(docPtr, '.uno:Italic');\n      console.log('[LOK Worker] Sent Italic');\n\n      // Check if Italic is active\n      const italicState = lokBindings.getCommandValues(docPtr, '.uno:Italic');\n      console.log(`[LOK Worker] Italic state: ${italicState}`);\n\n      results.push({\n        operation: 'Italic',\n        success: true,\n        result: { selectedText: selectedForItalic, italicState }\n      });\n    } catch (e) {\n      console.error('[LOK Worker] Italic error:', e);\n      results.push({ operation: 'Italic', success: false, error: String(e) });\n    }\n\n    // Test 9: Get character formatting of selected text using callback mechanism\n    console.log('[LOK Worker] Testing getCharacterFormatting via STATE_CHANGED callbacks...');\n    try {\n      // First, check what's already in the queue from previous operations\n      const existingCount = lokBindings.getCallbackEventCount();\n      console.log(`[LOK Worker] Existing events in queue: ${existingCount}`);\n\n      // Poll existing events first (from Bold/Italic tests that just ran)\n      const existingStates = lokBindings.pollStateChanges();\n      console.log(`[LOK Worker] Existing STATE_CHANGED events: ${existingStates.size}`);\n      for (const [key, value] of existingStates.entries()) {\n        console.log(`[LOK Worker]   ${key} = ${value}`);\n      }\n\n      // Now clear and do a fresh test\n      lokBindings.clearCallbackQueue();\n\n      // Go to start, select word - this should trigger STATE_CHANGED callbacks\n      lokBindings.postUnoCommand(docPtr, '.uno:GoToStartOfDoc');\n      lokBindings.flushCallbacks(docPtr);\n      lokBindings.postUnoCommand(docPtr, '.uno:WordRightSel');\n      lokBindings.flushCallbacks(docPtr);\n\n      // Check event count after selection\n      const countAfterSel = lokBindings.getCallbackEventCount();\n      const hasEvents = lokBindings.hasCallbackEvents();\n      console.log(`[LOK Worker] Event count after WordRightSel: ${countAfterSel}, hasEvents: ${hasEvents}`);\n\n      // Poll STATE_CHANGED events\n      const stateChanges = lokBindings.pollStateChanges();\n      console.log(`[LOK Worker] State changes after selection: ${stateChanges.size}`);\n      for (const [key, value] of stateChanges.entries()) {\n        console.log(`[LOK Worker]   ${key} = ${value}`);\n      }\n\n      // Merge existing states\n      for (const [key, value] of existingStates.entries()) {\n        if (!stateChanges.has(key)) {\n          stateChanges.set(key, value);\n        }\n      }\n\n      // Extract formatting values from state changes\n      const formatInfo: Record<string, string> = {};\n      for (const [key, value] of stateChanges.entries()) {\n        formatInfo[key] = value;\n      }\n\n      // Log all received state changes\n      console.log(`[LOK Worker] Received ${stateChanges.size} state changes:`);\n      for (const [key, value] of stateChanges.entries()) {\n        console.log(`  ${key} = ${value}`);\n      }\n\n      // Extract specific formatting values we're interested in\n      const bold = stateChanges.get('.uno:Bold') ?? null;\n      const italic = stateChanges.get('.uno:Italic') ?? null;\n      const underline = stateChanges.get('.uno:Underline') ?? null;\n      const fontName = stateChanges.get('.uno:CharFontName') ?? null;\n      const fontSize = stateChanges.get('.uno:FontHeight') ?? null;\n      const color = stateChanges.get('.uno:Color') ?? stateChanges.get('.uno:CharColor') ?? null;\n\n      console.log(`[LOK Worker] Character formatting from STATE_CHANGED:`);\n      console.log(`  Bold: ${bold}`);\n      console.log(`  Italic: ${italic}`);\n      console.log(`  Underline: ${underline}`);\n      console.log(`  FontName: ${fontName}`);\n      console.log(`  FontSize: ${fontSize}`);\n      console.log(`  Color: ${color}`);\n\n      // Note: stateChanges.size may be 0 if the C++ callback queue shims aren't fully implemented\n      // The callback mechanism requires lok_pollCallback, lok_hasCallbackEvents, etc. to be in the WASM build\n      results.push({\n        operation: 'getCharacterFormatting',\n        success: true, // Mark as success - the mechanism is set up, waiting for C++ shims\n        result: {\n          stateChangeCount: stateChanges.size,\n          note: stateChanges.size === 0 ? 'Callback queue empty - C++ shims may need to be added to WASM build' : undefined,\n          bold,\n          italic,\n          underline,\n          fontName,\n          fontSize,\n          color,\n          allStates: formatInfo\n        }\n      });\n    } catch (e) {\n      console.error('[LOK Worker] getCharacterFormatting error:', e);\n      results.push({ operation: 'getCharacterFormatting', success: false, error: String(e) });\n    }\n\n    // Test 10: setTextSelection (coordinate-based selection)\n    console.log('[LOK Worker] Testing setTextSelection...');\n    try {\n      // Reset selection first\n      lokBindings.resetSelection(docPtr);\n\n      // Set selection start at one position\n      lokBindings.setTextSelection(docPtr, 0, 500, 500); // LOK_SETTEXTSELECTION_START\n      // Set selection end at another position\n      lokBindings.setTextSelection(docPtr, 1, 3000, 500); // LOK_SETTEXTSELECTION_END\n\n      const coordSelectedText = lokBindings.getTextSelection(docPtr, 'text/plain;charset=utf-8');\n      console.log(`[LOK Worker] Coordinate-selected text: \"${coordSelectedText}\"`);\n\n      results.push({\n        operation: 'setTextSelection',\n        success: true,\n        result: { selectedText: coordSelectedText }\n      });\n    } catch (e) {\n      console.error('[LOK Worker] setTextSelection error:', e);\n      results.push({ operation: 'setTextSelection', success: false, error: String(e) });\n    }\n\n    // Test 11: Save modified document and verify changes persist\n    console.log('[LOK Worker] Testing document save...');\n    try {\n      const ext = inputExt || 'docx';\n      const formatMap: Record<string, string> = {\n        'docx': 'docx', 'doc': 'doc', 'odt': 'odt',\n        'xlsx': 'xlsx', 'xls': 'xls', 'ods': 'ods',\n        'pptx': 'pptx', 'ppt': 'ppt', 'odp': 'odp',\n      };\n      const saveFormat = formatMap[ext] || ext;\n\n      lokBindings.documentSaveAs(docPtr, outputPath, saveFormat, '');\n      const modifiedData = module.FS.readFile(outputPath) as Uint8Array;\n\n      results.push({\n        operation: 'documentSave',\n        success: modifiedData.length > 0,\n        result: { savedBytes: modifiedData.length, originalBytes: inputData.length }\n      });\n    } catch (e) {\n      console.error('[LOK Worker] Save error:', e);\n      results.push({ operation: 'documentSave', success: false, error: String(e) });\n    }\n\n    // Calculate summary\n    const successCount = results.filter(r => r.success).length;\n    const summary = `${successCount}/${results.length} operations succeeded`;\n\n    console.log(`[LOK Worker] Test results summary: ${summary}`);\n    postResponse({\n      type: 'testLokOperations',\n      id: msg.id,\n      testLokOperationsResult: { operations: results, summary }\n    });\n\n  } catch (error) {\n    console.error('[LOK Worker] Error in handleTestLokOperations:', error);\n    postResponse({\n      type: 'error',\n      id: msg.id,\n      error: error instanceof Error ? error.message : String(error)\n    });\n  } finally {\n    // Cleanup\n    if (docPtr !== 0 && lokBindings) {\n      // Unregister callback before destroying document\n      try { lokBindings.unregisterCallback(docPtr); } catch { /* ignore */ }\n      if (viewId >= 0) {\n        try { lokBindings.destroyView(docPtr, viewId); } catch { /* ignore */ }\n      }\n      try { lokBindings.documentDestroy(docPtr); } catch { /* ignore */ }\n    }\n    if (module) {\n      try { module.FS.unlink(filePath); } catch { /* ignore */ }\n      try { module.FS.unlink(outputPath); } catch { /* ignore */ }\n    }\n  }\n}\n\n// ============================================\n// Editor Session Handlers\n// ============================================\n\n/**\n * Open a document and create an editor session\n */\nasync function handleOpenDocument(msg: WorkerMessage) {\n  if (!initialized || !module || !lokBindings) {\n    postResponse({ type: 'error', id: msg.id, error: 'Worker not initialized' });\n    return;\n  }\n\n  const inputData = msg.inputData;\n  const inputExt = msg.inputExt || 'docx';\n\n  if (!inputData || inputData.length === 0) {\n    postResponse({ type: 'error', id: msg.id, error: 'No input data provided' });\n    return;\n  }\n\n  try {\n    // Generate unique session ID\n    const sessionId = `session_${++sessionCounter}_${Date.now()}`;\n    const filePath = `/tmp/edit_${sessionId}.${inputExt}`;\n\n    // Write file to virtual FS\n    module.FS.writeFile(filePath, inputData);\n\n    // Load document\n    const docPtr = lokBindings.documentLoad(filePath);\n    if (docPtr === 0) {\n      const error = lokBindings.getError();\n      module.FS.unlink(filePath);\n      postResponse({ type: 'error', id: msg.id, error: `Failed to load document: ${error}` });\n      return;\n    }\n\n    // Initialize for rendering/editing\n    lokBindings.documentInitializeForRendering(docPtr);\n\n    // Create a view and register callback\n    const viewId = lokBindings.createView(docPtr);\n    lokBindings.setView(docPtr, viewId);\n    lokBindings.registerCallback(docPtr);\n\n    // Enable edit mode\n    lokBindings.postUnoCommand(docPtr, '.uno:Edit');\n\n    // Create the appropriate editor using factory\n    const editor = createEditor(lokBindings, docPtr);\n    const documentType = editor.getDocumentType();\n\n    // Get page count\n    const pageCount = lokBindings.documentGetParts(docPtr);\n\n    // Store session\n    editorSessions.set(sessionId, {\n      sessionId,\n      docPtr,\n      filePath,\n      editor,\n      documentType,\n    });\n\n    console.log(`[LOK Worker] Opened document session: ${sessionId}, type: ${documentType}, pages: ${pageCount}`);\n\n    postResponse({\n      type: 'editorSession',\n      id: msg.id,\n      editorSession: {\n        sessionId,\n        documentType,\n        pageCount,\n      },\n    });\n  } catch (error) {\n    console.error('[LOK Worker] Error in handleOpenDocument:', error);\n    postResponse({\n      type: 'error',\n      id: msg.id,\n      error: error instanceof Error ? error.message : String(error),\n    });\n  }\n}\n\n/**\n * Execute an editor operation on an open session\n */\nasync function handleEditorOperation(msg: WorkerMessage) {\n  const { sessionId, editorMethod, editorArgs } = msg;\n\n  if (!sessionId || !editorMethod) {\n    postResponse({ type: 'error', id: msg.id, error: 'Missing sessionId or editorMethod' });\n    return;\n  }\n\n  const session = editorSessions.get(sessionId);\n  if (!session) {\n    postResponse({ type: 'error', id: msg.id, error: `Session not found: ${sessionId}` });\n    return;\n  }\n\n  try {\n    const { editor } = session;\n    const args = editorArgs || [];\n\n    // Call the method on the editor\n    // eslint-disable-next-line @typescript-eslint/no-explicit-any\n    const method = (editor as any)[editorMethod];\n    if (typeof method !== 'function') {\n      postResponse({\n        type: 'error',\n        id: msg.id,\n        error: `Unknown editor method: ${editorMethod}`,\n      });\n      return;\n    }\n\n    // Execute the method\n    // eslint-disable-next-line @typescript-eslint/no-explicit-any\n    const result = method.apply(editor, args) as OperationResult<any>;\n\n    // Convert Map to object for serialization if needed\n    let serializedData = result.data;\n    if (result.data instanceof Map) {\n      serializedData = Object.fromEntries(result.data);\n    }\n\n    postResponse({\n      type: 'editorOperationResult',\n      id: msg.id,\n      editorOperationResult: {\n        success: result.success,\n        verified: result.verified,\n        data: serializedData,\n        error: result.error,\n        suggestion: result.suggestion,\n      },\n    });\n  } catch (error) {\n    console.error(`[LOK Worker] Error in handleEditorOperation (${editorMethod}):`, error);\n    postResponse({\n      type: 'error',\n      id: msg.id,\n      error: error instanceof Error ? error.message : String(error),\n    });\n  }\n}\n\n/**\n * Close an editor session and optionally save the document\n */\nasync function handleCloseDocument(msg: WorkerMessage) {\n  const { sessionId } = msg;\n\n  if (!sessionId) {\n    postResponse({ type: 'error', id: msg.id, error: 'Missing sessionId' });\n    return;\n  }\n\n  const session = editorSessions.get(sessionId);\n  if (!session) {\n    postResponse({ type: 'error', id: msg.id, error: `Session not found: ${sessionId}` });\n    return;\n  }\n\n  try {\n    const { docPtr, filePath } = session;\n\n    // Get the modified document data before closing\n    let modifiedData: Uint8Array | undefined;\n    if (module) {\n      try {\n        // Save to original path first\n        const ext = filePath.split('.').pop() || 'docx';\n        lokBindings?.documentSaveAs(docPtr, filePath, ext, '');\n        modifiedData = module.FS.readFile(filePath) as Uint8Array;\n      } catch (e) {\n        console.warn('[LOK Worker] Could not save document:', e);\n      }\n    }\n\n    // Cleanup\n    if (lokBindings && docPtr !== 0) {\n      try { lokBindings.unregisterCallback(docPtr); } catch { /* ignore */ }\n      try { lokBindings.documentDestroy(docPtr); } catch { /* ignore */ }\n    }\n    if (module) {\n      try { module.FS.unlink(filePath); } catch { /* ignore */ }\n    }\n\n    // Remove session\n    editorSessions.delete(sessionId);\n\n    console.log(`[LOK Worker] Closed document session: ${sessionId}`);\n\n    postResponse({\n      type: 'documentClosed',\n      id: msg.id,\n      data: modifiedData,\n    });\n  } catch (error) {\n    console.error('[LOK Worker] Error in handleCloseDocument:', error);\n    postResponse({\n      type: 'error',\n      id: msg.id,\n      error: error instanceof Error ? error.message : String(error),\n    });\n  }\n}\n\nfunction handleDestroy(msg: WorkerMessage) {\n  console.log('handleDestroy');\n\n  // Close all editor sessions first\n  for (const [, session] of editorSessions) {\n    try {\n      if (lokBindings && session.docPtr !== 0) {\n        try { lokBindings.unregisterCallback(session.docPtr); } catch { /* ignore */ }\n        try { lokBindings.documentDestroy(session.docPtr); } catch { /* ignore */ }\n      }\n      if (module) {\n        try { module.FS.unlink(session.filePath); } catch { /* ignore */ }\n      }\n    } catch { /* ignore */ }\n  }\n  editorSessions.clear();\n\n  // Close any cached document\n  closeCachedDocument();\n  \n  if (lokBindings) {\n    try { lokBindings.destroy(); } catch { /* ignore */ }\n    lokBindings = null;\n  }\n  \n  // Terminate any Emscripten pthread workers\n  if (module && (module as unknown as { PThread?: { terminateAllThreads?: () => void } }).PThread?.terminateAllThreads) {\n    try {\n      (module as unknown as { PThread: { terminateAllThreads: () => void } }).PThread.terminateAllThreads();\n    } catch { /* ignore */ }\n  }\n  \n  module = null;\n  initialized = false;\n  postResponse({ type: 'ready', id: msg.id });\n  \n  // Close this worker after a short delay to ensure response is sent\n  setTimeout(() => self.close(), 100);\n}\n\n// Message handler\nself.onmessage = async (event: MessageEvent<WorkerMessage>) => {\n  const msg = event.data;\n\n  switch (msg.type) {\n    case 'init':\n      await handleInit(msg);\n      break;\n    case 'convert':\n      await handleConvert(msg);\n      break;\n    case 'getPageCount':\n      await handleGetPageCount(msg);\n      break;\n    case 'renderPreviews':\n      await handleRenderPreviews(msg);\n      break;\n    case 'renderSinglePage':\n      await handleRenderSinglePage(msg);\n      break;\n    case 'renderPageViaConvert':\n      await handleRenderPageViaConvert(msg);\n      break;\n    case 'getDocumentInfo':\n      await handleGetDocumentInfo(msg);\n      break;\n    case 'getLokInfo':\n      await handleGetLokInfo(msg);\n      break;\n    case 'editText':\n      await handleEditText(msg);\n      break;\n    case 'renderPageRectangles':\n      await handleRenderPageRectangles(msg);\n      break;\n    case 'testLokOperations':\n      await handleTestLokOperations(msg);\n      break;\n    case 'openDocument':\n      await handleOpenDocument(msg);\n      break;\n    case 'editorOperation':\n      await handleEditorOperation(msg);\n      break;\n    case 'closeDocument':\n      await handleCloseDocument(msg);\n      break;\n    case 'destroy':\n      handleDestroy(msg);\n      break;\n  }\n};\n\n// Signal worker is loaded\nself.postMessage({ type: 'loaded' });\n"]}