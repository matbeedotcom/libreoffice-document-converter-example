{"version":3,"sources":["../src/types.ts","../src/editor/base.ts","../src/editor/writer.ts","../src/editor/calc.ts","../src/editor/impress.ts","../src/editor/draw.ts","../src/editor/index.ts","../src/lok-bindings.ts","../src/converter.ts","../src/browser.worker.ts"],"names":["ConversionError","code","message","details","FORMAT_FILTERS","FORMAT_MIME_TYPES","EXTENSION_TO_FORMAT","LOK_DOCTYPE_OUTPUT_FORMATS","getOutputFormatsForDocType","docType","OUTPUT_FORMAT_TO_LOK","FORMAT_FILTER_OPTIONS","INPUT_FORMAT_CATEGORY","CATEGORY_OUTPUT_FORMATS","getValidOutputFormats","inputFormat","format","category","isConversionValid","outputFormat","getConversionErrorMessage","input","output","validOutputs","reason","OfficeEditor","lok","docPtr","options","error","path","afterMode","text","searchArgs","selection","hasMatch","find","replace","states","_selection","data","suggestion","truncation","content","maxChars","limit","original","truncated","lastSpace","items","itemToString","charCount","includedCount","item","itemStr","a1","match","colStr","rowStr","col","i","row","c","remainder","ref","WriterEditor","paragraphs","paragraphInfos","index","truncResult","p","structure","w","start","count","end","result","insertIndex","textArgs","styleName","styleArgs","oldText","findReplaceArgs","deletedText","_position","_start","_end","command","_range","args","boldState","italicState","underlineState","fontSizeState","size","fontNameState","existingStates","allText","CalcEditor","_options","numSheets","sheets","name","dataArea","names","cell","sheet","address","value","formula","range","startRow","startCol","endRow","endCol","cells","r","rowData","cellData","cellStr","sum","oldValue","valueStr","newValue","expectedStr","calculatedValue","values","cellsUpdated","rowValues","rangeStr","cellsCleared","afterRow","afterCol","colNum","newName","num","parts","hex","ImpressEditor","numSlides","slides","slideData","textFrames","f","newIndex","fromIndex","toIndex","title","oldTitle","body","oldBody","notes","layout","frames","titleFrame","para","idx","type","layoutId","DrawEditor","numPages","pages","pageInfo","shapes","pageData","pageIndex","shapeType","bounds","shapeCommand","boundsArgs","colorArgs","widthArgs","shapeIndex","newPosition","newSize","LOK_DOCTYPE_TEXT","LOK_DOCTYPE_SPREADSHEET","LOK_DOCTYPE_PRESENTATION","LOK_DOCTYPE_DRAWING","createEditor","getCallbackTypeName","LOK_CLASS","DOC_CLASS","textEncoder","textDecoder","LOKBindings","module","verbose","str","bytes","ptr","heap","slice","addr","installPath","pathPtr","hook","errPtr","lokClassPtr","getErrorPtr","fileUrl","startTime","documentLoadPtr","optsPtr","loadWithOptsPtr","outputPath","filterOptions","urlPtr","formatPtr","docClassPtr","saveAsPtr","destroyPtr","part","sizePtr","width","height","canvasWidth","canvasHeight","tilePosX","tilePosY","tileWidth","tileHeight","bufferSize","bufferPtr","currentPart","docSize","pageRectsStr","pageRect","aspectRatio","outputWidth","outputHeight","mimeType","mimePtr","usedMimePtr","resultPtr","x","y","buttons","modifier","charCode","keyCode","notifyWhenFinished","cmdPtr","argsPtr","dataPtr","dataSize","tilePixelWidth","tilePixelHeight","tileTwipWidth","tileTwipHeight","viewId","enabled","colPtr","rowPtr","mode","optionsPtr","payloadBuffer","payloadLengthPtr","eventType","payloadLength","payload","len","events","event","hasShim","eqIndex","key","rectanglesStr","s","rect","ensureNodeModules","LibreOfficeConverter","msg","resolve","convError","wasmPath","moduleModule","moduleUrl","config","script","reject","createModule","moduleWithCallback","fs","tryMkdir","originalOpen","flags","err","logDir","label","e","versionInfo","filename","inputData","inputExt","outputExt","inputPath","outputFilename","loadOptions","stat","lokFormat","pdfOpts","levelMap","pageNum","outputData","fsError","renderOptions","pageIndices","numParts","pagesToRender","_","results","preview","pageCount","validOutputFormats","docTypeNames","rectsStr","sheetIndex","_input","_sessionId","_method","_args","mod","worker","lastDot","phase","percent","PHASE_WEIGHTS","phaseProgress","currentInitRequestId","lastEmittedPercent","calculateTotalProgress","total","formatBytes","emitDownloadProgress","loaded","weight","phasePercent","newProgress","emitProgress","emitPhaseProgress","progress","installProgressInterceptors","originalFetch","init","url","response","contentLength","reader","stream","controller","done","OriginalXHR","ProgressXMLHttpRequest","xhr","requestUrl","method","async","username","password","originalSend","downloadPhase","lokBindings","converter","initialized","cachedDoc","editorSessions","sessionCounter","hashInput","hash","step","byte","getDocumentPageCount","pageRects","getOrLoadDocument","inputHash","closeCachedDocument","filePath","postResponse","postProgress","id","handleInit","sofficeJs","sofficeWasm","sofficeData","sofficeWorkerJs","_scriptDir","checkReady","orig","IMAGE_FORMATS","handleConvert","isImageFormat","inPath","outPath","outputFiles","baseOpts","pageFiles","docWidth","docHeight","exportWidth","exportHeight","pageOutPath","pageOpts","pageCopy","zipData","createSimpleZip","opts","sharedResult","files","chunks","centralDirectory","offset","file","nameBytes","localHeader","view","crc32","cdEntry","cdView","cdOffset","cdSize","entry","eocd","eocdView","totalSize","chunk","pos","crc","j","handleGetPageCount","handleRenderPreviews","maxWidth","previews","rendered","dataCopy","transfers","handleRenderSinglePage","errorMsg","handleRenderPageViaConvert","filterOpts","pngData","pngCopy","handleGetDocumentInfo","docTypeOutputFormats","documentInfo","handleGetLokInfo","pageRectangles","documentSize","partInfo","a11yFocusedParagraph","a11yCaretPosition","editMode","newViewId","parsedPartInfo","parsedA11yParagraph","lokInfo","handleEditText","findText","replaceText","insertText","operationResult","searchErr","pasteResult","insertArgs","ext","saveFormat","modifiedData","modifiedCopy","editResult","saveError","errorObj","moduleAny","exMsg","handleRenderPageRectangles","parsedRects","transferBuffers","handleTestLokOperations","selectedText","textLength","selType","selTypeAfterReset","selectedBeforeDelete","textAfterUndo","textAfterRedo","selectedForBold","selectedForItalic","existingCount","countAfterSel","hasEvents","stateChanges","formatInfo","bold","italic","underline","fontName","fontSize","color","coordSelectedText","summary","handleOpenDocument","sessionId","editor","documentType","handleEditorOperation","editorMethod","editorArgs","session","serializedData","handleCloseDocument","handleDestroy"],"mappings":"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","file":"browser.worker.global.js","sourcesContent":["/**\n * LibreOffice WASM Document Conversion Types\n * Headless document format conversion toolkit\n */\n\n/**\n * Supported input document formats\n */\nexport type InputFormat =\n  // Microsoft Office formats\n  | 'doc'\n  | 'docx'\n  | 'xls'\n  | 'xlsx'\n  | 'ppt'\n  | 'pptx'\n  // OpenDocument formats\n  | 'odt'\n  | 'ods'\n  | 'odp'\n  | 'odg'\n  | 'odf'\n  // Other formats\n  | 'rtf'\n  | 'txt'\n  | 'html'\n  | 'htm'\n  | 'csv'\n  | 'xml'\n  | 'epub'\n  | 'pdf';\n\n/**\n * Supported output document formats\n */\nexport type OutputFormat =\n  | 'pdf'\n  | 'docx'\n  | 'doc'\n  | 'odt'\n  | 'rtf'\n  | 'txt'\n  | 'html'\n  | 'xlsx'\n  | 'xls'\n  | 'ods'\n  | 'csv'\n  | 'pptx'\n  | 'ppt'\n  | 'odp'\n  | 'png'\n  | 'jpg'\n  | 'svg';\n\n/**\n * Document conversion options\n */\nexport interface ConversionOptions {\n  /**\n   * Output format for the conversion\n   */\n  outputFormat: OutputFormat;\n\n  /**\n   * Input format hint (auto-detected if not provided)\n   */\n  inputFormat?: InputFormat;\n\n  /**\n   * PDF-specific options\n   */\n  pdf?: PdfOptions;\n\n  /**\n   * Image output options (for png, jpg, svg)\n   */\n  image?: ImageOptions;\n\n  /**\n   * Password for encrypted documents\n   */\n  password?: string;\n}\n\n/**\n * PDF-specific conversion options\n */\nexport interface PdfOptions {\n  /**\n   * PDF/A conformance level\n   */\n  pdfaLevel?: 'PDF/A-1b' | 'PDF/A-2b' | 'PDF/A-3b';\n\n  /**\n   * PDF quality (0-100, affects image compression)\n   * @default 90\n   */\n  quality?: number;\n}\n\n/**\n * Image output options\n */\nexport interface ImageOptions {\n  /**\n   * Image width in pixels\n   */\n  width?: number;\n\n  /**\n   * Image height in pixels\n   */\n  height?: number;\n\n  /**\n   * DPI for rendering\n   * @default 150\n   */\n  dpi?: number;\n\n  /**\n   * Page index to export (0-based). Only exports this single page.\n   * If not specified, exports the first page (page 0).\n   * Cannot be used together with `pages`.\n   */\n  pageIndex?: number;\n\n  /**\n   * Array of page indices to export (0-based).\n   * If specified, returns an array of results (one per page).\n   * Cannot be used together with `pageIndex`.\n   */\n  pages?: number[];\n}\n\n/**\n * Result of a document conversion\n */\nexport interface ConversionResult {\n  /**\n   * The converted document data\n   */\n  data: Uint8Array;\n\n  /**\n   * MIME type of the output\n   */\n  mimeType: string;\n\n  /**\n   * Suggested filename with new extension\n   */\n  filename: string;\n\n  /**\n   * Conversion duration in milliseconds\n   */\n  duration: number;\n}\n\n/**\n * LibreOffice WASM module initialization options (Node.js)\n */\nexport interface LibreOfficeWasmOptions {\n  /**\n   * Path to WASM files directory\n   * @default './wasm'\n   */\n  wasmPath?: string;\n\n  /**\n   * Path to the worker script (for WorkerConverter)\n   * When not specified, auto-detected based on module location\n   */\n  workerPath?: string;\n\n  /**\n   * Enable verbose logging\n   * @default false\n   */\n  verbose?: boolean;\n\n  /**\n   * Called when WASM module is ready\n   */\n  onReady?: () => void;\n\n  /**\n   * Called on initialization error\n   */\n  onError?: (error: Error) => void;\n\n  /**\n   * Called with progress updates during initialization\n   */\n  onProgress?: (progress: ProgressInfo) => void;\n}\n\n/**\n * Explicit paths to WASM files (Browser)\n * All paths are required when specified explicitly\n */\nexport interface BrowserWasmPaths {\n  /** URL to soffice.js - the main Emscripten loader script */\n  sofficeJs: string;\n  /** URL to soffice.wasm - the WebAssembly binary (~112MB) */\n  sofficeWasm: string;\n  /** URL to soffice.data - the virtual filesystem image (~80MB) */\n  sofficeData: string;\n  /** URL to soffice.worker.js - the Emscripten pthread worker */\n  sofficeWorkerJs: string;\n}\n\n/**\n * Browser converter initialization options\n * All WASM paths are optional and default to /wasm/ via createWasmPaths()\n */\nexport interface BrowserConverterOptions {\n  /** URL to soffice.js - defaults to /wasm/soffice.js */\n  sofficeJs?: string;\n  /** URL to soffice.wasm - defaults to /wasm/soffice.wasm */\n  sofficeWasm?: string;\n  /** URL to soffice.data - defaults to /wasm/soffice.data */\n  sofficeData?: string;\n  /** URL to soffice.worker.js - defaults to /wasm/soffice.worker.js */\n  sofficeWorkerJs?: string;\n\n  /**\n   * Enable verbose logging\n   * @default false\n   */\n  verbose?: boolean;\n\n  /**\n   * Called when WASM module is ready\n   */\n  onReady?: () => void;\n\n  /**\n   * Called on initialization error\n   */\n  onError?: (error: Error) => void;\n\n  /**\n   * Called with progress updates during initialization\n   */\n  onProgress?: (progress: WasmLoadProgress) => void;\n}\n\n/**\n * Worker browser converter initialization options\n * All WASM paths are optional and default to /wasm/ via createWasmPaths()\n */\nexport interface WorkerBrowserConverterOptions extends BrowserConverterOptions {\n  /** URL to browser.worker.js - defaults to /dist/browser.worker.global.js */\n  browserWorkerJs?: string;\n}\n\n/**\n * Internal type for BrowserConverterOptions after defaults are applied\n * All WASM paths are guaranteed to be defined\n */\nexport type ResolvedBrowserConverterOptions = BrowserConverterOptions & BrowserWasmPaths;\n\n/**\n * Internal type for WorkerBrowserConverterOptions after defaults are applied\n * All WASM paths and browserWorkerJs are guaranteed to be defined\n */\nexport type ResolvedWorkerBrowserConverterOptions = WorkerBrowserConverterOptions & BrowserWasmPaths & {\n  browserWorkerJs: string;\n};\n\n/**\n * Default URL for WASM files - relative path for same-origin hosting\n * Users typically serve WASM files from their own server at /wasm/\n */\nexport const DEFAULT_WASM_BASE_URL = '/wasm/';\n\n/**\n * Create WASM file paths from a base URL\n * Convenience helper for users who keep all WASM files in one directory\n *\n * @param baseUrl - Base URL ending with '/' (e.g., '/wasm/', 'https://cdn.example.com/wasm/')\n *                  Defaults to '/wasm/' for same-origin hosting\n * @returns Object with all WASM file paths\n *\n * @example\n * ```typescript\n * // Use default /wasm/ path (same-origin)\n * const converter = new WorkerBrowserConverter({\n *   ...createWasmPaths(),\n *   browserWorkerJs: '/dist/browser.worker.js',\n * });\n *\n * // Or use your own CDN\n * const converter = new WorkerBrowserConverter({\n *   ...createWasmPaths('https://cdn.example.com/wasm/'),\n *   browserWorkerJs: '/dist/browser.worker.js',\n * });\n * ```\n */\nexport function createWasmPaths(baseUrl: string = DEFAULT_WASM_BASE_URL): BrowserWasmPaths {\n  // Ensure baseUrl ends with /\n  const base = baseUrl.endsWith('/') ? baseUrl : `${baseUrl}/`;\n  return {\n    sofficeJs: `${base}soffice.js`,\n    sofficeWasm: `${base}soffice.wasm`,\n    sofficeData: `${base}soffice.data`,\n    sofficeWorkerJs: `${base}soffice.worker.js`,\n  };\n}\n\n/**\n * Loading phases for WASM initialization\n * Used to track detailed progress during the ~80 second browser startup\n */\nexport type WasmLoadPhase =\n  | 'download-wasm'    // Downloading soffice.wasm (~142MB)\n  | 'download-data'    // Downloading soffice.data (~96MB)\n  | 'compile'          // WebAssembly compilation\n  | 'filesystem'       // Emscripten filesystem setup\n  | 'lok-init'         // LibreOfficeKit initialization\n  | 'ready' | 'starting' | 'loading' | 'initializing' | 'converting' | 'complete';           // Complete\n\n/**\n * Extended progress information with download details\n * Backward compatible - existing code using percent/message continues to work\n */\nexport interface WasmLoadProgress {\n  /** Overall progress 0-100 */\n  percent: number;\n  /** Human-readable status message */\n  message: string;\n  /** Current loading phase */\n  phase: WasmLoadPhase;\n  /** Bytes downloaded (present during download phases) */\n  bytesLoaded?: number;\n  /** Total bytes to download (present during download phases) */\n  bytesTotal?: number;\n}\n\n/**\n * Progress information\n * @deprecated Use WasmLoadProgress for richer progress data\n */\nexport interface ProgressInfo {\n  phase: 'loading' | 'initializing' | 'converting' | 'complete';\n  percent: number;\n  message: string;\n}\n\n/**\n * Error codes for conversion failures\n */\nexport enum ConversionErrorCode {\n  UNKNOWN = 'UNKNOWN',\n  INVALID_INPUT = 'INVALID_INPUT',\n  UNSUPPORTED_FORMAT = 'UNSUPPORTED_FORMAT',\n  CORRUPTED_DOCUMENT = 'CORRUPTED_DOCUMENT',\n  PASSWORD_REQUIRED = 'PASSWORD_REQUIRED',\n  WASM_NOT_INITIALIZED = 'WASM_NOT_INITIALIZED',\n  CONVERSION_FAILED = 'CONVERSION_FAILED',\n  LOAD_FAILED = 'LOAD_FAILED',\n}\n\n/**\n * Custom error class for conversion errors\n */\nexport class ConversionError extends Error {\n  public readonly code: ConversionErrorCode;\n  public readonly details?: string;\n\n  constructor(code: ConversionErrorCode, message: string, details?: string) {\n    super(message);\n    this.name = 'ConversionError';\n    this.code = code;\n    this.details = details;\n  }\n}\n\n/**\n * Emscripten Module interface\n */\nexport interface EmscriptenModule {\n  // Core Emscripten functions\n  ccall: (\n    name: string,\n    returnType: string | null,\n    argTypes: string[],\n    args: unknown[]\n  ) => unknown;\n  cwrap: (\n    name: string,\n    returnType: string | null,\n    argTypes: string[]\n  ) => (...args: unknown[]) => unknown;\n\n  // Memory management\n  _malloc: (size: number) => number;\n  _free: (ptr: number) => void;\n  HEAPU8: Uint8Array;\n  HEAP32: Int32Array;\n  HEAPU32: Uint32Array;\n\n  // File system\n  FS: EmscriptenFS;\n\n  // Lifecycle\n  onRuntimeInitialized?: () => void;\n  calledRun?: boolean;\n\n  // LibreOfficeKit hooks (exported C functions)\n  _lok_preinit?: (path: number, args: number) => number;\n  _lok_preinit_2?: (path: number, args: number, callback: number) => number;\n  _libreofficekit_hook?: (path: number) => number;\n  _libreofficekit_hook_2?: (path: number, userProfile: number) => number;\n  _main?: (argc: number, argv: number) => number;\n\n  // WebAssembly function table for indirect calls\n  wasmTable?: WebAssembly.Table;\n\n  // Module locator\n  locateFile?: (path: string) => string;\n  print?: (text: string) => void;\n  printErr?: (text: string) => void;\n\n  // Runtime ready promise (some builds)\n  ready?: Promise<EmscriptenModule>;\n}\n\n/**\n * Emscripten virtual filesystem\n */\nexport interface EmscriptenFS {\n  mkdir: (path: string) => void;\n  writeFile: (path: string, data: Uint8Array | string, opts?: { encoding?: string }) => void;\n  readFile: (path: string, opts?: { encoding?: string }) => Uint8Array | string;\n  unlink: (path: string) => void;\n  readdir: (path: string) => string[];\n  stat: (path: string) => { size: number; isDirectory: () => boolean };\n  rmdir: (path: string) => void;\n  rename: (oldPath: string, newPath: string) => void;\n  open: (path: string, flags: unknown, mode?: unknown) => unknown;\n}\n\n/**\n * Filter name mapping for LibreOffice export\n * Note: For image exports, use getFilterForDocType() instead as filters are document-type specific\n */\nexport const FORMAT_FILTERS: Record<OutputFormat, string> = {\n  pdf: 'writer_pdf_Export',\n  docx: 'MS Word 2007 XML',\n  doc: 'MS Word 97',\n  odt: 'writer8',\n  rtf: 'Rich Text Format',\n  txt: 'Text',\n  html: 'HTML (StarWriter)',\n  xlsx: 'Calc MS Excel 2007 XML',\n  xls: 'MS Excel 97',\n  ods: 'calc8',\n  csv: 'Text - txt - csv (StarCalc)',\n  pptx: 'Impress MS PowerPoint 2007 XML',\n  ppt: 'MS PowerPoint 97',\n  odp: 'impress8',\n  png: 'writer_png_Export',\n  jpg: 'writer_jpg_Export',\n  svg: 'writer_svg_Export',\n};\n\n/**\n * LibreOfficeKit document types (from LibreOfficeKitEnums.h)\n */\nexport enum LOKDocumentType {\n  TEXT = 0,\n  SPREADSHEET = 1,\n  PRESENTATION = 2,\n  DRAWING = 3,\n  OTHER = 4,\n}\n\n/**\n * Document-type-specific filters for image and PDF exports\n * Each document type (Writer, Calc, Impress, Draw) has its own export filters\n */\nexport const DOC_TYPE_FILTERS: Record<LOKDocumentType, Partial<Record<OutputFormat, string>>> = {\n  [LOKDocumentType.TEXT]: {\n    pdf: 'writer_pdf_Export',\n    png: 'writer_png_Export',\n    jpg: 'writer_jpg_Export',\n    svg: 'writer_svg_Export',\n    html: 'HTML (StarWriter)',\n  },\n  [LOKDocumentType.SPREADSHEET]: {\n    pdf: 'calc_pdf_Export',\n    png: 'calc_png_Export',\n    jpg: 'calc_jpg_Export',\n    svg: 'calc_svg_Export',\n    html: 'HTML (StarCalc)',\n  },\n  [LOKDocumentType.PRESENTATION]: {\n    pdf: 'impress_pdf_Export',\n    png: 'impress_png_Export',\n    jpg: 'impress_jpg_Export',\n    svg: 'impress_svg_Export',\n    html: 'impress_html_Export',\n  },\n  [LOKDocumentType.DRAWING]: {\n    pdf: 'draw_pdf_Export',\n    png: 'draw_png_Export',\n    jpg: 'draw_jpg_Export',\n    svg: 'draw_svg_Export',\n    html: 'draw_html_Export',\n  },\n  [LOKDocumentType.OTHER]: {\n    pdf: 'writer_pdf_Export',\n    png: 'writer_png_Export',\n    jpg: 'writer_jpg_Export',\n    svg: 'writer_svg_Export',\n  },\n};\n\n/**\n * Get the correct export filter for a given output format and document type\n * @param outputFormat The desired output format\n * @param docType The LibreOfficeKit document type (use documentGetDocumentType())\n * @returns The filter name to use for saveAs\n */\nexport function getFilterForDocType(outputFormat: OutputFormat, docType: LOKDocumentType | number): string {\n  // Check if there's a document-type-specific filter\n  const docTypeFilters = DOC_TYPE_FILTERS[docType as LOKDocumentType];\n  if (docTypeFilters && docTypeFilters[outputFormat]) {\n    return docTypeFilters[outputFormat];\n  }\n  \n  // Fall back to the default filter\n  return FORMAT_FILTERS[outputFormat];\n}\n\n/**\n * MIME types for output formats\n */\nexport const FORMAT_MIME_TYPES: Record<OutputFormat, string> = {\n  pdf: 'application/pdf',\n  docx: 'application/vnd.openxmlformats-officedocument.wordprocessingml.document',\n  doc: 'application/msword',\n  odt: 'application/vnd.oasis.opendocument.text',\n  rtf: 'application/rtf',\n  txt: 'text/plain',\n  html: 'text/html',\n  xlsx: 'application/vnd.openxmlformats-officedocument.spreadsheetml.sheet',\n  xls: 'application/vnd.ms-excel',\n  ods: 'application/vnd.oasis.opendocument.spreadsheet',\n  csv: 'text/csv',\n  pptx: 'application/vnd.openxmlformats-officedocument.presentationml.presentation',\n  ppt: 'application/vnd.ms-powerpoint',\n  odp: 'application/vnd.oasis.opendocument.presentation',\n  png: 'image/png',\n  jpg: 'image/jpeg',\n  svg: 'image/svg+xml',\n};\n\n/**\n * File extension to format mapping\n */\nexport const EXTENSION_TO_FORMAT: Record<string, InputFormat> = {\n  doc: 'doc',\n  docx: 'docx',\n  xls: 'xls',\n  xlsx: 'xlsx',\n  ppt: 'ppt',\n  pptx: 'pptx',\n  odt: 'odt',\n  ods: 'ods',\n  odp: 'odp',\n  odg: 'odg',\n  odf: 'odf',\n  rtf: 'rtf',\n  txt: 'txt',\n  html: 'html',\n  htm: 'html',\n  csv: 'csv',\n  xml: 'xml',\n  epub: 'epub',\n  pdf: 'pdf',\n};\n\n/**\n * Map LOK document type to valid output formats\n * This is based on LibreOffice's actual extension maps in desktop/source/lib/init.cxx\n * \n * IMPORTANT: These are the formats that LibreOffice's saveAs() actually supports.\n * The extension maps in init.cxx determine what filters are available per document type.\n * \n * Writer (TEXT): doc, docx, odt, pdf, rtf, txt, html, png, epub\n * Calc (SPREADSHEET): csv, ods, pdf, xls, xlsx, html, png\n * Impress (PRESENTATION): odp, pdf, ppt, pptx, svg, html, png\n * Draw (DRAWING): odg, pdf, svg, html, png\n * \n * NOTE: jpg is NOT in any extension map! Only png is supported for image export.\n * NOTE: svg is only supported for Impress and Draw, not Writer or Calc.\n */\nexport const LOK_DOCTYPE_OUTPUT_FORMATS: Record<LOKDocumentType, OutputFormat[]> = {\n  [LOKDocumentType.TEXT]: ['pdf', 'docx', 'doc', 'odt', 'rtf', 'txt', 'html', 'png'],\n  [LOKDocumentType.SPREADSHEET]: ['pdf', 'xlsx', 'xls', 'ods', 'csv', 'html', 'png'],\n  [LOKDocumentType.PRESENTATION]: ['pdf', 'pptx', 'ppt', 'odp', 'png', 'svg', 'html'],\n  [LOKDocumentType.DRAWING]: ['pdf', 'png', 'svg', 'html'],\n  [LOKDocumentType.OTHER]: ['pdf'],\n};\n\n/**\n * Get valid output formats for a LOK document type\n * Use this after loading a document to get accurate conversion options\n * @param docType The LOK document type (from documentGetDocumentType)\n * @returns Array of valid output formats\n */\nexport function getOutputFormatsForDocType(docType: LOKDocumentType | number): OutputFormat[] {\n  return LOK_DOCTYPE_OUTPUT_FORMATS[docType as LOKDocumentType] || ['pdf'];\n}\n\n/**\n * Map output format to LOK format string\n * These are the format names used by LibreOfficeKit's saveAs\n */\nexport const OUTPUT_FORMAT_TO_LOK: Record<OutputFormat, string> = {\n  pdf: 'pdf',\n  docx: 'docx',\n  doc: 'doc',\n  odt: 'odt',\n  rtf: 'rtf',\n  txt: 'txt',\n  html: 'html',\n  xlsx: 'xlsx',\n  xls: 'xls',\n  ods: 'ods',\n  csv: 'csv',\n  pptx: 'pptx',\n  ppt: 'ppt',\n  odp: 'odp',\n  png: 'png',\n  jpg: 'jpg',\n  svg: 'svg',\n};\n\n/**\n * Filter options for specific format conversions\n * These are passed to LibreOfficeKit's saveAs as the filterOptions parameter\n */\nexport const FORMAT_FILTER_OPTIONS: Partial<Record<OutputFormat, string>> = {\n  // PDF options can include things like:\n  // - SelectPdfVersion (0=PDF 1.4, 1=PDF/A-1, 2=PDF/A-2, 3=PDF/A-3)\n  // - UseLosslessCompression\n  // - Quality\n  pdf: '',\n  // CSV can specify separator, encoding, etc.\n  csv: '44,34,76,1,,0,false,true,false,false,false,-1',\n  // Text encoding\n  txt: 'UTF8',\n};\n\n/**\n * Document type categories for determining valid conversions\n */\nexport type DocumentCategory = 'text' | 'spreadsheet' | 'presentation' | 'drawing' | 'other';\n\n/**\n * Map input formats to their document category\n * This determines which output formats are valid\n */\nexport const INPUT_FORMAT_CATEGORY: Record<InputFormat, DocumentCategory> = {\n  // Text/Writer documents\n  doc: 'text',\n  docx: 'text',\n  odt: 'text',\n  rtf: 'text',\n  txt: 'text',\n  html: 'text',\n  htm: 'text',\n  epub: 'text',\n  xml: 'text',\n  // Spreadsheet/Calc documents\n  xls: 'spreadsheet',\n  xlsx: 'spreadsheet',\n  ods: 'spreadsheet',\n  csv: 'spreadsheet',\n  // Presentation/Impress documents\n  ppt: 'presentation',\n  pptx: 'presentation',\n  odp: 'presentation',\n  // Drawing/Draw documents (PDF imports as Draw)\n  odg: 'drawing',\n  odf: 'drawing',\n  pdf: 'drawing', // PDFs are imported as Draw documents\n};\n\n/**\n * Valid output formats for each document category\n * Based on LibreOffice's actual filter capabilities\n */\nexport const CATEGORY_OUTPUT_FORMATS: Record<DocumentCategory, OutputFormat[]> = {\n  // Writer documents can export to (based on aWriterExtensionMap in init.cxx):\n  // NOTE: jpg and svg are NOT supported for Writer - only png for images\n  text: ['pdf', 'docx', 'doc', 'odt', 'rtf', 'txt', 'html', 'png'],\n  // Calc documents can export to (based on aCalcExtensionMap in init.cxx):\n  // NOTE: jpg and svg are NOT supported for Calc - only png for images\n  spreadsheet: ['pdf', 'xlsx', 'xls', 'ods', 'csv', 'html', 'png'],\n  // Impress documents can export to (based on aImpressExtensionMap in init.cxx):\n  // NOTE: jpg is NOT supported - only png and svg for images\n  presentation: ['pdf', 'pptx', 'ppt', 'odp', 'png', 'svg', 'html'],\n  // Draw documents (including imported PDFs) can export to (based on aDrawExtensionMap in init.cxx):\n  // NOTE: jpg is NOT supported - only png and svg for images\n  drawing: ['pdf', 'png', 'svg', 'html'],\n  // Other/unknown - try PDF only\n  other: ['pdf'],\n};\n\n/**\n * Get valid output formats for a given input format\n * @param inputFormat The input document format\n * @returns Array of valid output formats\n */\nexport function getValidOutputFormats(inputFormat: InputFormat | string): OutputFormat[] {\n  const format = inputFormat.toLowerCase() as InputFormat;\n  const category = INPUT_FORMAT_CATEGORY[format];\n  \n  if (!category) {\n    // Unknown format - allow PDF as a safe default\n    return ['pdf'];\n  }\n  \n  return CATEGORY_OUTPUT_FORMATS[category];\n}\n\n/**\n * Check if a conversion from input format to output format is valid\n * @param inputFormat The input document format\n * @param outputFormat The desired output format\n * @returns true if the conversion is supported\n */\nexport function isConversionValid(\n  inputFormat: InputFormat | string,\n  outputFormat: OutputFormat | string\n): boolean {\n  const validOutputs = getValidOutputFormats(inputFormat);\n  return validOutputs.includes(outputFormat.toLowerCase() as OutputFormat);\n}\n\n/**\n * Get a human-readable error message for invalid conversions\n * @param inputFormat The input document format\n * @param outputFormat The desired output format\n * @returns Error message explaining why the conversion is not supported\n */\nexport function getConversionErrorMessage(\n  inputFormat: InputFormat | string,\n  outputFormat: OutputFormat | string\n): string {\n  const input = inputFormat.toLowerCase();\n  const output = outputFormat.toLowerCase();\n  const validOutputs = getValidOutputFormats(input as InputFormat);\n  \n  const category = INPUT_FORMAT_CATEGORY[input as InputFormat] || 'unknown';\n  \n  let reason = '';\n  if (category === 'drawing' && ['docx', 'doc', 'xlsx', 'xls', 'pptx', 'ppt'].includes(output)) {\n    reason = `PDF files are imported as Draw documents and cannot be exported to Office formats. `;\n  } else if (category === 'spreadsheet' && ['docx', 'doc', 'pptx', 'ppt'].includes(output)) {\n    reason = `Spreadsheet documents cannot be converted to word processing or presentation formats. `;\n  } else if (category === 'presentation' && ['docx', 'doc', 'xlsx', 'xls'].includes(output)) {\n    reason = `Presentation documents cannot be converted to word processing or spreadsheet formats. `;\n  } else if (category === 'text' && ['xlsx', 'xls', 'pptx', 'ppt'].includes(output)) {\n    reason = `Text documents cannot be converted to spreadsheet or presentation formats. `;\n  }\n  \n  return `Cannot convert ${input.toUpperCase()} to ${output.toUpperCase()}. ${reason}Valid output formats for ${input.toUpperCase()}: ${validOutputs.join(', ')}`;\n}\n\n// ============================================\n// Shared Converter Interface\n// ============================================\n\n/**\n * Page preview data returned by renderPage/renderPagePreviews\n */\nexport interface PagePreview {\n  page: number;\n  data: Uint8Array;\n  width: number;\n  height: number;\n}\n\n/**\n * Document information returned by getDocumentInfo\n */\nexport interface DocumentInfo {\n  documentType: LOKDocumentType | number;\n  documentTypeName: string;\n  validOutputFormats: OutputFormat[];\n  pageCount: number;\n}\n\n/**\n * Options for rendering page previews\n */\nexport interface RenderOptions {\n  /** Width of rendered image in pixels */\n  width?: number;\n  /** Height of rendered image in pixels (0 = auto based on aspect ratio) */\n  height?: number;\n  /** Specific page indices to render (0-based). If empty, renders all pages */\n  pageIndices?: number[];\n}\n\n/**\n * Editor session returned from openDocument\n */\nexport interface EditorSession {\n  sessionId: string;\n  documentType: string;\n  pageCount: number;\n}\n\n/**\n * Result from editor operations\n */\nexport interface EditorOperationResult<T = unknown> {\n  success: boolean;\n  verified?: boolean;\n  data?: T;\n  error?: string;\n  suggestion?: string;\n}\n\n/**\n * Options containing input format for document operations.\n */\nexport type InputFormatOptions = Pick<ConversionOptions, 'inputFormat'>;\n\n/**\n * Common interface for all LibreOffice converter implementations.\n * Ensures consistent API across different threading models (main thread, workers, child processes).\n *\n * All methods returning Promise are async in the interface to allow implementations\n * flexibility in whether they need actual async operations.\n */\nexport interface ILibreOfficeConverter {\n  // ============================================\n  // Lifecycle\n  // ============================================\n\n  /** Initialize the converter. Must be called before any other operations. */\n  initialize(): Promise<void>;\n\n  /** Destroy the converter and release all resources. */\n  destroy(): Promise<void>;\n\n  /** Check if the converter is ready for operations. */\n  isReady(): boolean;\n\n  // ============================================\n  // Core Conversion\n  // ============================================\n\n  /** Convert a document to a different format. */\n  convert(\n    input: Uint8Array | ArrayBuffer,\n    options: ConversionOptions,\n    filename?: string\n  ): Promise<ConversionResult>;\n\n  // ============================================\n  // Document Inspection\n  // ============================================\n\n  /** Get the number of pages in a document. */\n  getPageCount(\n    input: Uint8Array | ArrayBuffer,\n    options: InputFormatOptions\n  ): Promise<number>;\n\n  /** Get document information including type and valid output formats. */\n  getDocumentInfo(\n    input: Uint8Array | ArrayBuffer,\n    options: InputFormatOptions\n  ): Promise<DocumentInfo>;\n\n  // ============================================\n  // Page Rendering\n  // ============================================\n\n  /** Render a single page as an image. */\n  renderPage(\n    input: Uint8Array | ArrayBuffer,\n    options: InputFormatOptions,\n    pageIndex: number,\n    width: number,\n    height?: number\n  ): Promise<PagePreview>;\n\n  /** Render multiple pages as images. */\n  renderPagePreviews(\n    input: Uint8Array | ArrayBuffer,\n    options: InputFormatOptions,\n    renderOptions?: RenderOptions\n  ): Promise<PagePreview[]>;\n\n  // ============================================\n  // Editor Operations\n  // ============================================\n\n  /** Open a document for editing and return a session. */\n  openDocument(\n    input: Uint8Array | ArrayBuffer,\n    options: InputFormatOptions\n  ): Promise<EditorSession>;\n\n  /** Execute an editor operation on an open document. */\n  editorOperation<T = unknown>(\n    sessionId: string,\n    method: string,\n    args?: unknown[]\n  ): Promise<EditorOperationResult<T>>;\n\n  /** Close an editor session and optionally get the modified document. */\n  closeDocument(sessionId: string): Promise<Uint8Array | undefined>;\n}\n","// src/editor/base.ts\nimport type { LOKBindings } from '../lok-bindings.js';\nimport type { OutputFormat } from '../types.js';\nimport type {\n  OperationResult,\n  DocumentStructure,\n  OpenDocumentOptions,\n  SelectionRange,\n  FindOptions,\n  Position,\n  TruncationInfo,\n  CellRef,\n} from './types.js';\n\n/**\n * Abstract base class for all document editors\n */\nexport abstract class OfficeEditor {\n  protected lok: LOKBindings;\n  protected docPtr: number;\n  protected options: Required<Pick<OpenDocumentOptions, 'maxResponseChars'>> & OpenDocumentOptions;\n  protected inputPath: string = '';\n\n  constructor(lok: LOKBindings, docPtr: number, options: OpenDocumentOptions = {}) {\n    this.lok = lok;\n    this.docPtr = docPtr;\n    this.options = {\n      maxResponseChars: options.maxResponseChars ?? 8000,\n      ...options,\n    };\n  }\n\n  // ============================================\n  // Abstract methods (implemented by subclasses)\n  // ============================================\n\n  abstract getStructure(options?: { maxResponseChars?: number }): OperationResult<DocumentStructure>;\n  abstract getDocumentType(): 'writer' | 'calc' | 'impress' | 'draw';\n\n  // ============================================\n  // Accessor methods\n  // ============================================\n\n  /**\n   * Get the document pointer for low-level LOK operations\n   */\n  getDocPtr(): number {\n    return this.docPtr;\n  }\n\n  /**\n   * Get the LOK bindings for low-level operations\n   */\n  getLokBindings(): LOKBindings {\n    return this.lok;\n  }\n\n  // ============================================\n  // Lifecycle methods\n  // ============================================\n\n  save(): OperationResult<{ path: string }> {\n    try {\n      // Save to the original path\n      if (!this.inputPath) {\n        return this.createErrorResult('No input path set', 'Use saveAs() to specify a path');\n      }\n      // LibreOffice auto-saves on document operations, but we can force it\n      this.lok.postUnoCommand(this.docPtr, '.uno:Save');\n      return this.createResult({ path: this.inputPath });\n    } catch (error) {\n      return this.createErrorResult(`Save failed: ${String(error)}`);\n    }\n  }\n\n  saveAs(path: string, format: OutputFormat): OperationResult<{ path: string }> {\n    try {\n      this.lok.documentSaveAs(this.docPtr, path, format, '');\n      return this.createResult({ path });\n    } catch (error) {\n      return this.createErrorResult(`SaveAs failed: ${String(error)}`);\n    }\n  }\n\n  close(): OperationResult<void> {\n    try {\n      this.lok.documentDestroy(this.docPtr);\n      this.docPtr = 0;\n      return this.createResult(undefined);\n    } catch (error) {\n      return this.createErrorResult(`Close failed: ${String(error)}`);\n    }\n  }\n\n  /**\n   * Get the current edit mode of the document\n   * @returns 0 = view mode, 1 = edit mode\n   */\n  getEditMode(): number {\n    return this.lok.getEditMode(this.docPtr);\n  }\n\n  /**\n   * Attempt to enable edit mode for the document\n   * @returns OperationResult with success and verified fields\n   */\n  enableEditMode(): OperationResult<{ editMode: number }> {\n    try {\n      const beforeMode = this.lok.getEditMode(this.docPtr);\n      if (beforeMode === 1) {\n        // Already in edit mode\n        return this.createResult({ editMode: 1 });\n      }\n\n      // Try .uno:Edit command to switch to edit mode\n      this.lok.postUnoCommand(this.docPtr, '.uno:Edit');\n\n      const afterMode = this.lok.getEditMode(this.docPtr);\n      return {\n        success: true,\n        verified: afterMode === 1,\n        data: { editMode: afterMode },\n      };\n    } catch (error) {\n      return this.createErrorResult(`Failed to enable edit mode: ${String(error)}`);\n    }\n  }\n\n  // ============================================\n  // History methods\n  // ============================================\n\n  undo(): OperationResult<void> {\n    try {\n      this.lok.postUnoCommand(this.docPtr, '.uno:Undo');\n      return this.createResult(undefined);\n    } catch (error) {\n      return this.createErrorResult(`Undo failed: ${String(error)}`);\n    }\n  }\n\n  redo(): OperationResult<void> {\n    try {\n      this.lok.postUnoCommand(this.docPtr, '.uno:Redo');\n      return this.createResult(undefined);\n    } catch (error) {\n      return this.createErrorResult(`Redo failed: ${String(error)}`);\n    }\n  }\n\n  // ============================================\n  // Search methods\n  // ============================================\n\n  find(text: string, options?: FindOptions): OperationResult<{ matches: number; firstMatch?: Position }> {\n    try {\n      const searchArgs = JSON.stringify({\n        'SearchItem.SearchString': { type: 'string', value: text },\n        'SearchItem.Backward': { type: 'boolean', value: false },\n        'SearchItem.SearchAll': { type: 'boolean', value: true },\n        'SearchItem.MatchCase': { type: 'boolean', value: options?.caseSensitive ?? false },\n        'SearchItem.WordOnly': { type: 'boolean', value: options?.wholeWord ?? false },\n      });\n\n      this.lok.postUnoCommand(this.docPtr, '.uno:ExecuteSearch', searchArgs);\n\n      // Get search results - this is approximate as LOK doesn't return match count directly\n      const selection = this.lok.getTextSelection(this.docPtr, 'text/plain');\n      const hasMatch = selection !== null && selection.length > 0;\n\n      return this.createResult({\n        matches: hasMatch ? 1 : 0, // LOK doesn't provide count, we report if found\n        firstMatch: hasMatch ? { x: 0, y: 0 } : undefined,\n      });\n    } catch (error) {\n      return this.createErrorResult(`Find failed: ${String(error)}`);\n    }\n  }\n\n  findAndReplaceAll(find: string, replace: string, options?: FindOptions): OperationResult<{ replacements: number }> {\n    try {\n      const searchArgs = JSON.stringify({\n        'SearchItem.SearchString': { type: 'string', value: find },\n        'SearchItem.ReplaceString': { type: 'string', value: replace },\n        'SearchItem.Command': { type: 'long', value: 3 }, // Replace All\n        'SearchItem.MatchCase': { type: 'boolean', value: options?.caseSensitive ?? false },\n        'SearchItem.WordOnly': { type: 'boolean', value: options?.wholeWord ?? false },\n      });\n\n      this.lok.postUnoCommand(this.docPtr, '.uno:ExecuteSearch', searchArgs);\n\n      // LOK doesn't return replacement count, we assume success\n      return this.createResult({ replacements: -1 }); // -1 indicates unknown count\n    } catch (error) {\n      return this.createErrorResult(`Replace failed: ${String(error)}`);\n    }\n  }\n\n  // ============================================\n  // Callback-based state retrieval\n  // ============================================\n\n  /**\n   * Poll all STATE_CHANGED callback events and return as a map.\n   *\n   * LOK sends STATE_CHANGED events when formatting state changes (e.g., when\n   * the cursor moves over bold text, `.uno:Bold=true` is emitted).\n   *\n   * Pattern for getting current format state:\n   * 1. clearCallbackQueue() - clear any stale events\n   * 2. Perform action that triggers state change (e.g., SelectWord)\n   * 3. flushCallbacks(docPtr) - force LOK to process callbacks\n   * 4. pollStateChanges() - retrieve the events\n   *\n   * @returns Map of UNO command names to their state values\n   *          e.g., Map { '.uno:Bold' => 'true', '.uno:Italic' => 'false' }\n   */\n  getStateChanges(): OperationResult<Map<string, string>> {\n    try {\n      const states = this.lok.pollStateChanges();\n      return this.createResult(states);\n    } catch (error) {\n      return this.createErrorResult(`Failed to poll state changes: ${String(error)}`);\n    }\n  }\n\n  /**\n   * Flush pending LOK callbacks and then poll for state changes.\n   * Convenience method that combines flushCallbacks + pollStateChanges.\n   *\n   * @returns Map of UNO command names to their state values\n   */\n  flushAndPollState(): OperationResult<Map<string, string>> {\n    try {\n      this.lok.flushCallbacks(this.docPtr);\n      const states = this.lok.pollStateChanges();\n      return this.createResult(states);\n    } catch (error) {\n      return this.createErrorResult(`Failed to flush and poll state: ${String(error)}`);\n    }\n  }\n\n  /**\n   * Clear the callback queue, useful before performing operations\n   * where you want to capture only new state changes.\n   */\n  clearCallbackQueue(): void {\n    this.lok.clearCallbackQueue();\n  }\n\n  // ============================================\n  // Selection methods\n  // ============================================\n\n  select(_selection: SelectionRange): OperationResult<{ selected: string }> {\n    try {\n      // Implementation depends on selection type - subclasses may override\n      // Base implementation just returns current selection\n      const text = this.lok.getTextSelection(this.docPtr, 'text/plain');\n      return this.createResult({ selected: text || '' });\n    } catch (error) {\n      return this.createErrorResult(`Select failed: ${String(error)}`);\n    }\n  }\n\n  getSelection(): OperationResult<{ text: string; range: SelectionRange }> {\n    try {\n      const text = this.lok.getTextSelection(this.docPtr, 'text/plain');\n      return this.createResult({\n        text: text || '',\n        range: { type: 'text', start: { paragraph: 0, character: 0 } },\n      });\n    } catch (error) {\n      return this.createErrorResult(`GetSelection failed: ${String(error)}`);\n    }\n  }\n\n  clearSelection(): OperationResult<void> {\n    try {\n      this.lok.resetSelection(this.docPtr);\n      return this.createResult(undefined);\n    } catch (error) {\n      return this.createErrorResult(`ClearSelection failed: ${String(error)}`);\n    }\n  }\n\n  // ============================================\n  // Protected helper methods\n  // ============================================\n\n  protected createResult<T>(data: T): OperationResult<T> {\n    return {\n      success: true,\n      verified: true,\n      data,\n    };\n  }\n\n  protected createErrorResult<T>(error: string, suggestion?: string): OperationResult<T> {\n    return {\n      success: false,\n      verified: false,\n      error,\n      suggestion,\n    };\n  }\n\n  protected createResultWithTruncation<T>(data: T, truncation?: TruncationInfo): OperationResult<T> {\n    return {\n      success: true,\n      verified: true,\n      data,\n      truncated: truncation,\n    };\n  }\n\n  protected truncateContent(content: string, maxChars?: number): {\n    content: string;\n    truncated: boolean;\n    original: number;\n    returned: number;\n  } {\n    const limit = maxChars ?? this.options.maxResponseChars;\n    const original = content.length;\n\n    if (original <= limit) {\n      return { content, truncated: false, original, returned: original };\n    }\n\n    // Truncate at a word boundary if possible\n    let truncated = content.slice(0, limit);\n    const lastSpace = truncated.lastIndexOf(' ');\n    if (lastSpace > limit * 0.8) {\n      truncated = truncated.slice(0, lastSpace);\n    }\n\n    return {\n      content: truncated,\n      truncated: true,\n      original,\n      returned: truncated.length,\n    };\n  }\n\n  protected truncateArray<T>(items: T[], maxChars: number, itemToString: (item: T) => string): {\n    items: T[];\n    truncated: boolean;\n    original: number;\n    returned: number;\n  } {\n    const original = items.length;\n    let charCount = 0;\n    let includedCount = 0;\n\n    for (const item of items) {\n      const itemStr = itemToString(item);\n      if (charCount + itemStr.length > maxChars) {\n        break;\n      }\n      charCount += itemStr.length;\n      includedCount++;\n    }\n\n    return {\n      items: items.slice(0, includedCount),\n      truncated: includedCount < original,\n      original,\n      returned: includedCount,\n    };\n  }\n\n  // ============================================\n  // Cell address helpers\n  // ============================================\n\n  protected a1ToRowCol(a1: string): { row: number; col: number } {\n    const match = a1.match(/^([A-Z]+)(\\d+)$/i);\n    if (!match) {\n      throw new Error(`Invalid A1 notation: ${a1}`);\n    }\n\n    const colStr = match[1]!.toUpperCase();\n    const rowStr = match[2]!;\n\n    let col = 0;\n    for (let i = 0; i < colStr.length; i++) {\n      col = col * 26 + (colStr.charCodeAt(i) - 64);\n    }\n    col -= 1; // 0-indexed\n\n    const row = parseInt(rowStr, 10) - 1; // 0-indexed\n\n    return { row, col };\n  }\n\n  protected rowColToA1(row: number, col: number): string {\n    let colStr = '';\n    let c = col + 1; // 1-indexed for conversion\n\n    while (c > 0) {\n      const remainder = (c - 1) % 26;\n      colStr = String.fromCharCode(65 + remainder) + colStr;\n      c = Math.floor((c - 1) / 26);\n    }\n\n    return `${colStr}${row + 1}`;\n  }\n\n  protected normalizeCellRef(ref: CellRef): { row: number; col: number } {\n    if (typeof ref === 'string') {\n      return this.a1ToRowCol(ref);\n    }\n    return ref;\n  }\n\n  // ============================================\n  // Internal state\n  // ============================================\n\n  setInputPath(path: string): void {\n    this.inputPath = path;\n  }\n\n  isOpen(): boolean {\n    return this.docPtr !== 0;\n  }\n}\n","// src/editor/writer.ts\nimport { OfficeEditor } from './base.js';\nimport type {\n  OperationResult,\n  WriterStructure,\n  Paragraph,\n  TextPosition,\n  TextRange,\n  TextFormat,\n} from './types.js';\n\n/**\n * Editor for Writer (text) documents\n */\nexport class WriterEditor extends OfficeEditor {\n  private cachedParagraphs: string[] | null = null;\n\n  getDocumentType(): 'writer' {\n    return 'writer';\n  }\n\n  getStructure(options?: { maxResponseChars?: number }): OperationResult<WriterStructure> {\n    try {\n      const paragraphs = this.getParagraphsInternal();\n      const maxChars = options?.maxResponseChars ?? this.options.maxResponseChars;\n\n      const paragraphInfos = paragraphs.map((text, index) => ({\n        index,\n        preview: text.slice(0, 100) + (text.length > 100 ? '...' : ''),\n        style: 'Normal', // Would need UNO query to get actual style\n        charCount: text.length,\n      }));\n\n      // Truncate if needed\n      const truncResult = this.truncateArray(\n        paragraphInfos,\n        maxChars,\n        (p) => JSON.stringify(p)\n      );\n\n      const structure: WriterStructure = {\n        type: 'writer',\n        paragraphs: truncResult.items,\n        pageCount: this.lok.documentGetParts(this.docPtr),\n        wordCount: paragraphs.join(' ').split(/\\s+/).filter(w => w.length > 0).length,\n      };\n\n      if (truncResult.truncated) {\n        return this.createResultWithTruncation(structure, {\n          original: truncResult.original,\n          returned: truncResult.returned,\n          message: `Showing ${truncResult.returned} of ${truncResult.original} paragraphs. Use getParagraphs(start, count) to paginate.`,\n        });\n      }\n\n      return this.createResult(structure);\n    } catch (error) {\n      return this.createErrorResult(`Failed to get structure: ${String(error)}`);\n    }\n  }\n\n  getParagraph(index: number): OperationResult<Paragraph> {\n    try {\n      const paragraphs = this.getParagraphsInternal();\n\n      if (index < 0 || index >= paragraphs.length) {\n        return this.createErrorResult(\n          `Paragraph index ${index} out of range (0-${paragraphs.length - 1})`,\n          `Use getStructure() to see available paragraphs`\n        );\n      }\n\n      const text = paragraphs[index]!;\n      return this.createResult({\n        index,\n        text,\n        style: 'Normal',\n        charCount: text.length,\n      });\n    } catch (error) {\n      return this.createErrorResult(`Failed to get paragraph: ${String(error)}`);\n    }\n  }\n\n  getParagraphs(start: number, count: number): OperationResult<Paragraph[]> {\n    try {\n      const paragraphs = this.getParagraphsInternal();\n\n      if (start < 0 || start >= paragraphs.length) {\n        return this.createErrorResult(\n          `Start index ${start} out of range`,\n          `Valid range: 0-${paragraphs.length - 1}`\n        );\n      }\n\n      const end = Math.min(start + count, paragraphs.length);\n      const result = paragraphs.slice(start, end).map((text, i) => ({\n        index: start + i,\n        text,\n        style: 'Normal',\n        charCount: text.length,\n      }));\n\n      return this.createResult(result);\n    } catch (error) {\n      return this.createErrorResult(`Failed to get paragraphs: ${String(error)}`);\n    }\n  }\n\n  insertParagraph(text: string, options?: {\n    afterIndex?: number;\n    style?: 'Normal' | 'Heading 1' | 'Heading 2' | 'Heading 3' | 'List';\n  }): OperationResult<{ index: number }> {\n    try {\n      const paragraphs = this.getParagraphsInternal();\n      const insertIndex = options?.afterIndex !== undefined\n        ? options.afterIndex + 1\n        : paragraphs.length;\n\n      // Move to end of target paragraph or document end\n      if (insertIndex > 0 && insertIndex <= paragraphs.length) {\n        // Navigate to position\n        this.lok.postUnoCommand(this.docPtr, '.uno:GoToEndOfDoc');\n      }\n\n      // Insert paragraph break and text\n      this.lok.postUnoCommand(this.docPtr, '.uno:InsertPara');\n\n      // Insert the text\n      const textArgs = JSON.stringify({\n        Text: { type: 'string', value: text },\n      });\n      this.lok.postUnoCommand(this.docPtr, '.uno:InsertText', textArgs);\n\n      // Apply style if specified\n      if (options?.style && options.style !== 'Normal') {\n        const styleMap: Record<string, string> = {\n          'Heading 1': 'Heading 1',\n          'Heading 2': 'Heading 2',\n          'Heading 3': 'Heading 3',\n          'List': 'List',\n        };\n        const styleName = styleMap[options.style];\n        if (styleName) {\n          const styleArgs = JSON.stringify({\n            Template: { type: 'string', value: styleName },\n            Family: { type: 'short', value: 2 }, // Paragraph styles\n          });\n          this.lok.postUnoCommand(this.docPtr, '.uno:StyleApply', styleArgs);\n        }\n      }\n\n      // Invalidate cache\n      this.cachedParagraphs = null;\n\n      // Verify by re-reading\n      const newParagraphs = this.getParagraphsInternal();\n      const verified = newParagraphs.length > paragraphs.length;\n\n      return {\n        success: true,\n        verified,\n        data: { index: insertIndex },\n      };\n    } catch (error) {\n      return this.createErrorResult(`Failed to insert paragraph: ${String(error)}`);\n    }\n  }\n\n  replaceParagraph(index: number, text: string): OperationResult<{ oldText: string }> {\n    try {\n      const paragraphs = this.getParagraphsInternal();\n\n      if (index < 0 || index >= paragraphs.length) {\n        return this.createErrorResult(\n          `Paragraph index ${index} out of range`,\n          `Valid range: 0-${paragraphs.length - 1}`\n        );\n      }\n\n      const oldText = paragraphs[index]!;\n\n      // Select the paragraph and replace\n      // This is a simplified implementation - full implementation would use cursor positioning\n      const findReplaceArgs = JSON.stringify({\n        'SearchItem.SearchString': { type: 'string', value: oldText },\n        'SearchItem.ReplaceString': { type: 'string', value: text },\n        'SearchItem.Command': { type: 'long', value: 2 }, // Replace\n      });\n      this.lok.postUnoCommand(this.docPtr, '.uno:ExecuteSearch', findReplaceArgs);\n\n      // Invalidate cache\n      this.cachedParagraphs = null;\n\n      return this.createResult({ oldText });\n    } catch (error) {\n      return this.createErrorResult(`Failed to replace paragraph: ${String(error)}`);\n    }\n  }\n\n  deleteParagraph(index: number): OperationResult<{ deletedText: string }> {\n    try {\n      const paragraphs = this.getParagraphsInternal();\n\n      if (index < 0 || index >= paragraphs.length) {\n        return this.createErrorResult(\n          `Paragraph index ${index} out of range`,\n          `Valid range: 0-${paragraphs.length - 1}`\n        );\n      }\n\n      const deletedText = paragraphs[index]!;\n\n      // Replace with empty string\n      const result = this.replaceParagraph(index, '');\n      if (!result.success) {\n        return this.createErrorResult(result.error || 'Failed to delete');\n      }\n\n      return this.createResult({ deletedText });\n    } catch (error) {\n      return this.createErrorResult(`Failed to delete paragraph: ${String(error)}`);\n    }\n  }\n\n  insertText(text: string, _position: TextPosition): OperationResult<void> {\n    try {\n      // TODO: Navigate to position using cursor before inserting\n      const textArgs = JSON.stringify({\n        Text: { type: 'string', value: text },\n      });\n      this.lok.postUnoCommand(this.docPtr, '.uno:InsertText', textArgs);\n\n      this.cachedParagraphs = null;\n      return this.createResult(undefined);\n    } catch (error) {\n      return this.createErrorResult(`Failed to insert text: ${String(error)}`);\n    }\n  }\n\n  deleteText(_start: TextPosition, _end: TextPosition): OperationResult<{ deleted: string }> {\n    try {\n      // TODO: Use start/end to select text range before deleting\n      // Get current selection\n      const selection = this.lok.getTextSelection(this.docPtr, 'text/plain');\n\n      // Delete selection\n      this.lok.postUnoCommand(this.docPtr, '.uno:Delete');\n\n      this.cachedParagraphs = null;\n      return this.createResult({ deleted: selection || '' });\n    } catch (error) {\n      return this.createErrorResult(`Failed to delete text: ${String(error)}`);\n    }\n  }\n\n  replaceText(find: string, replace: string, options?: {\n    paragraph?: number;\n    all?: boolean;\n  }): OperationResult<{ replacements: number }> {\n    try {\n      const command = options?.all ? 3 : 2; // 3 = Replace All, 2 = Replace\n\n      const searchArgs = JSON.stringify({\n        'SearchItem.SearchString': { type: 'string', value: find },\n        'SearchItem.ReplaceString': { type: 'string', value: replace },\n        'SearchItem.Command': { type: 'long', value: command },\n      });\n\n      this.lok.postUnoCommand(this.docPtr, '.uno:ExecuteSearch', searchArgs);\n\n      this.cachedParagraphs = null;\n\n      // LOK doesn't return count, we indicate success\n      return this.createResult({ replacements: -1 });\n    } catch (error) {\n      return this.createErrorResult(`Failed to replace text: ${String(error)}`);\n    }\n  }\n\n  formatText(_range: TextRange, format: TextFormat): OperationResult<void> {\n    try {\n      // TODO: Use range to select text before applying format\n      // Apply formatting commands\n      if (format.bold !== undefined) {\n        this.lok.postUnoCommand(this.docPtr, '.uno:Bold');\n      }\n      if (format.italic !== undefined) {\n        this.lok.postUnoCommand(this.docPtr, '.uno:Italic');\n      }\n      if (format.underline !== undefined) {\n        this.lok.postUnoCommand(this.docPtr, '.uno:Underline');\n      }\n      if (format.fontSize !== undefined) {\n        const args = JSON.stringify({\n          FontHeight: { type: 'float', value: format.fontSize },\n        });\n        this.lok.postUnoCommand(this.docPtr, '.uno:FontHeight', args);\n      }\n      if (format.fontName !== undefined) {\n        const args = JSON.stringify({\n          CharFontName: { type: 'string', value: format.fontName },\n        });\n        this.lok.postUnoCommand(this.docPtr, '.uno:CharFontName', args);\n      }\n\n      return this.createResult(undefined);\n    } catch (error) {\n      return this.createErrorResult(`Failed to format text: ${String(error)}`);\n    }\n  }\n\n  /**\n   * Get the text formatting at the current selection or cursor position.\n   *\n   * Uses LOK callback mechanism to retrieve STATE_CHANGED events which contain\n   * formatting state like `.uno:Bold=true`, `.uno:Italic=false`, etc.\n   *\n   * @param _position - Text position (currently unused, uses current selection)\n   * @returns TextFormat with bold, italic, underline, fontSize, fontName properties\n   */\n  getFormat(_position?: TextPosition): OperationResult<TextFormat> {\n    try {\n      // Clear any existing callback events\n      this.lok.clearCallbackQueue();\n\n      // Trigger a selection change to get current formatting state\n      // Moving cursor slightly and back triggers STATE_CHANGED callbacks\n      this.lok.postUnoCommand(this.docPtr, '.uno:CharRightSel');\n      this.lok.flushCallbacks(this.docPtr);\n      this.lok.postUnoCommand(this.docPtr, '.uno:CharLeft');\n      this.lok.flushCallbacks(this.docPtr);\n\n      // Poll STATE_CHANGED events to get formatting state\n      const states = this.lok.pollStateChanges();\n\n      // Parse the state values into TextFormat\n      const format: TextFormat = {};\n\n      // Bold: .uno:Bold=true or .uno:Bold=false\n      const boldState = states.get('.uno:Bold');\n      if (boldState !== undefined) {\n        format.bold = boldState === 'true';\n      }\n\n      // Italic: .uno:Italic=true or .uno:Italic=false\n      const italicState = states.get('.uno:Italic');\n      if (italicState !== undefined) {\n        format.italic = italicState === 'true';\n      }\n\n      // Underline: .uno:Underline=true or .uno:Underline=false\n      const underlineState = states.get('.uno:Underline');\n      if (underlineState !== undefined) {\n        format.underline = underlineState === 'true';\n      }\n\n      // Font size: .uno:FontHeight=12\n      const fontSizeState = states.get('.uno:FontHeight');\n      if (fontSizeState !== undefined) {\n        const size = parseFloat(fontSizeState);\n        if (!isNaN(size)) {\n          format.fontSize = size;\n        }\n      }\n\n      // Font name: .uno:CharFontName=Arial\n      const fontNameState = states.get('.uno:CharFontName');\n      if (fontNameState !== undefined && fontNameState.length > 0) {\n        format.fontName = fontNameState;\n      }\n\n      return this.createResult(format);\n    } catch (error) {\n      return this.createErrorResult(`Failed to get format: ${String(error)}`);\n    }\n  }\n\n  /**\n   * Get formatting state for the current selection using the callback mechanism.\n   * This is the preferred way to get character formatting as it uses LOK's\n   * STATE_CHANGED callback events.\n   *\n   * @returns Map of UNO command names to their state values\n   */\n  getSelectionFormat(): OperationResult<Map<string, string>> {\n    try {\n      // Poll any existing STATE_CHANGED events (from previous operations)\n      const existingStates = this.lok.pollStateChanges();\n\n      if (existingStates.size === 0) {\n        // No existing states, trigger a selection to get current format\n        this.lok.clearCallbackQueue();\n        this.lok.postUnoCommand(this.docPtr, '.uno:SelectWord');\n        this.lok.flushCallbacks(this.docPtr);\n        const states = this.lok.pollStateChanges();\n        return this.createResult(states);\n      }\n\n      return this.createResult(existingStates);\n    } catch (error) {\n      return this.createErrorResult(`Failed to get selection format: ${String(error)}`);\n    }\n  }\n\n  // ============================================\n  // Private helpers\n  // ============================================\n\n  private getParagraphsInternal(): string[] {\n    if (this.cachedParagraphs) {\n      return this.cachedParagraphs;\n    }\n\n    const allText = this.lok.getAllText(this.docPtr);\n    if (!allText) {\n      return [];\n    }\n\n    // Split by double newlines (paragraph breaks) or single newlines\n    this.cachedParagraphs = allText\n      .split(/\\n\\n|\\r\\n\\r\\n/)\n      .map(p => p.trim())\n      .filter(p => p.length > 0);\n\n    return this.cachedParagraphs;\n  }\n}\n","// src/editor/calc.ts\nimport { OfficeEditor } from './base.js';\nimport type {\n  OperationResult,\n  CalcStructure,\n  CellRef,\n  RangeRef,\n  SheetRef,\n  ColRef,\n  CellData,\n  CellValue,\n  CellFormat,\n  SheetInfo,\n} from './types.js';\n\n/**\n * Editor for Calc (spreadsheet) documents\n */\nexport class CalcEditor extends OfficeEditor {\n  getDocumentType(): 'calc' {\n    return 'calc';\n  }\n\n  getStructure(_options?: { maxResponseChars?: number }): OperationResult<CalcStructure> {\n    try {\n      const numSheets = this.lok.documentGetParts(this.docPtr);\n      const sheets: SheetInfo[] = [];\n\n      for (let i = 0; i < numSheets; i++) {\n        const name = this.lok.getPartName(this.docPtr, i) || `Sheet${i + 1}`;\n        const dataArea = this.lok.getDataArea(this.docPtr, i);\n\n        sheets.push({\n          index: i,\n          name,\n          usedRange: dataArea.col > 0 && dataArea.row > 0\n            ? `A1:${this.rowColToA1(dataArea.row - 1, dataArea.col - 1)}`\n            : 'A1',\n          rowCount: dataArea.row,\n          colCount: dataArea.col,\n        });\n      }\n\n      const structure: CalcStructure = {\n        type: 'calc',\n        sheets,\n      };\n\n      return this.createResult(structure);\n    } catch (error) {\n      return this.createErrorResult(`Failed to get structure: ${String(error)}`);\n    }\n  }\n\n  getSheetNames(): OperationResult<string[]> {\n    try {\n      const numSheets = this.lok.documentGetParts(this.docPtr);\n      const names: string[] = [];\n\n      for (let i = 0; i < numSheets; i++) {\n        const name = this.lok.getPartName(this.docPtr, i) || `Sheet${i + 1}`;\n        names.push(name);\n      }\n\n      return this.createResult(names);\n    } catch (error) {\n      return this.createErrorResult(`Failed to get sheet names: ${String(error)}`);\n    }\n  }\n\n  // ============================================\n  // Cell reading\n  // ============================================\n\n  getCell(cell: CellRef, sheet?: SheetRef): OperationResult<CellData> {\n    try {\n      this.selectSheet(sheet);\n      const { row, col } = this.normalizeCellRef(cell);\n      const address = this.rowColToA1(row, col);\n\n      // Navigate to cell\n      this.goToCell(address);\n\n      // Get value\n      const value = this.getCellValueInternal();\n      const formula = this.getCellFormulaInternal();\n\n      return this.createResult({\n        address,\n        value,\n        formula: formula || undefined,\n      });\n    } catch (error) {\n      return this.createErrorResult(`Failed to get cell: ${String(error)}`);\n    }\n  }\n\n  getCells(range: RangeRef, sheet?: SheetRef, options?: {\n    maxResponseChars?: number;\n  }): OperationResult<CellData[][]> {\n    try {\n      this.selectSheet(sheet);\n      const { startRow, startCol, endRow, endCol } = this.normalizeRangeRef(range);\n      const maxChars = options?.maxResponseChars ?? this.options.maxResponseChars;\n\n      const cells: CellData[][] = [];\n      let charCount = 0;\n      let truncated = false;\n\n      for (let r = startRow; r <= endRow && !truncated; r++) {\n        const rowData: CellData[] = [];\n\n        for (let c = startCol; c <= endCol && !truncated; c++) {\n          const address = this.rowColToA1(r, c);\n          this.goToCell(address);\n\n          const value = this.getCellValueInternal();\n          const cellData: CellData = { address, value };\n\n          const cellStr = JSON.stringify(cellData);\n          if (charCount + cellStr.length > maxChars) {\n            truncated = true;\n            break;\n          }\n\n          charCount += cellStr.length;\n          rowData.push(cellData);\n        }\n\n        if (rowData.length > 0) {\n          cells.push(rowData);\n        }\n      }\n\n      if (truncated) {\n        return this.createResultWithTruncation(cells, {\n          original: (endRow - startRow + 1) * (endCol - startCol + 1),\n          returned: cells.reduce((sum, row) => sum + row.length, 0),\n          message: 'Range truncated due to size. Use smaller ranges to paginate.',\n        });\n      }\n\n      return this.createResult(cells);\n    } catch (error) {\n      return this.createErrorResult(`Failed to get cells: ${String(error)}`);\n    }\n  }\n\n  // ============================================\n  // Cell writing\n  // ============================================\n\n  setCellValue(cell: CellRef, value: string | number, sheet?: SheetRef): OperationResult<{\n    oldValue: CellValue;\n    newValue: CellValue;\n  }> {\n    try {\n      this.selectSheet(sheet);\n      const { row, col } = this.normalizeCellRef(cell);\n      const address = this.rowColToA1(row, col);\n\n      // Get old value first\n      this.goToCell(address);\n      const oldValue = this.getCellValueInternal();\n\n      // Enter the new value\n      const valueStr = typeof value === 'number' ? value.toString() : value;\n      const args = JSON.stringify({\n        StringName: { type: 'string', value: valueStr },\n      });\n      this.lok.postUnoCommand(this.docPtr, '.uno:EnterString', args);\n\n      // Verify by re-reading the cell\n      const newValue = this.getCellValueInternal();\n      const expectedStr = typeof value === 'number' ? value.toString() : value;\n      const verified = newValue === expectedStr || newValue === value;\n\n      return {\n        success: true,\n        verified,\n        data: { oldValue, newValue },\n      };\n    } catch (error) {\n      return this.createErrorResult(`Failed to set cell value: ${String(error)}`);\n    }\n  }\n\n  setCellFormula(cell: CellRef, formula: string, sheet?: SheetRef): OperationResult<{\n    calculatedValue: CellValue;\n  }> {\n    try {\n      this.selectSheet(sheet);\n      const { row, col } = this.normalizeCellRef(cell);\n      const address = this.rowColToA1(row, col);\n\n      // Navigate and enter formula\n      this.goToCell(address);\n\n      const args = JSON.stringify({\n        StringName: { type: 'string', value: formula },\n      });\n      this.lok.postUnoCommand(this.docPtr, '.uno:EnterString', args);\n\n      // Get calculated value\n      const calculatedValue = this.getCellValueInternal();\n\n      return this.createResult({ calculatedValue });\n    } catch (error) {\n      return this.createErrorResult(`Failed to set formula: ${String(error)}`);\n    }\n  }\n\n  setCells(range: RangeRef, values: CellValue[][], sheet?: SheetRef): OperationResult<{\n    cellsUpdated: number;\n  }> {\n    try {\n      this.selectSheet(sheet);\n      const { startRow, startCol } = this.normalizeRangeRef(range);\n      let cellsUpdated = 0;\n\n      for (let r = 0; r < values.length; r++) {\n        const rowValues = values[r];\n        if (!rowValues) continue;\n\n        for (let c = 0; c < rowValues.length; c++) {\n          const value = rowValues[c];\n          if (value === null || value === undefined) continue;\n\n          const address = this.rowColToA1(startRow + r, startCol + c);\n          this.goToCell(address);\n\n          const valueStr = typeof value === 'number' ? value.toString() : String(value);\n          const args = JSON.stringify({\n            StringName: { type: 'string', value: valueStr },\n          });\n          this.lok.postUnoCommand(this.docPtr, '.uno:EnterString', args);\n          cellsUpdated++;\n        }\n      }\n\n      return this.createResult({ cellsUpdated });\n    } catch (error) {\n      return this.createErrorResult(`Failed to set cells: ${String(error)}`);\n    }\n  }\n\n  // ============================================\n  // Clear operations\n  // ============================================\n\n  clearCell(cell: CellRef, sheet?: SheetRef): OperationResult<{ oldValue: CellValue }> {\n    try {\n      this.selectSheet(sheet);\n      const { row, col } = this.normalizeCellRef(cell);\n      const address = this.rowColToA1(row, col);\n\n      this.goToCell(address);\n      const oldValue = this.getCellValueInternal();\n\n      this.lok.postUnoCommand(this.docPtr, '.uno:ClearContents');\n\n      return this.createResult({ oldValue });\n    } catch (error) {\n      return this.createErrorResult(`Failed to clear cell: ${String(error)}`);\n    }\n  }\n\n  clearRange(range: RangeRef, sheet?: SheetRef): OperationResult<{ cellsCleared: number }> {\n    try {\n      this.selectSheet(sheet);\n      const rangeStr = this.normalizeRangeToString(range);\n\n      // Select range and clear\n      this.goToCell(rangeStr);\n      this.lok.postUnoCommand(this.docPtr, '.uno:ClearContents');\n\n      // Count is approximate\n      const { startRow, startCol, endRow, endCol } = this.normalizeRangeRef(range);\n      const cellsCleared = (endRow - startRow + 1) * (endCol - startCol + 1);\n\n      return this.createResult({ cellsCleared });\n    } catch (error) {\n      return this.createErrorResult(`Failed to clear range: ${String(error)}`);\n    }\n  }\n\n  // ============================================\n  // Row/Column operations\n  // ============================================\n\n  insertRow(afterRow: number, sheet?: SheetRef): OperationResult<void> {\n    try {\n      this.selectSheet(sheet);\n      this.goToCell(this.rowColToA1(afterRow + 1, 0));\n      this.lok.postUnoCommand(this.docPtr, '.uno:InsertRows');\n      return this.createResult(undefined);\n    } catch (error) {\n      return this.createErrorResult(`Failed to insert row: ${String(error)}`);\n    }\n  }\n\n  insertColumn(afterCol: ColRef, sheet?: SheetRef): OperationResult<void> {\n    try {\n      this.selectSheet(sheet);\n      const colNum = typeof afterCol === 'string'\n        ? this.a1ToRowCol(afterCol + '1').col + 1\n        : afterCol + 1;\n\n      this.goToCell(this.rowColToA1(0, colNum));\n      this.lok.postUnoCommand(this.docPtr, '.uno:InsertColumns');\n      return this.createResult(undefined);\n    } catch (error) {\n      return this.createErrorResult(`Failed to insert column: ${String(error)}`);\n    }\n  }\n\n  deleteRow(row: number, sheet?: SheetRef): OperationResult<void> {\n    try {\n      this.selectSheet(sheet);\n      this.goToCell(this.rowColToA1(row, 0));\n      this.lok.postUnoCommand(this.docPtr, '.uno:DeleteRows');\n      return this.createResult(undefined);\n    } catch (error) {\n      return this.createErrorResult(`Failed to delete row: ${String(error)}`);\n    }\n  }\n\n  deleteColumn(col: ColRef, sheet?: SheetRef): OperationResult<void> {\n    try {\n      this.selectSheet(sheet);\n      const colNum = typeof col === 'string'\n        ? this.a1ToRowCol(col + '1').col\n        : col;\n\n      this.goToCell(this.rowColToA1(0, colNum));\n      this.lok.postUnoCommand(this.docPtr, '.uno:DeleteColumns');\n      return this.createResult(undefined);\n    } catch (error) {\n      return this.createErrorResult(`Failed to delete column: ${String(error)}`);\n    }\n  }\n\n  // ============================================\n  // Formatting\n  // ============================================\n\n  formatCells(range: RangeRef, format: CellFormat, sheet?: SheetRef): OperationResult<void> {\n    try {\n      this.selectSheet(sheet);\n      const rangeStr = this.normalizeRangeToString(range);\n      this.goToCell(rangeStr);\n\n      if (format.bold !== undefined) {\n        this.lok.postUnoCommand(this.docPtr, '.uno:Bold');\n      }\n      if (format.numberFormat !== undefined) {\n        const args = JSON.stringify({\n          NumberFormatValue: { type: 'string', value: format.numberFormat },\n        });\n        this.lok.postUnoCommand(this.docPtr, '.uno:NumberFormatValue', args);\n      }\n      if (format.backgroundColor !== undefined) {\n        const args = JSON.stringify({\n          BackgroundColor: { type: 'long', value: this.hexToNumber(format.backgroundColor) },\n        });\n        this.lok.postUnoCommand(this.docPtr, '.uno:BackgroundColor', args);\n      }\n\n      return this.createResult(undefined);\n    } catch (error) {\n      return this.createErrorResult(`Failed to format cells: ${String(error)}`);\n    }\n  }\n\n  // ============================================\n  // Sheet management\n  // ============================================\n\n  addSheet(name: string): OperationResult<{ index: number }> {\n    try {\n      const args = JSON.stringify({\n        Name: { type: 'string', value: name },\n      });\n      this.lok.postUnoCommand(this.docPtr, '.uno:Insert', args);\n\n      const numSheets = this.lok.documentGetParts(this.docPtr);\n      return this.createResult({ index: numSheets - 1 });\n    } catch (error) {\n      return this.createErrorResult(`Failed to add sheet: ${String(error)}`);\n    }\n  }\n\n  renameSheet(sheet: SheetRef, newName: string): OperationResult<void> {\n    try {\n      this.selectSheet(sheet);\n      const args = JSON.stringify({\n        Name: { type: 'string', value: newName },\n      });\n      this.lok.postUnoCommand(this.docPtr, '.uno:RenameTable', args);\n      return this.createResult(undefined);\n    } catch (error) {\n      return this.createErrorResult(`Failed to rename sheet: ${String(error)}`);\n    }\n  }\n\n  deleteSheet(sheet: SheetRef): OperationResult<void> {\n    try {\n      this.selectSheet(sheet);\n      this.lok.postUnoCommand(this.docPtr, '.uno:Remove');\n      return this.createResult(undefined);\n    } catch (error) {\n      return this.createErrorResult(`Failed to delete sheet: ${String(error)}`);\n    }\n  }\n\n  // ============================================\n  // Private helpers\n  // ============================================\n\n  private selectSheet(sheet?: SheetRef): void {\n    if (sheet === undefined) return;\n\n    const index = typeof sheet === 'number'\n      ? sheet\n      : this.getSheetIndexByName(sheet);\n\n    if (index >= 0) {\n      this.lok.documentSetPart(this.docPtr, index);\n    }\n  }\n\n  private getSheetIndexByName(name: string): number {\n    const numSheets = this.lok.documentGetParts(this.docPtr);\n    for (let i = 0; i < numSheets; i++) {\n      if (this.lok.getPartName(this.docPtr, i) === name) {\n        return i;\n      }\n    }\n    return -1;\n  }\n\n  private goToCell(address: string): void {\n    const args = JSON.stringify({\n      ToPoint: { type: 'string', value: address },\n    });\n    this.lok.postUnoCommand(this.docPtr, '.uno:GoToCell', args);\n  }\n\n  private getCellValueInternal(): CellValue {\n    const text = this.lok.getTextSelection(this.docPtr, 'text/plain');\n    if (!text) return null;\n\n    // Try to parse as number\n    const num = parseFloat(text);\n    if (!isNaN(num) && text.trim() === num.toString()) {\n      return num;\n    }\n\n    // Check for boolean\n    if (text.toLowerCase() === 'true') return true;\n    if (text.toLowerCase() === 'false') return false;\n\n    return text;\n  }\n\n  private getCellFormulaInternal(): string | null {\n    const result = this.lok.getCommandValues(this.docPtr, '.uno:GetFormulaBarText');\n    if (!result) return null;\n\n    try {\n      const parsed = JSON.parse(result) as { value?: string };\n      return parsed.value ?? null;\n    } catch {\n      return null;\n    }\n  }\n\n  private normalizeRangeRef(range: RangeRef): {\n    startRow: number;\n    startCol: number;\n    endRow: number;\n    endCol: number;\n  } {\n    if (typeof range === 'string') {\n      const parts = range.split(':');\n      const start = this.a1ToRowCol(parts[0]!);\n      const end = parts[1] ? this.a1ToRowCol(parts[1]) : start;\n      return {\n        startRow: start.row,\n        startCol: start.col,\n        endRow: end.row,\n        endCol: end.col,\n      };\n    }\n\n    const start = this.normalizeCellRef(range.start);\n    const end = this.normalizeCellRef(range.end);\n    return {\n      startRow: start.row,\n      startCol: start.col,\n      endRow: end.row,\n      endCol: end.col,\n    };\n  }\n\n  private normalizeRangeToString(range: RangeRef): string {\n    if (typeof range === 'string') return range;\n\n    const start = this.normalizeCellRef(range.start);\n    const end = this.normalizeCellRef(range.end);\n    return `${this.rowColToA1(start.row, start.col)}:${this.rowColToA1(end.row, end.col)}`;\n  }\n\n  private hexToNumber(hex: string): number {\n    return parseInt(hex.replace('#', ''), 16);\n  }\n}\n","// src/editor/impress.ts\nimport { OfficeEditor } from './base.js';\nimport type {\n  OperationResult,\n  ImpressStructure,\n  SlideData,\n  SlideInfo,\n  SlideLayout,\n  TextFrame,\n} from './types.js';\n\n/**\n * Editor for Impress (presentation) documents\n */\nexport class ImpressEditor extends OfficeEditor {\n  getDocumentType(): 'impress' {\n    return 'impress';\n  }\n\n  getStructure(_options?: { maxResponseChars?: number }): OperationResult<ImpressStructure> {\n    try {\n      const numSlides = this.lok.documentGetParts(this.docPtr);\n      const slides: SlideInfo[] = [];\n\n      for (let i = 0; i < numSlides; i++) {\n        const slideData = this.getSlideInfoInternal(i);\n        slides.push(slideData);\n      }\n\n      const structure: ImpressStructure = {\n        type: 'impress',\n        slides,\n        slideCount: numSlides,\n      };\n\n      return this.createResult(structure);\n    } catch (error) {\n      return this.createErrorResult(`Failed to get structure: ${String(error)}`);\n    }\n  }\n\n  // ============================================\n  // Slide reading\n  // ============================================\n\n  getSlide(index: number): OperationResult<SlideData> {\n    try {\n      const numSlides = this.lok.documentGetParts(this.docPtr);\n\n      if (index < 0 || index >= numSlides) {\n        return this.createErrorResult(\n          `Invalid slide index: ${index}. Valid range: 0-${numSlides - 1}`,\n          'Use getStructure() to see available slides'\n        );\n      }\n\n      this.lok.documentSetPart(this.docPtr, index);\n      const text = this.lok.getAllText(this.docPtr) || '';\n      const textFrames = this.parseTextFrames(text);\n\n      const slideData: SlideData = {\n        index,\n        title: textFrames.find(f => f.type === 'title')?.text,\n        textFrames,\n        hasNotes: false, // Could detect from LOK if available\n      };\n\n      return this.createResult(slideData);\n    } catch (error) {\n      return this.createErrorResult(`Failed to get slide: ${String(error)}`);\n    }\n  }\n\n  getSlideCount(): OperationResult<number> {\n    try {\n      const count = this.lok.documentGetParts(this.docPtr);\n      return this.createResult(count);\n    } catch (error) {\n      return this.createErrorResult(`Failed to get slide count: ${String(error)}`);\n    }\n  }\n\n  // ============================================\n  // Slide management\n  // ============================================\n\n  addSlide(options?: { afterSlide?: number; layout?: SlideLayout }): OperationResult<{ index: number }> {\n    try {\n      const numSlides = this.lok.documentGetParts(this.docPtr);\n\n      // Navigate to position if specified\n      if (options?.afterSlide !== undefined) {\n        this.lok.documentSetPart(this.docPtr, options.afterSlide);\n      } else {\n        // Go to last slide\n        this.lok.documentSetPart(this.docPtr, numSlides - 1);\n      }\n\n      // Insert new slide\n      this.lok.postUnoCommand(this.docPtr, '.uno:InsertPage');\n\n      // Apply layout if specified\n      if (options?.layout) {\n        this.applySlideLayout(options.layout);\n      }\n\n      const newIndex = options?.afterSlide !== undefined\n        ? options.afterSlide + 1\n        : numSlides;\n\n      // Verify by checking slide count increased\n      const newNumSlides = this.lok.documentGetParts(this.docPtr);\n      const verified = newNumSlides > numSlides;\n\n      return {\n        success: true,\n        verified,\n        data: { index: newIndex },\n      };\n    } catch (error) {\n      return this.createErrorResult(`Failed to add slide: ${String(error)}`);\n    }\n  }\n\n  deleteSlide(index: number): OperationResult<void> {\n    try {\n      const numSlides = this.lok.documentGetParts(this.docPtr);\n\n      if (numSlides <= 1) {\n        return this.createErrorResult(\n          'Cannot delete the last slide',\n          'A presentation must have at least one slide'\n        );\n      }\n\n      if (index < 0 || index >= numSlides) {\n        return this.createErrorResult(\n          `Invalid slide index: ${index}`,\n          `Valid range: 0-${numSlides - 1}`\n        );\n      }\n\n      this.lok.documentSetPart(this.docPtr, index);\n      this.lok.postUnoCommand(this.docPtr, '.uno:DeletePage');\n\n      return this.createResult(undefined);\n    } catch (error) {\n      return this.createErrorResult(`Failed to delete slide: ${String(error)}`);\n    }\n  }\n\n  duplicateSlide(index: number): OperationResult<{ newIndex: number }> {\n    try {\n      const numSlides = this.lok.documentGetParts(this.docPtr);\n\n      if (index < 0 || index >= numSlides) {\n        return this.createErrorResult(\n          `Invalid slide index: ${index}`,\n          `Valid range: 0-${numSlides - 1}`\n        );\n      }\n\n      this.lok.documentSetPart(this.docPtr, index);\n      this.lok.postUnoCommand(this.docPtr, '.uno:DuplicatePage');\n\n      return this.createResult({ newIndex: index + 1 });\n    } catch (error) {\n      return this.createErrorResult(`Failed to duplicate slide: ${String(error)}`);\n    }\n  }\n\n  moveSlide(fromIndex: number, toIndex: number): OperationResult<void> {\n    try {\n      const numSlides = this.lok.documentGetParts(this.docPtr);\n\n      if (fromIndex < 0 || fromIndex >= numSlides || toIndex < 0 || toIndex >= numSlides) {\n        return this.createErrorResult(\n          `Invalid slide indices. Valid range: 0-${numSlides - 1}`,\n          'Check slide indices are within bounds'\n        );\n      }\n\n      if (fromIndex === toIndex) {\n        return this.createErrorResult(\n          'Source and destination are the same',\n          'Provide different indices to move'\n        );\n      }\n\n      // LOK doesn't have direct slide move - we simulate via cut/paste\n      this.lok.documentSetPart(this.docPtr, fromIndex);\n\n      const args = JSON.stringify({\n        Position: { type: 'long', value: toIndex },\n      });\n      this.lok.postUnoCommand(this.docPtr, '.uno:MovePageFirst', args);\n\n      return this.createResult(undefined);\n    } catch (error) {\n      return this.createErrorResult(`Failed to move slide: ${String(error)}`);\n    }\n  }\n\n  // ============================================\n  // Slide content editing\n  // ============================================\n\n  setSlideTitle(index: number, title: string): OperationResult<{ oldTitle?: string }> {\n    try {\n      const numSlides = this.lok.documentGetParts(this.docPtr);\n\n      if (index < 0 || index >= numSlides) {\n        return this.createErrorResult(`Invalid slide index: ${index}`);\n      }\n\n      this.lok.documentSetPart(this.docPtr, index);\n\n      // Get current title\n      const text = this.lok.getAllText(this.docPtr) || '';\n      const frames = this.parseTextFrames(text);\n      const oldTitle = frames.find(f => f.type === 'title')?.text;\n\n      // Select title placeholder and replace\n      this.lok.postUnoCommand(this.docPtr, '.uno:SelectAll');\n\n      // Enter title text (this replaces first text frame typically)\n      const args = JSON.stringify({\n        Text: { type: 'string', value: title },\n      });\n      this.lok.postUnoCommand(this.docPtr, '.uno:InsertText', args);\n\n      return this.createResult({ oldTitle });\n    } catch (error) {\n      return this.createErrorResult(`Failed to set slide title: ${String(error)}`);\n    }\n  }\n\n  setSlideBody(index: number, body: string): OperationResult<{ oldBody?: string }> {\n    try {\n      const numSlides = this.lok.documentGetParts(this.docPtr);\n\n      if (index < 0 || index >= numSlides) {\n        return this.createErrorResult(`Invalid slide index: ${index}`);\n      }\n\n      this.lok.documentSetPart(this.docPtr, index);\n\n      // Get current body\n      const text = this.lok.getAllText(this.docPtr) || '';\n      const frames = this.parseTextFrames(text);\n      const oldBody = frames.find(f => f.type === 'body')?.text;\n\n      // Navigate to body and replace\n      // Using Tab to move from title to body placeholder\n      this.lok.postUnoCommand(this.docPtr, '.uno:NextObject');\n\n      const args = JSON.stringify({\n        Text: { type: 'string', value: body },\n      });\n      this.lok.postUnoCommand(this.docPtr, '.uno:InsertText', args);\n\n      return this.createResult({ oldBody });\n    } catch (error) {\n      return this.createErrorResult(`Failed to set slide body: ${String(error)}`);\n    }\n  }\n\n  setSlideNotes(index: number, notes: string): OperationResult<void> {\n    try {\n      const numSlides = this.lok.documentGetParts(this.docPtr);\n\n      if (index < 0 || index >= numSlides) {\n        return this.createErrorResult(`Invalid slide index: ${index}`);\n      }\n\n      this.lok.documentSetPart(this.docPtr, index);\n\n      // Switch to notes view and insert text\n      this.lok.postUnoCommand(this.docPtr, '.uno:NotesMode');\n\n      const args = JSON.stringify({\n        Text: { type: 'string', value: notes },\n      });\n      this.lok.postUnoCommand(this.docPtr, '.uno:InsertText', args);\n\n      // Switch back to normal view\n      this.lok.postUnoCommand(this.docPtr, '.uno:NormalViewMode');\n\n      return this.createResult(undefined);\n    } catch (error) {\n      return this.createErrorResult(`Failed to set slide notes: ${String(error)}`);\n    }\n  }\n\n  // ============================================\n  // Slide layout\n  // ============================================\n\n  setSlideLayout(index: number, layout: SlideLayout): OperationResult<void> {\n    try {\n      const numSlides = this.lok.documentGetParts(this.docPtr);\n\n      if (index < 0 || index >= numSlides) {\n        return this.createErrorResult(`Invalid slide index: ${index}`);\n      }\n\n      this.lok.documentSetPart(this.docPtr, index);\n      this.applySlideLayout(layout);\n\n      return this.createResult(undefined);\n    } catch (error) {\n      return this.createErrorResult(`Failed to set slide layout: ${String(error)}`);\n    }\n  }\n\n  // ============================================\n  // Private helpers\n  // ============================================\n\n  private getSlideInfoInternal(index: number): SlideInfo {\n    this.lok.documentSetPart(this.docPtr, index);\n\n    const text = this.lok.getAllText(this.docPtr) || '';\n    const frames = this.parseTextFrames(text);\n    const titleFrame = frames.find(f => f.type === 'title');\n\n    return {\n      index,\n      title: titleFrame?.text,\n      layout: this.detectLayout(frames),\n      textFrameCount: frames.length,\n    };\n  }\n\n  private parseTextFrames(text: string): TextFrame[] {\n    // Parse text content into frames\n    // In Impress, text is typically separated by paragraph breaks\n    const paragraphs = text.split(/\\n\\n+/).filter(p => p.trim());\n    const frames: TextFrame[] = [];\n\n    paragraphs.forEach((para, idx) => {\n      const type = idx === 0 ? 'title' : (idx === 1 ? 'body' : 'other');\n      frames.push({\n        index: idx,\n        type: type as TextFrame['type'],\n        text: para.trim(),\n        bounds: { x: 0, y: 0, width: 0, height: 0 }, // Would need LOK API for actual bounds\n      });\n    });\n\n    return frames;\n  }\n\n  private detectLayout(frames: TextFrame[]): SlideLayout {\n    if (frames.length === 0) return 'blank';\n    if (frames.length === 1 && frames[0]?.type === 'title') return 'title';\n    if (frames.length >= 2) return 'titleContent';\n    return 'blank';\n  }\n\n  private applySlideLayout(layout: SlideLayout): void {\n    // Map layout names to LOK layout IDs\n    const layoutMap: Record<SlideLayout, number> = {\n      blank: 0,\n      title: 1,\n      titleContent: 2,\n      twoColumn: 3,\n    };\n\n    const layoutId = layoutMap[layout] ?? 0;\n    const args = JSON.stringify({\n      WhatLayout: { type: 'long', value: layoutId },\n    });\n    this.lok.postUnoCommand(this.docPtr, '.uno:AssignLayout', args);\n  }\n}\n","// src/editor/draw.ts\nimport { OfficeEditor } from './base.js';\nimport type {\n  OperationResult,\n  DrawStructure,\n  PageData,\n  PageInfo,\n  ShapeData,\n  ShapeType,\n  Rectangle,\n  Size,\n  Position,\n} from './types.js';\n\n/**\n * Editor for Draw (vector graphics) documents\n * Also handles imported PDFs opened for editing\n */\nexport class DrawEditor extends OfficeEditor {\n  private isImportedPdf: boolean = false;\n\n  getDocumentType(): 'draw' {\n    return 'draw';\n  }\n\n  setImportedPdf(value: boolean): void {\n    this.isImportedPdf = value;\n  }\n\n  getStructure(_options?: { maxResponseChars?: number }): OperationResult<DrawStructure> {\n    try {\n      const numPages = this.lok.documentGetParts(this.docPtr);\n      const pages: PageInfo[] = [];\n\n      for (let i = 0; i < numPages; i++) {\n        const pageInfo = this.getPageInfoInternal(i);\n        pages.push(pageInfo);\n      }\n\n      const structure: DrawStructure = {\n        type: 'draw',\n        pages,\n        pageCount: numPages,\n        isImportedPdf: this.isImportedPdf,\n      };\n\n      return this.createResult(structure);\n    } catch (error) {\n      return this.createErrorResult(`Failed to get structure: ${String(error)}`);\n    }\n  }\n\n  // ============================================\n  // Page reading\n  // ============================================\n\n  getPage(index: number): OperationResult<PageData> {\n    try {\n      const numPages = this.lok.documentGetParts(this.docPtr);\n\n      if (index < 0 || index >= numPages) {\n        return this.createErrorResult(\n          `Invalid page index: ${index}. Valid range: 0-${numPages - 1}`,\n          'Use getStructure() to see available pages'\n        );\n      }\n\n      this.lok.documentSetPart(this.docPtr, index);\n      const size = this.lok.documentGetDocumentSize(this.docPtr);\n      const shapes = this.getShapesOnPage();\n\n      const pageData: PageData = {\n        index,\n        shapes,\n        size: { width: size.width, height: size.height },\n      };\n\n      return this.createResult(pageData);\n    } catch (error) {\n      return this.createErrorResult(`Failed to get page: ${String(error)}`);\n    }\n  }\n\n  getPageCount(): OperationResult<number> {\n    try {\n      const count = this.lok.documentGetParts(this.docPtr);\n      return this.createResult(count);\n    } catch (error) {\n      return this.createErrorResult(`Failed to get page count: ${String(error)}`);\n    }\n  }\n\n  // ============================================\n  // Page management\n  // ============================================\n\n  addPage(options?: { afterPage?: number }): OperationResult<{ index: number }> {\n    try {\n      const numPages = this.lok.documentGetParts(this.docPtr);\n\n      // Navigate to position\n      if (options?.afterPage !== undefined) {\n        this.lok.documentSetPart(this.docPtr, options.afterPage);\n      } else {\n        this.lok.documentSetPart(this.docPtr, numPages - 1);\n      }\n\n      // Insert new page\n      this.lok.postUnoCommand(this.docPtr, '.uno:InsertPage');\n\n      const newIndex = options?.afterPage !== undefined\n        ? options.afterPage + 1\n        : numPages;\n\n      return this.createResult({ index: newIndex });\n    } catch (error) {\n      return this.createErrorResult(`Failed to add page: ${String(error)}`);\n    }\n  }\n\n  deletePage(index: number): OperationResult<void> {\n    try {\n      const numPages = this.lok.documentGetParts(this.docPtr);\n\n      if (numPages <= 1) {\n        return this.createErrorResult(\n          'Cannot delete the last page',\n          'A drawing document must have at least one page'\n        );\n      }\n\n      if (index < 0 || index >= numPages) {\n        return this.createErrorResult(\n          `Invalid page index: ${index}`,\n          `Valid range: 0-${numPages - 1}`\n        );\n      }\n\n      this.lok.documentSetPart(this.docPtr, index);\n      this.lok.postUnoCommand(this.docPtr, '.uno:DeletePage');\n\n      return this.createResult(undefined);\n    } catch (error) {\n      return this.createErrorResult(`Failed to delete page: ${String(error)}`);\n    }\n  }\n\n  duplicatePage(index: number): OperationResult<{ newIndex: number }> {\n    try {\n      const numPages = this.lok.documentGetParts(this.docPtr);\n\n      if (index < 0 || index >= numPages) {\n        return this.createErrorResult(\n          `Invalid page index: ${index}`,\n          `Valid range: 0-${numPages - 1}`\n        );\n      }\n\n      this.lok.documentSetPart(this.docPtr, index);\n      this.lok.postUnoCommand(this.docPtr, '.uno:DuplicatePage');\n\n      return this.createResult({ newIndex: index + 1 });\n    } catch (error) {\n      return this.createErrorResult(`Failed to duplicate page: ${String(error)}`);\n    }\n  }\n\n  // ============================================\n  // Shape operations\n  // ============================================\n\n  addShape(\n    pageIndex: number,\n    shapeType: ShapeType,\n    bounds: Rectangle,\n    options?: { text?: string; fillColor?: string; lineColor?: string }\n  ): OperationResult<{ shapeIndex: number }> {\n    try {\n      const numPages = this.lok.documentGetParts(this.docPtr);\n\n      if (pageIndex < 0 || pageIndex >= numPages) {\n        return this.createErrorResult(`Invalid page index: ${pageIndex}`);\n      }\n\n      this.lok.documentSetPart(this.docPtr, pageIndex);\n\n      // Map shape type to UNO command\n      const shapeCommand = this.getShapeCommand(shapeType);\n\n      // Set shape bounds\n      const boundsArgs = JSON.stringify({\n        X: { type: 'long', value: bounds.x },\n        Y: { type: 'long', value: bounds.y },\n        Width: { type: 'long', value: bounds.width },\n        Height: { type: 'long', value: bounds.height },\n      });\n\n      this.lok.postUnoCommand(this.docPtr, shapeCommand, boundsArgs);\n\n      // Set optional properties\n      if (options?.text) {\n        const textArgs = JSON.stringify({\n          Text: { type: 'string', value: options.text },\n        });\n        this.lok.postUnoCommand(this.docPtr, '.uno:InsertText', textArgs);\n      }\n\n      if (options?.fillColor) {\n        const colorArgs = JSON.stringify({\n          FillColor: { type: 'long', value: this.hexToNumber(options.fillColor) },\n        });\n        this.lok.postUnoCommand(this.docPtr, '.uno:FillColor', colorArgs);\n      }\n\n      if (options?.lineColor) {\n        const colorArgs = JSON.stringify({\n          LineColor: { type: 'long', value: this.hexToNumber(options.lineColor) },\n        });\n        this.lok.postUnoCommand(this.docPtr, '.uno:XLineColor', colorArgs);\n      }\n\n      // Return approximate index (would need LOK API to get actual)\n      return this.createResult({ shapeIndex: 0 });\n    } catch (error) {\n      return this.createErrorResult(`Failed to add shape: ${String(error)}`);\n    }\n  }\n\n  addLine(\n    pageIndex: number,\n    start: Position,\n    end: Position,\n    options?: { lineColor?: string; lineWidth?: number }\n  ): OperationResult<{ shapeIndex: number }> {\n    try {\n      const numPages = this.lok.documentGetParts(this.docPtr);\n\n      if (pageIndex < 0 || pageIndex >= numPages) {\n        return this.createErrorResult(`Invalid page index: ${pageIndex}`);\n      }\n\n      this.lok.documentSetPart(this.docPtr, pageIndex);\n\n      const args = JSON.stringify({\n        StartX: { type: 'long', value: start.x },\n        StartY: { type: 'long', value: start.y },\n        EndX: { type: 'long', value: end.x },\n        EndY: { type: 'long', value: end.y },\n      });\n\n      this.lok.postUnoCommand(this.docPtr, '.uno:Line', args);\n\n      if (options?.lineColor) {\n        const colorArgs = JSON.stringify({\n          LineColor: { type: 'long', value: this.hexToNumber(options.lineColor) },\n        });\n        this.lok.postUnoCommand(this.docPtr, '.uno:XLineColor', colorArgs);\n      }\n\n      if (options?.lineWidth) {\n        const widthArgs = JSON.stringify({\n          LineWidth: { type: 'long', value: options.lineWidth },\n        });\n        this.lok.postUnoCommand(this.docPtr, '.uno:LineWidth', widthArgs);\n      }\n\n      return this.createResult({ shapeIndex: 0 });\n    } catch (error) {\n      return this.createErrorResult(`Failed to add line: ${String(error)}`);\n    }\n  }\n\n  deleteShape(pageIndex: number, shapeIndex: number): OperationResult<void> {\n    try {\n      this.lok.documentSetPart(this.docPtr, pageIndex);\n\n      // Select shape by index (simplified - real impl would use object selection)\n      this.selectShape(shapeIndex);\n      this.lok.postUnoCommand(this.docPtr, '.uno:Delete');\n\n      return this.createResult(undefined);\n    } catch (error) {\n      return this.createErrorResult(`Failed to delete shape: ${String(error)}`);\n    }\n  }\n\n  setShapeText(pageIndex: number, shapeIndex: number, text: string): OperationResult<void> {\n    try {\n      this.lok.documentSetPart(this.docPtr, pageIndex);\n      this.selectShape(shapeIndex);\n\n      // Enter edit mode for the shape\n      this.lok.postUnoCommand(this.docPtr, '.uno:EnterGroup');\n\n      // Replace text\n      this.lok.postUnoCommand(this.docPtr, '.uno:SelectAll');\n      const args = JSON.stringify({\n        Text: { type: 'string', value: text },\n      });\n      this.lok.postUnoCommand(this.docPtr, '.uno:InsertText', args);\n\n      // Exit edit mode\n      this.lok.postUnoCommand(this.docPtr, '.uno:LeaveGroup');\n\n      return this.createResult(undefined);\n    } catch (error) {\n      return this.createErrorResult(`Failed to set shape text: ${String(error)}`);\n    }\n  }\n\n  moveShape(pageIndex: number, shapeIndex: number, newPosition: Position): OperationResult<void> {\n    try {\n      this.lok.documentSetPart(this.docPtr, pageIndex);\n      this.selectShape(shapeIndex);\n\n      const args = JSON.stringify({\n        X: { type: 'long', value: newPosition.x },\n        Y: { type: 'long', value: newPosition.y },\n      });\n      this.lok.postUnoCommand(this.docPtr, '.uno:SetObjectPosition', args);\n\n      return this.createResult(undefined);\n    } catch (error) {\n      return this.createErrorResult(`Failed to move shape: ${String(error)}`);\n    }\n  }\n\n  resizeShape(pageIndex: number, shapeIndex: number, newSize: Size): OperationResult<void> {\n    try {\n      this.lok.documentSetPart(this.docPtr, pageIndex);\n      this.selectShape(shapeIndex);\n\n      const args = JSON.stringify({\n        Width: { type: 'long', value: newSize.width },\n        Height: { type: 'long', value: newSize.height },\n      });\n      this.lok.postUnoCommand(this.docPtr, '.uno:Size', args);\n\n      return this.createResult(undefined);\n    } catch (error) {\n      return this.createErrorResult(`Failed to resize shape: ${String(error)}`);\n    }\n  }\n\n  // ============================================\n  // Private helpers\n  // ============================================\n\n  private getPageInfoInternal(index: number): PageInfo {\n    this.lok.documentSetPart(this.docPtr, index);\n    const size = this.lok.documentGetDocumentSize(this.docPtr);\n    const shapes = this.getShapesOnPage();\n\n    return {\n      index,\n      shapeCount: shapes.length,\n      size: { width: size.width, height: size.height },\n    };\n  }\n\n  private getShapesOnPage(): ShapeData[] {\n    // In a real implementation, we'd enumerate shapes via LOK\n    // For now, we parse text content as a simple proxy\n    const text = this.lok.getAllText(this.docPtr) || '';\n\n    if (!text.trim()) {\n      return [];\n    }\n\n    // Return a single text shape if there's content\n    return [{\n      index: 0,\n      type: 'text',\n      text,\n      bounds: { x: 0, y: 0, width: 0, height: 0 },\n    }];\n  }\n\n  private selectShape(shapeIndex: number): void {\n    // Navigate to shape - simplified implementation\n    // Real implementation would use object enumeration\n    const args = JSON.stringify({\n      Index: { type: 'long', value: shapeIndex },\n    });\n    this.lok.postUnoCommand(this.docPtr, '.uno:SelectObject', args);\n  }\n\n  private getShapeCommand(shapeType: ShapeType): string {\n    const commands: Record<ShapeType, string> = {\n      rectangle: '.uno:Rect',\n      ellipse: '.uno:Ellipse',\n      line: '.uno:Line',\n      text: '.uno:Text',\n      image: '.uno:InsertGraphic',\n      group: '.uno:FormatGroup',\n      other: '.uno:Rect', // Default to rectangle\n    };\n    return commands[shapeType];\n  }\n\n  private hexToNumber(hex: string): number {\n    return parseInt(hex.replace('#', ''), 16);\n  }\n}\n","// src/editor/index.ts\nimport type { LOKBindings } from '../lok-bindings.js';\nimport { OfficeEditor } from './base.js';\nimport { WriterEditor } from './writer.js';\nimport { CalcEditor } from './calc.js';\nimport { ImpressEditor } from './impress.js';\nimport { DrawEditor } from './draw.js';\nimport type { OpenDocumentOptions } from './types.js';\n\n// LOK document type constants (from LibreOfficeKit)\nconst LOK_DOCTYPE_TEXT = 0;\nconst LOK_DOCTYPE_SPREADSHEET = 1;\nconst LOK_DOCTYPE_PRESENTATION = 2;\nconst LOK_DOCTYPE_DRAWING = 3;\n\n/**\n * Factory function to create the appropriate editor based on document type\n *\n * @param lok - LibreOfficeKit bindings instance\n * @param docPtr - Document pointer from lok.documentLoad()\n * @param options - Editor options (maxResponseChars, etc.)\n * @returns Typed editor instance (WriterEditor, CalcEditor, ImpressEditor, or DrawEditor)\n * @throws Error if document type is unsupported\n *\n * @example\n * ```typescript\n * const docPtr = lok.documentLoad('/tmp/document.docx');\n * const editor = createEditor(lok, docPtr);\n *\n * if (isWriterEditor(editor)) {\n *   // TypeScript knows editor has WriterEditor methods\n *   const result = editor.insertParagraph('Hello World');\n * }\n * ```\n */\nexport function createEditor(\n  lok: LOKBindings,\n  docPtr: number,\n  options?: OpenDocumentOptions\n): OfficeEditor {\n  const docType = lok.documentGetDocumentType(docPtr);\n\n  switch (docType) {\n    case LOK_DOCTYPE_TEXT:\n      return new WriterEditor(lok, docPtr, options);\n\n    case LOK_DOCTYPE_SPREADSHEET:\n      return new CalcEditor(lok, docPtr, options);\n\n    case LOK_DOCTYPE_PRESENTATION:\n      return new ImpressEditor(lok, docPtr, options);\n\n    case LOK_DOCTYPE_DRAWING:\n      return new DrawEditor(lok, docPtr, options);\n\n    default:\n      throw new Error(`Unsupported document type: ${docType}`);\n  }\n}\n\n// ============================================\n// Type Guards\n// ============================================\n\n/**\n * Type guard for WriterEditor\n */\nexport function isWriterEditor(editor: OfficeEditor): editor is WriterEditor {\n  return editor.getDocumentType() === 'writer';\n}\n\n/**\n * Type guard for CalcEditor\n */\nexport function isCalcEditor(editor: OfficeEditor): editor is CalcEditor {\n  return editor.getDocumentType() === 'calc';\n}\n\n/**\n * Type guard for ImpressEditor\n */\nexport function isImpressEditor(editor: OfficeEditor): editor is ImpressEditor {\n  return editor.getDocumentType() === 'impress';\n}\n\n/**\n * Type guard for DrawEditor\n */\nexport function isDrawEditor(editor: OfficeEditor): editor is DrawEditor {\n  return editor.getDocumentType() === 'draw';\n}\n\n// ============================================\n// Re-exports\n// ============================================\n\n// Export all types\nexport type {\n  OperationResult,\n  TruncationInfo,\n  OpenDocumentOptions,\n  TextPosition,\n  TextRange,\n  TextFormat,\n  Paragraph,\n  WriterStructure,\n  CellRef,\n  RangeRef,\n  ColRef,\n  SheetRef,\n  CellValue,\n  CellData,\n  CellFormat,\n  SheetInfo,\n  CalcStructure,\n  SlideLayout,\n  TextFrame,\n  SlideData,\n  SlideInfo,\n  ImpressStructure,\n  ShapeType,\n  ShapeData,\n  PageData,\n  PageInfo,\n  DrawStructure,\n  Rectangle,\n  Size,\n  Position,\n  DocumentMetadata,\n  DocumentStructure,\n  DocumentType,\n  SelectionRange,\n  FindOptions,\n} from './types.js';\n\n// Export all editor classes\nexport { OfficeEditor } from './base.js';\nexport { WriterEditor } from './writer.js';\nexport { CalcEditor } from './calc.js';\nexport { ImpressEditor } from './impress.js';\nexport { DrawEditor } from './draw.js';\n\n// Export LLM tool definitions\nexport {\n  // Tool collections\n  allTools,\n  toolsByName,\n  commonTools,\n  writerTools,\n  calcTools,\n  impressTools,\n  drawTools,\n  documentTools,\n  // Utility functions\n  getToolsForDocumentType,\n  toOpenAIFunction,\n  toAnthropicTool,\n  getOpenAIFunctions,\n  getAnthropicTools,\n} from './tools.js';\n\nexport type {\n  ToolDefinition,\n  CommonToolName,\n  WriterToolName,\n  CalcToolName,\n  ImpressToolName,\n  DrawToolName,\n  DocumentToolName,\n  AllToolName,\n  ToolParameters,\n} from './tools.js';\n","/**\n * LibreOfficeKit Low-Level Bindings\n *\n * This module provides direct access to the LibreOfficeKit C API\n * through the WASM module using the stable lok_* shim exports.\n *\n * Shim functions (C side) should be defined as:\n *   - lok_documentLoad(pKit, pPath)\n *   - lok_documentLoadWithOptions(pKit, pPath, pOptions)\n *   - lok_documentSaveAs(pDoc, pUrl, pFormat, pFilterOptions)\n *   - lok_documentDestroy(pDoc)\n *   - lok_getError(pKit)\n *   - lok_destroy(pKit)          <-- RECOMMENDED to add\n */\n\nimport type { EmscriptenModule } from './types.js';\n\n// Extended module type with our LOK shim exports\ninterface LOKModule extends EmscriptenModule {\n  _lok_documentLoad?: (lok: number, path: number) => number;\n  _lok_documentLoadWithOptions?: (lok: number, path: number, options: number) => number;\n  _lok_documentSaveAs?: (doc: number, url: number, format: number, opts: number) => number;\n  _lok_documentDestroy?: (doc: number) => void;\n  _lok_getError?: (lok: number) => number;\n  _lok_destroy?: (lok: number) => void;\n  // Page rendering shims\n  _lok_documentGetParts?: (doc: number) => number;\n  _lok_documentGetPart?: (doc: number) => number;\n  _lok_documentSetPart?: (doc: number, part: number) => void;\n  _lok_documentGetDocumentType?: (doc: number) => number;\n  _lok_documentGetDocumentSize?: (doc: number, widthPtr: number, heightPtr: number) => void;\n  _lok_documentInitializeForRendering?: (doc: number, args: number) => void;\n  _lok_documentPaintTile?: (\n    doc: number,\n    buffer: number,\n    canvasWidth: number,\n    canvasHeight: number,\n    tilePosX: number,\n    tilePosY: number,\n    tileWidth: number,\n    tileHeight: number\n  ) => void;\n  _lok_documentGetTileMode?: (doc: number) => number;\n  // Text selection and content shims\n  _lok_documentGetTextSelection?: (doc: number, mimeType: number, usedMimeType: number) => number;\n  _lok_documentSetTextSelection?: (doc: number, type: number, x: number, y: number) => void;\n  _lok_documentGetSelectionType?: (doc: number) => number;\n  _lok_documentResetSelection?: (doc: number) => void;\n  // Mouse and keyboard event shims\n  _lok_documentPostMouseEvent?: (doc: number, type: number, x: number, y: number, count: number, buttons: number, modifier: number) => void;\n  _lok_documentPostKeyEvent?: (doc: number, type: number, charCode: number, keyCode: number) => void;\n  // UNO command shims\n  _lok_documentPostUnoCommand?: (doc: number, command: number, args: number, notifyWhenFinished: number) => void;\n  _lok_documentGetCommandValues?: (doc: number, command: number) => number;\n  // Page/Part information shims\n  _lok_documentGetPartPageRectangles?: (doc: number) => number;\n  _lok_documentGetPartInfo?: (doc: number, part: number) => number;\n  _lok_documentGetPartName?: (doc: number, part: number) => number;\n  // Clipboard shims\n  _lok_documentPaste?: (doc: number, mimeType: number, data: number, size: number) => number;\n  // View and zoom shims\n  _lok_documentSetClientZoom?: (doc: number, tilePixelWidth: number, tilePixelHeight: number, tileTwipWidth: number, tileTwipHeight: number) => void;\n  _lok_documentSetClientVisibleArea?: (doc: number, x: number, y: number, width: number, height: number) => void;\n  // Accessibility shims\n  _lok_documentGetA11yFocusedParagraph?: (doc: number) => number;\n  _lok_documentGetA11yCaretPosition?: (doc: number) => number;\n  _lok_documentSetAccessibilityState?: (doc: number, viewId: number, enabled: number) => void;\n  // Spreadsheet-specific shims\n  _lok_documentGetDataArea?: (doc: number, part: number, colPtr: number, rowPtr: number) => void;\n  // Edit mode shim\n  _lok_documentGetEditMode?: (doc: number) => number;\n  _lok_documentSetEditMode?: (doc: number, mode: number) => void;\n  // View management shims\n  _lok_documentCreateView?: (doc: number) => number;\n  _lok_documentCreateViewWithOptions?: (doc: number, options: number) => number;\n  _lok_documentDestroyView?: (doc: number, viewId: number) => void;\n  _lok_documentSetView?: (doc: number, viewId: number) => void;\n  _lok_documentGetView?: (doc: number) => number;\n  _lok_documentGetViewsCount?: (doc: number) => number;\n  // Event loop and callback shims\n  _lok_enableSyncEvents?: () => void;\n  _lok_disableSyncEvents?: () => void;\n  _lok_runLoop?: (lok: number, pollCallback: number, wakeCallback: number, data: number) => void;\n  // Callback queue shims\n  _lok_documentRegisterCallback?: (doc: number) => void;\n  _lok_documentUnregisterCallback?: (doc: number) => void;\n  _lok_hasCallbackEvents?: () => number;\n  _lok_getCallbackEventCount?: () => number;\n  _lok_pollCallback?: (payloadBuffer: number, bufferSize: number, payloadLengthPtr: number) => number;\n  _lok_clearCallbackQueue?: () => void;\n  _lok_flushCallbacks?: (doc: number) => void;\n}\n\n// LOK Mouse Event Types\nexport const LOK_MOUSEEVENT_BUTTONDOWN = 0;\nexport const LOK_MOUSEEVENT_BUTTONUP = 1;\nexport const LOK_MOUSEEVENT_MOVE = 2;\n\n// LOK Key Event Types\nexport const LOK_KEYEVENT_KEYINPUT = 0;\nexport const LOK_KEYEVENT_KEYUP = 1;\n\n// LOK Selection Types\nexport const LOK_SELTYPE_NONE = 0;\nexport const LOK_SELTYPE_TEXT = 1;\nexport const LOK_SELTYPE_CELL = 2;\n\n// LOK Text Selection Types\nexport const LOK_SETTEXTSELECTION_START = 0;\nexport const LOK_SETTEXTSELECTION_END = 1;\nexport const LOK_SETTEXTSELECTION_RESET = 2;\n\n// LOK Document Types\nexport const LOK_DOCTYPE_TEXT = 0;\nexport const LOK_DOCTYPE_SPREADSHEET = 1;\nexport const LOK_DOCTYPE_PRESENTATION = 2;\nexport const LOK_DOCTYPE_DRAWING = 3;\nexport const LOK_DOCTYPE_OTHER = 4;\n\n// LOK Callback Types (from LibreOfficeKitEnums.h)\nexport const LOK_CALLBACK_INVALIDATE_TILES = 0;\nexport const LOK_CALLBACK_INVALIDATE_VISIBLE_CURSOR = 1;\nexport const LOK_CALLBACK_TEXT_SELECTION = 2;\nexport const LOK_CALLBACK_TEXT_SELECTION_START = 3;\nexport const LOK_CALLBACK_TEXT_SELECTION_END = 4;\nexport const LOK_CALLBACK_CURSOR_VISIBLE = 5;\nexport const LOK_CALLBACK_GRAPHIC_SELECTION = 6;\nexport const LOK_CALLBACK_HYPERLINK_CLICKED = 7;\nexport const LOK_CALLBACK_STATE_CHANGED = 8;\nexport const LOK_CALLBACK_STATUS_INDICATOR_START = 9;\nexport const LOK_CALLBACK_STATUS_INDICATOR_SET_VALUE = 10;\nexport const LOK_CALLBACK_STATUS_INDICATOR_FINISH = 11;\nexport const LOK_CALLBACK_SEARCH_NOT_FOUND = 12;\nexport const LOK_CALLBACK_DOCUMENT_SIZE_CHANGED = 13;\nexport const LOK_CALLBACK_SET_PART = 14;\nexport const LOK_CALLBACK_SEARCH_RESULT_SELECTION = 15;\nexport const LOK_CALLBACK_UNO_COMMAND_RESULT = 16;\nexport const LOK_CALLBACK_CELL_CURSOR = 17;\nexport const LOK_CALLBACK_MOUSE_POINTER = 18;\nexport const LOK_CALLBACK_CELL_FORMULA = 19;\nexport const LOK_CALLBACK_DOCUMENT_PASSWORD = 20;\nexport const LOK_CALLBACK_DOCUMENT_PASSWORD_TO_MODIFY = 21;\nexport const LOK_CALLBACK_CONTEXT_MENU = 22;\nexport const LOK_CALLBACK_INVALIDATE_VIEW_CURSOR = 23;\nexport const LOK_CALLBACK_TEXT_VIEW_SELECTION = 24;\nexport const LOK_CALLBACK_CELL_VIEW_CURSOR = 25;\nexport const LOK_CALLBACK_GRAPHIC_VIEW_SELECTION = 26;\nexport const LOK_CALLBACK_VIEW_CURSOR_VISIBLE = 27;\nexport const LOK_CALLBACK_VIEW_LOCK = 28;\nexport const LOK_CALLBACK_REDLINE_TABLE_SIZE_CHANGED = 29;\nexport const LOK_CALLBACK_REDLINE_TABLE_ENTRY_MODIFIED = 30;\nexport const LOK_CALLBACK_COMMENT = 31;\nexport const LOK_CALLBACK_INVALIDATE_HEADER = 32;\nexport const LOK_CALLBACK_CELL_ADDRESS = 33;\n\n// Callback event interface\nexport interface LOKCallbackEvent {\n  type: number;\n  typeName: string;\n  payload: string;\n}\n\n// Map callback type to name\nexport function getCallbackTypeName(type: number): string {\n  const names: Record<number, string> = {\n    [LOK_CALLBACK_INVALIDATE_TILES]: 'INVALIDATE_TILES',\n    [LOK_CALLBACK_INVALIDATE_VISIBLE_CURSOR]: 'INVALIDATE_VISIBLE_CURSOR',\n    [LOK_CALLBACK_TEXT_SELECTION]: 'TEXT_SELECTION',\n    [LOK_CALLBACK_TEXT_SELECTION_START]: 'TEXT_SELECTION_START',\n    [LOK_CALLBACK_TEXT_SELECTION_END]: 'TEXT_SELECTION_END',\n    [LOK_CALLBACK_CURSOR_VISIBLE]: 'CURSOR_VISIBLE',\n    [LOK_CALLBACK_GRAPHIC_SELECTION]: 'GRAPHIC_SELECTION',\n    [LOK_CALLBACK_HYPERLINK_CLICKED]: 'HYPERLINK_CLICKED',\n    [LOK_CALLBACK_STATE_CHANGED]: 'STATE_CHANGED',\n    [LOK_CALLBACK_STATUS_INDICATOR_START]: 'STATUS_INDICATOR_START',\n    [LOK_CALLBACK_STATUS_INDICATOR_SET_VALUE]: 'STATUS_INDICATOR_SET_VALUE',\n    [LOK_CALLBACK_STATUS_INDICATOR_FINISH]: 'STATUS_INDICATOR_FINISH',\n    [LOK_CALLBACK_SEARCH_NOT_FOUND]: 'SEARCH_NOT_FOUND',\n    [LOK_CALLBACK_DOCUMENT_SIZE_CHANGED]: 'DOCUMENT_SIZE_CHANGED',\n    [LOK_CALLBACK_SET_PART]: 'SET_PART',\n    [LOK_CALLBACK_SEARCH_RESULT_SELECTION]: 'SEARCH_RESULT_SELECTION',\n    [LOK_CALLBACK_UNO_COMMAND_RESULT]: 'UNO_COMMAND_RESULT',\n    [LOK_CALLBACK_CELL_CURSOR]: 'CELL_CURSOR',\n    [LOK_CALLBACK_MOUSE_POINTER]: 'MOUSE_POINTER',\n    [LOK_CALLBACK_CELL_FORMULA]: 'CELL_FORMULA',\n    [LOK_CALLBACK_DOCUMENT_PASSWORD]: 'DOCUMENT_PASSWORD',\n    [LOK_CALLBACK_DOCUMENT_PASSWORD_TO_MODIFY]: 'DOCUMENT_PASSWORD_TO_MODIFY',\n    [LOK_CALLBACK_CONTEXT_MENU]: 'CONTEXT_MENU',\n    [LOK_CALLBACK_INVALIDATE_VIEW_CURSOR]: 'INVALIDATE_VIEW_CURSOR',\n    [LOK_CALLBACK_TEXT_VIEW_SELECTION]: 'TEXT_VIEW_SELECTION',\n    [LOK_CALLBACK_CELL_VIEW_CURSOR]: 'CELL_VIEW_CURSOR',\n    [LOK_CALLBACK_GRAPHIC_VIEW_SELECTION]: 'GRAPHIC_VIEW_SELECTION',\n    [LOK_CALLBACK_VIEW_CURSOR_VISIBLE]: 'VIEW_CURSOR_VISIBLE',\n    [LOK_CALLBACK_VIEW_LOCK]: 'VIEW_LOCK',\n    [LOK_CALLBACK_REDLINE_TABLE_SIZE_CHANGED]: 'REDLINE_TABLE_SIZE_CHANGED',\n    [LOK_CALLBACK_REDLINE_TABLE_ENTRY_MODIFIED]: 'REDLINE_TABLE_ENTRY_MODIFIED',\n    [LOK_CALLBACK_COMMENT]: 'COMMENT',\n    [LOK_CALLBACK_INVALIDATE_HEADER]: 'INVALIDATE_HEADER',\n    [LOK_CALLBACK_CELL_ADDRESS]: 'CELL_ADDRESS',\n  };\n  return names[type] || `UNKNOWN(${type})`;\n}\n\n// Fallback offsets for WASM32 (4-byte pointers) if shims not available\nconst LOK_CLASS = {\n  nSize: 0,\n  destroy: 4,\n  documentLoad: 8,\n  getError: 12,\n  documentLoadWithOptions: 16,\n  freeError: 20,\n};\n\nconst DOC_CLASS = {\n  nSize: 0,\n  destroy: 4,\n  saveAs: 8,\n};\n\n// Reuse encoder/decoder\nconst textEncoder = new TextEncoder();\nconst textDecoder = new TextDecoder();\n\nexport class LOKBindings {\n  private module: LOKModule;\n  private lokPtr = 0;\n  private verbose: boolean;\n  private useShims: boolean;\n\n  constructor(module: EmscriptenModule, verbose = false) {\n    this.module = module as LOKModule;\n    this.verbose = verbose;\n\n    this.useShims = typeof this.module._lok_documentLoad === 'function';\n    if (this.useShims) {\n      this.log('Using direct LOK shim exports');\n    } else {\n      this.log('Using vtable traversal (shims not available)');\n    }\n  }\n\n  private log(...args: unknown[]): void {\n    if (this.verbose) {\n      console.log('[LOK]', ...args);\n    }\n  }\n\n  /**\n   * Get fresh heap views (important after memory growth!)\n   */\n  private get HEAPU8(): Uint8Array {\n    return this.module.HEAPU8;\n  }\n\n  private get HEAPU32(): Uint32Array {\n    return this.module.HEAPU32;\n  }\n\n  private get HEAP32(): Int32Array {\n    return this.module.HEAP32;\n  }\n\n  /**\n   * Allocate a null-terminated string in WASM memory\n   */\n  allocString(str: string): number {\n    const bytes = textEncoder.encode(str + '\\0');\n    const ptr = this.module._malloc(bytes.length);\n    // Always get fresh heap view after malloc (might have grown memory)\n    this.HEAPU8.set(bytes, ptr);\n    return ptr;\n  }\n\n  /**\n   * Read a null-terminated string from WASM memory\n   */\n  readString(ptr: number): string | null {\n    if (ptr === 0) return null;\n    // Always get fresh heap view\n    const heap = this.HEAPU8;\n    let end = ptr;\n    while (heap[end] !== 0) end++;\n    // Copy the data to avoid SharedArrayBuffer issues in browsers\n    // TextDecoder.decode() doesn't accept SharedArrayBuffer views in some browsers\n    const slice = heap.slice(ptr, end);\n    return textDecoder.decode(slice);\n  }\n\n  /**\n   * Read a 32-bit pointer from memory (unsigned)\n   */\n  readPtr(addr: number): number {\n    // Always get fresh heap view\n    return this.HEAPU32[addr >> 2] || 0;\n  }\n\n  /**\n   * Get a function from the WASM table (fallback for vtable traversal)\n   */\n  private getFunc<T>(ptr: number): T {\n    const wasmTable = this.module.wasmTable as WebAssembly.Table;\n    return wasmTable.get(ptr) as T;\n  }\n\n  /**\n   * Initialize LibreOfficeKit\n   */\n  initialize(installPath: string = '/instdir/program'): void {\n    this.log('Initializing with path:', installPath);\n    const pathPtr = this.allocString(installPath);\n\n    try {\n      // eslint-disable-next-line @typescript-eslint/no-explicit-any, @typescript-eslint/no-unsafe-member-access\n      const hook = (this.module as any)._libreofficekit_hook as\n        | ((pathPtr: number) => number)\n        | undefined;\n\n      if (typeof hook !== 'function') {\n        throw new Error('libreofficekit_hook export not found on module');\n      }\n\n      this.lokPtr = hook(pathPtr);\n\n      if (this.lokPtr === 0) {\n        throw new Error('Failed to initialize LibreOfficeKit');\n      }\n\n      this.log('LOK initialized, ptr:', this.lokPtr);\n    } finally {\n      this.module._free(pathPtr);\n    }\n  }\n\n  /**\n   * Get the last error message\n   */\n  getError(): string | null {\n    if (this.lokPtr === 0) return null;\n\n    // Prefer shim\n    if (this.useShims && this.module._lok_getError) {\n      const errPtr = this.module._lok_getError(this.lokPtr);\n      return this.readString(errPtr);\n    }\n\n    // Fallback: vtable traversal\n    const lokClassPtr = this.readPtr(this.lokPtr);\n    const getErrorPtr = this.readPtr(lokClassPtr + LOK_CLASS.getError);\n    if (getErrorPtr === 0) return null;\n\n    const getError = this.getFunc<(lok: number) => number>(getErrorPtr);\n    const errPtr = getError(this.lokPtr);\n    return this.readString(errPtr);\n  }\n\n  /**\n   * Get version info\n   */\n  getVersionInfo(): string | null {\n    return 'LibreOffice WASM';\n  }\n\n  /**\n   * Convert a filesystem path to a file:// URL\n   * Required by LibreOffice's getAbsoluteURL() which uses rtl::Uri::convertRelToAbs()\n   */\n  private toFileUrl(path: string): string {\n    if (path.startsWith('file://')) return path;\n    const absolutePath = path.startsWith('/') ? path : '/' + path;\n    return 'file://' + absolutePath;\n  }\n\n  /**\n   * Load a document from the virtual filesystem\n   */\n  documentLoad(path: string): number {\n    if (this.lokPtr === 0) {\n      throw new Error('LOK not initialized');\n    }\n\n    const fileUrl = this.toFileUrl(path);\n    this.log('Loading document:', path, '->', fileUrl);\n    const pathPtr = this.allocString(fileUrl);\n\n    try {\n      const startTime = Date.now();\n      let docPtr: number;\n\n      if (this.useShims && this.module._lok_documentLoad) {\n        // Use direct shim export\n        docPtr = this.module._lok_documentLoad(this.lokPtr, pathPtr);\n      } else {\n        // Fallback: vtable traversal\n        const lokClassPtr = this.readPtr(this.lokPtr);\n        const documentLoadPtr = this.readPtr(lokClassPtr + LOK_CLASS.documentLoad);\n        const documentLoad = this.getFunc<(lok: number, path: number) => number>(documentLoadPtr);\n        docPtr = documentLoad(this.lokPtr, pathPtr);\n      }\n\n      this.log('Document loaded in', Date.now() - startTime, 'ms, ptr:', docPtr);\n\n      if (docPtr === 0) {\n        const error = this.getError();\n        throw new Error(`Failed to load document: ${error || 'unknown error'}`);\n      }\n\n      return docPtr;\n    } finally {\n      this.module._free(pathPtr);\n    }\n  }\n\n  /**\n   * Load a document with options\n   */\n  documentLoadWithOptions(path: string, options: string): number {\n    if (this.lokPtr === 0) {\n      throw new Error('LOK not initialized');\n    }\n\n    const fileUrl = this.toFileUrl(path);\n    this.log('Loading document with options:', path, '->', fileUrl, options);\n    const pathPtr = this.allocString(fileUrl);\n    const optsPtr = this.allocString(options);\n\n    try {\n      let docPtr: number;\n\n      if (this.useShims && this.module._lok_documentLoadWithOptions) {\n        // Use direct shim export\n        docPtr = this.module._lok_documentLoadWithOptions(this.lokPtr, pathPtr, optsPtr);\n      } else {\n        // Fallback: vtable traversal\n        const lokClassPtr = this.readPtr(this.lokPtr);\n        const loadWithOptsPtr = this.readPtr(lokClassPtr + LOK_CLASS.documentLoadWithOptions);\n\n        if (loadWithOptsPtr === 0) {\n          // No special method - fall back to plain load\n          return this.documentLoad(path);\n        }\n\n        const loadWithOpts = this.getFunc<\n          (lok: number, path: number, opts: number) => number\n        >(loadWithOptsPtr);\n        docPtr = loadWithOpts(this.lokPtr, pathPtr, optsPtr);\n      }\n\n      if (docPtr === 0) {\n        const error = this.getError();\n        throw new Error(`Failed to load document: ${error || 'unknown error'}`);\n      }\n\n      this.log('Document loaded, ptr:', docPtr);\n      return docPtr;\n    } finally {\n      this.module._free(pathPtr);\n      this.module._free(optsPtr);\n    }\n  }\n\n  /**\n   * Save a document to a different format\n   */\n  documentSaveAs(\n    docPtr: number,\n    outputPath: string,\n    format: string,\n    filterOptions: string = ''\n  ): void {\n    if (docPtr === 0) {\n      throw new Error('Invalid document pointer');\n    }\n\n    const fileUrl = this.toFileUrl(outputPath);\n    this.log('Saving document to:', outputPath, '->', fileUrl, 'format:', format);\n\n    const urlPtr = this.allocString(fileUrl);\n    const formatPtr = this.allocString(format);\n    const optsPtr = this.allocString(filterOptions);\n\n    try {\n      let result: number;\n\n      if (this.useShims && this.module._lok_documentSaveAs) {\n        // Use direct shim export\n        result = this.module._lok_documentSaveAs(docPtr, urlPtr, formatPtr, optsPtr);\n      } else {\n        // Fallback: vtable traversal\n        const docClassPtr = this.readPtr(docPtr);\n        const saveAsPtr = this.readPtr(docClassPtr + DOC_CLASS.saveAs);\n        const saveAs = this.getFunc<\n          (doc: number, url: number, format: number, opts: number) => number\n        >(saveAsPtr);\n        result = saveAs(docPtr, urlPtr, formatPtr, optsPtr);\n      }\n\n      this.log('Save result:', result);\n\n      if (result === 0) {\n        throw new Error('Failed to save document');\n      }\n    } finally {\n      this.module._free(urlPtr);\n      this.module._free(formatPtr);\n      this.module._free(optsPtr);\n    }\n  }\n\n  /**\n   * Destroy a document\n   */\n  documentDestroy(docPtr: number): void {\n    if (docPtr === 0) return;\n\n    if (this.useShims && this.module._lok_documentDestroy) {\n      // Use direct shim export\n      this.module._lok_documentDestroy(docPtr);\n      this.log('Document destroyed (via shim)');\n      return;\n    }\n\n    // Fallback: vtable traversal\n    const docClassPtr = this.readPtr(docPtr);\n    const destroyPtr = this.readPtr(docClassPtr + DOC_CLASS.destroy);\n\n    if (destroyPtr !== 0) {\n      const destroy = this.getFunc<(doc: number) => void>(destroyPtr);\n      destroy(docPtr);\n      this.log('Document destroyed (via vtable)');\n    }\n  }\n\n  /**\n   * Destroy the LOK instance\n   */\n  destroy(): void {\n    if (this.lokPtr === 0) return;\n\n    try {\n      // Prefer C shim if available\n      if (this.useShims && this.module._lok_destroy) {\n        this.module._lok_destroy(this.lokPtr);\n        this.log('LOK destroyed (via shim)');\n      } else {\n        // Fallback: vtable traversal\n        const lokClassPtr = this.readPtr(this.lokPtr);\n        const destroyPtr = this.readPtr(lokClassPtr + LOK_CLASS.destroy);\n\n        if (destroyPtr !== 0) {\n          const destroy = this.getFunc<(lok: number) => void>(destroyPtr);\n          destroy(this.lokPtr);\n          this.log('LOK destroyed (via vtable)');\n        }\n      }\n    } catch (error) {\n      this.log('LOK destroy error (ignored):', error);\n    }\n\n    this.lokPtr = 0;\n  }\n\n  /**\n   * Check if LOK is initialized\n   */\n  isInitialized(): boolean {\n    return this.lokPtr !== 0;\n  }\n\n  /**\n   * Check if using direct shim exports\n   */\n  isUsingShims(): boolean {\n    return this.useShims;\n  }\n\n  // ==========================================\n  // Page Rendering Methods\n  // ==========================================\n\n  /**\n   * Get the number of parts (pages/slides) in a document\n   */\n  documentGetParts(docPtr: number): number {\n    if (docPtr === 0) {\n      throw new Error('Invalid document pointer');\n    }\n\n    if (this.useShims && this.module._lok_documentGetParts) {\n      return this.module._lok_documentGetParts(docPtr);\n    }\n\n    // Fallback not implemented - would need vtable offsets\n    this.log('documentGetParts: shim not available');\n    return 0;\n  }\n\n  /**\n   * Get the current part (page/slide) index\n   */\n  documentGetPart(docPtr: number): number {\n    if (docPtr === 0) {\n      throw new Error('Invalid document pointer');\n    }\n\n    if (this.useShims && this.module._lok_documentGetPart) {\n      return this.module._lok_documentGetPart(docPtr);\n    }\n\n    this.log('documentGetPart: shim not available');\n    return 0;\n  }\n\n  /**\n   * Set the current part (page/slide) index\n   */\n  documentSetPart(docPtr: number, part: number): void {\n    if (docPtr === 0) {\n      throw new Error('Invalid document pointer');\n    }\n\n    if (this.useShims && this.module._lok_documentSetPart) {\n      this.module._lok_documentSetPart(docPtr, part);\n      return;\n    }\n\n    this.log('documentSetPart: shim not available');\n  }\n\n  /**\n   * Get document type (0=text, 1=spreadsheet, 2=presentation, 3=drawing)\n   */\n  documentGetDocumentType(docPtr: number): number {\n    if (docPtr === 0) {\n      throw new Error('Invalid document pointer');\n    }\n\n    if (this.useShims && this.module._lok_documentGetDocumentType) {\n      return this.module._lok_documentGetDocumentType(docPtr);\n    }\n\n    this.log('documentGetDocumentType: shim not available');\n    return 0;\n  }\n\n  /**\n   * Get document size in twips (1/1440 inch)\n   */\n  documentGetDocumentSize(docPtr: number): { width: number; height: number } {\n    this.log(`documentGetDocumentSize called with docPtr: ${docPtr}`);\n    if (docPtr === 0) {\n      throw new Error('Invalid document pointer');\n    }\n\n    if (this.useShims && this.module._lok_documentGetDocumentSize) {\n      // Allocate space for two longs (32-bit on WASM)\n      const sizePtr = this.module._malloc(8);\n      try {\n        this.module._lok_documentGetDocumentSize(docPtr, sizePtr, sizePtr + 4);\n        const width = this.HEAP32[sizePtr >> 2] ?? 0;\n        const height = this.HEAP32[(sizePtr + 4) >> 2] ?? 0;\n        this.log(`documentGetDocumentSize: ${width}x${height} twips`);\n        return { width, height };\n      } finally {\n        this.module._free(sizePtr);\n      }\n    }\n\n    this.log('documentGetDocumentSize: shim not available');\n    return { width: 0, height: 0 };\n  }\n\n  /**\n   * Initialize document for rendering\n   */\n  documentInitializeForRendering(docPtr: number, options: string = ''): void {\n    if (docPtr === 0) {\n      throw new Error('Invalid document pointer');\n    }\n\n    if (this.useShims && this.module._lok_documentInitializeForRendering) {\n      const optsPtr = this.allocString(options);\n      try {\n        this.module._lok_documentInitializeForRendering(docPtr, optsPtr);\n      } finally {\n        this.module._free(optsPtr);\n      }\n      return;\n    }\n\n    this.log('documentInitializeForRendering: shim not available');\n  }\n\n  /**\n   * Paint a tile of the document to a buffer\n   * @param docPtr Document pointer\n   * @param canvasWidth Output width in pixels\n   * @param canvasHeight Output height in pixels\n   * @param tilePosX X position in twips\n   * @param tilePosY Y position in twips\n   * @param tileWidth Width in twips\n   * @param tileHeight Height in twips\n   * @returns RGBA pixel data\n   */\n  documentPaintTile(\n    docPtr: number,\n    canvasWidth: number,\n    canvasHeight: number,\n    tilePosX: number,\n    tilePosY: number,\n    tileWidth: number,\n    tileHeight: number\n  ): Uint8Array {\n    if (docPtr === 0) {\n      throw new Error('Invalid document pointer');\n    }\n\n    if (this.useShims && this.module._lok_documentPaintTile) {\n      // Allocate RGBA buffer (4 bytes per pixel)\n      const bufferSize = canvasWidth * canvasHeight * 4;\n      const bufferPtr = this.module._malloc(bufferSize);\n\n      if (bufferPtr === 0) {\n        throw new Error(`Failed to allocate ${bufferSize} bytes for tile buffer`);\n      }\n\n      try {\n        this.module._lok_documentPaintTile(\n          docPtr,\n          bufferPtr,\n          canvasWidth,\n          canvasHeight,\n          tilePosX,\n          tilePosY,\n          tileWidth,\n          tileHeight\n        );\n\n        // Copy data out of WASM memory\n        const result = new Uint8Array(bufferSize);\n        result.set(this.HEAPU8.subarray(bufferPtr, bufferPtr + bufferSize));\n        return result;\n      } finally {\n        this.module._free(bufferPtr);\n      }\n    }\n\n    this.log('documentPaintTile: shim not available');\n    return new Uint8Array(0);\n  }\n\n  /**\n   * Get tile mode (0=RGBA, 1=BGRA)\n   */\n  documentGetTileMode(docPtr: number): number {\n    if (docPtr === 0) {\n      throw new Error('Invalid document pointer');\n    }\n\n    if (this.useShims && this.module._lok_documentGetTileMode) {\n      return this.module._lok_documentGetTileMode(docPtr);\n    }\n\n    this.log('documentGetTileMode: shim not available');\n    return 0; // Default to RGBA\n  }\n\n  /**\n   * Render a page/slide to an image\n   * @param docPtr Document pointer\n   * @param pageIndex Page/slide index (0-based)\n   * @param width Output width in pixels\n   * @param height Output height in pixels (0 = auto based on aspect ratio)\n   * @returns RGBA pixel data and dimensions\n   */\n  renderPage(\n    docPtr: number,\n    pageIndex: number,\n    width: number,\n    height: number = 0\n  ): { data: Uint8Array; width: number; height: number } {\n    // Initialize for rendering if not already done\n    this.documentInitializeForRendering(docPtr);\n\n    // Get document type to determine rendering strategy\n    const docType = this.documentGetDocumentType(docPtr);\n    \n    // For presentations and drawings, use setPart to select the slide/page\n    // For text documents, we need to use page rectangles\n    if (docType === 2 || docType === 3) { // PRESENTATION or DRAWING\n      console.log(`[LOK] Setting part to ${pageIndex} for presentation/drawing`);\n      this.documentSetPart(docPtr, pageIndex);\n      const currentPart = this.documentGetPart(docPtr);\n      console.log(`[LOK] Current part after setPart: ${currentPart}`);\n    }\n\n    // Get document/page size in twips\n    const docSize = this.documentGetDocumentSize(docPtr);\n    this.log('Document size (twips):', docSize);\n\n    if (docSize.width === 0 || docSize.height === 0) {\n      throw new Error('Failed to get document size');\n    }\n\n    // For text documents, get page rectangles to find the specific page\n    let tilePosX = 0;\n    let tilePosY = 0;\n    let tileWidth = docSize.width;\n    let tileHeight = docSize.height;\n\n    if (docType === 0 || docType === 1) { // TEXT or SPREADSHEET\n      // Get page rectangles to find the Y offset for this page\n      const pageRectsStr = this.getPartPageRectangles(docPtr);\n      if (pageRectsStr) {\n        const pageRects = this.parsePageRectangles(pageRectsStr);\n        const pageRect = pageRects[pageIndex];\n        if (pageRect) {\n          tilePosX = pageRect.x;\n          tilePosY = pageRect.y;\n          tileWidth = pageRect.width;\n          tileHeight = pageRect.height;\n          this.log(`Page ${pageIndex} rectangle:`, pageRect);\n        }\n      }\n    }\n\n    // Calculate output dimensions maintaining aspect ratio\n    const aspectRatio = tileHeight / tileWidth;\n    const outputWidth = width;\n    const outputHeight = height > 0 ? height : Math.round(width * aspectRatio);\n\n    console.log(`[LOK] Calling paintTile: ${outputWidth}x${outputHeight} from tile pos (${tilePosX}, ${tilePosY}) size (${tileWidth}x${tileHeight})`);\n\n    // Paint the tile for this specific page\n    const data = this.documentPaintTile(\n      docPtr,\n      outputWidth,\n      outputHeight,\n      tilePosX,\n      tilePosY,\n      tileWidth,\n      tileHeight\n    );\n\n    console.log(`[LOK] paintTile returned ${data.length} bytes`);\n    return { data, width: outputWidth, height: outputHeight };\n  }\n\n  // ==========================================\n  // Text Selection and Content Methods\n  // ==========================================\n\n  /**\n   * Get currently selected text\n   * @param docPtr Document pointer\n   * @param mimeType Desired MIME type. Must include charset, e.g., 'text/plain;charset=utf-8'\n   *                 Note: 'text/plain' without charset is NOT supported by LOK\n   * @returns Selected text or null\n   */\n  getTextSelection(docPtr: number, mimeType: string = 'text/plain;charset=utf-8'): string | null {\n    if (docPtr === 0) throw new Error('Invalid document pointer');\n\n    if (this.useShims && this.module._lok_documentGetTextSelection) {\n      const mimePtr = this.allocString(mimeType);\n      const usedMimePtr = this.module._malloc(4); // pointer to char*\n      try {\n        const resultPtr = this.module._lok_documentGetTextSelection(docPtr, mimePtr, usedMimePtr);\n        if (resultPtr === 0) return null;\n        const result = this.readString(resultPtr);\n        this.module._free(resultPtr);\n        return result;\n      } finally {\n        this.module._free(mimePtr);\n        this.module._free(usedMimePtr);\n      }\n    }\n\n    this.log('getTextSelection: shim not available');\n    return null;\n  }\n\n  /**\n   * Set text selection at coordinates\n   * @param docPtr Document pointer\n   * @param type Selection type (LOK_SETTEXTSELECTION_START, END, or RESET)\n   * @param x X coordinate in twips\n   * @param y Y coordinate in twips\n   */\n  setTextSelection(docPtr: number, type: number, x: number, y: number): void {\n    if (docPtr === 0) throw new Error('Invalid document pointer');\n\n    if (this.useShims && this.module._lok_documentSetTextSelection) {\n      this.module._lok_documentSetTextSelection(docPtr, type, x, y);\n      return;\n    }\n\n    this.log('setTextSelection: shim not available');\n  }\n\n  /**\n   * Get current selection type\n   * @param docPtr Document pointer\n   * @returns Selection type (LOK_SELTYPE_NONE, TEXT, or CELL)\n   */\n  getSelectionType(docPtr: number): number {\n    if (docPtr === 0) throw new Error('Invalid document pointer');\n\n    if (this.useShims && this.module._lok_documentGetSelectionType) {\n      return this.module._lok_documentGetSelectionType(docPtr);\n    }\n\n    this.log('getSelectionType: shim not available');\n    return 0;\n  }\n\n  /**\n   * Reset/clear current selection\n   * @param docPtr Document pointer\n   */\n  resetSelection(docPtr: number): void {\n    if (docPtr === 0) throw new Error('Invalid document pointer');\n\n    if (this.useShims && this.module._lok_documentResetSelection) {\n      this.module._lok_documentResetSelection(docPtr);\n      return;\n    }\n\n    this.log('resetSelection: shim not available');\n  }\n\n  // ==========================================\n  // Mouse and Keyboard Event Methods\n  // ==========================================\n\n  /**\n   * Post a mouse event to the document\n   * @param docPtr Document pointer\n   * @param type Event type (LOK_MOUSEEVENT_BUTTONDOWN, BUTTONUP, MOVE)\n   * @param x X coordinate in twips\n   * @param y Y coordinate in twips\n   * @param count Click count (1 for single, 2 for double click)\n   * @param buttons Button mask (1=left, 2=middle, 4=right)\n   * @param modifier Modifier keys mask\n   */\n  postMouseEvent(\n    docPtr: number,\n    type: number,\n    x: number,\n    y: number,\n    count: number = 1,\n    buttons: number = 1,\n    modifier: number = 0\n  ): void {\n    if (docPtr === 0) throw new Error('Invalid document pointer');\n\n    if (this.useShims && this.module._lok_documentPostMouseEvent) {\n      this.module._lok_documentPostMouseEvent(docPtr, type, x, y, count, buttons, modifier);\n      return;\n    }\n\n    this.log('postMouseEvent: shim not available');\n  }\n\n  /**\n   * Post a keyboard event to the document\n   * @param docPtr Document pointer\n   * @param type Event type (LOK_KEYEVENT_KEYINPUT, KEYUP)\n   * @param charCode Character code\n   * @param keyCode Key code\n   */\n  postKeyEvent(docPtr: number, type: number, charCode: number, keyCode: number): void {\n    if (docPtr === 0) throw new Error('Invalid document pointer');\n\n    if (this.useShims && this.module._lok_documentPostKeyEvent) {\n      this.module._lok_documentPostKeyEvent(docPtr, type, charCode, keyCode);\n      return;\n    }\n\n    this.log('postKeyEvent: shim not available');\n  }\n\n  // ==========================================\n  // UNO Command Methods\n  // ==========================================\n\n  /**\n   * Execute a UNO command\n   * @param docPtr Document pointer\n   * @param command UNO command (e.g., '.uno:SelectAll', '.uno:Copy')\n   * @param args JSON arguments string\n   * @param notifyWhenFinished Whether to notify when command completes\n   */\n  postUnoCommand(\n    docPtr: number,\n    command: string,\n    args: string = '{}',\n    notifyWhenFinished: boolean = false\n  ): void {\n    if (docPtr === 0) throw new Error('Invalid document pointer');\n\n    if (this.useShims && this.module._lok_documentPostUnoCommand) {\n      const cmdPtr = this.allocString(command);\n      const argsPtr = this.allocString(args);\n      try {\n        this.module._lok_documentPostUnoCommand(docPtr, cmdPtr, argsPtr, notifyWhenFinished ? 1 : 0);\n      } finally {\n        this.module._free(cmdPtr);\n        this.module._free(argsPtr);\n      }\n      return;\n    }\n\n    this.log('postUnoCommand: shim not available');\n  }\n\n  /**\n   * Get command values (query document state)\n   * @param docPtr Document pointer\n   * @param command Command to query (e.g., '.uno:CharFontName')\n   * @returns JSON string with command values\n   */\n  getCommandValues(docPtr: number, command: string): string | null {\n    if (docPtr === 0) throw new Error('Invalid document pointer');\n\n    if (this.useShims && this.module._lok_documentGetCommandValues) {\n      const cmdPtr = this.allocString(command);\n      try {\n        const resultPtr = this.module._lok_documentGetCommandValues(docPtr, cmdPtr);\n        if (resultPtr === 0) return null;\n        const result = this.readString(resultPtr);\n        this.module._free(resultPtr);\n        return result;\n      } finally {\n        this.module._free(cmdPtr);\n      }\n    }\n\n    this.log('getCommandValues: shim not available');\n    return null;\n  }\n\n  // ==========================================\n  // Page/Part Information Methods\n  // ==========================================\n\n  /**\n   * Get bounding rectangles for all pages\n   * @param docPtr Document pointer\n   * @returns String with rectangles \"x,y,width,height;x,y,width,height;...\"\n   */\n  getPartPageRectangles(docPtr: number): string | null {\n    this.log(`getPartPageRectangles called with docPtr: ${docPtr}`);\n    if (docPtr === 0) throw new Error('Invalid document pointer');\n\n    if (this.useShims && this.module._lok_documentGetPartPageRectangles) {\n      this.log('getPartPageRectangles: using shim');\n      const resultPtr = this.module._lok_documentGetPartPageRectangles(docPtr);\n      this.log(`getPartPageRectangles: resultPtr=${resultPtr}`);\n      if (resultPtr === 0) return null;\n      const result = this.readString(resultPtr);\n      this.log(`getPartPageRectangles: result=\"${result?.slice(0, 100)}...\"`);\n      this.module._free(resultPtr);\n      return result;\n    }\n\n    this.log('getPartPageRectangles: shim not available');\n    return null;\n  }\n\n  /**\n   * Get information about a page/slide\n   * @param docPtr Document pointer\n   * @param part Part index\n   * @returns JSON string with part info\n   */\n  getPartInfo(docPtr: number, part: number): string | null {\n    if (docPtr === 0) throw new Error('Invalid document pointer');\n\n    if (this.useShims && this.module._lok_documentGetPartInfo) {\n      const resultPtr = this.module._lok_documentGetPartInfo(docPtr, part);\n      if (resultPtr === 0) return null;\n      const result = this.readString(resultPtr);\n      this.module._free(resultPtr);\n      return result;\n    }\n\n    this.log('getPartInfo: shim not available');\n    return null;\n  }\n\n  /**\n   * Get name of a page/slide\n   * @param docPtr Document pointer\n   * @param part Part index\n   * @returns Part name\n   */\n  getPartName(docPtr: number, part: number): string | null {\n    if (docPtr === 0) throw new Error('Invalid document pointer');\n\n    if (this.useShims && this.module._lok_documentGetPartName) {\n      const resultPtr = this.module._lok_documentGetPartName(docPtr, part);\n      if (resultPtr === 0) return null;\n      const result = this.readString(resultPtr);\n      this.module._free(resultPtr);\n      return result;\n    }\n\n    this.log('getPartName: shim not available');\n    return null;\n  }\n\n  // ==========================================\n  // Clipboard Methods\n  // ==========================================\n\n  /**\n   * Paste content at current cursor position\n   * @param docPtr Document pointer\n   * @param mimeType MIME type of data\n   * @param data Data to paste\n   * @returns true if successful\n   */\n  paste(docPtr: number, mimeType: string, data: string | Uint8Array): boolean {\n    if (docPtr === 0) throw new Error('Invalid document pointer');\n\n    if (this.useShims && this.module._lok_documentPaste) {\n      const mimePtr = this.allocString(mimeType);\n      let dataPtr: number;\n      let dataSize: number;\n\n      if (typeof data === 'string') {\n        const bytes = new TextEncoder().encode(data);\n        dataSize = bytes.length;\n        dataPtr = this.module._malloc(dataSize);\n        this.HEAPU8.set(bytes, dataPtr);\n      } else {\n        dataSize = data.length;\n        dataPtr = this.module._malloc(dataSize);\n        this.HEAPU8.set(data, dataPtr);\n      }\n\n      try {\n        return this.module._lok_documentPaste(docPtr, mimePtr, dataPtr, dataSize) !== 0;\n      } finally {\n        this.module._free(mimePtr);\n        this.module._free(dataPtr);\n      }\n    }\n\n    this.log('paste: shim not available');\n    return false;\n  }\n\n  // ==========================================\n  // View and Zoom Methods\n  // ==========================================\n\n  /**\n   * Set client zoom level\n   * @param docPtr Document pointer\n   * @param tilePixelWidth Tile width in pixels\n   * @param tilePixelHeight Tile height in pixels\n   * @param tileTwipWidth Tile width in twips\n   * @param tileTwipHeight Tile height in twips\n   */\n  setClientZoom(\n    docPtr: number,\n    tilePixelWidth: number,\n    tilePixelHeight: number,\n    tileTwipWidth: number,\n    tileTwipHeight: number\n  ): void {\n    if (docPtr === 0) throw new Error('Invalid document pointer');\n\n    if (this.useShims && this.module._lok_documentSetClientZoom) {\n      this.module._lok_documentSetClientZoom(docPtr, tilePixelWidth, tilePixelHeight, tileTwipWidth, tileTwipHeight);\n      return;\n    }\n\n    this.log('setClientZoom: shim not available');\n  }\n\n  /**\n   * Set visible area for the client\n   * @param docPtr Document pointer\n   * @param x X position in twips\n   * @param y Y position in twips\n   * @param width Width in twips\n   * @param height Height in twips\n   */\n  setClientVisibleArea(docPtr: number, x: number, y: number, width: number, height: number): void {\n    if (docPtr === 0) throw new Error('Invalid document pointer');\n\n    if (this.useShims && this.module._lok_documentSetClientVisibleArea) {\n      this.module._lok_documentSetClientVisibleArea(docPtr, x, y, width, height);\n      return;\n    }\n\n    this.log('setClientVisibleArea: shim not available');\n  }\n\n  // ==========================================\n  // Accessibility Methods\n  // ==========================================\n\n  /**\n   * Get the currently focused paragraph text\n   * @param docPtr Document pointer\n   * @returns Focused paragraph text\n   */\n  getA11yFocusedParagraph(docPtr: number): string | null {\n    if (docPtr === 0) throw new Error('Invalid document pointer');\n\n    if (this.useShims && this.module._lok_documentGetA11yFocusedParagraph) {\n      const resultPtr = this.module._lok_documentGetA11yFocusedParagraph(docPtr);\n      if (resultPtr === 0) return null;\n      const result = this.readString(resultPtr);\n      this.module._free(resultPtr);\n      return result;\n    }\n\n    this.log('getA11yFocusedParagraph: shim not available');\n    return null;\n  }\n\n  /**\n   * Get caret position in focused paragraph\n   * @param docPtr Document pointer\n   * @returns Caret position or -1\n   */\n  getA11yCaretPosition(docPtr: number): number {\n    if (docPtr === 0) throw new Error('Invalid document pointer');\n\n    if (this.useShims && this.module._lok_documentGetA11yCaretPosition) {\n      return this.module._lok_documentGetA11yCaretPosition(docPtr);\n    }\n\n    this.log('getA11yCaretPosition: shim not available');\n    return -1;\n  }\n\n  /**\n   * Enable/disable accessibility features\n   * @param docPtr Document pointer\n   * @param viewId View ID\n   * @param enabled Whether to enable accessibility\n   */\n  setAccessibilityState(docPtr: number, viewId: number, enabled: boolean): void {\n    if (docPtr === 0) throw new Error('Invalid document pointer');\n\n    if (this.useShims && this.module._lok_documentSetAccessibilityState) {\n      this.module._lok_documentSetAccessibilityState(docPtr, viewId, enabled ? 1 : 0);\n      return;\n    }\n\n    this.log('setAccessibilityState: shim not available');\n  }\n\n  // ==========================================\n  // Spreadsheet-Specific Methods\n  // ==========================================\n\n  /**\n   * Get data area for a spreadsheet (last used row/column)\n   * @param docPtr Document pointer\n   * @param part Sheet index\n   * @returns Object with col and row counts\n   */\n  getDataArea(docPtr: number, part: number): { col: number; row: number } {\n    if (docPtr === 0) throw new Error('Invalid document pointer');\n\n    if (this.useShims && this.module._lok_documentGetDataArea) {\n      const colPtr = this.module._malloc(8);\n      const rowPtr = this.module._malloc(8);\n      try {\n        this.module._lok_documentGetDataArea(docPtr, part, colPtr, rowPtr);\n        const col = this.HEAP32[colPtr >> 2] ?? 0;\n        const row = this.HEAP32[rowPtr >> 2] ?? 0;\n        return { col, row };\n      } finally {\n        this.module._free(colPtr);\n        this.module._free(rowPtr);\n      }\n    }\n\n    this.log('getDataArea: shim not available');\n    return { col: 0, row: 0 };\n  }\n\n  // ==========================================\n  // Edit Mode Methods\n  // ==========================================\n\n  /**\n   * Get current edit mode\n   * @param docPtr Document pointer\n   * @returns Edit mode value\n   */\n  getEditMode(docPtr: number): number {\n    if (docPtr === 0) throw new Error('Invalid document pointer');\n\n    if (this.useShims && this.module._lok_documentGetEditMode) {\n      return this.module._lok_documentGetEditMode(docPtr);\n    }\n\n    this.log('getEditMode: shim not available');\n    return 0;\n  }\n\n  /**\n   * Set edit mode for the document\n   * @param docPtr Document pointer\n   * @param mode 0 for view mode, 1 for edit mode\n   */\n  setEditMode(docPtr: number, mode: number): void {\n    if (docPtr === 0) throw new Error('Invalid document pointer');\n\n    if (this.useShims && this.module._lok_documentSetEditMode) {\n      this.log(`setEditMode: setting mode to ${mode}`);\n      this.module._lok_documentSetEditMode(docPtr, mode);\n      return;\n    }\n\n    this.log('setEditMode: shim not available');\n  }\n\n  // ==========================================\n  // View Management Methods\n  // ==========================================\n\n  /**\n   * Create a new view for the document\n   * @param docPtr Document pointer\n   * @returns View ID\n   */\n  createView(docPtr: number): number {\n    if (docPtr === 0) throw new Error('Invalid document pointer');\n\n    if (this.useShims && this.module._lok_documentCreateView) {\n      const viewId = this.module._lok_documentCreateView(docPtr);\n      this.log(`createView: created view ${viewId}`);\n      return viewId;\n    }\n\n    this.log('createView: shim not available');\n    return -1;\n  }\n\n  /**\n   * Create a new view with options\n   * @param docPtr Document pointer\n   * @param options Options string (JSON)\n   * @returns View ID\n   */\n  createViewWithOptions(docPtr: number, options: string): number {\n    if (docPtr === 0) throw new Error('Invalid document pointer');\n\n    if (this.useShims && this.module._lok_documentCreateViewWithOptions) {\n      const optionsPtr = this.allocString(options);\n      try {\n        const viewId = this.module._lok_documentCreateViewWithOptions(docPtr, optionsPtr);\n        this.log(`createViewWithOptions: created view ${viewId}`);\n        return viewId;\n      } finally {\n        this.module._free(optionsPtr);\n      }\n    }\n\n    this.log('createViewWithOptions: shim not available');\n    return -1;\n  }\n\n  /**\n   * Destroy a view\n   * @param docPtr Document pointer\n   * @param viewId View ID to destroy\n   */\n  destroyView(docPtr: number, viewId: number): void {\n    if (docPtr === 0) throw new Error('Invalid document pointer');\n\n    if (this.useShims && this.module._lok_documentDestroyView) {\n      this.log(`destroyView: destroying view ${viewId}`);\n      this.module._lok_documentDestroyView(docPtr, viewId);\n      return;\n    }\n\n    this.log('destroyView: shim not available');\n  }\n\n  /**\n   * Set the current active view\n   * @param docPtr Document pointer\n   * @param viewId View ID to make active\n   */\n  setView(docPtr: number, viewId: number): void {\n    if (docPtr === 0) throw new Error('Invalid document pointer');\n\n    if (this.useShims && this.module._lok_documentSetView) {\n      this.log(`setView: setting active view to ${viewId}`);\n      this.module._lok_documentSetView(docPtr, viewId);\n      return;\n    }\n\n    this.log('setView: shim not available');\n  }\n\n  /**\n   * Get the current active view ID\n   * @param docPtr Document pointer\n   * @returns Current view ID\n   */\n  getView(docPtr: number): number {\n    if (docPtr === 0) throw new Error('Invalid document pointer');\n\n    if (this.useShims && this.module._lok_documentGetView) {\n      return this.module._lok_documentGetView(docPtr);\n    }\n\n    this.log('getView: shim not available');\n    return -1;\n  }\n\n  /**\n   * Get the number of views\n   * @param docPtr Document pointer\n   * @returns Number of views\n   */\n  getViewsCount(docPtr: number): number {\n    if (docPtr === 0) throw new Error('Invalid document pointer');\n\n    if (this.useShims && this.module._lok_documentGetViewsCount) {\n      return this.module._lok_documentGetViewsCount(docPtr);\n    }\n\n    this.log('getViewsCount: shim not available');\n    return 0;\n  }\n\n  // ==========================================\n  // Event Loop and Callback Methods\n  // ==========================================\n\n  /**\n   * Enable synchronous event dispatch (Unipoll mode).\n   * This must be called before using postKeyEvent, postMouseEvent, etc.\n   * to ensure events are processed immediately instead of being queued.\n   *\n   * Without this, events posted via postKeyEvent/postMouseEvent are queued\n   * via Application::PostUserEvent() and never processed in headless mode.\n   */\n  enableSyncEvents(): void {\n    if (this.useShims && this.module._lok_enableSyncEvents) {\n      this.module._lok_enableSyncEvents();\n      this.log('enableSyncEvents: Unipoll mode enabled');\n    } else {\n      this.log('enableSyncEvents: shim not available');\n    }\n  }\n\n  /**\n   * Disable synchronous event dispatch.\n   * Call this when done with event-based operations.\n   */\n  disableSyncEvents(): void {\n    if (this.useShims && this.module._lok_disableSyncEvents) {\n      this.module._lok_disableSyncEvents();\n      this.log('disableSyncEvents: Unipoll mode disabled');\n    } else {\n      this.log('disableSyncEvents: shim not available');\n    }\n  }\n\n  // ==========================================\n  // Callback Queue Methods\n  // ==========================================\n\n  /**\n   * Register a callback handler for the document.\n   * Events are queued and can be retrieved via pollCallback().\n   * @param docPtr Document pointer\n   */\n  registerCallback(docPtr: number): void {\n    if (docPtr === 0) throw new Error('Invalid document pointer');\n\n    if (this.useShims && this.module._lok_documentRegisterCallback) {\n      this.module._lok_documentRegisterCallback(docPtr);\n      this.log('registerCallback: callback registered');\n    } else {\n      this.log('registerCallback: shim not available');\n    }\n  }\n\n  /**\n   * Unregister the callback handler for the document.\n   * @param docPtr Document pointer\n   */\n  unregisterCallback(docPtr: number): void {\n    if (docPtr === 0) throw new Error('Invalid document pointer');\n\n    if (this.useShims && this.module._lok_documentUnregisterCallback) {\n      this.module._lok_documentUnregisterCallback(docPtr);\n      this.log('unregisterCallback: callback unregistered');\n    } else {\n      this.log('unregisterCallback: shim not available');\n    }\n  }\n\n  /**\n   * Check if there are any pending callback events.\n   * @returns true if events are pending\n   */\n  hasCallbackEvents(): boolean {\n    if (this.useShims && this.module._lok_hasCallbackEvents) {\n      return this.module._lok_hasCallbackEvents() !== 0;\n    }\n    return false;\n  }\n\n  /**\n   * Get the number of pending callback events.\n   * @returns Number of events in the queue\n   */\n  getCallbackEventCount(): number {\n    if (this.useShims && this.module._lok_getCallbackEventCount) {\n      return this.module._lok_getCallbackEventCount();\n    }\n    return 0;\n  }\n\n  /**\n   * Poll and retrieve the next callback event from the queue.\n   * @returns The next event, or null if queue is empty\n   */\n  pollCallback(): LOKCallbackEvent | null {\n    if (!this.useShims || !this.module._lok_pollCallback) {\n      return null;\n    }\n\n    const bufferSize = 4096;\n    const payloadBuffer = this.module._malloc(bufferSize);\n    const payloadLengthPtr = this.module._malloc(4);\n\n    try {\n      const eventType = this.module._lok_pollCallback(payloadBuffer, bufferSize, payloadLengthPtr);\n\n      if (eventType === -1) {\n        return null; // Queue is empty\n      }\n\n      // Read the payload length\n      const payloadLength = this.module.HEAP32[payloadLengthPtr >> 2] ?? 0;\n\n      // Read the payload string\n      let payload = '';\n      if (payloadLength > 0) {\n        // Copy bytes from HEAPU8 to avoid SharedArrayBuffer issues in browsers\n        // TextDecoder.decode() doesn't accept SharedArrayBuffer views in some browsers\n        const len = Math.min(payloadLength, bufferSize - 1);\n        const bytes = this.module.HEAPU8.slice(payloadBuffer, payloadBuffer + len);\n        payload = textDecoder.decode(bytes);\n      }\n\n      return {\n        type: eventType,\n        typeName: getCallbackTypeName(eventType),\n        payload,\n      };\n    } finally {\n      this.module._free(payloadBuffer);\n      this.module._free(payloadLengthPtr);\n    }\n  }\n\n  /**\n   * Poll all pending callback events.\n   * @returns Array of all pending events\n   */\n  pollAllCallbacks(): LOKCallbackEvent[] {\n    const events: LOKCallbackEvent[] = [];\n    let event = this.pollCallback();\n    while (event !== null) {\n      events.push(event);\n      event = this.pollCallback();\n    }\n    return events;\n  }\n\n  /**\n   * Clear all pending callback events.\n   */\n  clearCallbackQueue(): void {\n    if (this.useShims && this.module._lok_clearCallbackQueue) {\n      this.module._lok_clearCallbackQueue();\n      this.log('clearCallbackQueue: queue cleared');\n    }\n  }\n\n  /**\n   * Force flush pending LOK callbacks for a document.\n   * This is needed in WASM because callbacks are queued via PostUserEvent\n   * but the event loop doesn't run automatically.\n   * Call this after operations that trigger callbacks (e.g., postUnoCommand)\n   * to ensure the callback queue is populated.\n   * @param docPtr Document pointer\n   */\n  flushCallbacks(docPtr: number): void {\n    if (docPtr === 0) throw new Error('Invalid document pointer');\n\n    const hasShim = !!this.module._lok_flushCallbacks;\n    this.log(`flushCallbacks: useShims=${this.useShims}, _lok_flushCallbacks exists=${hasShim}`);\n\n    if (this.useShims && this.module._lok_flushCallbacks) {\n      this.module._lok_flushCallbacks(docPtr);\n      this.log('flushCallbacks: callbacks flushed');\n    } else {\n      this.log('flushCallbacks: shim not available');\n    }\n  }\n\n  /**\n   * Poll for STATE_CHANGED callbacks and parse them into a map.\n   * STATE_CHANGED payloads are in format: \".uno:CommandName=value\"\n   * @returns Map of command names to values\n   */\n  pollStateChanges(): Map<string, string> {\n    const states = new Map<string, string>();\n    const events = this.pollAllCallbacks();\n\n    for (const event of events) {\n      if (event.type === LOK_CALLBACK_STATE_CHANGED) {\n        // Parse \".uno:Bold=true\" format\n        const eqIndex = event.payload.indexOf('=');\n        if (eqIndex !== -1) {\n          const key = event.payload.substring(0, eqIndex);\n          const value = event.payload.substring(eqIndex + 1);\n          states.set(key, value);\n        } else {\n          // Some state changes are just the command name (enabled/disabled toggle)\n          states.set(event.payload, '');\n        }\n      }\n    }\n\n    return states;\n  }\n\n  // ==========================================\n  // High-Level Convenience Methods\n  // ==========================================\n\n  /**\n   * Click at a position and get text at that location\n   * @param docPtr Document pointer\n   * @param x X coordinate in twips\n   * @param y Y coordinate in twips\n   * @returns Text at the clicked position\n   */\n  clickAndGetText(docPtr: number, x: number, y: number): string | null {\n    // Click down and up to select\n    this.postMouseEvent(docPtr, LOK_MOUSEEVENT_BUTTONDOWN, x, y, 1, 1, 0);\n    this.postMouseEvent(docPtr, LOK_MOUSEEVENT_BUTTONUP, x, y, 1, 1, 0);\n\n    // Get selected text\n    return this.getTextSelection(docPtr, 'text/plain;charset=utf-8');\n  }\n\n  /**\n   * Double-click to select a word and get it\n   * @param docPtr Document pointer\n   * @param x X coordinate in twips\n   * @param y Y coordinate in twips\n   * @returns Selected word\n   */\n  doubleClickAndGetWord(docPtr: number, x: number, y: number): string | null {\n    // Double click to select word\n    this.postMouseEvent(docPtr, LOK_MOUSEEVENT_BUTTONDOWN, x, y, 2, 1, 0);\n    this.postMouseEvent(docPtr, LOK_MOUSEEVENT_BUTTONUP, x, y, 2, 1, 0);\n\n    // Get selected text\n    return this.getTextSelection(docPtr, 'text/plain;charset=utf-8');\n  }\n\n  /**\n   * Select all content in the document\n   * @param docPtr Document pointer\n   */\n  selectAll(docPtr: number): void {\n    this.postUnoCommand(docPtr, '.uno:SelectAll');\n  }\n\n  /**\n   * Get all text content from the document\n   * @param docPtr Document pointer\n   * @returns All text content\n   */\n  getAllText(docPtr: number): string | null {\n    this.log(`getAllText called with docPtr: ${docPtr}`);\n    this.selectAll(docPtr);\n    const text = this.getTextSelection(docPtr, 'text/plain;charset=utf-8');\n    this.log(`getAllText: text=\"${text?.slice(0, 100)}...\"`);\n    this.resetSelection(docPtr);\n    return text;\n  }\n\n  /**\n   * Parse page rectangles string into array of objects\n   * @param rectanglesStr String from getPartPageRectangles\n   * @returns Array of rectangle objects\n   */\n  parsePageRectangles(rectanglesStr: string): Array<{ x: number; y: number; width: number; height: number }> {\n    if (!rectanglesStr) return [];\n    \n    return rectanglesStr.split(';').filter(s => s.trim()).map(rect => {\n      const parts = rect.split(',').map(Number);\n      return { \n        x: parts[0] ?? 0, \n        y: parts[1] ?? 0, \n        width: parts[2] ?? 0, \n        height: parts[3] ?? 0 \n      };\n    });\n  }\n}\n","/**\n * LibreOffice WASM Document Converter\n * Core conversion functionality using LibreOfficeKit via WASM\n */\n\nimport {\n  ConversionError,\n  ConversionErrorCode,\n  ConversionOptions,\n  ConversionResult,\n  DocumentInfo,\n  EditorOperationResult,\n  EditorSession,\n  EmscriptenModule,\n  EXTENSION_TO_FORMAT,\n  FORMAT_FILTERS,\n  FORMAT_MIME_TYPES,\n  FORMAT_FILTER_OPTIONS,\n  ILibreOfficeConverter,\n  InputFormatOptions,\n  LibreOfficeWasmOptions,\n  LOKDocumentType,\n  OUTPUT_FORMAT_TO_LOK,\n  OutputFormat,\n  PagePreview,\n  ProgressInfo,\n  RenderOptions,\n  isConversionValid,\n  getConversionErrorMessage,\n  getValidOutputFormats,\n  InputFormat,\n  getOutputFormatsForDocType,\n} from './types.js';\nimport { LOKBindings } from './lok-bindings.js';\n\n// Declare the module factory type\ntype ModuleFactory = (config: Partial<EmscriptenModule>) => Promise<EmscriptenModule>;\n\n// Check if running in Node.js\nconst isNode =\n  typeof process !== 'undefined' &&\n  process.versions != null &&\n  process.versions.node != null;\n\n// Node.js module types for dynamic imports\ninterface PathModule {\n  isAbsolute: (path: string) => boolean;\n  dirname: (path: string) => string;\n  resolve: (...paths: string[]) => string;\n  join: (...paths: string[]) => string;\n}\n\ninterface UrlModule {\n  fileURLToPath: (url: string | URL) => string;\n}\n\ninterface FsModule {\n  existsSync: (path: string) => boolean;\n  readFileSync: (path: string) => Buffer;\n  writeFileSync: (path: string, data: Uint8Array) => void;\n  unlinkSync: (path: string) => void;\n}\n\ninterface ModuleModule {\n  createRequire: (url: string | URL) => (id: string) => unknown;\n}\n\ninterface WasmLoaderModule {\n  createModule: (config: Record<string, unknown>) => Promise<EmscriptenModule>;\n}\n\n/** Emscripten worker with Node.js-specific methods */\ninterface EmscriptenWorker {\n  unref?: () => void;\n  terminate?: () => void;\n}\n\n/** Emscripten PThread interface for pthread cleanup */\ninterface EmscriptenPThread {\n  terminateAllThreads?: () => void;\n  runningWorkers?: EmscriptenWorker[];\n  unusedWorkers?: EmscriptenWorker[];\n}\n\n/** Emscripten module with PThread support */\ninterface EmscriptenModuleWithPThread extends EmscriptenModule {\n  PThread?: EmscriptenPThread;\n}\n\n/** Node.js process handle */\ninterface ProcessHandle {\n  unref?: () => void;\n  constructor?: { name?: string };\n  remoteAddress?: string;\n}\n\n/** Node.js process with internal methods */\ninterface ProcessWithHandles {\n  _getActiveHandles?: () => ProcessHandle[];\n}\n\n// Node.js modules - loaded dynamically when needed\nlet pathModule: PathModule | null = null;\nlet urlModule: UrlModule | null = null;\nlet fsModule: FsModule | null = null;\nlet moduleModule: ModuleModule | null = null;\nlet nodeModulesLoaded = false;\n\n// Load Node.js modules dynamically (works in both ESM and CJS)\nasync function ensureNodeModules(): Promise<boolean> {\n  if (nodeModulesLoaded) return pathModule !== null;\n  if (!isNode) return false;\n\n  try {\n    // Dynamic imports work in both ESM and CJS Node.js\n    pathModule = await import('path');\n    urlModule = await import('url');\n    fsModule = await import('fs');\n    moduleModule = await import('module');\n    nodeModulesLoaded = true;\n    return true;\n  } catch {\n    nodeModulesLoaded = true;\n    return false;\n  }\n}\n\n/**\n * LibreOffice WASM Document Converter\n *\n * A headless document conversion toolkit that uses LibreOffice\n * compiled to WebAssembly for browser and Node.js environments.\n */\nexport class LibreOfficeConverter implements ILibreOfficeConverter {\n  private module: EmscriptenModule | null = null;\n  private lokBindings: LOKBindings | null = null;\n  private initialized = false;\n  private initializing = false;\n  private options: LibreOfficeWasmOptions;\n  private corrupted = false;\n  private fsTracked = false;\n\n  constructor(options: LibreOfficeWasmOptions = {}) {\n    this.options = {\n      wasmPath: './wasm',\n      verbose: false,\n      ...options,\n    };\n  }\n\n  /**\n   * Check if an error indicates LOK corruption requiring reinitialization\n   */\n  private isCorruptionError(error: Error | string): boolean {\n    const msg = error instanceof Error ? error.message : error;\n    return msg.includes('memory access out of bounds') ||\n           msg.includes('ComponentContext is not avail') ||\n           msg.includes('unreachable') ||\n           msg.includes('table index is out of bounds') ||\n           msg.includes('null function');\n  }\n\n  /**\n   * Force reinitialization of the converter (for recovery from errors)\n   */\n  async reinitialize(): Promise<void> {\n    if (this.options.verbose) {\n      console.log('[LibreOfficeConverter] Reinitializing due to corruption...');\n    }\n\n    // Clean up existing state\n    if (this.lokBindings) {\n      try {\n        this.lokBindings.destroy();\n      } catch {\n        // Ignore errors during cleanup\n      }\n      this.lokBindings = null;\n    }\n    this.module = null;\n    this.initialized = false;\n    this.corrupted = false;\n\n    // Reinitialize\n    await this.initialize();\n  }\n\n  /**\n   * Initialize with a pre-loaded Emscripten module\n   * This is useful for environments like Web Workers that have their own\n   * WASM loading mechanism (e.g., importScripts with progress tracking)\n   */\n  async initializeWithModule(module: EmscriptenModule): Promise<void> {\n    if (this.initialized) {\n      return;\n    }\n\n    if (this.initializing) {\n      while (this.initializing) {\n        await new Promise((resolve) => setTimeout(resolve, 100));\n      }\n      return;\n    }\n\n    this.initializing = true;\n\n    try {\n      this.module = module;\n\n      // Set up filesystem\n      this.setupFileSystem();\n\n      // Initialize LibreOfficeKit\n      this.initializeLibreOfficeKit();\n\n      this.initialized = true;\n      this.options.onReady?.();\n    } catch (error) {\n      console.error('[LibreOfficeConverter] Initialization error:', error);\n      const convError =\n        error instanceof ConversionError\n          ? error\n          : new ConversionError(\n              ConversionErrorCode.WASM_NOT_INITIALIZED,\n              `Failed to initialize with module: ${String(error)}`\n            );\n      this.options.onError?.(convError);\n      throw convError;\n    } finally {\n      this.initializing = false;\n    }\n  }\n\n  /**\n   * Initialize the LibreOffice WASM module\n   */\n  async initialize(): Promise<void> {\n    if (this.initialized) {\n      return;\n    }\n\n    if (this.initializing) {\n      while (this.initializing) {\n        await new Promise((resolve) => setTimeout(resolve, 100));\n      }\n      return;\n    }\n\n    this.initializing = true;\n    this.emitProgress('loading', 0, 'Loading LibreOffice WASM module...');\n\n    try {\n      // Load WASM module (progress 0-45% handled by loader)\n      this.module = await this.loadModule();\n      \n      this.emitProgress('initializing', 50, 'Setting up virtual filesystem...');\n\n      // Create directories in virtual filesystem\n      this.setupFileSystem();\n      \n      this.emitProgress('initializing', 60, 'Initializing LibreOfficeKit...');\n\n      // Initialize LibreOfficeKit\n      this.initializeLibreOfficeKit();\n\n      this.emitProgress('initializing', 90, 'LibreOfficeKit ready');\n\n      this.initialized = true;\n      this.emitProgress('complete', 100, 'LibreOffice ready');\n      this.options.onReady?.();\n    } catch (error) {\n      console.error('[LibreOfficeConverter] Initialization error:', error);\n      const convError =\n        error instanceof ConversionError\n          ? error\n          : new ConversionError(\n              ConversionErrorCode.WASM_NOT_INITIALIZED,\n              `Failed to initialize WASM module: ${String(error)}`\n            );\n      this.options.onError?.(convError);\n      throw convError;\n    } finally {\n      this.initializing = false;\n    }\n  }\n\n  /**\n   * Load the Emscripten WASM module\n   */\n  private async loadModule(): Promise<EmscriptenModule> {\n    const wasmPath = this.options.wasmPath || './wasm';\n    console.log('[LibreOfficeConverter] Loading WASM module from:', wasmPath);\n    if (isNode) {\n      return this.loadNodeModule(wasmPath);\n    } else {\n      return this.loadBrowserModule(wasmPath);\n    }\n  }\n\n  /**\n   * Load module in Node.js environment\n   */\n  private async loadNodeModule(wasmPath: string): Promise<EmscriptenModule> {\n    // Load Node.js modules dynamically\n    await ensureNodeModules();\n\n    // Ensure Node.js modules are available\n    if (!pathModule || !urlModule || !fsModule || !moduleModule) {\n      throw new ConversionError(\n        ConversionErrorCode.WASM_NOT_INITIALIZED,\n        'Node.js modules not available. This method should only be called in Node.js environment.'\n      );\n    }\n\n    // Resolve absolute path\n    let absolutePath = wasmPath;\n    if (!pathModule.isAbsolute(wasmPath)) {\n      let currentDir: string;\n      try {\n        // ESM\n        currentDir = pathModule.dirname(urlModule.fileURLToPath(import.meta.url));\n      } catch {\n        // CJS fallback\n        currentDir = typeof __dirname !== 'undefined' ? __dirname : process.cwd();\n      }\n      absolutePath = pathModule.resolve(currentDir, '..', wasmPath);\n    }\n\n    // Check for loader.cjs and soffice.cjs\n    const loaderPath = pathModule.join(absolutePath, 'loader.cjs');\n    const modulePath = pathModule.join(absolutePath, 'soffice.cjs');\n\n    if (!fsModule.existsSync(modulePath)) {\n      throw new ConversionError(\n        ConversionErrorCode.WASM_NOT_INITIALIZED,\n        `WASM module not found at: ${modulePath}. Build LibreOffice WASM first.`\n      );\n    }\n\n    if (!fsModule.existsSync(loaderPath)) {\n      throw new ConversionError(\n        ConversionErrorCode.WASM_NOT_INITIALIZED,\n        `WASM loader not found at: ${loaderPath}. Ensure wasm/loader.cjs exists.`\n      );\n    }\n\n    // Use createRequire to load CommonJS module from ESM context\n    const requireFn = moduleModule.createRequire(import.meta.url);\n\n    // Load the loader module\n    const loader = requireFn(pathModule.resolve(loaderPath)) as WasmLoaderModule;\n\n    // Use the loader's createModule function with progress callback\n    const config = {\n      verbose: this.options.verbose,\n      print: this.options.verbose ? console.log : () => {},\n      printErr: this.options.verbose ? console.error : () => {},\n      onProgress: (_phase: string, percent: number, message: string) => {\n        // Map loader progress to our progress phases\n        this.emitProgress('loading', percent, message);\n      },\n    };\n\n    return await loader.createModule(config);\n  }\n\n  /**\n   * Load module in browser environment\n   */\n  private async loadBrowserModule(wasmPath: string): Promise<EmscriptenModule> {\n    const moduleUrl = `${wasmPath}/soffice.js`;\n\n    const config: Partial<EmscriptenModule> = {\n      locateFile: (path: string) => {\n        if (path.endsWith('.wasm')) {\n          return `${wasmPath}/soffice.wasm`;\n        }\n        if (path.endsWith('.data')) {\n          return `${wasmPath}/soffice.data`;\n        }\n        return `${wasmPath}/${path}`;\n      },\n      print: this.options.verbose ? console.log : () => {},\n      printErr: this.options.verbose ? console.error : () => {},\n    };\n\n    // Create a script element to load the module\n    const script = document.createElement('script');\n    script.src = moduleUrl;\n\n    await new Promise<void>((resolve, reject) => {\n      script.onload = () => resolve();\n      script.onerror = () => reject(new Error(`Failed to load ${moduleUrl}`));\n      document.head.appendChild(script);\n    });\n\n    // The module factory should now be available globally\n    const createModule = (window as Window & { createSofficeModule?: ModuleFactory }).createSofficeModule;\n\n    if (!createModule) {\n      throw new ConversionError(\n        ConversionErrorCode.WASM_NOT_INITIALIZED,\n        'WASM module factory not found. Make sure soffice.js is loaded.'\n      );\n    }\n\n    return new Promise((resolve, reject) => {\n      const moduleWithCallback: Partial<EmscriptenModule> = {\n        ...config,\n        onRuntimeInitialized: () => {\n          resolve(moduleWithCallback as EmscriptenModule);\n        },\n      };\n\n      createModule(moduleWithCallback).catch(reject);\n    });\n  }\n\n  /**\n   * Set up the virtual filesystem\n   */\n  private setupFileSystem(): void {\n    if (!this.module?.FS) {\n      throw new ConversionError(\n        ConversionErrorCode.WASM_NOT_INITIALIZED,\n        'Filesystem not available'\n      );\n    }\n\n    const fs = this.module.FS;\n\n    const tryMkdir = (path: string) => {\n      try {\n        fs.mkdir(path);\n      } catch {\n        // Directory may already exist\n      }\n    };\n\n    tryMkdir('/tmp');\n    tryMkdir('/tmp/input');\n    tryMkdir('/tmp/output');\n  }\n\n  /**\n   * Initialize LibreOfficeKit\n   */\n  private initializeLibreOfficeKit(): void {\n    if (!this.module) {\n      throw new ConversionError(\n        ConversionErrorCode.WASM_NOT_INITIALIZED,\n        'Module not loaded'\n      );\n    }\n\n    // Debug filesystem contents before LOK init\n    if (this.options.verbose && this.module.FS) {\n      const fs = this.module.FS as typeof this.module.FS & {\n        trackingDelegate?: Record<string, unknown>;\n        open: (...args: unknown[]) => unknown;\n      };\n\n      if (!this.fsTracked) {\n        this.fsTracked = true;\n\n        if (!fs.trackingDelegate) {\n          fs.trackingDelegate = {\n            onOpen: (path: string) => {\n              console.log('[FS OPEN]', path);\n            },\n            onOpenFile: (path: string) => {\n              console.log('[FS OPEN FILE]', path);\n            },\n          };\n        }\n\n        if (typeof fs.open === 'function') {\n          const originalOpen = fs.open.bind(fs);\n          fs.open = ((path: string, flags?: unknown, mode?: unknown) => {\n            console.log('[FS OPEN CALL]', path);\n            try {\n              return originalOpen(path, flags as never, mode as never);\n            } catch (err) {\n              const error = err as { code?: string; message?: string };\n              if (error?.code === 'ENOENT') {\n                console.log('[FS ENOENT]', path);\n              }\n              throw err;\n            }\n          }) as typeof fs.open;\n        }\n      }\n\n      const logDir = (label: string, path: string) => {\n        try {\n          console.log(`[FS] ${label}:`, fs.readdir(path));\n        } catch (e) {\n          console.log(`[FS] ${label}: ERROR -`, (e as Error).message);\n        }\n      };\n\n      logDir('ROOT', '/');\n      logDir('PROGRAM DIR', '/instdir/program');\n      logDir('SHARE DIR', '/instdir/share');\n      logDir('REGISTRY DIR', '/instdir/share/registry');\n      logDir('FILTER DIR', '/instdir/share/filter');\n      logDir('CONFIG DIR', '/instdir/share/config/soffice.cfg');\n      logDir('CONFIG FILTER', '/instdir/share/config/soffice.cfg/filter');\n      logDir('IMPRESS MODULES', '/instdir/share/config/soffice.cfg/modules/simpress');\n    }\n\n    // Create LOK bindings wrapper\n    this.lokBindings = new LOKBindings(this.module, this.options.verbose);\n\n    try {\n      // Initialize LibreOfficeKit through the bindings\n      this.lokBindings.initialize('/instdir/program');\n\n      if (this.options.verbose) {\n        const versionInfo = this.lokBindings.getVersionInfo();\n        if (versionInfo) {\n          console.log('[LOK] Version:', versionInfo);\n        }\n      }\n    } catch (error) {\n      throw new ConversionError(\n        ConversionErrorCode.WASM_NOT_INITIALIZED,\n        `Failed to initialize LibreOfficeKit: ${String(error)}`\n      );\n    }\n  }\n\n  /**\n   * Convert a document to a different format\n   */\n  async convert(\n    input: Uint8Array | ArrayBuffer | Buffer,\n    options: ConversionOptions,\n    filename = 'document'\n  ): Promise<ConversionResult> {\n    // Check if we need to reinitialize due to previous corruption\n    if (this.corrupted) {\n      await this.reinitialize();\n    }\n\n    if (!this.initialized || !this.module) {\n      throw new ConversionError(\n        ConversionErrorCode.WASM_NOT_INITIALIZED,\n        'LibreOffice WASM not initialized. Call initialize() first.'\n      );\n    }\n\n    const startTime = Date.now();\n    const inputData = this.normalizeInput(input);\n\n    if (inputData.length === 0) {\n      throw new ConversionError(\n        ConversionErrorCode.INVALID_INPUT,\n        'Empty document provided'\n      );\n    }\n\n    const inputExt = options.inputFormat || this.getExtensionFromFilename(filename) || 'docx';\n    const outputExt = options.outputFormat;\n\n    if (!FORMAT_FILTERS[outputExt]) {\n      throw new ConversionError(\n        ConversionErrorCode.UNSUPPORTED_FORMAT,\n        `Unsupported output format: ${outputExt}`\n      );\n    }\n\n    // Validate that this conversion path is supported\n    if (!isConversionValid(inputExt, outputExt)) {\n      throw new ConversionError(\n        ConversionErrorCode.UNSUPPORTED_FORMAT,\n        getConversionErrorMessage(inputExt, outputExt)\n      );\n    }\n\n    const inputPath = `/tmp/input/doc.${inputExt}`;\n    const outputPath = `/tmp/output/doc.${outputExt}`;\n\n    try {\n      this.emitProgress('converting', 10, 'Writing input document...');\n\n      // Write input file to virtual filesystem\n      this.module.FS.writeFile(inputPath, inputData);\n\n      this.emitProgress('converting', 30, 'Converting document...');\n\n      // Perform conversion\n      const result = await this.performConversion(inputPath, outputPath, options);\n\n      this.emitProgress('complete', 100, 'Conversion complete');\n\n      const baseName = this.getBasename(filename);\n      const outputFilename = `${baseName}.${outputExt}`;\n\n      return {\n        data: result,\n        mimeType: FORMAT_MIME_TYPES[outputExt],\n        filename: outputFilename,\n        duration: Date.now() - startTime,\n      };\n    } catch (error) {\n      // Check if this error indicates corruption\n      if (error instanceof Error && this.isCorruptionError(error)) {\n        this.corrupted = true;\n        if (this.options.verbose) {\n          console.log('[LibreOfficeConverter] Corruption detected, will reinitialize on next convert');\n        }\n      }\n      throw error;\n    } finally {\n      // Cleanup temporary files\n      try {\n        this.module?.FS.unlink(inputPath);\n      } catch {\n        // Ignore\n      }\n      try {\n        this.module?.FS.unlink(outputPath);\n      } catch {\n        // Ignore\n      }\n    }\n  }\n\n  /**\n   * Perform the actual conversion using LibreOfficeKit\n   */\n  private async performConversion(\n    inputPath: string,\n    outputPath: string,\n    options: ConversionOptions\n  ): Promise<Uint8Array> {\n    if (!this.module || !this.lokBindings) {\n      throw new ConversionError(\n        ConversionErrorCode.WASM_NOT_INITIALIZED,\n        'Module not loaded'\n      );\n    }\n\n    this.emitProgress('converting', 40, 'Loading document...');\n\n    let docPtr = 0;\n\n    try {\n      // Build load options (e.g., for password-protected documents)\n      const loadOptions = options.password \n        ? `,Password=${options.password}` \n        : '';\n\n      // Debug: verify file exists before LOK load\n      if (this.options.verbose) {\n        try {\n          const stat = this.module.FS.stat(inputPath);\n          console.log('[Convert] File exists before LOK load:', inputPath, 'size:', stat.size);\n        } catch (e) {\n          console.log('[Convert] File NOT found before LOK load:', inputPath, (e as Error).message);\n        }\n      }\n\n      // Load the document using LibreOfficeKit\n      if (loadOptions) {\n        docPtr = this.lokBindings.documentLoadWithOptions(inputPath, loadOptions);\n      } else {\n        docPtr = this.lokBindings.documentLoad(inputPath);\n      }\n\n      if (docPtr === 0) {\n        throw new ConversionError(\n          ConversionErrorCode.LOAD_FAILED,\n          'Failed to load document'\n        );\n      }\n\n      this.emitProgress('converting', 60, 'Converting format...');\n\n      // Determine the output format string for LOK\n      const lokFormat = OUTPUT_FORMAT_TO_LOK[options.outputFormat];\n      \n      // Get filter options for the format\n      let filterOptions = FORMAT_FILTER_OPTIONS[options.outputFormat] || '';\n      \n      // Add PDF-specific options if applicable\n      if (options.outputFormat === 'pdf' && options.pdf) {\n        const pdfOpts: string[] = [];\n        if (options.pdf.pdfaLevel) {\n          const levelMap: Record<string, number> = {\n            'PDF/A-1b': 1,\n            'PDF/A-2b': 2,\n            'PDF/A-3b': 3,\n          };\n          pdfOpts.push(`SelectPdfVersion=${levelMap[options.pdf.pdfaLevel] || 0}`);\n        }\n        if (options.pdf.quality !== undefined) {\n          pdfOpts.push(`Quality=${options.pdf.quality}`);\n        }\n        if (pdfOpts.length > 0) {\n          filterOptions = pdfOpts.join(',');\n        }\n      }\n\n      // Add page selection for image exports (png, jpg, svg)\n      if (['png', 'jpg', 'svg'].includes(options.outputFormat) && options.image?.pageIndex !== undefined) {\n        // PageRange is 1-indexed\n        const pageNum = options.image.pageIndex + 1;\n        if (filterOptions) {\n          filterOptions += `;PageRange=${pageNum}-${pageNum}`;\n        } else {\n          filterOptions = `PageRange=${pageNum}-${pageNum}`;\n        }\n      }\n\n      this.emitProgress('converting', 70, 'Saving document...');\n\n      // Save the document in the new format\n      this.lokBindings.documentSaveAs(docPtr, outputPath, lokFormat, filterOptions);\n\n      this.emitProgress('converting', 90, 'Reading output...');\n\n      // Read the converted output file\n      try {\n        const outputData = this.module.FS.readFile(outputPath) as Uint8Array;\n        \n        if (outputData.length === 0) {\n          throw new ConversionError(\n            ConversionErrorCode.CONVERSION_FAILED,\n            'Conversion produced empty output'\n          );\n        }\n        \n        return outputData;\n      } catch (fsError) {\n        throw new ConversionError(\n          ConversionErrorCode.CONVERSION_FAILED,\n          `Failed to read converted file: ${String(fsError)}`\n        );\n      }\n    } catch (error) {\n      if (error instanceof ConversionError) {\n        throw error;\n      }\n      throw new ConversionError(\n        ConversionErrorCode.CONVERSION_FAILED,\n        `Conversion failed: ${String(error)}`\n      );\n    } finally {\n      // Always clean up the document\n      if (docPtr !== 0 && this.lokBindings) {\n        try {\n          this.lokBindings.documentDestroy(docPtr);\n        } catch {\n          // Ignore cleanup errors\n        }\n      }\n    }\n  }\n\n  /**\n   * Render page previews (thumbnails) for a document\n   * @param input Document data\n   * @param options Options with inputFormat\n   * @param renderOptions Render settings (width, height, pageIndices)\n   * @returns Array of page preview data with RGBA pixels\n   */\n  async renderPagePreviews(\n    input: Uint8Array | ArrayBuffer | Buffer,\n    options: InputFormatOptions,\n    renderOptions: RenderOptions = {}\n  ): Promise<PagePreview[]> {\n    if (!this.initialized || !this.module || !this.lokBindings) {\n      throw new ConversionError(\n        ConversionErrorCode.WASM_NOT_INITIALIZED,\n        'Converter not initialized'\n      );\n    }\n\n    const data = this.normalizeInput(input);\n    const inputFormat = (options.inputFormat || 'docx').toLowerCase();\n    const width = renderOptions.width ?? 256;\n    const height = renderOptions.height ?? 0;\n    const pageIndices = renderOptions.pageIndices ?? [];\n\n    // Write input file to virtual FS\n    const inputPath = `/tmp/preview/doc.${inputFormat}`;\n    const fs = this.module.FS;\n\n    try {\n      // Create directory\n      try {\n        fs.mkdir('/tmp/preview');\n      } catch {\n        // Directory might exist\n      }\n\n      // Write file\n      fs.writeFile(inputPath, data);\n\n      // Load document\n      const docPtr = this.lokBindings.documentLoad(inputPath);\n      if (docPtr === 0) {\n        throw new ConversionError(\n          ConversionErrorCode.LOAD_FAILED,\n          'Failed to load document for preview'\n        );\n      }\n\n      try {\n        // Get number of pages/parts\n        const numParts = this.lokBindings.documentGetParts(docPtr);\n        if (this.options.verbose) {\n          console.log(`[Preview] Document has ${numParts} pages/parts`);\n        }\n\n        // Determine which pages to render\n        const pagesToRender =\n          pageIndices.length > 0\n            ? pageIndices.filter((i) => i >= 0 && i < numParts)\n            : Array.from({ length: numParts }, (_, i) => i);\n\n        const results: PagePreview[] = [];\n\n        // Render each page\n        for (const pageIndex of pagesToRender) {\n          if (this.options.verbose) {\n            console.log(`[Preview] Rendering page ${pageIndex + 1}/${numParts}`);\n          }\n\n          const preview = this.lokBindings.renderPage(docPtr, pageIndex, width, height);\n          results.push({\n            page: pageIndex,\n            data: preview.data,\n            width: preview.width,\n            height: preview.height,\n          });\n        }\n\n        return results;\n      } finally {\n        // Clean up document\n        this.lokBindings.documentDestroy(docPtr);\n      }\n    } finally {\n      // Clean up input file\n      try {\n        fs.unlink(inputPath);\n      } catch {\n        // Ignore\n      }\n      try {\n        fs.rmdir('/tmp/preview');\n      } catch {\n        // Ignore\n      }\n    }\n  }\n\n  /**\n   * Get the number of pages/parts in a document\n   */\n  async getPageCount(\n    input: Uint8Array | ArrayBuffer | Buffer,\n    options: InputFormatOptions\n  ): Promise<number> {\n    if (!this.initialized || !this.module || !this.lokBindings) {\n      throw new ConversionError(\n        ConversionErrorCode.WASM_NOT_INITIALIZED,\n        'Converter not initialized'\n      );\n    }\n\n    const data = this.normalizeInput(input);\n    const inputFormat = (options.inputFormat || 'docx').toLowerCase();\n\n    const inputPath = `/tmp/pagecount/doc.${inputFormat}`;\n    const fs = this.module.FS;\n\n    try {\n      try {\n        fs.mkdir('/tmp/pagecount');\n      } catch {\n        // Directory might exist\n      }\n\n      fs.writeFile(inputPath, data);\n      const docPtr = this.lokBindings.documentLoad(inputPath);\n\n      if (docPtr === 0) {\n        throw new ConversionError(\n          ConversionErrorCode.LOAD_FAILED,\n          'Failed to load document'\n        );\n      }\n\n      try {\n        return this.lokBindings.documentGetParts(docPtr);\n      } finally {\n        this.lokBindings.documentDestroy(docPtr);\n      }\n    } finally {\n      try {\n        fs.unlink(inputPath);\n      } catch {\n        // Ignore\n      }\n      try {\n        fs.rmdir('/tmp/pagecount');\n      } catch {\n        // Ignore\n      }\n    }\n  }\n\n  /**\n   * Get valid output formats for a document by loading it and checking its type\n   * This is more accurate than static validation as it uses LibreOffice's actual document type detection\n   * @param input Document data\n   * @param options Options with inputFormat\n   * @returns Object with document type and valid output formats\n   */\n  async getDocumentInfo(\n    input: Uint8Array | ArrayBuffer | Buffer,\n    options: InputFormatOptions\n  ): Promise<DocumentInfo> {\n    if (!this.initialized || !this.module || !this.lokBindings) {\n      throw new ConversionError(\n        ConversionErrorCode.WASM_NOT_INITIALIZED,\n        'Converter not initialized'\n      );\n    }\n\n    const data = this.normalizeInput(input);\n    const inputFormat = (options.inputFormat || 'docx').toLowerCase();\n\n    const inputPath = `/tmp/docinfo/doc.${inputFormat}`;\n    const fs = this.module.FS;\n\n    try {\n      try {\n        fs.mkdir('/tmp/docinfo');\n      } catch {\n        // Directory might exist\n      }\n\n      fs.writeFile(inputPath, data);\n      const docPtr = this.lokBindings.documentLoad(inputPath);\n\n      if (docPtr === 0) {\n        throw new ConversionError(\n          ConversionErrorCode.LOAD_FAILED,\n          'Failed to load document'\n        );\n      }\n\n      try {\n        const docType = this.lokBindings.documentGetDocumentType(docPtr) as LOKDocumentType;\n        const pageCount = this.lokBindings.documentGetParts(docPtr);\n        const validOutputFormats = getOutputFormatsForDocType(docType);\n\n        const docTypeNames: Record<LOKDocumentType, string> = {\n          [LOKDocumentType.TEXT]: 'Text Document',\n          [LOKDocumentType.SPREADSHEET]: 'Spreadsheet',\n          [LOKDocumentType.PRESENTATION]: 'Presentation',\n          [LOKDocumentType.DRAWING]: 'Drawing',\n          [LOKDocumentType.OTHER]: 'Other',\n        };\n\n        return {\n          documentType: docType,\n          documentTypeName: docTypeNames[docType] || 'Unknown',\n          validOutputFormats,\n          pageCount,\n        };\n      } finally {\n        this.lokBindings.documentDestroy(docPtr);\n      }\n    } finally {\n      try {\n        fs.unlink(inputPath);\n      } catch {\n        // Ignore\n      }\n      try {\n        fs.rmdir('/tmp/docinfo');\n      } catch {\n        // Ignore\n      }\n    }\n  }\n\n  // ============================================================\n  // Document Inspection Methods\n  // ============================================================\n\n  /**\n   * Get all text content from a document\n   * @param input Document data\n   * @param options Conversion options with inputFormat\n   * @returns All text content from the document\n   */\n  async getDocumentText(\n    input: Uint8Array | ArrayBuffer | Buffer,\n    options: ConversionOptions\n  ): Promise<string | null> {\n    if (!this.initialized || !this.module || !this.lokBindings) {\n      throw new ConversionError(\n        ConversionErrorCode.WASM_NOT_INITIALIZED,\n        'Converter not initialized'\n      );\n    }\n\n    const data = this.normalizeInput(input);\n    const inputFormat = options.inputFormat?.toLowerCase();\n\n    if (!inputFormat) {\n      throw new ConversionError(\n        ConversionErrorCode.INVALID_INPUT,\n        'Input format is required'\n      );\n    }\n\n    const inputPath = `/tmp/inspect/doc.${inputFormat}`;\n    const fs = this.module.FS;\n\n    try {\n      try {\n        fs.mkdir('/tmp/inspect');\n      } catch {\n        // Directory might exist\n      }\n\n      fs.writeFile(inputPath, data);\n      const docPtr = this.lokBindings.documentLoad(inputPath);\n\n      if (docPtr === 0) {\n        throw new ConversionError(\n          ConversionErrorCode.LOAD_FAILED,\n          'Failed to load document'\n        );\n      }\n\n      try {\n        return this.lokBindings.getAllText(docPtr);\n      } finally {\n        this.lokBindings.documentDestroy(docPtr);\n      }\n    } finally {\n      try {\n        fs.unlink(inputPath);\n      } catch {\n        // Ignore\n      }\n      try {\n        fs.rmdir('/tmp/inspect');\n      } catch {\n        // Ignore\n      }\n    }\n  }\n\n  /**\n   * Get page/slide names from a document\n   * @param input Document data\n   * @param options Conversion options with inputFormat\n   * @returns Array of page/slide names\n   */\n  async getPageNames(\n    input: Uint8Array | ArrayBuffer | Buffer,\n    options: ConversionOptions\n  ): Promise<string[]> {\n    if (!this.initialized || !this.module || !this.lokBindings) {\n      throw new ConversionError(\n        ConversionErrorCode.WASM_NOT_INITIALIZED,\n        'Converter not initialized'\n      );\n    }\n\n    const data = this.normalizeInput(input);\n    const inputFormat = options.inputFormat?.toLowerCase();\n\n    if (!inputFormat) {\n      throw new ConversionError(\n        ConversionErrorCode.INVALID_INPUT,\n        'Input format is required'\n      );\n    }\n\n    const inputPath = `/tmp/names/doc.${inputFormat}`;\n    const fs = this.module.FS;\n\n    try {\n      try {\n        fs.mkdir('/tmp/names');\n      } catch {\n        // Directory might exist\n      }\n\n      fs.writeFile(inputPath, data);\n      const docPtr = this.lokBindings.documentLoad(inputPath);\n\n      if (docPtr === 0) {\n        throw new ConversionError(\n          ConversionErrorCode.LOAD_FAILED,\n          'Failed to load document'\n        );\n      }\n\n      try {\n        const numParts = this.lokBindings.documentGetParts(docPtr);\n        const names: string[] = [];\n        \n        for (let i = 0; i < numParts; i++) {\n          const name = this.lokBindings.getPartName(docPtr, i);\n          names.push(name || `Page ${i + 1}`);\n        }\n        \n        return names;\n      } finally {\n        this.lokBindings.documentDestroy(docPtr);\n      }\n    } finally {\n      try {\n        fs.unlink(inputPath);\n      } catch {\n        // Ignore\n      }\n      try {\n        fs.rmdir('/tmp/names');\n      } catch {\n        // Ignore\n      }\n    }\n  }\n\n  /**\n   * Get page bounding rectangles from a document\n   * @param input Document data\n   * @param options Conversion options with inputFormat\n   * @returns Array of page rectangles in twips\n   */\n  async getPageRectangles(\n    input: Uint8Array | ArrayBuffer | Buffer,\n    options: ConversionOptions\n  ): Promise<Array<{ x: number; y: number; width: number; height: number }>> {\n    if (!this.initialized || !this.module || !this.lokBindings) {\n      throw new ConversionError(\n        ConversionErrorCode.WASM_NOT_INITIALIZED,\n        'Converter not initialized'\n      );\n    }\n\n    const data = this.normalizeInput(input);\n    const inputFormat = options.inputFormat?.toLowerCase();\n\n    if (!inputFormat) {\n      throw new ConversionError(\n        ConversionErrorCode.INVALID_INPUT,\n        'Input format is required'\n      );\n    }\n\n    const inputPath = `/tmp/rects/doc.${inputFormat}`;\n    const fs = this.module.FS;\n\n    try {\n      try {\n        fs.mkdir('/tmp/rects');\n      } catch {\n        // Directory might exist\n      }\n\n      fs.writeFile(inputPath, data);\n      const docPtr = this.lokBindings.documentLoad(inputPath);\n\n      if (docPtr === 0) {\n        throw new ConversionError(\n          ConversionErrorCode.LOAD_FAILED,\n          'Failed to load document'\n        );\n      }\n\n      try {\n        const rectsStr = this.lokBindings.getPartPageRectangles(docPtr);\n        return this.lokBindings.parsePageRectangles(rectsStr || '');\n      } finally {\n        this.lokBindings.documentDestroy(docPtr);\n      }\n    } finally {\n      try {\n        fs.unlink(inputPath);\n      } catch {\n        // Ignore\n      }\n      try {\n        fs.rmdir('/tmp/rects');\n      } catch {\n        // Ignore\n      }\n    }\n  }\n\n  /**\n   * Get spreadsheet data area (last used row/column)\n   * @param input Document data\n   * @param options Conversion options with inputFormat\n   * @param sheetIndex Sheet index (0-based)\n   * @returns Object with col and row counts\n   */\n  async getSpreadsheetDataArea(\n    input: Uint8Array | ArrayBuffer | Buffer,\n    options: ConversionOptions,\n    sheetIndex: number = 0\n  ): Promise<{ col: number; row: number }> {\n    if (!this.initialized || !this.module || !this.lokBindings) {\n      throw new ConversionError(\n        ConversionErrorCode.WASM_NOT_INITIALIZED,\n        'Converter not initialized'\n      );\n    }\n\n    const data = this.normalizeInput(input);\n    const inputFormat = options.inputFormat?.toLowerCase();\n\n    if (!inputFormat) {\n      throw new ConversionError(\n        ConversionErrorCode.INVALID_INPUT,\n        'Input format is required'\n      );\n    }\n\n    const inputPath = `/tmp/dataarea/doc.${inputFormat}`;\n    const fs = this.module.FS;\n\n    try {\n      try {\n        fs.mkdir('/tmp/dataarea');\n      } catch {\n        // Directory might exist\n      }\n\n      fs.writeFile(inputPath, data);\n      const docPtr = this.lokBindings.documentLoad(inputPath);\n\n      if (docPtr === 0) {\n        throw new ConversionError(\n          ConversionErrorCode.LOAD_FAILED,\n          'Failed to load document'\n        );\n      }\n\n      try {\n        return this.lokBindings.getDataArea(docPtr, sheetIndex);\n      } finally {\n        this.lokBindings.documentDestroy(docPtr);\n      }\n    } finally {\n      try {\n        fs.unlink(inputPath);\n      } catch {\n        // Ignore\n      }\n      try {\n        fs.rmdir('/tmp/dataarea');\n      } catch {\n        // Ignore\n      }\n    }\n  }\n\n  /**\n   * Execute a UNO command on a document\n   * @param input Document data\n   * @param options Conversion options with inputFormat\n   * @param command UNO command (e.g., '.uno:SelectAll')\n   * @param args JSON arguments string\n   * @returns Command result (if any)\n   */\n  async executeUnoCommand(\n    input: Uint8Array | ArrayBuffer | Buffer,\n    options: ConversionOptions,\n    command: string,\n    args: string = '{}'\n  ): Promise<void> {\n    if (!this.initialized || !this.module || !this.lokBindings) {\n      throw new ConversionError(\n        ConversionErrorCode.WASM_NOT_INITIALIZED,\n        'Converter not initialized'\n      );\n    }\n\n    const data = this.normalizeInput(input);\n    const inputFormat = options.inputFormat?.toLowerCase();\n\n    if (!inputFormat) {\n      throw new ConversionError(\n        ConversionErrorCode.INVALID_INPUT,\n        'Input format is required'\n      );\n    }\n\n    const inputPath = `/tmp/uno/doc.${inputFormat}`;\n    const fs = this.module.FS;\n\n    try {\n      try {\n        fs.mkdir('/tmp/uno');\n      } catch {\n        // Directory might exist\n      }\n\n      fs.writeFile(inputPath, data);\n      const docPtr = this.lokBindings.documentLoad(inputPath);\n\n      if (docPtr === 0) {\n        throw new ConversionError(\n          ConversionErrorCode.LOAD_FAILED,\n          'Failed to load document'\n        );\n      }\n\n      try {\n        this.lokBindings.postUnoCommand(docPtr, command, args);\n      } finally {\n        this.lokBindings.documentDestroy(docPtr);\n      }\n    } finally {\n      try {\n        fs.unlink(inputPath);\n      } catch {\n        // Ignore\n      }\n      try {\n        fs.rmdir('/tmp/uno');\n      } catch {\n        // Ignore\n      }\n    }\n  }\n\n  // ============================================\n  // ILibreOfficeConverter Interface Methods\n  // ============================================\n\n  /**\n   * Render a single page as an image\n   * @param input Document data\n   * @param options Options with inputFormat\n   * @param pageIndex Zero-based page index to render\n   * @param width Target width for rendered page\n   * @param height Optional target height (0 = auto based on aspect ratio)\n   * @returns Page preview with RGBA data\n   */\n  async renderPage(\n    input: Uint8Array | ArrayBuffer | Buffer,\n    options: InputFormatOptions,\n    pageIndex: number,\n    width: number,\n    height = 0\n  ): Promise<PagePreview> {\n    if (!this.initialized || !this.module || !this.lokBindings) {\n      throw new ConversionError(\n        ConversionErrorCode.WASM_NOT_INITIALIZED,\n        'Converter not initialized'\n      );\n    }\n\n    const data = this.normalizeInput(input);\n    const inputFormat = (options.inputFormat || 'docx').toLowerCase();\n\n    const inputPath = `/tmp/renderpage/doc.${inputFormat}`;\n    const fs = this.module.FS;\n\n    try {\n      try {\n        fs.mkdir('/tmp/renderpage');\n      } catch {\n        // Directory might exist\n      }\n\n      fs.writeFile(inputPath, data);\n      const docPtr = this.lokBindings.documentLoad(inputPath);\n\n      if (docPtr === 0) {\n        throw new ConversionError(\n          ConversionErrorCode.LOAD_FAILED,\n          'Failed to load document'\n        );\n      }\n\n      try {\n        const preview = this.lokBindings.renderPage(docPtr, pageIndex, width, height);\n        return {\n          page: pageIndex,\n          data: preview.data,\n          width: preview.width,\n          height: preview.height,\n        };\n      } finally {\n        this.lokBindings.documentDestroy(docPtr);\n      }\n    } finally {\n      try {\n        fs.unlink(inputPath);\n      } catch {\n        // Ignore\n      }\n      try {\n        fs.rmdir('/tmp/renderpage');\n      } catch {\n        // Ignore\n      }\n    }\n  }\n\n  /**\n   * Open a document for editing\n   * Note: This low-level converter does not support persistent editor sessions.\n   * Use WorkerConverter or WorkerBrowserConverter for editor operations.\n   * @throws ConversionError Always throws - editor sessions not supported\n   */\n  openDocument(\n    _input: Uint8Array | ArrayBuffer,\n    _options: InputFormatOptions\n  ): Promise<EditorSession> {\n    return Promise.reject(new ConversionError(\n      ConversionErrorCode.CONVERSION_FAILED,\n      'Editor sessions not supported by LibreOfficeConverter. Use WorkerConverter or WorkerBrowserConverter.'\n    ));\n  }\n\n  /**\n   * Execute an editor operation on an open document\n   * Note: This low-level converter does not support editor operations.\n   * @throws ConversionError Always throws - editor operations not supported\n   */\n  editorOperation<T = unknown>(\n    _sessionId: string,\n    _method: string,\n    _args?: unknown[]\n  ): Promise<EditorOperationResult<T>> {\n    return Promise.reject(new ConversionError(\n      ConversionErrorCode.CONVERSION_FAILED,\n      'Editor operations not supported by LibreOfficeConverter. Use WorkerConverter or WorkerBrowserConverter.'\n    ));\n  }\n\n  /**\n   * Close an editor session\n   * Note: This low-level converter does not support editor sessions.\n   * @throws ConversionError Always throws - editor sessions not supported\n   */\n  closeDocument(_sessionId: string): Promise<Uint8Array | undefined> {\n    return Promise.reject(new ConversionError(\n      ConversionErrorCode.CONVERSION_FAILED,\n      'Editor sessions not supported by LibreOfficeConverter. Use WorkerConverter or WorkerBrowserConverter.'\n    ));\n  }\n\n  /**\n   * Get LOK bindings for advanced operations\n   * Use with caution - this exposes low-level API\n   * @returns LOK bindings instance or null\n   */\n  getLokBindings(): typeof this.lokBindings {\n    return this.lokBindings;\n  }\n\n  /**\n   * Destroy the LibreOffice instance and free resources\n   */\n  destroy(): Promise<void> {\n    if (this.lokBindings) {\n      try {\n        this.lokBindings.destroy();\n      } catch {\n        // Ignore cleanup errors\n      }\n      this.lokBindings = null;\n    }\n\n    // Terminate Emscripten pthread workers to allow process to exit\n    if (this.module) {\n      try {\n        const mod = this.module as EmscriptenModuleWithPThread;\n\n        // Try to terminate all pthread workers\n        if (mod.PThread?.terminateAllThreads) {\n          mod.PThread.terminateAllThreads();\n        }\n\n        // Unref any running workers to allow process to exit\n        if (mod.PThread?.runningWorkers) {\n          for (const worker of mod.PThread.runningWorkers) {\n            if (worker?.unref) {\n              worker.unref();\n            }\n            if (worker?.terminate) {\n              worker.terminate();\n            }\n          }\n          mod.PThread.runningWorkers = [];\n        }\n\n        // Also check unusedWorkers\n        if (mod.PThread?.unusedWorkers) {\n          for (const worker of mod.PThread.unusedWorkers) {\n            if (worker?.unref) {\n              worker.unref();\n            }\n            if (worker?.terminate) {\n              worker.terminate();\n            }\n          }\n          mod.PThread.unusedWorkers = [];\n        }\n      } catch {\n        // Ignore pthread cleanup errors\n      }\n    }\n\n    // In Node.js, unref any remaining handles to allow process exit\n    if (isNode && typeof process !== 'undefined') {\n      try {\n        const proc = process as unknown as ProcessWithHandles;\n        if (proc._getActiveHandles) {\n          const handles = proc._getActiveHandles();\n          for (const handle of handles) {\n            // Only unref handles that look like worker-related (MessagePort, internal sockets)\n            if (handle?.unref) {\n              const name = handle.constructor?.name ?? '';\n              if (name === 'MessagePort' || (name === 'Socket' && !handle.remoteAddress)) {\n                handle.unref();\n              }\n            }\n          }\n        }\n      } catch {\n        // Ignore\n      }\n    }\n\n    this.module = null;\n    this.initialized = false;\n    return Promise.resolve();\n  }\n\n  /**\n   * Check if the converter is ready\n   */\n  isReady(): boolean {\n    return this.initialized;\n  }\n\n  /**\n   * Get the Emscripten module for advanced operations\n   * This is useful for direct filesystem or module access\n   */\n  getModule(): EmscriptenModule | null {\n    return this.module;\n  }\n\n  /**\n   * Get supported input formats\n   */\n  static getSupportedInputFormats(): string[] {\n    return Object.keys(EXTENSION_TO_FORMAT);\n  }\n\n  /**\n   * Get supported output formats\n   */\n  static getSupportedOutputFormats(): OutputFormat[] {\n    return Object.keys(FORMAT_FILTERS) as OutputFormat[];\n  }\n\n  /**\n   * Get valid output formats for a given input format\n   * @param inputFormat The input document format (e.g., 'pdf', 'docx', 'xlsx')\n   * @returns Array of valid output formats for this input\n   */\n  static getValidOutputFormats(inputFormat: string): OutputFormat[] {\n    return getValidOutputFormats(inputFormat as InputFormat);\n  }\n\n  /**\n   * Check if a conversion from input format to output format is supported\n   * @param inputFormat The input document format\n   * @param outputFormat The desired output format\n   * @returns true if the conversion is supported\n   */\n  static isConversionSupported(inputFormat: string, outputFormat: string): boolean {\n    return isConversionValid(inputFormat, outputFormat);\n  }\n\n  // ============================================================\n  // Private helper methods\n  // ============================================================\n\n  private normalizeInput(input: Uint8Array | ArrayBuffer | Buffer): Uint8Array {\n    if (input instanceof Uint8Array) {\n      return input;\n    }\n    if (input instanceof ArrayBuffer) {\n      return new Uint8Array(input);\n    }\n    return new Uint8Array(input);\n  }\n\n  private getExtensionFromFilename(filename: string): string | null {\n    const parts = filename.split('.');\n    if (parts.length > 1) {\n      return parts.pop()?.toLowerCase() || null;\n    }\n    return null;\n  }\n\n  private getBasename(filename: string): string {\n    const lastDot = filename.lastIndexOf('.');\n    if (lastDot > 0) {\n      return filename.substring(0, lastDot);\n    }\n    return filename;\n  }\n\n  private emitProgress(\n    phase: ProgressInfo['phase'],\n    percent: number,\n    message: string\n  ): void {\n    this.options.onProgress?.({ phase, percent, message });\n  }\n}\n","/**\n * Browser Web Worker for LibreOffice WASM conversions\n *\n * This worker runs the WASM module off the main thread to avoid blocking the UI.\n * Communication is via postMessage.\n */\n\nimport type { EditorOperationResult, EmscriptenModule, WasmLoadPhase, WasmLoadProgress } from './types.js';\nimport { LOKBindings } from './lok-bindings.js';\nimport { FORMAT_FILTER_OPTIONS, OUTPUT_FORMAT_TO_LOK } from './types.js';\nimport { createEditor, OfficeEditor } from './editor/index.js';\nimport type { OperationResult } from './editor/types.js';\nimport { LibreOfficeConverter } from './converter.js';\n\n// ============================================\n// WASM Loading Progress System\n// ============================================\n\n/**\n * Cumulative progress tracking - each step adds to the total\n * This ensures progress always increases even if events arrive out of order\n *\n * Weight distribution (sums to 100):\n * - download-wasm: 50 points (largest file ~142MB)\n * - download-data: 30 points (~96MB)\n * - compile: 5 points\n * - filesystem: 7 points\n * - lok-init: 7 points\n * - ready: 1 point (final)\n */\nconst PHASE_WEIGHTS: Record<WasmLoadPhase, number> = {\n  'download-wasm': 50,\n  'download-data': 30,\n  'compile': 5,\n  'filesystem': 7,\n  'lok-init': 7,\n  'ready': 1,\n  'starting': 0,\n  'loading': 0,\n  'initializing': 0,\n  'converting': 0,\n  'complete': 0,\n};\n\n/** Track completed progress for each phase */\nconst phaseProgress: Record<WasmLoadPhase, number> = {\n  'download-wasm': 0,\n  'download-data': 0,\n  'compile': 0,\n  'filesystem': 0,\n  'lok-init': 0,\n  'ready': 0,\n  'starting': 0,\n  'loading': 0,\n  'initializing': 0,\n  'converting': 0,\n  'complete': 0,\n};\n\n/** Current request ID for progress messages */\nlet currentInitRequestId: number = 0;\n\n/** Last emitted percentage - ensures monotonic progress */\nlet lastEmittedPercent: number = 0;\n\n/** Calculate total progress as sum of all phase progress */\nfunction calculateTotalProgress(): number {\n  let total = 0;\n  for (const phase of Object.keys(phaseProgress) as WasmLoadPhase[]) {\n    total += phaseProgress[phase];\n  }\n  const percent = Math.min(100, Math.round(total));\n  // Ensure we never emit a lower percentage than before\n  if (percent > lastEmittedPercent) {\n    lastEmittedPercent = percent;\n  }\n  return lastEmittedPercent;\n}\n\n/** Format bytes as human-readable MB */\nfunction formatBytes(bytes: number): string {\n  const mb = bytes / (1024 * 1024);\n  return `${mb.toFixed(1)} MB`;\n}\n\n/** Emit download progress with bytes info */\nfunction emitDownloadProgress(phase: WasmLoadPhase, loaded: number, total: number) {\n  const weight = PHASE_WEIGHTS[phase];\n  const phasePercent = total > 0 ? loaded / total : 0;\n  const newProgress = weight * phasePercent;\n\n  // Only update if progress increased (never go backwards)\n  if (newProgress > phaseProgress[phase]) {\n    phaseProgress[phase] = newProgress;\n  }\n\n  const message = phase === 'download-wasm'\n    ? `Downloading WebAssembly... ${formatBytes(loaded)} / ${formatBytes(total)}`\n    : `Downloading filesystem... ${formatBytes(loaded)} / ${formatBytes(total)}`;\n\n  emitProgress({ percent: calculateTotalProgress(), message, phase, bytesLoaded: loaded, bytesTotal: total });\n}\n\n/** Emit phase progress (marks phase as complete) */\nfunction emitPhaseProgress(phase: WasmLoadPhase, message: string) {\n  // Only update if this is an increase\n  const newProgress = PHASE_WEIGHTS[phase];\n  if (newProgress > phaseProgress[phase]) {\n    phaseProgress[phase] = newProgress;\n  }\n  emitProgress({ percent: calculateTotalProgress(), message, phase });\n}\n\n/** Send progress to main thread */\nfunction emitProgress(progress: WasmLoadProgress) {\n  self.postMessage({ type: 'progress', id: currentInitRequestId, progress });\n}\n\n/**\n * Install fetch interceptor to track WASM file downloads\n * Must be called BEFORE importScripts() loads Emscripten\n *\n * Modern Emscripten uses fetch() API for downloading .wasm and .data files\n */\nfunction installProgressInterceptors() {\n  const originalFetch = self.fetch;\n\n  // Intercept fetch for progress tracking\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\n  (self).fetch = async function(input: RequestInfo | URL, init?: RequestInit): Promise<Response> {\n    const url = typeof input === 'string' ? input : input instanceof URL ? input.href : input.url;\n\n    // Identify which file is being downloaded\n    let phase: WasmLoadPhase | null = null;\n    if (url.includes('soffice.wasm')) {\n      phase = 'download-wasm';\n      console.log('[Worker] Starting fetch download: soffice.wasm');\n    } else if (url.includes('soffice.data')) {\n      phase = 'download-data';\n      console.log('[Worker] Starting fetch download: soffice.data');\n    }\n\n    const response = await originalFetch(input, init);\n\n    // If not a tracked file, return original response\n    if (!phase) {\n      return response;\n    }\n\n    // Get content length for progress calculation\n    const contentLength = response.headers.get('Content-Length');\n    const total = contentLength ? parseInt(contentLength, 10) : 0;\n\n    // If no content length or no body, return original response\n    if (!total || !response.body) {\n      console.log(`[Worker] No content-length for ${url}, skipping progress tracking`);\n      return response;\n    }\n\n    // Create a new response with progress tracking\n    const reader = response.body.getReader();\n    let loaded = 0;\n\n    const stream = new ReadableStream({\n      async start(controller) {\n        while (true) {\n          const { done, value } = await reader.read();\n\n          if (done) {\n            console.log(`[Worker] Finished fetch download: ${phase === 'download-wasm' ? 'soffice.wasm' : 'soffice.data'}`);\n            controller.close();\n            break;\n          }\n\n          loaded += value.length;\n          emitDownloadProgress(phase, loaded, total);\n          controller.enqueue(value);\n        }\n      }\n    });\n\n    return new Response(stream, {\n      headers: response.headers,\n      status: response.status,\n      statusText: response.statusText\n    });\n  };\n\n  console.log('[Worker] Installed progress-tracking fetch interceptor');\n\n  // Also intercept XHR as fallback (some Emscripten configurations use it)\n  const OriginalXHR = self.XMLHttpRequest;\n\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\n  const ProgressXMLHttpRequest = function(this: XMLHttpRequest) {\n    const xhr = new OriginalXHR();\n    let requestUrl = '';\n\n    const originalOpen = xhr.open.bind(xhr);\n    (xhr).open = function(method: string, url: string | URL, async?: boolean, username?: string | null, password?: string | null) {\n      requestUrl = String(url);\n      return originalOpen(method, url, async ?? true, username, password);\n    };\n\n    const originalSend = xhr.send.bind(xhr);\n    // eslint-disable-next-line @typescript-eslint/no-explicit-any\n    (xhr).send = function(body?: any) {\n      let phase: WasmLoadPhase | null = null;\n      if (requestUrl.includes('soffice.wasm')) {\n        phase = 'download-wasm';\n        console.log('[Worker] Starting XHR download: soffice.wasm');\n      } else if (requestUrl.includes('soffice.data')) {\n        phase = 'download-data';\n        console.log('[Worker] Starting XHR download: soffice.data');\n      }\n\n      if (phase) {\n        const downloadPhase = phase;\n        xhr.addEventListener('progress', (e: ProgressEvent) => {\n          if (e.lengthComputable) {\n            emitDownloadProgress(downloadPhase, e.loaded, e.total);\n          }\n        });\n\n        xhr.addEventListener('load', () => {\n          console.log(`[Worker] Finished XHR download: ${downloadPhase === 'download-wasm' ? 'soffice.wasm' : 'soffice.data'}`);\n        });\n      }\n\n      return originalSend(body);\n    };\n\n    return xhr;\n  };\n\n  Object.defineProperty(ProgressXMLHttpRequest, 'prototype', {\n    value: OriginalXHR.prototype,\n    writable: false,\n  });\n\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any, @typescript-eslint/no-unsafe-member-access\n  (self as any).XMLHttpRequest = ProgressXMLHttpRequest;\n\n  console.log('[Worker] Installed progress-tracking XHR interceptor');\n}\n\ninterface WorkerMessage {\n  type: 'init' | 'convert' | 'destroy' | 'getPageCount' | 'renderPreviews' | 'renderSinglePage' | 'renderPageViaConvert' | 'getDocumentInfo' | 'getLokInfo' | 'editText' | 'renderPageRectangles' | 'testLokOperations' | 'openDocument' | 'editorOperation' | 'closeDocument';\n  id: number;\n  // Explicit WASM file paths (required for init)\n  sofficeJs?: string;\n  sofficeWasm?: string;\n  sofficeData?: string;\n  sofficeWorkerJs?: string;\n  verbose?: boolean;\n  inputData?: Uint8Array;\n  inputExt?: string;\n  outputFormat?: string;\n  filterOptions?: string;\n  password?: string;\n  maxWidth?: number;\n  pageIndex?: number; // For renderSinglePage / renderPageViaConvert\n  // Text editing parameters\n  findText?: string;      // Text to find for replacement\n  replaceText?: string;   // Text to replace with\n  insertText?: string;    // Text to insert at cursor\n  // LOK operations testing\n  operations?: string[];  // List of operations to test\n  // Editor session parameters\n  sessionId?: string;\n  editorMethod?: string;\n  editorArgs?: unknown[];\n}\n\ninterface PagePreview {\n  page: number;\n  data: Uint8Array;\n  width: number;\n  height: number;\n}\n\ninterface DocumentInfo {\n  documentType: number;\n  documentTypeName: string;\n  validOutputFormats: string[];\n  pageCount: number;\n}\n\ninterface PartInfo {\n  visible: string;\n  selected: string;\n  masterPageCount?: string;\n  mode: string;\n}\n\ninterface A11yFocusedParagraph {\n  content: string;\n  position: string;\n  start: string;\n  end: string;\n}\n\ninterface LokInfo {\n  pageRectangles: string | null;\n  documentSize: { width: number; height: number };\n  partInfo: PartInfo | null;\n  a11yFocusedParagraph: A11yFocusedParagraph | null;\n  a11yCaretPosition: number;\n  editMode: number;\n  allText: string | null;\n}\n\ninterface EditResult {\n  success: boolean;\n  editMode: number;\n  message: string;\n  modifiedDocument?: Uint8Array;  // The modified document as a new file\n}\n\ninterface PageRectangle {\n  index: number;\n  x: number;      // X position in twips\n  y: number;      // Y position in twips\n  width: number;  // Width in twips\n  height: number; // Height in twips\n  imageData: Uint8Array;  // RGBA pixel data\n  imageWidth: number;     // Rendered width in pixels\n  imageHeight: number;    // Rendered height in pixels\n}\n\ninterface LokOperationResult {\n  operation: string;\n  success: boolean;\n  result?: unknown;\n  error?: string;\n}\n\ninterface TestLokOperationsResult {\n  operations: LokOperationResult[];\n  summary: string;\n}\n\n// Editor session info returned from openDocument\ninterface EditorSessionInfo {\n  sessionId: string;\n  documentType: 'writer' | 'calc' | 'impress' | 'draw';\n  pageCount: number;\n}\n\n\ninterface WorkerResponse {\n  type: 'ready' | 'progress' | 'result' | 'error' | 'pageCount' | 'previews' | 'singlePagePreview' | 'documentInfo' | 'lokInfo' | 'editResult' | 'pageRectangles' | 'testLokOperations' | 'editorSession' | 'editorOperationResult' | 'documentClosed';\n  id: number;\n  data?: Uint8Array;\n  error?: string;\n  progress?: { percent: number; message: string };\n  pageCount?: number;\n  previews?: PagePreview[];\n  preview?: PagePreview; // Single page preview\n  documentInfo?: DocumentInfo;\n  lokInfo?: LokInfo;\n  editResult?: EditResult;\n  pageRectangles?: PageRectangle[];\n  testLokOperationsResult?: TestLokOperationsResult;\n  editorSession?: EditorSessionInfo;\n  editorOperationResult?: EditorOperationResult;\n}\n\n/** Web Worker global scope with Module property */\n/** Extended EmscriptenModule with pthread worker config */\ninterface EmscriptenModuleConfig extends Partial<EmscriptenModule> {\n  mainScriptUrlOrBlob?: string;\n}\n\ninterface WorkerGlobalScopeWithModule {\n  Module?: EmscriptenModuleConfig;\n  XMLHttpRequest: typeof XMLHttpRequest;\n  fetch: typeof fetch;\n  postMessage: (message: unknown, transfer?: Transferable[]) => void;\n  onmessage: ((event: MessageEvent) => void) | null;\n  close: () => void;\n}\n\n// eslint-disable-next-line @typescript-eslint/no-explicit-any\ndeclare const self: WorkerGlobalScopeWithModule & Record<string, any>;\ndeclare function importScripts(...urls: string[]): void;\n\nlet module: EmscriptenModule | null = null;\nlet lokBindings: LOKBindings | null = null;\nlet converter: LibreOfficeConverter | null = null;\nlet initialized = false;\n\n// Document cache for efficient multi-page rendering\nlet cachedDoc: {\n  docPtr: number;\n  inputHash: string;\n  filePath: string;\n  pageCount: number;  // Cache page count since getting it requires a view\n} | null = null;\n\n// Editor session storage - keeps documents open for editing\ninterface EditorSession {\n  sessionId: string;\n  docPtr: number;\n  filePath: string;\n  editor: OfficeEditor;\n  documentType: 'writer' | 'calc' | 'impress' | 'draw';\n}\n\nconst editorSessions = new Map<string, EditorSession>();\nlet sessionCounter = 0;\n\n// Simple hash function for input data\nfunction hashInput(data: Uint8Array): string {\n  let hash = 0;\n  const step = Math.max(1, Math.floor(data.length / 1000)); // Sample ~1000 bytes\n  for (let i = 0; i < data.length; i += step) {\n    const byte = data[i];\n    if (byte !== undefined) {\n      hash = ((hash << 5) - hash + byte) | 0;\n    }\n  }\n  return `${hash}_${data.length}`;\n}\n\n// Get page count for a document, handling different document types correctly\nfunction getDocumentPageCount(docPtr: number): number {\n  const docType = lokBindings!.documentGetDocumentType(docPtr);\n\n  // For Text Documents (type 0), getParts returns 0 or 1 (representing \"parts\" not pages)\n  // We need to use getPartPageRectangles to get actual page count\n  if (docType === 0) { // TEXT document\n    const pageRectsStr = lokBindings!.getPartPageRectangles(docPtr);\n    if (pageRectsStr) {\n      const pageRects = lokBindings!.parsePageRectangles(pageRectsStr);\n      console.log(`[Worker] getDocumentPageCount: TEXT doc has ${pageRects.length} pages from rectangles`);\n      return pageRects.length;\n    }\n    // Fallback: if no page rectangles, assume at least 1 page\n    console.log(`[Worker] getDocumentPageCount: TEXT doc has no page rectangles, assuming 1 page`);\n    return 1;\n  }\n\n  // For Presentations, Drawings, Spreadsheets - getParts returns slide/page/sheet count\n  const parts = lokBindings!.documentGetParts(docPtr);\n  console.log(`[Worker] getDocumentPageCount: docType=${docType} has ${parts} parts`);\n  return parts;\n}\n\n// Get or load a document (reuses cached document if same input)\nfunction getOrLoadDocument(inputData: Uint8Array, inputExt: string): { docPtr: number; pageCount: number } {\n  const inputHash = hashInput(inputData);\n\n  // Check if we already have this document loaded\n  if (cachedDoc && cachedDoc.inputHash === inputHash && lokBindings) {\n    console.log(`[Worker] getOrLoadDocument: reusing cached doc ptr=${cachedDoc.docPtr}, pageCount=${cachedDoc.pageCount}`);\n    return { docPtr: cachedDoc.docPtr, pageCount: cachedDoc.pageCount };\n  }\n\n  // Close previous document if any\n  console.log(`[Worker] getOrLoadDocument: loading new document (hash=${inputHash})`);\n  closeCachedDocument();\n\n  // Load new document\n  const filePath = `/tmp/input/cached_doc.${inputExt || 'docx'}`;\n  module!.FS.writeFile(filePath, inputData);\n  const docPtr = lokBindings!.documentLoad(filePath);\n\n  if (docPtr === 0) {\n    const error = lokBindings!.getError();\n    throw new Error(error || 'Failed to load document');\n  }\n\n  const pageCount = getDocumentPageCount(docPtr);\n  console.log(`[Worker] getOrLoadDocument: loaded doc ptr=${docPtr}, pageCount=${pageCount}`);\n\n  // Cache the document with page count (page count requires a view to calculate correctly,\n  // so we cache it here when the document is first loaded)\n  cachedDoc = { docPtr, inputHash, filePath, pageCount };\n\n  return { docPtr, pageCount };\n}\n\n// Close cached document\nfunction closeCachedDocument() {\n  if (cachedDoc && lokBindings && module) {\n    console.log(`[Worker] closeCachedDocument: closing cached doc ptr=${cachedDoc.docPtr}`);\n    try { lokBindings.documentDestroy(cachedDoc.docPtr); } catch { /* ignore */ }\n    try { module.FS.unlink(cachedDoc.filePath); } catch { /* ignore */ }\n    cachedDoc = null;\n  }\n}\n\nfunction postResponse(response: WorkerResponse) {\n  if (response.data) {\n    // Transfer the ArrayBuffer for efficiency\n    self.postMessage(response, [response.data.buffer]);\n  } else {\n    self.postMessage(response);\n  }\n}\n\nfunction postProgress(id: number, percent: number, message: string) {\n  postResponse({ type: 'progress', id, progress: { percent, message } });\n}\n\nasync function handleInit(msg: WorkerMessage) {\n  if (initialized) {\n    postResponse({ type: 'ready', id: msg.id });\n    return;\n  }\n\n  // Require explicit paths\n  const { sofficeJs, sofficeWasm, sofficeData, sofficeWorkerJs } = msg;\n  if (!sofficeJs || !sofficeWasm || !sofficeData || !sofficeWorkerJs) {\n    postResponse({ type: 'error', id: msg.id, error: 'Missing required WASM paths (sofficeJs, sofficeWasm, sofficeData, sofficeWorkerJs)' });\n    return;\n  }\n\n  const verbose = msg.verbose || false;\n\n  // Store request ID for progress emission\n  currentInitRequestId = msg.id;\n\n  // Reset progress tracking for fresh initialization\n  for (const phase of Object.keys(phaseProgress) as WasmLoadPhase[]) {\n    phaseProgress[phase] = 0;\n  }\n  lastEmittedPercent = 0;\n\n  // Install XHR interceptor BEFORE any Emscripten code loads\n  // This intercepts soffice.wasm and soffice.data downloads\n  installProgressInterceptors();\n\n  // Emit initial progress\n  emitPhaseProgress('download-wasm', 'Preparing to download WebAssembly...');\n\n  try {\n    // Configure global Module for Emscripten\n    console.log('[Worker] Setting up Module with explicit paths:', { sofficeJs, sofficeWasm, sofficeData, sofficeWorkerJs });\n    self.Module = {\n      // Tell pthread workers where to load the main module from\n      mainScriptUrlOrBlob: sofficeJs,\n      locateFile: (path: string, _scriptDir?: string) => {\n        let result: string;\n        if (path.endsWith('.wasm')) result = sofficeWasm;\n        else if (path.endsWith('.data')) result = sofficeData;\n        // Handle both .worker.js and .worker.cjs requests\n        else if (path.includes('.worker.')) result = sofficeWorkerJs;\n        else {\n          // Fallback: derive from sofficeJs path for any other files\n          const baseUrl = sofficeJs.substring(0, sofficeJs.lastIndexOf('/') + 1);\n          result = `${baseUrl}${path}`;\n        }\n        console.log('[Worker] locateFile called:', path, 'scriptDir:', _scriptDir, '-> result:', result);\n        return result;\n      },\n      // Always print LibreOffice output to console for debugging\n      print: console.log,\n      printErr: console.error,\n    };\n\n    // Load the soffice.js script using importScripts\n    // This triggers the .wasm download (tracked by XHR interceptor)\n    importScripts(sofficeJs);\n\n    // Wait for runtime to be ready\n    // .data file download and WebAssembly compilation happen here\n    emitPhaseProgress('compile', 'Compiling WebAssembly module...');\n\n    await new Promise<void>((resolve, reject) => {\n      const checkReady = () => {\n        if (self.Module && self.Module.calledRun) {\n          resolve();\n        } else if (self.Module?.onRuntimeInitialized) {\n          // Already has a callback, chain it\n          const orig = self.Module.onRuntimeInitialized;\n          self.Module.onRuntimeInitialized = () => {\n            orig?.();\n            resolve();\n          };\n        } else if (self.Module) {\n          self.Module.onRuntimeInitialized = resolve;\n        }\n\n        // Timeout\n        setTimeout(() => reject(new Error('WASM initialization timeout')), 120000);\n      };\n\n      // Check if already ready\n      if (self.Module && self.Module.calledRun) {\n        resolve();\n      } else {\n        checkReady();\n      }\n    });\n\n    module = self.Module as EmscriptenModule;\n    emitPhaseProgress('filesystem', 'Setting up filesystem...');\n\n    // Set SAL_LOG environment variable for LibreOffice logging\n    // Must be done before LOK initialization\n    // Options: +ALL (everything), +lok (LibreOfficeKit), +vcl (rendering), +lok.shim (our shims)\n    try {\n      const mod = module as unknown as { ENV?: Record<string, string> };\n      if (mod.ENV) {\n        mod.ENV['SAL_LOG'] = '+ALL';\n        mod.ENV['MAX_CONCURRENCY'] = '1';\n        console.log('[Worker] Set SAL_LOG to +ALL');\n      } else {\n        console.log('[Worker] ENV not available');\n      }\n    } catch (e) {\n      console.log('[Worker] Could not set SAL_LOG:', e);\n    }\n\n    // Setup filesystem\n    const fs = module.FS;\n\n    // Add FS tracking for debugging (sends logs to main thread)\n    if (verbose) {\n      const originalOpen = fs.open.bind(fs);\n      fs.open = (path: string, flags: unknown, mode?: unknown) => {\n        console.log('[FS OPEN CALL]', path);\n        try {\n          return originalOpen(path, flags, mode);\n        } catch (err: unknown) {\n          const error = err as { code?: string };\n          if (error?.code === 'ENOENT') {\n            console.log('[FS ENOENT]', path);\n          }\n          throw err;\n        }\n      };\n    }\n    try { fs.mkdir('/tmp'); } catch { /* exists */ }\n    try { fs.mkdir('/tmp/input'); } catch { /* exists */ }\n    try { fs.mkdir('/tmp/output'); } catch { /* exists */ }\n\n    emitPhaseProgress('lok-init', 'Initializing LibreOfficeKit...');\n\n    // Initialize LibreOfficeConverter with the pre-loaded module\n    // This reuses the same LOK initialization logic as the Node.js converter\n    converter = new LibreOfficeConverter({ verbose });\n    await converter.initializeWithModule(module);\n\n    // Get LOK bindings from converter for direct access (needed for browser-specific features)\n    lokBindings = converter.getLokBindings();\n\n    if (!lokBindings) {\n      throw new Error('Failed to get LOK bindings from converter');\n    }\n\n    // Enable synchronous event dispatch (Unipoll mode) globally\n    // Without this, postKeyEvent/postMouseEvent events are queued but never processed\n    lokBindings.enableSyncEvents();\n    console.log('[LOK Worker] Enabled synchronous event dispatch (Unipoll mode)');\n\n    initialized = true;\n    emitPhaseProgress('ready', 'Ready');\n    postResponse({ type: 'ready', id: msg.id });\n\n  } catch (error) {\n    postResponse({\n      type: 'error',\n      id: msg.id,\n      error: error instanceof Error ? error.message : String(error)\n    });\n  }\n}\n\n// Image formats that need multi-page handling\nconst IMAGE_FORMATS = ['png', 'jpg', 'jpeg', 'svg'];\n\nfunction handleConvert(msg: WorkerMessage) {\n  if (!initialized || !module || !lokBindings) {\n    postResponse({ type: 'error', id: msg.id, error: 'Worker not initialized' });\n    return;\n  }\n\n  const { inputData, inputExt, outputFormat, filterOptions, password } = msg;\n\n  if (!inputData || !outputFormat) {\n    postResponse({ type: 'error', id: msg.id, error: 'Missing input data or output format' });\n    return;\n  }\n\n  // Check if this is an image format that might need multi-page export\n  const isImageFormat = IMAGE_FORMATS.includes(outputFormat.toLowerCase());\n\n  const inPath = `/tmp/input/doc.${inputExt || 'docx'}`;\n  const outPath = `/tmp/output/doc.${outputFormat}`;\n  let docPtr = 0;\n  const outputFiles: string[] = []; // Track files to clean up\n\n  try {\n    postProgress(msg.id, 10, 'Writing input file...');\n    module.FS.writeFile(inPath, inputData);\n\n    postProgress(msg.id, 30, 'Loading document...');\n    if (password) {\n      docPtr = lokBindings.documentLoadWithOptions(inPath, `,Password=${password}`);\n    } else {\n      docPtr = lokBindings.documentLoad(inPath);\n    }\n\n    if (docPtr === 0) {\n      const error = lokBindings.getError();\n      throw new Error(error || 'Failed to load document');\n    }\n\n    // Get page count for multi-page image export\n    const pageCount = lokBindings.documentGetParts(docPtr);\n    const docType = lokBindings.documentGetDocumentType(docPtr);\n\n    // For image formats with multiple pages, export each page separately and zip\n    if (isImageFormat && pageCount > 1) {\n      postProgress(msg.id, 40, `Exporting ${pageCount} pages as ${outputFormat.toUpperCase()}...`);\n\n      const lokFormat = OUTPUT_FORMAT_TO_LOK[outputFormat as keyof typeof OUTPUT_FORMAT_TO_LOK];\n      const baseOpts = filterOptions || FORMAT_FILTER_OPTIONS[outputFormat as keyof typeof FORMAT_FILTER_OPTIONS] || '';\n\n      // Export each page\n      const pageFiles: Array<{ name: string; data: Uint8Array }> = [];\n\n      // Get document size for calculating export dimensions (for image formats)\n      const { width: docWidth, height: docHeight } = lokBindings.documentGetDocumentSize(docPtr);\n      const aspectRatio = docHeight / docWidth;\n      const exportWidth = 1024; // High quality export\n      const exportHeight = Math.round(exportWidth * aspectRatio);\n\n      for (let i = 0; i < pageCount; i++) {\n        const progress = 40 + Math.round((i / pageCount) * 40);\n        postProgress(msg.id, progress, `Exporting page ${i + 1}/${pageCount}...`);\n\n        const pageOutPath = `/tmp/output/page_${i + 1}.${outputFormat}`;\n        outputFiles.push(pageOutPath);\n\n        // For presentations/drawings, we need to set the part AND use PixelWidth/PixelHeight\n        // for PNG/JPG export to work correctly (same approach as handleRenderPageViaConvert)\n        if (docType === 2 || docType === 3) { // PRESENTATION or DRAWING\n          lokBindings.documentSetPart(docPtr, i);\n\n          // For image formats, include pixel dimensions in filter options\n          let pageOpts = baseOpts;\n          if (outputFormat === 'png' || outputFormat === 'jpg' || outputFormat === 'jpeg') {\n            pageOpts = `PixelWidth=${exportWidth};PixelHeight=${exportHeight}`;\n            if (baseOpts) pageOpts = `${baseOpts};${pageOpts}`;\n          }\n\n          lokBindings.documentSaveAs(docPtr, pageOutPath, lokFormat, pageOpts);\n          console.log(`[Worker] Page ${i + 1} (presentation) exported with opts: ${pageOpts}`);\n        } else {\n          // For text documents, use PageRange filter option (1-indexed)\n          let pageOpts = `PageRange=${i + 1}-${i + 1}`;\n\n          // For image formats, also include pixel dimensions\n          if (outputFormat === 'png' || outputFormat === 'jpg' || outputFormat === 'jpeg') {\n            pageOpts += `;PixelWidth=${exportWidth};PixelHeight=${exportHeight}`;\n          }\n\n          if (baseOpts) pageOpts = `${baseOpts};${pageOpts}`;\n\n          lokBindings.documentSaveAs(docPtr, pageOutPath, lokFormat, pageOpts);\n          console.log(`[Worker] Page ${i + 1} (text) exported with opts: ${pageOpts}`);\n        }\n\n        const pageData = module.FS.readFile(pageOutPath) as Uint8Array;\n        console.log(`[Worker] Page ${i + 1} exported: ${pageData.length} bytes`);\n\n        if (pageData.length > 0) {\n          const pageCopy = new Uint8Array(pageData.length);\n          pageCopy.set(pageData);\n          pageFiles.push({ name: `page_${i + 1}.${outputFormat}`, data: pageCopy });\n        } else {\n          console.warn(`[Worker] Page ${i + 1} export produced empty file`);\n        }\n      }\n\n      postProgress(msg.id, 85, 'Creating ZIP archive...');\n\n      // Create a simple ZIP file (no compression for images)\n      const zipData = createSimpleZip(pageFiles);\n\n      postProgress(msg.id, 100, 'Complete');\n      postResponse({ type: 'result', id: msg.id, data: zipData });\n\n    } else {\n      // Single page or non-image format: standard export\n      postProgress(msg.id, 50, 'Converting...');\n\n      const lokFormat = OUTPUT_FORMAT_TO_LOK[outputFormat as keyof typeof OUTPUT_FORMAT_TO_LOK];\n      const opts = filterOptions || FORMAT_FILTER_OPTIONS[outputFormat as keyof typeof FORMAT_FILTER_OPTIONS] || '';\n\n      postProgress(msg.id, 70, 'Saving...');\n      lokBindings.documentSaveAs(docPtr, outPath, lokFormat, opts);\n      outputFiles.push(outPath);\n\n      postProgress(msg.id, 90, 'Reading output...');\n      const sharedResult = module.FS.readFile(outPath) as Uint8Array;\n\n      if (sharedResult.length === 0) {\n        throw new Error('Conversion produced empty output');\n      }\n\n      // Copy from SharedArrayBuffer to regular ArrayBuffer for transfer\n      const result = new Uint8Array(sharedResult.length);\n      result.set(sharedResult);\n\n      postProgress(msg.id, 100, 'Complete');\n      postResponse({ type: 'result', id: msg.id, data: result });\n    }\n\n  } catch (error) {\n    postResponse({\n      type: 'error',\n      id: msg.id,\n      error: error instanceof Error ? error.message : String(error)\n    });\n  } finally {\n    // Cleanup\n    if (docPtr !== 0) {\n      try { lokBindings.documentDestroy(docPtr); } catch { /* ignore */ }\n    }\n    try { module.FS.unlink(inPath); } catch { /* ignore */ }\n    for (const path of outputFiles) {\n      try { module.FS.unlink(path); } catch { /* ignore */ }\n    }\n  }\n}\n\n/**\n * Create a simple ZIP file from an array of files\n * This is a minimal ZIP implementation without compression (STORE method)\n */\nfunction createSimpleZip(files: Array<{ name: string; data: Uint8Array }>): Uint8Array {\n  const chunks: Uint8Array[] = [];\n  const centralDirectory: Uint8Array[] = [];\n  let offset = 0;\n\n  for (const file of files) {\n    const nameBytes = new TextEncoder().encode(file.name);\n\n    // Local file header\n    const localHeader = new Uint8Array(30 + nameBytes.length);\n    const view = new DataView(localHeader.buffer);\n\n    view.setUint32(0, 0x04034b50, true);  // Local file header signature\n    view.setUint16(4, 20, true);           // Version needed\n    view.setUint16(6, 0, true);            // General purpose flags\n    view.setUint16(8, 0, true);            // Compression method (STORE)\n    view.setUint16(10, 0, true);           // Mod time\n    view.setUint16(12, 0, true);           // Mod date\n    view.setUint32(14, crc32(file.data), true); // CRC-32\n    view.setUint32(18, file.data.length, true); // Compressed size\n    view.setUint32(22, file.data.length, true); // Uncompressed size\n    view.setUint16(26, nameBytes.length, true); // File name length\n    view.setUint16(28, 0, true);           // Extra field length\n    localHeader.set(nameBytes, 30);\n\n    chunks.push(localHeader);\n    chunks.push(file.data);\n\n    // Central directory entry\n    const cdEntry = new Uint8Array(46 + nameBytes.length);\n    const cdView = new DataView(cdEntry.buffer);\n\n    cdView.setUint32(0, 0x02014b50, true);  // Central directory signature\n    cdView.setUint16(4, 20, true);           // Version made by\n    cdView.setUint16(6, 20, true);           // Version needed\n    cdView.setUint16(8, 0, true);            // General purpose flags\n    cdView.setUint16(10, 0, true);           // Compression method\n    cdView.setUint16(12, 0, true);           // Mod time\n    cdView.setUint16(14, 0, true);           // Mod date\n    cdView.setUint32(16, crc32(file.data), true); // CRC-32\n    cdView.setUint32(20, file.data.length, true); // Compressed size\n    cdView.setUint32(24, file.data.length, true); // Uncompressed size\n    cdView.setUint16(28, nameBytes.length, true); // File name length\n    cdView.setUint16(30, 0, true);           // Extra field length\n    cdView.setUint16(32, 0, true);           // Comment length\n    cdView.setUint16(34, 0, true);           // Disk number start\n    cdView.setUint16(36, 0, true);           // Internal attributes\n    cdView.setUint32(38, 0, true);           // External attributes\n    cdView.setUint32(42, offset, true);      // Offset of local header\n    cdEntry.set(nameBytes, 46);\n\n    centralDirectory.push(cdEntry);\n    offset += localHeader.length + file.data.length;\n  }\n\n  const cdOffset = offset;\n  let cdSize = 0;\n  for (const entry of centralDirectory) {\n    chunks.push(entry);\n    cdSize += entry.length;\n  }\n\n  // End of central directory\n  const eocd = new Uint8Array(22);\n  const eocdView = new DataView(eocd.buffer);\n  eocdView.setUint32(0, 0x06054b50, true);  // EOCD signature\n  eocdView.setUint16(4, 0, true);            // Disk number\n  eocdView.setUint16(6, 0, true);            // Disk with CD\n  eocdView.setUint16(8, files.length, true); // Entries on this disk\n  eocdView.setUint16(10, files.length, true);// Total entries\n  eocdView.setUint32(12, cdSize, true);      // CD size\n  eocdView.setUint32(16, cdOffset, true);    // CD offset\n  eocdView.setUint16(20, 0, true);           // Comment length\n\n  chunks.push(eocd);\n\n  // Combine all chunks\n  const totalSize = chunks.reduce((sum, chunk) => sum + chunk.length, 0);\n  const result = new Uint8Array(totalSize);\n  let pos = 0;\n  for (const chunk of chunks) {\n    result.set(chunk, pos);\n    pos += chunk.length;\n  }\n\n  return result;\n}\n\n/**\n * CRC-32 calculation for ZIP files\n */\nfunction crc32(data: Uint8Array): number {\n  let crc = 0xFFFFFFFF;\n  for (let i = 0; i < data.length; i++) {\n    const byte = data[i]!;\n    crc ^= byte;\n    for (let j = 0; j < 8; j++) {\n      crc = (crc >>> 1) ^ (crc & 1 ? 0xEDB88320 : 0);\n    }\n  }\n  return (crc ^ 0xFFFFFFFF) >>> 0;\n}\n\nasync function handleGetPageCount(msg: WorkerMessage) {\n  if (!initialized || !module || !lokBindings) {\n    postResponse({ type: 'error', id: msg.id, error: 'Worker not initialized' });\n    return;\n  }\n\n  const { inputData, inputExt } = msg;\n\n  if (!inputData) {\n    postResponse({ type: 'error', id: msg.id, error: 'Missing input data' });\n    return;\n  }\n\n  try {\n    // Use cached document\n    const { pageCount } = getOrLoadDocument(inputData, inputExt || 'docx');\n    postResponse({ type: 'pageCount', id: msg.id, pageCount });\n    // Document stays cached\n\n  } catch (error) {\n    postResponse({\n      type: 'error',\n      id: msg.id,\n      error: error instanceof Error ? error.message : String(error)\n    });\n    closeCachedDocument();\n  }\n}\n\nasync function handleRenderPreviews(msg: WorkerMessage) {\n  if (!initialized || !module || !lokBindings) {\n    postResponse({ type: 'error', id: msg.id, error: 'Worker not initialized' });\n    return;\n  }\n\n  const { inputData, inputExt, maxWidth = 256 } = msg;\n\n  if (!inputData) {\n    postResponse({ type: 'error', id: msg.id, error: 'Missing input data' });\n    return;\n  }\n\n  try {\n    postProgress(msg.id, 10, 'Loading document for preview...');\n    \n    // Use cached document\n    const { docPtr, pageCount } = getOrLoadDocument(inputData, inputExt || 'docx');\n    postProgress(msg.id, 20, `Rendering ${pageCount} pages...`);\n\n    const previews: PagePreview[] = [];\n    \n    for (let i = 0; i < pageCount; i++) {\n      const progress = 20 + Math.round((i / pageCount) * 70);\n      postProgress(msg.id, progress, `Rendering page ${i + 1}/${pageCount}...`);\n      \n      // Render the page - let renderPage handle page selection and sizing\n      const rendered = lokBindings.renderPage(docPtr, i, maxWidth);\n      \n      // Copy from SharedArrayBuffer to regular ArrayBuffer\n      const dataCopy = new Uint8Array(rendered.data.length);\n      dataCopy.set(rendered.data);\n      \n      previews.push({\n        page: i + 1,\n        data: dataCopy,\n        width: rendered.width,\n        height: rendered.height\n      });\n    }\n\n    postProgress(msg.id, 100, 'Preview complete');\n    \n    // Transfer all preview buffers\n    const transfers = previews.map(p => p.data.buffer);\n    self.postMessage({ type: 'previews', id: msg.id, previews }, transfers);\n    // Document stays cached\n\n  } catch (error) {\n    postResponse({\n      type: 'error',\n      id: msg.id,\n      error: error instanceof Error ? error.message : String(error)\n    });\n    closeCachedDocument();\n  }\n}\n\n/**\n * Render a single page preview - reuses cached document for efficiency\n */\nasync function handleRenderSinglePage(msg: WorkerMessage) {\n  if (!initialized || !module || !lokBindings) {\n    postResponse({ type: 'error', id: msg.id, error: 'Worker not initialized' });\n    return;\n  }\n\n  const { inputData, inputExt, maxWidth = 256, pageIndex = 0 } = msg;\n\n  if (!inputData) {\n    postResponse({ type: 'error', id: msg.id, error: 'Missing input data' });\n    return;\n  }\n\n  let viewId = -1;\n  let docPtr = 0;\n\n  try {\n    // Get or reuse cached document\n    const result = getOrLoadDocument(inputData, inputExt || 'docx');\n    docPtr = result.docPtr;\n    const pageCount = result.pageCount;\n\n    if (pageIndex < 0 || pageIndex >= pageCount) {\n      throw new Error(`Page index ${pageIndex} out of range (0-${pageCount - 1})`);\n    }\n\n    // Create a view before rendering for all document types.\n    // Without a view, LOK returns empty page rectangles and incorrect document sizes,\n    // causing paintTile to crash with \"memory access out of bounds\".\n    // The warning \"No Frame-Controller created\" indicates no view exists.\n    const docType = lokBindings.documentGetDocumentType(docPtr);\n    const docTypeNames = ['TEXT', 'SPREADSHEET', 'PRESENTATION', 'DRAWING'];\n    console.log(`[Worker] handleRenderSinglePage: ${docTypeNames[docType] || 'UNKNOWN'} document - creating view for rendering`);\n    viewId = lokBindings.createView(docPtr);\n    if (viewId >= 0) {\n      lokBindings.setView(docPtr, viewId);\n      console.log(`[Worker] handleRenderSinglePage: Created and set view ${viewId}`);\n    }\n\n    // Render the page - let renderPage handle page-specific sizing\n    // We just pass maxWidth and let it calculate the correct height based on the page's aspect ratio\n    console.log(`[Worker] handleRenderSinglePage: calling renderPage for page ${pageIndex} at maxWidth=${maxWidth}...`);\n    const rendered = lokBindings.renderPage(docPtr, pageIndex, maxWidth);\n    console.log(`[Worker] handleRenderSinglePage: renderPage returned ${rendered.data.length} bytes (${rendered.width}x${rendered.height})`);\n    \n    // Copy from SharedArrayBuffer to regular ArrayBuffer\n    const dataCopy = new Uint8Array(rendered.data.length);\n    dataCopy.set(rendered.data);\n    \n    const preview: PagePreview = {\n      page: pageIndex + 1,\n      data: dataCopy,\n      width: rendered.width,\n      height: rendered.height\n    };\n\n    // Cleanup view if we created one (for Drawing documents)\n    if (viewId >= 0 && docPtr !== 0) {\n      try { lokBindings.destroyView(docPtr, viewId); } catch { /* ignore */ }\n      console.log(`[Worker] handleRenderSinglePage: Destroyed view ${viewId}`);\n    }\n\n    // Transfer the buffer\n    self.postMessage({ type: 'singlePagePreview', id: msg.id, preview }, [dataCopy.buffer]);\n\n  } catch (error) {\n    // Cleanup view if we created one (for Drawing documents)\n    if (viewId >= 0 && docPtr !== 0) {\n      try { lokBindings.destroyView(docPtr, viewId); } catch { /* ignore */ }\n      console.log(`[Worker] handleRenderSinglePage: Destroyed view ${viewId} (on error)`);\n    }\n\n    // Convert error message to a regular string (not SharedArrayBuffer-backed)\n    const errorMsg = error instanceof Error ? String(error.message) : String(error);\n    postResponse({\n      type: 'error',\n      id: msg.id,\n      error: errorMsg\n    });\n    // On error, close the cached document to allow retry\n    closeCachedDocument();\n  }\n  // Note: We don't close the document here - it stays cached for subsequent page renders\n}\n\n/**\n * Render a page preview by converting to PNG - fallback for Chrome/Edge\n * This uses the saveAs conversion path instead of paintTile which hangs in Chromium\n */\nasync function handleRenderPageViaConvert(msg: WorkerMessage) {\n  if (!initialized || !module || !lokBindings) {\n    postResponse({ type: 'error', id: msg.id, error: 'Worker not initialized' });\n    return;\n  }\n\n  const { inputData, inputExt, maxWidth = 256, pageIndex = 0 } = msg;\n\n  if (!inputData) {\n    postResponse({ type: 'error', id: msg.id, error: 'Missing input data' });\n    return;\n  }\n\n  const outPath = `/tmp/output/page_${pageIndex}.png`;\n\n  try {\n    // Use cached document\n    const { docPtr, pageCount } = getOrLoadDocument(inputData, inputExt || 'pdf');\n\n    // Get document type to determine how to handle page selection\n    const docType = lokBindings.documentGetDocumentType(docPtr);\n    \n    if (pageIndex < 0 || pageIndex >= pageCount) {\n      throw new Error(`Page index ${pageIndex} out of range (0-${pageCount - 1})`);\n    }\n\n    // For presentations/drawings, setPart works for page selection\n    // For text documents, we need to use PageRange filter option\n    if (docType === 2 || docType === 3) { // PRESENTATION or DRAWING\n      lokBindings.documentSetPart(docPtr, pageIndex);\n    }\n\n    // Get document size to calculate aspect ratio\n    const { width: docWidth, height: docHeight } = lokBindings.documentGetDocumentSize(docPtr);\n    const aspectRatio = docHeight / docWidth;\n    const outputWidth = Math.min(maxWidth, docWidth);\n    const outputHeight = Math.round(outputWidth * aspectRatio);\n\n    // Build filter options\n    // For Writer documents, use PageRange to export specific page (1-indexed)\n    // For presentations/drawings, the part is already set\n    let filterOpts = `PixelWidth=${outputWidth};PixelHeight=${outputHeight}`;\n    if (docType === 0) { // TEXT document\n      filterOpts += `;PageRange=${pageIndex + 1}-${pageIndex + 1}`;\n    }\n    \n    lokBindings.documentSaveAs(docPtr, outPath, 'png', filterOpts);\n\n    // Read the PNG file\n    const pngData = module.FS.readFile(outPath) as Uint8Array;\n    \n    if (pngData.length === 0) {\n      throw new Error('PNG export produced empty output');\n    }\n\n    // Copy from SharedArrayBuffer\n    const pngCopy = new Uint8Array(pngData.length);\n    pngCopy.set(pngData);\n\n    // Send as a special PNG preview (not RGBA like paintTile)\n    const preview = {\n      page: pageIndex + 1,\n      data: pngCopy,\n      width: outputWidth,\n      height: outputHeight,\n      format: 'png' as const\n    };\n\n    self.postMessage({ type: 'singlePagePreview', id: msg.id, preview, isPng: true }, [pngCopy.buffer]);\n    // Document stays cached\n\n    // Clean up output file only\n    try { module.FS.unlink(outPath); } catch { /* ignore */ }\n\n  } catch (error) {\n    postResponse({\n      type: 'error',\n      id: msg.id,\n      error: error instanceof Error ? error.message : String(error)\n    });\n    closeCachedDocument();\n    try { module.FS.unlink(outPath); } catch { /* ignore */ }\n  }\n}\n\nasync function handleGetDocumentInfo(msg: WorkerMessage) {\n  if (!initialized || !module || !lokBindings) {\n    postResponse({ type: 'error', id: msg.id, error: 'Worker not initialized' });\n    return;\n  }\n\n  const { inputData, inputExt } = msg;\n\n  if (!inputData) {\n    postResponse({ type: 'error', id: msg.id, error: 'Missing input data' });\n    return;\n  }\n\n  try {\n    // Use cached document - this will load it if not already loaded\n    const { docPtr, pageCount } = getOrLoadDocument(inputData, inputExt || 'docx');\n\n    const docType = lokBindings.documentGetDocumentType(docPtr);\n\n    // Map document type to valid output formats (based on LibreOffice capabilities)\n    const docTypeOutputFormats: Record<number, string[]> = {\n      0: ['pdf', 'docx', 'doc', 'odt', 'rtf', 'txt', 'html', 'png', 'jpg', 'svg'], // TEXT\n      1: ['pdf', 'xlsx', 'xls', 'ods', 'csv', 'html', 'png', 'jpg', 'svg'],        // SPREADSHEET\n      2: ['pdf', 'pptx', 'ppt', 'odp', 'png', 'jpg', 'svg', 'html'],              // PRESENTATION\n      3: ['pdf', 'png', 'jpg', 'svg', 'html'],                                     // DRAWING\n      4: ['pdf'],                                                                   // OTHER\n    };\n\n    const docTypeNames: Record<number, string> = {\n      0: 'Text Document',\n      1: 'Spreadsheet',\n      2: 'Presentation',\n      3: 'Drawing',\n      4: 'Other',\n    };\n\n    const documentInfo: DocumentInfo = {\n      documentType: docType,\n      documentTypeName: docTypeNames[docType] || 'Unknown',\n      validOutputFormats: docTypeOutputFormats[docType] || ['pdf'],\n      pageCount,\n    };\n\n    postResponse({ type: 'documentInfo', id: msg.id, documentInfo });\n    // Note: Document stays cached for subsequent operations\n\n  } catch (error) {\n    postResponse({\n      type: 'error',\n      id: msg.id,\n      error: error instanceof Error ? error.message : String(error)\n    });\n    // On error, close the cached document to allow retry\n    closeCachedDocument();\n  }\n}\n\n/**\n * Get LOK information about a loaded document - bounding boxes, positions, etc.\n */\nasync function handleGetLokInfo(msg: WorkerMessage) {\n  console.log('[LOK Worker] handleGetLokInfo called');\n  if (!initialized || !module || !lokBindings) {\n    postResponse({ type: 'error', id: msg.id, error: 'Worker not initialized' });\n    return;\n  }\n\n  const { inputData, inputExt } = msg;\n\n  if (!inputData) {\n    postResponse({ type: 'error', id: msg.id, error: 'Missing input data' });\n    return;\n  }\n\n  try {\n    // Use cached document\n    console.log('[LOK Worker] Getting or loading document...');\n    const { docPtr } = getOrLoadDocument(inputData, inputExt || 'docx');\n    console.log(`[LOK Worker] Got docPtr: ${docPtr}`);\n\n    // Get all available LOK read information\n    console.log('[LOK Worker] Calling LOK methods...');\n    const pageRectangles = lokBindings.getPartPageRectangles(docPtr);\n    console.log(`[LOK Worker] pageRectangles: ${pageRectangles}`);\n\n    const documentSize = lokBindings.documentGetDocumentSize(docPtr);\n    console.log(`[LOK Worker] documentSize: ${documentSize.width}x${documentSize.height}`);\n\n    const partInfo = lokBindings.getPartInfo(docPtr, 0);\n    console.log(`[LOK Worker] partInfo: ${partInfo}`);\n\n    const a11yFocusedParagraph = lokBindings.getA11yFocusedParagraph(docPtr);\n    console.log(`[LOK Worker] a11yFocusedParagraph: ${a11yFocusedParagraph}`);\n\n    const a11yCaretPosition = lokBindings.getA11yCaretPosition(docPtr);\n    console.log(`[LOK Worker] a11yCaretPosition: ${a11yCaretPosition}`);\n\n    let editMode = lokBindings.getEditMode(docPtr);\n    console.log(`[LOK Worker] editMode (initial): ${editMode}`);\n\n    // Try to enable edit mode for text extraction\n    let allText: string | null = null;\n    let viewId = -1;\n\n    // 1. Get the existing view created during document load\n    viewId = lokBindings.getView(docPtr);\n    console.log(`[LOK Worker] Got existing view: ${viewId}`);\n\n    // 2. Make it active with setActiveFrame (triggers setActiveFrame internally)\n    if (viewId >= 0) {\n      lokBindings.setView(docPtr, viewId);\n      console.log(`[LOK Worker] Set active view to ${viewId}`);\n    }\n\n    // 3. Now try creating a NEW view (this might work now with active frame set)\n    const newViewId = lokBindings.createView(docPtr);\n    console.log(`[LOK Worker] Created new view: ${newViewId}`);\n\n    if (newViewId >= 0) {\n      lokBindings.setView(docPtr, newViewId);\n      console.log(`[LOK Worker] Switched to new view: ${newViewId}`);\n    }\n\n    // Now enable edit mode\n    lokBindings.setEditMode(docPtr, 1);\n    editMode = lokBindings.getEditMode(docPtr);\n    console.log(`[LOK Worker] editMode (after setEditMode): ${editMode}`);\n\n    // Now try to get all text\n    allText = lokBindings.getAllText(docPtr);\n    console.log(`[LOK Worker] allText: ${allText?.slice(0, 100) || 'null'}`);\n\n    // Cleanup the new view we created\n    if (newViewId >= 0) {\n      lokBindings.destroyView(docPtr, newViewId);\n      console.log(`[LOK Worker] Destroyed view: ${newViewId}`);\n    }\n\n    // Parse JSON strings into objects\n    let parsedPartInfo: PartInfo | null = null;\n    if (partInfo) {\n      try {\n        parsedPartInfo = JSON.parse(partInfo) as PartInfo;\n      } catch {\n        console.warn('[LOK Worker] Failed to parse partInfo JSON:', partInfo);\n      }\n    }\n\n    let parsedA11yParagraph: A11yFocusedParagraph | null = null;\n    if (a11yFocusedParagraph) {\n      try {\n        parsedA11yParagraph = JSON.parse(a11yFocusedParagraph) as A11yFocusedParagraph;\n      } catch {\n        console.warn('[LOK Worker] Failed to parse a11yFocusedParagraph JSON:', a11yFocusedParagraph);\n      }\n    }\n\n    const lokInfo: LokInfo = {\n      pageRectangles,\n      documentSize,\n      partInfo: parsedPartInfo,\n      a11yFocusedParagraph: parsedA11yParagraph,\n      a11yCaretPosition,\n      editMode,\n      allText,\n    };\n\n    console.log('[LOK Worker] Posting lokInfo response');\n    postResponse({ type: 'lokInfo', id: msg.id, lokInfo });\n    // Document stays cached\n\n  } catch (error) {\n    console.error('[LOK Worker] Error in handleGetLokInfo:', error);\n    postResponse({\n      type: 'error',\n      id: msg.id,\n      error: error instanceof Error ? error.message : String(error)\n    });\n    closeCachedDocument();\n  }\n}\n\n/**\n * Handle text editing operations - find/replace or insert text\n */\nasync function handleEditText(msg: WorkerMessage) {\n  console.log('[LOK Worker] handleEditText called');\n  if (!initialized || !module || !lokBindings) {\n    postResponse({ type: 'error', id: msg.id, error: 'Worker not initialized' });\n    return;\n  }\n\n  const { inputData, inputExt, findText, replaceText, insertText } = msg;\n\n  if (!inputData) {\n    postResponse({ type: 'error', id: msg.id, error: 'Missing input data' });\n    return;\n  }\n\n  // Close any cached document since we need a fresh load for editing\n  closeCachedDocument();\n\n  const filePath = `/tmp/input/edit_doc.${inputExt || 'docx'}`;\n  const outputPath = `/tmp/output/edited_doc.${inputExt || 'docx'}`;\n  let docPtr = 0;\n  let viewId = -1;\n\n  try {\n    // Write file and load document\n    console.log('[LOK Worker] Writing input file...');\n    module.FS.writeFile(filePath, inputData);\n\n    console.log('[LOK Worker] Loading document for editing...');\n    docPtr = lokBindings.documentLoad(filePath);\n\n    if (docPtr === 0) {\n      const error = lokBindings.getError();\n      throw new Error(error || 'Failed to load document');\n    }\n    console.log(`[LOK Worker] Document loaded, docPtr=${docPtr}`);\n\n    // Initialize for rendering (required for some operations)\n    lokBindings.documentInitializeForRendering(docPtr);\n    console.log('[LOK Worker] Document initialized for rendering');\n\n    // 1. Get the existing view created during document load\n    viewId = lokBindings.getView(docPtr);\n    console.log(`[LOK Worker] Got existing view: ${viewId}`);\n\n    // 2. Make it active with setActiveFrame (triggers xDesktop->setActiveFrame() in C++)\n    if (viewId >= 0) {\n      lokBindings.setView(docPtr, viewId);\n      console.log(`[LOK Worker] Set active view to ${viewId}`);\n    }\n\n    // 3. Create a NEW view - this helps establish proper editing context\n    const newViewId = lokBindings.createView(docPtr);\n    console.log(`[LOK Worker] Created new view: ${newViewId}`);\n\n    if (newViewId >= 0) {\n      lokBindings.setView(docPtr, newViewId);\n      console.log(`[LOK Worker] Switched to new view: ${newViewId}`);\n      viewId = newViewId; // Track new view for cleanup\n    }\n\n    // Now enable edit mode\n    lokBindings.setEditMode(docPtr, 1);\n    const editMode = lokBindings.getEditMode(docPtr);\n    console.log(`[LOK Worker] Edit mode after setEditMode(1): ${editMode}`);\n\n    let operationResult = '';\n\n    // Perform the requested operation\n    if (findText && replaceText !== undefined) {\n      // Find and replace\n      console.log(`[LOK Worker] Attempting find/replace: \"${findText}\" -> \"${replaceText}\"`);\n\n      // Use .uno:ExecuteSearch for find/replace\n      // Note: Command type should be \"unsigned short\" with string value\n      const searchArgs = JSON.stringify({\n        'SearchItem.SearchString': { type: 'string', value: findText },\n        'SearchItem.ReplaceString': { type: 'string', value: replaceText },\n        'SearchItem.Command': { type: 'unsigned short', value: '3' }, // 3 = Replace All\n      });\n\n      try {\n        lokBindings.postUnoCommand(docPtr, '.uno:ExecuteSearch', searchArgs);\n        operationResult = `Attempted replace all \"${findText}\" with \"${replaceText}\"`;\n        console.log(`[LOK Worker] ${operationResult}`);\n      } catch (searchErr) {\n        console.error(`[LOK Worker] ExecuteSearch threw:`, searchErr);\n        operationResult = `ExecuteSearch failed: ${String(searchErr)}`;\n      }\n    } else if (insertText) {\n      // Insert text at cursor\n      console.log(`[LOK Worker] Attempting to insert text: \"${insertText}\"`);\n      const results: string[] = [];\n\n      // First, click in the document to establish focus (position 1000, 1000 twips)\n      // LOK_MOUSEEVENT_BUTTONDOWN = 0, LOK_MOUSEEVENT_BUTTONUP = 1\n      try {\n        console.log(`[LOK Worker] Clicking in document to establish focus...`);\n        lokBindings.postMouseEvent(docPtr, 0, 1000, 1000, 1, 1, 0); // BUTTONDOWN\n        lokBindings.postMouseEvent(docPtr, 1, 1000, 1000, 1, 1, 0); // BUTTONUP\n        console.log(`[LOK Worker] Posted mouse events for focus`);\n        results.push('mouseEvents:ok');\n      } catch (e) {\n        console.error(`[LOK Worker] postMouseEvent threw:`, e);\n        results.push(`mouseEvents:err`);\n      }\n\n      // Go to end of document\n      try {\n        lokBindings.postUnoCommand(docPtr, '.uno:GoToEndOfDoc');\n        console.log(`[LOK Worker] Posted GoToEndOfDoc`);\n        results.push('GoToEndOfDoc:ok');\n      } catch (e) {\n        console.error(`[LOK Worker] GoToEndOfDoc threw:`, e);\n        results.push(`GoToEndOfDoc:err`);\n      }\n\n      // Approach 1: Try lok_documentPaste directly (bypasses event queue)\n      let pasteResult = false;\n      try {\n        console.log(`[LOK Worker] Trying paste() with text/plain...`);\n        pasteResult = lokBindings.paste(docPtr, 'text/plain;charset=utf-8', insertText);\n        console.log(`[LOK Worker] paste() returned: ${pasteResult}`);\n        results.push(`paste:${pasteResult}`);\n      } catch (e) {\n        console.error(`[LOK Worker] paste() threw:`, e);\n        results.push(`paste:err`);\n      }\n\n      // Approach 2: Try .uno:InsertText\n      try {\n        const insertArgs = JSON.stringify({\n          Text: { type: 'string', value: insertText },\n        });\n        lokBindings.postUnoCommand(docPtr, '.uno:InsertText', insertArgs);\n        console.log(`[LOK Worker] Posted InsertText`);\n        results.push('InsertText:ok');\n      } catch (e) {\n        console.error(`[LOK Worker] InsertText threw:`, e);\n        results.push(`InsertText:err`);\n      }\n\n      // Approach 3: Also try postKeyEvent to type each character\n      // LOK_KEYEVENT_KEYINPUT = 0, LOK_KEYEVENT_KEYUP = 1\n      try {\n        console.log(`[LOK Worker] Now trying postKeyEvent for each character...`);\n        for (let i = 0; i < insertText.length; i++) {\n          const charCode = insertText.charCodeAt(i);\n          lokBindings.postKeyEvent(docPtr, 0, charCode, 0); // KEY_PRESSED\n          lokBindings.postKeyEvent(docPtr, 1, charCode, 0); // KEY_RELEASED\n        }\n        console.log(`[LOK Worker] Posted ${insertText.length} key events`);\n        results.push(`keyEvents:${insertText.length}`);\n      } catch (e) {\n        console.error(`[LOK Worker] postKeyEvent threw:`, e);\n        results.push(`keyEvents:err`);\n      }\n\n      operationResult = `Insert attempts: ${results.join(', ')}`;\n      console.log(`[LOK Worker] ${operationResult}`);\n    } else {\n      operationResult = 'No edit operation specified (need findText+replaceText or insertText)';\n      console.log(`[LOK Worker] ${operationResult}`);\n    }\n\n    // Try to save the document back to a file\n    console.log('[LOK Worker] Attempting to save modified document...');\n\n    // Determine the format for saving\n    const ext = inputExt || 'docx';\n    const formatMap: Record<string, string> = {\n      'docx': 'docx',\n      'doc': 'doc',\n      'odt': 'odt',\n      'xlsx': 'xlsx',\n      'xls': 'xls',\n      'ods': 'ods',\n      'pptx': 'pptx',\n      'ppt': 'ppt',\n      'odp': 'odp',\n    };\n    const saveFormat = formatMap[ext] || ext;\n\n    try {\n      lokBindings.documentSaveAs(docPtr, outputPath, saveFormat, '');\n      console.log('[LOK Worker] Document saved');\n\n      // Read the modified document\n      const modifiedData = module.FS.readFile(outputPath) as Uint8Array;\n      console.log(`[LOK Worker] Modified document size: ${modifiedData.length} bytes`);\n\n      // Copy to regular ArrayBuffer\n      const modifiedCopy = new Uint8Array(modifiedData.length);\n      modifiedCopy.set(modifiedData);\n\n      const editResult: EditResult = {\n        success: true,\n        editMode,\n        message: operationResult + ` | Document saved (${modifiedCopy.length} bytes)`,\n        modifiedDocument: modifiedCopy,\n      };\n\n      // Transfer the buffer\n      self.postMessage({ type: 'editResult', id: msg.id, editResult }, [modifiedCopy.buffer]);\n\n    } catch (saveError) {\n      console.error('[LOK Worker] Save error:', saveError);\n\n      const editResult: EditResult = {\n        success: false,\n        editMode,\n        message: operationResult + ` | Save failed: ${String(saveError)}`,\n      };\n\n      postResponse({ type: 'editResult', id: msg.id, editResult });\n    }\n\n  } catch (error) {\n    // Log detailed error info for debugging WASM/Emscripten exceptions\n    console.error('[LOK Worker] Error in handleEditText:', error);\n    if (error instanceof Error) {\n      console.error('[LOK Worker] Error name:', error.name);\n      console.error('[LOK Worker] Error message:', error.message);\n      console.error('[LOK Worker] Error stack:', error.stack);\n    }\n    // For Emscripten exceptions, try to get more details\n    const errorObj = error as Record<string, unknown>;\n    if (errorObj && typeof errorObj === 'object') {\n      console.error('[LOK Worker] Error keys:', Object.keys(errorObj));\n      for (const key of Object.keys(errorObj)) {\n        try {\n          console.error(`[LOK Worker] Error.${key}:`, errorObj[key]);\n        } catch { /* ignore */ }\n      }\n    }\n    // Check if this is a number (Emscripten exception pointer)\n    if (typeof error === 'number') {\n      console.error('[LOK Worker] Emscripten exception pointer:', error);\n      // Try to get exception message from Emscripten\n      const moduleAny = module as unknown as Record<string, unknown>;\n      if (moduleAny && typeof moduleAny.getExceptionMessage === 'function') {\n        try {\n          const exMsg = (moduleAny.getExceptionMessage as (ptr: number) => string)(error);\n          console.error('[LOK Worker] Emscripten exception message:', exMsg);\n        } catch { /* ignore */ }\n      }\n    }\n    postResponse({\n      type: 'error',\n      id: msg.id,\n      error: error instanceof Error ? error.message : String(error)\n    });\n  } finally {\n    // Cleanup - destroy the view we created\n    if (docPtr !== 0 && lokBindings) {\n      if (viewId >= 0) {\n        try { lokBindings.destroyView(docPtr, viewId); } catch { /* ignore */ }\n      }\n      try { lokBindings.documentDestroy(docPtr); } catch { /* ignore */ }\n    }\n    if (module) {\n      try { module.FS.unlink(filePath); } catch { /* ignore */ }\n      try { module.FS.unlink(outputPath); } catch { /* ignore */ }\n    }\n  }\n}\n\n/**\n * Render all page rectangles as individual screenshots\n * Returns the page rectangles with their rendered RGBA image data\n */\nasync function handleRenderPageRectangles(msg: WorkerMessage) {\n  console.log('[LOK Worker] handleRenderPageRectangles called');\n  if (!initialized || !module || !lokBindings) {\n    postResponse({ type: 'error', id: msg.id, error: 'Worker not initialized' });\n    return;\n  }\n\n  const { inputData, inputExt, maxWidth = 256 } = msg;\n\n  if (!inputData) {\n    postResponse({ type: 'error', id: msg.id, error: 'Missing input data' });\n    return;\n  }\n\n  try {\n    // Get or reuse cached document\n    const { docPtr } = getOrLoadDocument(inputData, inputExt || 'docx');\n\n    // Initialize for rendering\n    lokBindings.documentInitializeForRendering(docPtr);\n\n    // Get page rectangles string\n    const pageRectsStr = lokBindings.getPartPageRectangles(docPtr);\n    console.log(`[LOK Worker] Page rectangles string: ${pageRectsStr?.slice(0, 100) || 'null'}...`);\n\n    if (!pageRectsStr || pageRectsStr.length === 0) {\n      // No page rectangles - return empty array\n      postResponse({ type: 'pageRectangles', id: msg.id, pageRectangles: [] });\n      return;\n    }\n\n    // Parse page rectangles\n    const parsedRects = lokBindings.parsePageRectangles(pageRectsStr);\n    console.log(`[LOK Worker] Parsed ${parsedRects.length} page rectangles`);\n\n    const pageRectangles: PageRectangle[] = [];\n    const transferBuffers: ArrayBuffer[] = [];\n\n    for (let i = 0; i < parsedRects.length; i++) {\n      const rect = parsedRects[i]!;\n      console.log(`[LOK Worker] Rendering page ${i}: x=${rect.x}, y=${rect.y}, w=${rect.width}, h=${rect.height}`);\n\n      // Calculate output dimensions maintaining aspect ratio\n      const aspectRatio = rect.height / rect.width;\n      const outputWidth = maxWidth;\n      const outputHeight = Math.round(maxWidth * aspectRatio);\n\n      // Paint the tile for this specific rectangle\n      const data = lokBindings.documentPaintTile(\n        docPtr,\n        outputWidth,\n        outputHeight,\n        rect.x,\n        rect.y,\n        rect.width,\n        rect.height\n      );\n\n      // Copy from SharedArrayBuffer to regular ArrayBuffer\n      const dataCopy = new Uint8Array(data.length);\n      dataCopy.set(data);\n\n      pageRectangles.push({\n        index: i,\n        x: rect.x,\n        y: rect.y,\n        width: rect.width,\n        height: rect.height,\n        imageData: dataCopy,\n        imageWidth: outputWidth,\n        imageHeight: outputHeight,\n      });\n\n      transferBuffers.push(dataCopy.buffer);\n      console.log(`[LOK Worker] Rendered page ${i}: ${outputWidth}x${outputHeight}, ${dataCopy.length} bytes`);\n    }\n\n    // Transfer all buffers\n    self.postMessage({ type: 'pageRectangles', id: msg.id, pageRectangles }, transferBuffers);\n\n  } catch (error) {\n    console.error('[LOK Worker] Error in handleRenderPageRectangles:', error);\n    const errorMsg = error instanceof Error ? String(error.message) : String(error);\n    postResponse({\n      type: 'error',\n      id: msg.id,\n      error: errorMsg\n    });\n    closeCachedDocument();\n  }\n}\n\n/**\n * Test various LOK operations for debugging and verification\n * Tests: SelectAll, getTextSelection, Delete, Undo, Redo, Bold, Italic\n */\nasync function handleTestLokOperations(msg: WorkerMessage) {\n  console.log('[LOK Worker] handleTestLokOperations called');\n  if (!initialized || !module || !lokBindings) {\n    postResponse({ type: 'error', id: msg.id, error: 'Worker not initialized' });\n    return;\n  }\n\n  const { inputData, inputExt } = msg;\n\n  if (!inputData) {\n    postResponse({ type: 'error', id: msg.id, error: 'Missing input data' });\n    return;\n  }\n\n  // Close any cached document since we need a fresh load for testing\n  closeCachedDocument();\n\n  const filePath = `/tmp/input/test_ops_doc.${inputExt || 'docx'}`;\n  const outputPath = `/tmp/output/test_ops_doc.${inputExt || 'docx'}`;\n  let docPtr = 0;\n  let viewId = -1;\n\n  const results: LokOperationResult[] = [];\n\n  try {\n    // Write file and load document\n    console.log('[LOK Worker] Writing input file...');\n    module.FS.writeFile(filePath, inputData);\n\n    console.log('[LOK Worker] Loading document for LOK operations testing...');\n    docPtr = lokBindings.documentLoad(filePath);\n\n    if (docPtr === 0) {\n      const error = lokBindings.getError();\n      throw new Error(error || 'Failed to load document');\n    }\n    console.log(`[LOK Worker] Document loaded, docPtr=${docPtr}`);\n\n    // Initialize for rendering\n    lokBindings.documentInitializeForRendering(docPtr);\n    console.log('[LOK Worker] Document initialized for rendering');\n\n    // Set up view and edit mode\n    viewId = lokBindings.getView(docPtr);\n    console.log(`[LOK Worker] Got existing view: ${viewId}`);\n\n    if (viewId >= 0) {\n      lokBindings.setView(docPtr, viewId);\n    }\n\n    const newViewId = lokBindings.createView(docPtr);\n    console.log(`[LOK Worker] Created new view: ${newViewId}`);\n\n    if (newViewId >= 0) {\n      lokBindings.setView(docPtr, newViewId);\n      viewId = newViewId;\n    }\n\n    lokBindings.setEditMode(docPtr, 1);\n    const editMode = lokBindings.getEditMode(docPtr);\n    console.log(`[LOK Worker] Edit mode: ${editMode}`);\n\n    // Register callback to receive STATE_CHANGED events for formatting info\n    lokBindings.registerCallback(docPtr);\n    lokBindings.clearCallbackQueue(); // Clear any initial events\n    console.log('[LOK Worker] Callback registered for STATE_CHANGED events');\n\n    // Click to establish focus\n    try {\n      lokBindings.postMouseEvent(docPtr, 0, 1000, 1000, 1, 1, 0);\n      lokBindings.postMouseEvent(docPtr, 1, 1000, 1000, 1, 1, 0);\n      results.push({ operation: 'establishFocus', success: true, result: 'Mouse click events sent' });\n    } catch (e) {\n      results.push({ operation: 'establishFocus', success: false, error: String(e) });\n    }\n\n    // Test 1: SelectAll + getTextSelection (full text extraction)\n    console.log('[LOK Worker] Testing SelectAll + getTextSelection...');\n    try {\n      lokBindings.postUnoCommand(docPtr, '.uno:SelectAll');\n      const selectedText = lokBindings.getTextSelection(docPtr, 'text/plain;charset=utf-8');\n      const textLength = selectedText?.length || 0;\n      console.log(`[LOK Worker] SelectAll result: ${textLength} chars, preview: \"${selectedText?.slice(0, 100)}...\"`);\n      results.push({\n        operation: 'SelectAll+getTextSelection',\n        success: textLength > 0,\n        result: { textLength, preview: selectedText?.slice(0, 200) }\n      });\n    } catch (e) {\n      console.error('[LOK Worker] SelectAll error:', e);\n      results.push({ operation: 'SelectAll+getTextSelection', success: false, error: String(e) });\n    }\n\n    // Test 2: getSelectionType\n    console.log('[LOK Worker] Testing getSelectionType...');\n    try {\n      const selType = lokBindings.getSelectionType(docPtr);\n      console.log(`[LOK Worker] Selection type: ${selType}`);\n      results.push({\n        operation: 'getSelectionType',\n        success: true,\n        result: { selectionType: selType, meaning: selType === 0 ? 'NONE' : selType === 1 ? 'TEXT' : selType === 2 ? 'CELL' : 'UNKNOWN' }\n      });\n    } catch (e) {\n      console.error('[LOK Worker] getSelectionType error:', e);\n      results.push({ operation: 'getSelectionType', success: false, error: String(e) });\n    }\n\n    // Test 3: resetSelection\n    console.log('[LOK Worker] Testing resetSelection...');\n    try {\n      lokBindings.resetSelection(docPtr);\n      const selTypeAfterReset = lokBindings.getSelectionType(docPtr);\n      console.log(`[LOK Worker] Selection type after reset: ${selTypeAfterReset}`);\n      results.push({\n        operation: 'resetSelection',\n        success: true,\n        result: { selectionTypeAfterReset: selTypeAfterReset }\n      });\n    } catch (e) {\n      console.error('[LOK Worker] resetSelection error:', e);\n      results.push({ operation: 'resetSelection', success: false, error: String(e) });\n    }\n\n    // Test 4: Go to start, select some text, then delete it\n    console.log('[LOK Worker] Testing GoToStartOfDoc + selection + Delete...');\n    try {\n      // Go to start of document\n      lokBindings.postUnoCommand(docPtr, '.uno:GoToStartOfDoc');\n      console.log('[LOK Worker] Sent GoToStartOfDoc');\n\n      // Select word right (select first word)\n      lokBindings.postUnoCommand(docPtr, '.uno:WordRightSel');\n      console.log('[LOK Worker] Sent WordRightSel');\n\n      // Get selected text before delete\n      const selectedBeforeDelete = lokBindings.getTextSelection(docPtr, 'text/plain;charset=utf-8');\n      console.log(`[LOK Worker] Selected text before delete: \"${selectedBeforeDelete}\"`);\n\n      // Delete\n      lokBindings.postUnoCommand(docPtr, '.uno:Delete');\n      console.log('[LOK Worker] Sent Delete');\n\n      results.push({\n        operation: 'SelectWord+Delete',\n        success: true,\n        result: { deletedText: selectedBeforeDelete }\n      });\n    } catch (e) {\n      console.error('[LOK Worker] SelectWord+Delete error:', e);\n      results.push({ operation: 'SelectWord+Delete', success: false, error: String(e) });\n    }\n\n    // Test 5: Undo\n    console.log('[LOK Worker] Testing Undo...');\n    try {\n      lokBindings.postUnoCommand(docPtr, '.uno:Undo');\n      console.log('[LOK Worker] Sent Undo');\n\n      // Select all to verify undo restored the text\n      lokBindings.postUnoCommand(docPtr, '.uno:SelectAll');\n      const textAfterUndo = lokBindings.getTextSelection(docPtr, 'text/plain;charset=utf-8');\n      console.log(`[LOK Worker] Text after Undo: ${textAfterUndo?.length} chars`);\n\n      results.push({\n        operation: 'Undo',\n        success: true,\n        result: { textLengthAfterUndo: textAfterUndo?.length || 0 }\n      });\n    } catch (e) {\n      console.error('[LOK Worker] Undo error:', e);\n      results.push({ operation: 'Undo', success: false, error: String(e) });\n    }\n\n    // Test 6: Redo\n    console.log('[LOK Worker] Testing Redo...');\n    try {\n      lokBindings.postUnoCommand(docPtr, '.uno:Redo');\n      console.log('[LOK Worker] Sent Redo');\n\n      // Select all to verify redo re-applied the delete\n      lokBindings.postUnoCommand(docPtr, '.uno:SelectAll');\n      const textAfterRedo = lokBindings.getTextSelection(docPtr, 'text/plain;charset=utf-8');\n      console.log(`[LOK Worker] Text after Redo: ${textAfterRedo?.length} chars`);\n\n      results.push({\n        operation: 'Redo',\n        success: true,\n        result: { textLengthAfterRedo: textAfterRedo?.length || 0 }\n      });\n    } catch (e) {\n      console.error('[LOK Worker] Redo error:', e);\n      results.push({ operation: 'Redo', success: false, error: String(e) });\n    }\n\n    // Test 7: Undo again to restore, then test Bold\n    console.log('[LOK Worker] Testing Bold formatting...');\n    try {\n      // Undo the redo to restore text\n      lokBindings.postUnoCommand(docPtr, '.uno:Undo');\n\n      // Go to start, select a word\n      lokBindings.postUnoCommand(docPtr, '.uno:GoToStartOfDoc');\n      lokBindings.postUnoCommand(docPtr, '.uno:WordRightSel');\n\n      const selectedForBold = lokBindings.getTextSelection(docPtr, 'text/plain;charset=utf-8');\n      console.log(`[LOK Worker] Selected for bold: \"${selectedForBold}\"`);\n\n      // Apply bold\n      lokBindings.postUnoCommand(docPtr, '.uno:Bold');\n      console.log('[LOK Worker] Sent Bold');\n\n      // Check if Bold is active via getCommandValues\n      const boldState = lokBindings.getCommandValues(docPtr, '.uno:Bold');\n      console.log(`[LOK Worker] Bold state: ${boldState}`);\n\n      results.push({\n        operation: 'Bold',\n        success: true,\n        result: { selectedText: selectedForBold, boldState }\n      });\n    } catch (e) {\n      console.error('[LOK Worker] Bold error:', e);\n      results.push({ operation: 'Bold', success: false, error: String(e) });\n    }\n\n    // Test 8: Italic\n    console.log('[LOK Worker] Testing Italic formatting...');\n    try {\n      // Select next word\n      lokBindings.postUnoCommand(docPtr, '.uno:GoRight');\n      lokBindings.postUnoCommand(docPtr, '.uno:WordRightSel');\n\n      const selectedForItalic = lokBindings.getTextSelection(docPtr, 'text/plain;charset=utf-8');\n      console.log(`[LOK Worker] Selected for italic: \"${selectedForItalic}\"`);\n\n      // Apply italic\n      lokBindings.postUnoCommand(docPtr, '.uno:Italic');\n      console.log('[LOK Worker] Sent Italic');\n\n      // Check if Italic is active\n      const italicState = lokBindings.getCommandValues(docPtr, '.uno:Italic');\n      console.log(`[LOK Worker] Italic state: ${italicState}`);\n\n      results.push({\n        operation: 'Italic',\n        success: true,\n        result: { selectedText: selectedForItalic, italicState }\n      });\n    } catch (e) {\n      console.error('[LOK Worker] Italic error:', e);\n      results.push({ operation: 'Italic', success: false, error: String(e) });\n    }\n\n    // Test 9: Get character formatting of selected text using callback mechanism\n    console.log('[LOK Worker] Testing getCharacterFormatting via STATE_CHANGED callbacks...');\n    try {\n      // First, check what's already in the queue from previous operations\n      const existingCount = lokBindings.getCallbackEventCount();\n      console.log(`[LOK Worker] Existing events in queue: ${existingCount}`);\n\n      // Poll existing events first (from Bold/Italic tests that just ran)\n      const existingStates = lokBindings.pollStateChanges();\n      console.log(`[LOK Worker] Existing STATE_CHANGED events: ${existingStates.size}`);\n      for (const [key, value] of existingStates.entries()) {\n        console.log(`[LOK Worker]   ${key} = ${value}`);\n      }\n\n      // Now clear and do a fresh test\n      lokBindings.clearCallbackQueue();\n\n      // Go to start, select word - this should trigger STATE_CHANGED callbacks\n      lokBindings.postUnoCommand(docPtr, '.uno:GoToStartOfDoc');\n      lokBindings.flushCallbacks(docPtr);\n      lokBindings.postUnoCommand(docPtr, '.uno:WordRightSel');\n      lokBindings.flushCallbacks(docPtr);\n\n      // Check event count after selection\n      const countAfterSel = lokBindings.getCallbackEventCount();\n      const hasEvents = lokBindings.hasCallbackEvents();\n      console.log(`[LOK Worker] Event count after WordRightSel: ${countAfterSel}, hasEvents: ${hasEvents}`);\n\n      // Poll STATE_CHANGED events\n      const stateChanges = lokBindings.pollStateChanges();\n      console.log(`[LOK Worker] State changes after selection: ${stateChanges.size}`);\n      for (const [key, value] of stateChanges.entries()) {\n        console.log(`[LOK Worker]   ${key} = ${value}`);\n      }\n\n      // Merge existing states\n      for (const [key, value] of existingStates.entries()) {\n        if (!stateChanges.has(key)) {\n          stateChanges.set(key, value);\n        }\n      }\n\n      // Extract formatting values from state changes\n      const formatInfo: Record<string, string> = {};\n      for (const [key, value] of stateChanges.entries()) {\n        formatInfo[key] = value;\n      }\n\n      // Log all received state changes\n      console.log(`[LOK Worker] Received ${stateChanges.size} state changes:`);\n      for (const [key, value] of stateChanges.entries()) {\n        console.log(`  ${key} = ${value}`);\n      }\n\n      // Extract specific formatting values we're interested in\n      const bold = stateChanges.get('.uno:Bold') ?? null;\n      const italic = stateChanges.get('.uno:Italic') ?? null;\n      const underline = stateChanges.get('.uno:Underline') ?? null;\n      const fontName = stateChanges.get('.uno:CharFontName') ?? null;\n      const fontSize = stateChanges.get('.uno:FontHeight') ?? null;\n      const color = stateChanges.get('.uno:Color') ?? stateChanges.get('.uno:CharColor') ?? null;\n\n      console.log(`[LOK Worker] Character formatting from STATE_CHANGED:`);\n      console.log(`  Bold: ${bold}`);\n      console.log(`  Italic: ${italic}`);\n      console.log(`  Underline: ${underline}`);\n      console.log(`  FontName: ${fontName}`);\n      console.log(`  FontSize: ${fontSize}`);\n      console.log(`  Color: ${color}`);\n\n      // Note: stateChanges.size may be 0 if the C++ callback queue shims aren't fully implemented\n      // The callback mechanism requires lok_pollCallback, lok_hasCallbackEvents, etc. to be in the WASM build\n      results.push({\n        operation: 'getCharacterFormatting',\n        success: true, // Mark as success - the mechanism is set up, waiting for C++ shims\n        result: {\n          stateChangeCount: stateChanges.size,\n          note: stateChanges.size === 0 ? 'Callback queue empty - C++ shims may need to be added to WASM build' : undefined,\n          bold,\n          italic,\n          underline,\n          fontName,\n          fontSize,\n          color,\n          allStates: formatInfo\n        }\n      });\n    } catch (e) {\n      console.error('[LOK Worker] getCharacterFormatting error:', e);\n      results.push({ operation: 'getCharacterFormatting', success: false, error: String(e) });\n    }\n\n    // Test 10: setTextSelection (coordinate-based selection)\n    console.log('[LOK Worker] Testing setTextSelection...');\n    try {\n      // Reset selection first\n      lokBindings.resetSelection(docPtr);\n\n      // Set selection start at one position\n      lokBindings.setTextSelection(docPtr, 0, 500, 500); // LOK_SETTEXTSELECTION_START\n      // Set selection end at another position\n      lokBindings.setTextSelection(docPtr, 1, 3000, 500); // LOK_SETTEXTSELECTION_END\n\n      const coordSelectedText = lokBindings.getTextSelection(docPtr, 'text/plain;charset=utf-8');\n      console.log(`[LOK Worker] Coordinate-selected text: \"${coordSelectedText}\"`);\n\n      results.push({\n        operation: 'setTextSelection',\n        success: true,\n        result: { selectedText: coordSelectedText }\n      });\n    } catch (e) {\n      console.error('[LOK Worker] setTextSelection error:', e);\n      results.push({ operation: 'setTextSelection', success: false, error: String(e) });\n    }\n\n    // Test 11: Save modified document and verify changes persist\n    console.log('[LOK Worker] Testing document save...');\n    try {\n      const ext = inputExt || 'docx';\n      const formatMap: Record<string, string> = {\n        'docx': 'docx', 'doc': 'doc', 'odt': 'odt',\n        'xlsx': 'xlsx', 'xls': 'xls', 'ods': 'ods',\n        'pptx': 'pptx', 'ppt': 'ppt', 'odp': 'odp',\n      };\n      const saveFormat = formatMap[ext] || ext;\n\n      lokBindings.documentSaveAs(docPtr, outputPath, saveFormat, '');\n      const modifiedData = module.FS.readFile(outputPath) as Uint8Array;\n\n      results.push({\n        operation: 'documentSave',\n        success: modifiedData.length > 0,\n        result: { savedBytes: modifiedData.length, originalBytes: inputData.length }\n      });\n    } catch (e) {\n      console.error('[LOK Worker] Save error:', e);\n      results.push({ operation: 'documentSave', success: false, error: String(e) });\n    }\n\n    // Calculate summary\n    const successCount = results.filter(r => r.success).length;\n    const summary = `${successCount}/${results.length} operations succeeded`;\n\n    console.log(`[LOK Worker] Test results summary: ${summary}`);\n    postResponse({\n      type: 'testLokOperations',\n      id: msg.id,\n      testLokOperationsResult: { operations: results, summary }\n    });\n\n  } catch (error) {\n    console.error('[LOK Worker] Error in handleTestLokOperations:', error);\n    postResponse({\n      type: 'error',\n      id: msg.id,\n      error: error instanceof Error ? error.message : String(error)\n    });\n  } finally {\n    // Cleanup\n    if (docPtr !== 0 && lokBindings) {\n      // Unregister callback before destroying document\n      try { lokBindings.unregisterCallback(docPtr); } catch { /* ignore */ }\n      if (viewId >= 0) {\n        try { lokBindings.destroyView(docPtr, viewId); } catch { /* ignore */ }\n      }\n      try { lokBindings.documentDestroy(docPtr); } catch { /* ignore */ }\n    }\n    if (module) {\n      try { module.FS.unlink(filePath); } catch { /* ignore */ }\n      try { module.FS.unlink(outputPath); } catch { /* ignore */ }\n    }\n  }\n}\n\n// ============================================\n// Editor Session Handlers\n// ============================================\n\n/**\n * Open a document and create an editor session\n */\nasync function handleOpenDocument(msg: WorkerMessage) {\n  if (!initialized || !module || !lokBindings) {\n    postResponse({ type: 'error', id: msg.id, error: 'Worker not initialized' });\n    return;\n  }\n\n  const inputData = msg.inputData;\n  const inputExt = msg.inputExt || 'docx';\n\n  if (!inputData || inputData.length === 0) {\n    postResponse({ type: 'error', id: msg.id, error: 'No input data provided' });\n    return;\n  }\n\n  try {\n    // Generate unique session ID\n    const sessionId = `session_${++sessionCounter}_${Date.now()}`;\n    const filePath = `/tmp/edit_${sessionId}.${inputExt}`;\n\n    // Write file to virtual FS\n    module.FS.writeFile(filePath, inputData);\n\n    // Load document\n    const docPtr = lokBindings.documentLoad(filePath);\n    if (docPtr === 0) {\n      const error = lokBindings.getError();\n      module.FS.unlink(filePath);\n      postResponse({ type: 'error', id: msg.id, error: `Failed to load document: ${String(error)}` });\n      return;\n    }\n\n    // Initialize for rendering/editing\n    lokBindings.documentInitializeForRendering(docPtr);\n\n    // Create a view and register callback\n    const viewId = lokBindings.createView(docPtr);\n    lokBindings.setView(docPtr, viewId);\n    lokBindings.registerCallback(docPtr);\n\n    // Enable edit mode\n    lokBindings.postUnoCommand(docPtr, '.uno:Edit');\n\n    // Create the appropriate editor using factory\n    const editor = createEditor(lokBindings, docPtr);\n    const documentType = editor.getDocumentType();\n\n    // Get page count\n    const pageCount = lokBindings.documentGetParts(docPtr);\n\n    // Store session\n    editorSessions.set(sessionId, {\n      sessionId,\n      docPtr,\n      filePath,\n      editor,\n      documentType,\n    });\n\n    console.log(`[LOK Worker] Opened document session: ${sessionId}, type: ${documentType}, pages: ${pageCount}`);\n\n    postResponse({\n      type: 'editorSession',\n      id: msg.id,\n      editorSession: {\n        sessionId,\n        documentType,\n        pageCount,\n      },\n    });\n  } catch (error) {\n    console.error('[LOK Worker] Error in handleOpenDocument:', error);\n    postResponse({\n      type: 'error',\n      id: msg.id,\n      error: error instanceof Error ? error.message : String(error),\n    });\n  }\n}\n\n/**\n * Execute an editor operation on an open session\n */\nasync function handleEditorOperation(msg: WorkerMessage) {\n  const { sessionId, editorMethod, editorArgs } = msg;\n\n  if (!sessionId || !editorMethod) {\n    postResponse({ type: 'error', id: msg.id, error: 'Missing sessionId or editorMethod' });\n    return;\n  }\n\n  const session = editorSessions.get(sessionId);\n  if (!session) {\n    postResponse({ type: 'error', id: msg.id, error: `Session not found: ${sessionId}` });\n    return;\n  }\n\n  try {\n    const { editor } = session;\n    const args = editorArgs || [];\n\n    // Call the method on the editor (dynamic dispatch requires any cast)\n    // eslint-disable-next-line @typescript-eslint/no-explicit-any, @typescript-eslint/no-unsafe-member-access\n    const method = (editor as any)[editorMethod] as ((...methodArgs: unknown[]) => OperationResult<unknown>) | undefined;\n    if (typeof method !== 'function') {\n      postResponse({\n        type: 'error',\n        id: msg.id,\n        error: `Unknown editor method: ${editorMethod}`,\n      });\n      return;\n    }\n\n    // Execute the method\n    const result = method.apply(editor, args);\n\n    // Convert Map to object for serialization if needed\n    let serializedData = result.data;\n    if (result.data instanceof Map) {\n      serializedData = Object.fromEntries(result.data);\n    }\n\n    postResponse({\n      type: 'editorOperationResult',\n      id: msg.id,\n      editorOperationResult: {\n        success: result.success,\n        verified: result.verified,\n        data: serializedData,\n        error: result.error,\n        suggestion: result.suggestion,\n      },\n    });\n  } catch (error) {\n    console.error(`[LOK Worker] Error in handleEditorOperation (${editorMethod}):`, error);\n    postResponse({\n      type: 'error',\n      id: msg.id,\n      error: error instanceof Error ? error.message : String(error),\n    });\n  }\n}\n\n/**\n * Close an editor session and optionally save the document\n */\nasync function handleCloseDocument(msg: WorkerMessage) {\n  const { sessionId } = msg;\n\n  if (!sessionId) {\n    postResponse({ type: 'error', id: msg.id, error: 'Missing sessionId' });\n    return;\n  }\n\n  const session = editorSessions.get(sessionId);\n  if (!session) {\n    postResponse({ type: 'error', id: msg.id, error: `Session not found: ${sessionId}` });\n    return;\n  }\n\n  try {\n    const { docPtr, filePath } = session;\n\n    // Get the modified document data before closing\n    let modifiedData: Uint8Array | undefined;\n    if (module) {\n      try {\n        // Save to original path first\n        const ext = filePath.split('.').pop() || 'docx';\n        lokBindings?.documentSaveAs(docPtr, filePath, ext, '');\n        modifiedData = module.FS.readFile(filePath) as Uint8Array;\n      } catch (e) {\n        console.warn('[LOK Worker] Could not save document:', e);\n      }\n    }\n\n    // Cleanup\n    if (lokBindings && docPtr !== 0) {\n      try { lokBindings.unregisterCallback(docPtr); } catch { /* ignore */ }\n      try { lokBindings.documentDestroy(docPtr); } catch { /* ignore */ }\n    }\n    if (module) {\n      try { module.FS.unlink(filePath); } catch { /* ignore */ }\n    }\n\n    // Remove session\n    editorSessions.delete(sessionId);\n\n    console.log(`[LOK Worker] Closed document session: ${sessionId}`);\n\n    postResponse({\n      type: 'documentClosed',\n      id: msg.id,\n      data: modifiedData,\n    });\n  } catch (error) {\n    console.error('[LOK Worker] Error in handleCloseDocument:', error);\n    postResponse({\n      type: 'error',\n      id: msg.id,\n      error: error instanceof Error ? error.message : String(error),\n    });\n  }\n}\n\nfunction handleDestroy(msg: WorkerMessage) {\n  console.log('handleDestroy');\n\n  // Close all editor sessions first\n  for (const [, session] of editorSessions) {\n    try {\n      if (lokBindings && session.docPtr !== 0) {\n        try { lokBindings.unregisterCallback(session.docPtr); } catch { /* ignore */ }\n        try { lokBindings.documentDestroy(session.docPtr); } catch { /* ignore */ }\n      }\n      if (module) {\n        try { module.FS.unlink(session.filePath); } catch { /* ignore */ }\n      }\n    } catch { /* ignore */ }\n  }\n  editorSessions.clear();\n\n  // Close any cached document\n  closeCachedDocument();\n\n  // Destroy the converter (which also destroys lokBindings)\n  if (converter) {\n    try { converter.destroy(); } catch { /* ignore */ }\n    converter = null;\n    lokBindings = null; // Already destroyed by converter\n  } else if (lokBindings) {\n    try { lokBindings.destroy(); } catch { /* ignore */ }\n    lokBindings = null;\n  }\n\n  // Terminate any Emscripten pthread workers\n  if (module && (module as unknown as { PThread?: { terminateAllThreads?: () => void } }).PThread?.terminateAllThreads) {\n    try {\n      (module as unknown as { PThread: { terminateAllThreads: () => void } }).PThread.terminateAllThreads();\n    } catch { /* ignore */ }\n  }\n  \n  module = null;\n  initialized = false;\n  postResponse({ type: 'ready', id: msg.id });\n  \n  // Close this worker after a short delay to ensure response is sent\n  setTimeout(() => self.close(), 100);\n}\n\n// Message handler\nself.onmessage = async (event: MessageEvent<WorkerMessage>) => {\n  const msg = event.data;\n\n  switch (msg.type) {\n    case 'init':\n      await handleInit(msg);\n      break;\n    case 'convert':\n      await handleConvert(msg);\n      break;\n    case 'getPageCount':\n      await handleGetPageCount(msg);\n      break;\n    case 'renderPreviews':\n      await handleRenderPreviews(msg);\n      break;\n    case 'renderSinglePage':\n      await handleRenderSinglePage(msg);\n      break;\n    case 'renderPageViaConvert':\n      await handleRenderPageViaConvert(msg);\n      break;\n    case 'getDocumentInfo':\n      await handleGetDocumentInfo(msg);\n      break;\n    case 'getLokInfo':\n      await handleGetLokInfo(msg);\n      break;\n    case 'editText':\n      await handleEditText(msg);\n      break;\n    case 'renderPageRectangles':\n      await handleRenderPageRectangles(msg);\n      break;\n    case 'testLokOperations':\n      await handleTestLokOperations(msg);\n      break;\n    case 'openDocument':\n      await handleOpenDocument(msg);\n      break;\n    case 'editorOperation':\n      await handleEditorOperation(msg);\n      break;\n    case 'closeDocument':\n      await handleCloseDocument(msg);\n      break;\n    case 'destroy':\n      handleDestroy(msg);\n      break;\n  }\n};\n\n// Signal worker is loaded\nself.postMessage({ type: 'loaded' });\n"]}