{"version":3,"sources":["../src/types.ts","../src/editor/base.ts","../src/editor/writer.ts","../src/editor/calc.ts","../src/editor/impress.ts","../src/editor/draw.ts","../src/editor/index.ts","../src/lok-bindings.ts","../src/converter.ts","../src/browser.worker.ts"],"names":["ConversionError","code","message","details","FORMAT_FILTERS","FORMAT_MIME_TYPES","EXTENSION_TO_FORMAT","LOK_DOCTYPE_OUTPUT_FORMATS","getOutputFormatsForDocType","docType","OUTPUT_FORMAT_TO_LOK","FORMAT_FILTER_OPTIONS","INPUT_FORMAT_CATEGORY","CATEGORY_OUTPUT_FORMATS","getValidOutputFormats","inputFormat","format","category","isConversionValid","outputFormat","getConversionErrorMessage","input","output","validOutputs","reason","OfficeEditor","lok","docPtr","options","error","path","afterMode","text","searchArgs","selection","hasMatch","find","replace","states","_selection","data","suggestion","truncation","content","maxChars","limit","original","truncated","lastSpace","items","itemToString","charCount","includedCount","item","itemStr","a1","match","colStr","rowStr","col","row","c","remainder","ref","WriterEditor","paragraphs","paragraphInfos","index","truncResult","p","structure","w","start","count","end","result","insertIndex","textArgs","styleName","styleArgs","oldText","findReplaceArgs","deletedText","_position","_start","_end","command","_range","args","boldState","italicState","underlineState","fontSizeState","size","fontNameState","existingStates","allText","CalcEditor","_options","numSheets","sheets","i","name","dataArea","names","cell","sheet","address","value","formula","range","startRow","startCol","endRow","endCol","cells","r","rowData","cellData","cellStr","sum","oldValue","valueStr","newValue","expectedStr","calculatedValue","values","cellsUpdated","rowValues","rangeStr","cellsCleared","afterRow","afterCol","colNum","newName","num","parts","hex","ImpressEditor","numSlides","slides","slideData","textFrames","f","newIndex","fromIndex","toIndex","title","oldTitle","body","oldBody","notes","layout","frames","titleFrame","para","idx","type","layoutId","DrawEditor","numPages","pages","pageInfo","shapes","pageData","pageIndex","shapeType","bounds","shapeCommand","boundsArgs","colorArgs","widthArgs","shapeIndex","newPosition","newSize","LOK_DOCTYPE_TEXT","LOK_DOCTYPE_SPREADSHEET","LOK_DOCTYPE_PRESENTATION","LOK_DOCTYPE_DRAWING","createEditor","getCallbackTypeName","LOK_CLASS","DOC_CLASS","textEncoder","textDecoder","LOKBindings","module","verbose","str","bytes","ptr","heap","slice","addr","installPath","pathPtr","hook","errPtr","lokClassPtr","getErrorPtr","fileUrl","startTime","documentLoadPtr","optsPtr","loadWithOptsPtr","outputPath","filterOptions","urlPtr","formatPtr","docClassPtr","saveAsPtr","destroyPtr","part","sizePtr","width","height","canvasWidth","canvasHeight","tilePosX","tilePosY","tileWidth","tileHeight","bufferSize","bufferPtr","editMode","currentPart","docSize","pageRectsStr","pageRect","aspectRatio","outputWidth","outputHeight","dpi","maxDimension","TWIPS_PER_INCH","effectiveDpi","scale","mimeType","mimePtr","usedMimePtr","resultPtr","x","y","buttons","modifier","charCode","keyCode","notifyWhenFinished","cmdPtr","argsPtr","dataPtr","dataSize","tilePixelWidth","tilePixelHeight","tileTwipWidth","tileTwipHeight","viewId","enabled","colPtr","rowPtr","mode","optionsPtr","payloadBuffer","payloadLengthPtr","eventType","payloadLength","payload","len","events","event","hasShim","eqIndex","key","rectanglesStr","s","rect","LibreOfficeConverter","msg","resolve","convError","wasmPath","moduleUrl","config","script","reject","createModule","moduleWithCallback","fs","tryMkdir","originalOpen","flags","err","logDir","label","e","versionInfo","filename","inputData","inputExt","outputExt","inputPath","outputFilename","loadOptions","stat","lokFormat","pdfOpts","levelMap","pageNum","outputData","fsError","renderOptions","pageIndices","numParts","pagesToRender","_","results","preview","pageCount","validOutputFormats","docTypeNames","rectsStr","sheetIndex","_input","_sessionId","_method","_args","mod","worker","lastDot","phase","percent","PHASE_WEIGHTS","phaseProgress","currentInitRequestId","lastEmittedPercent","calculateTotalProgress","total","formatBytes","emitDownloadProgress","loaded","weight","phasePercent","newProgress","emitProgress","emitPhaseProgress","progress","installProgressInterceptors","originalFetch","init","url","response","contentLength","reader","stream","controller","done","OriginalXHR","ProgressXMLHttpRequest","xhr","requestUrl","method","async","username","password","originalSend","downloadPhase","lokBindings","converter","initialized","cachedDoc","editorSessions","sessionCounter","hashInput","hash","step","byte","getDocumentPageCount","pageRects","getOrLoadDocument","inputHash","closeCachedDocument","filePath","postResponse","postProgress","id","handleInit","sofficeJs","sofficeWasm","sofficeData","sofficeWorkerJs","_scriptDir","checkReady","orig","IMAGE_FORMATS","handleConvert","isImageFormat","inPath","outPath","outputFiles","baseOpts","pageFiles","docWidth","docHeight","exportWidth","exportHeight","pageOutPath","pageOpts","pageCopy","zipData","createSimpleZip","opts","sharedResult","files","chunks","centralDirectory","offset","file","nameBytes","localHeader","view","crc32","cdEntry","cdView","cdOffset","cdSize","entry","eocd","eocdView","totalSize","chunk","pos","crc","j","handleGetPageCount","handleRenderPreviews","maxWidth","previews","rendered","dataCopy","transfers","handleRenderSinglePage","errorMsg","handleRenderPageViaConvert","filterOpts","pngData","pngCopy","handleRenderPageFullQuality","handleGetDocumentInfo","docTypeOutputFormats","documentInfo","handleGetLokInfo","pageRectangles","documentSize","partInfo","a11yFocusedParagraph","a11yCaretPosition","newViewId","parsedPartInfo","parsedA11yParagraph","lokInfo","handleEditText","findText","replaceText","insertText","operationResult","searchErr","pasteResult","insertArgs","ext","saveFormat","modifiedData","modifiedCopy","editResult","saveError","errorObj","moduleAny","exMsg","handleRenderPageRectangles","parsedRects","transferBuffers","handleTestLokOperations","selectedText","textLength","selType","selTypeAfterReset","selectedBeforeDelete","textAfterUndo","textAfterRedo","selectedForBold","selectedForItalic","existingCount","countAfterSel","hasEvents","stateChanges","formatInfo","bold","italic","underline","fontName","fontSize","color","coordSelectedText","summary","handleOpenDocument","sessionId","editor","documentType","handleEditorOperation","editorMethod","editorArgs","session","serializedData","handleCloseDocument","handleDestroy"],"mappings":"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","file":"browser.worker.global.js","sourcesContent":["/**\n * LibreOffice WASM Document Conversion Types\n * Headless document format conversion toolkit\n */\n\n/**\n * Supported input document formats\n */\nexport type InputFormat =\n  // Microsoft Office formats\n  | 'doc'\n  | 'docx'\n  | 'xls'\n  | 'xlsx'\n  | 'ppt'\n  | 'pptx'\n  // OpenDocument formats\n  | 'odt'\n  | 'ods'\n  | 'odp'\n  | 'odg'\n  | 'odf'\n  // Other formats\n  | 'rtf'\n  | 'txt'\n  | 'html'\n  | 'htm'\n  | 'csv'\n  | 'xml'\n  | 'epub'\n  | 'pdf';\n\n/**\n * Supported output document formats\n */\nexport type OutputFormat =\n  | 'pdf'\n  | 'docx'\n  | 'doc'\n  | 'odt'\n  | 'rtf'\n  | 'txt'\n  | 'html'\n  | 'xlsx'\n  | 'xls'\n  | 'ods'\n  | 'csv'\n  | 'pptx'\n  | 'ppt'\n  | 'odp'\n  | 'png'\n  | 'jpg'\n  | 'svg';\n\n/**\n * Document conversion options\n */\nexport interface ConversionOptions {\n  /**\n   * Output format for the conversion\n   */\n  outputFormat: OutputFormat;\n\n  /**\n   * Input format hint (auto-detected if not provided)\n   */\n  inputFormat?: InputFormat;\n\n  /**\n   * PDF-specific options\n   */\n  pdf?: PdfOptions;\n\n  /**\n   * Image output options (for png, jpg, svg)\n   */\n  image?: ImageOptions;\n\n  /**\n   * Password for encrypted documents\n   */\n  password?: string;\n}\n\n/**\n * PDF-specific conversion options\n */\nexport interface PdfOptions {\n  /**\n   * PDF/A conformance level\n   */\n  pdfaLevel?: 'PDF/A-1b' | 'PDF/A-2b' | 'PDF/A-3b';\n\n  /**\n   * PDF quality (0-100, affects image compression)\n   * @default 90\n   */\n  quality?: number;\n}\n\n/**\n * Image output options\n */\nexport interface ImageOptions {\n  /**\n   * Image width in pixels\n   */\n  width?: number;\n\n  /**\n   * Image height in pixels\n   */\n  height?: number;\n\n  /**\n   * DPI for rendering\n   * @default 150\n   */\n  dpi?: number;\n\n  /**\n   * Page index to export (0-based). Only exports this single page.\n   * If not specified, exports the first page (page 0).\n   * Cannot be used together with `pages`.\n   */\n  pageIndex?: number;\n\n  /**\n   * Array of page indices to export (0-based).\n   * If specified, returns an array of results (one per page).\n   * Cannot be used together with `pageIndex`.\n   */\n  pages?: number[];\n}\n\n/**\n * Result of a document conversion\n */\nexport interface ConversionResult {\n  /**\n   * The converted document data\n   */\n  data: Uint8Array;\n\n  /**\n   * MIME type of the output\n   */\n  mimeType: string;\n\n  /**\n   * Suggested filename with new extension\n   */\n  filename: string;\n\n  /**\n   * Conversion duration in milliseconds\n   */\n  duration: number;\n}\n\n/**\n * WASM loader module interface\n * This is the interface for the loader.cjs module that creates the Emscripten module\n */\nexport interface WasmLoaderModule {\n  createModule: (config: Record<string, unknown>) => Promise<EmscriptenModule>;\n}\n\n/**\n * LibreOffice WASM module initialization options (Node.js)\n */\nexport interface LibreOfficeWasmOptions {\n  /**\n   * Path to WASM files directory\n   * @default './wasm'\n   */\n  wasmPath?: string;\n\n  /**\n   * Path to the worker script (for WorkerConverter)\n   * When not specified, auto-detected based on module location\n   */\n  workerPath?: string;\n\n  /**\n   * Pre-loaded WASM loader module\n   * When provided, bypasses dynamic require of loader.cjs\n   * This is useful for bundlers like Turbopack that can't handle dynamic requires\n   *\n   * @example\n   * ```typescript\n   * // In your code, import the loader statically\n   * import * as wasmLoader from '@matbee/libreoffice-converter/wasm/loader.cjs';\n   *\n   * const converter = new LibreOfficeConverter({\n   *   wasmPath: './wasm',\n   *   wasmLoader,\n   * });\n   * ```\n   */\n  wasmLoader?: WasmLoaderModule;\n\n  /**\n   * Enable verbose logging\n   * @default false\n   */\n  verbose?: boolean;\n\n  /**\n   * Called when WASM module is ready\n   */\n  onReady?: () => void;\n\n  /**\n   * Called on initialization error\n   */\n  onError?: (error: Error) => void;\n\n  /**\n   * Called with progress updates during initialization\n   */\n  onProgress?: (progress: ProgressInfo) => void;\n}\n\n/**\n * Explicit paths to WASM files (Browser)\n * All paths are required when specified explicitly\n */\nexport interface BrowserWasmPaths {\n  /** URL to soffice.js - the main Emscripten loader script */\n  sofficeJs: string;\n  /** URL to soffice.wasm - the WebAssembly binary (~112MB) */\n  sofficeWasm: string;\n  /** URL to soffice.data - the virtual filesystem image (~80MB) */\n  sofficeData: string;\n  /** URL to soffice.worker.js - the Emscripten pthread worker */\n  sofficeWorkerJs: string;\n}\n\n/**\n * Browser converter initialization options\n * All WASM paths are optional and default to /wasm/ via createWasmPaths()\n */\nexport interface BrowserConverterOptions {\n  /** URL to soffice.js - defaults to /wasm/soffice.js */\n  sofficeJs?: string;\n  /** URL to soffice.wasm - defaults to /wasm/soffice.wasm */\n  sofficeWasm?: string;\n  /** URL to soffice.data - defaults to /wasm/soffice.data */\n  sofficeData?: string;\n  /** URL to soffice.worker.js - defaults to /wasm/soffice.worker.js */\n  sofficeWorkerJs?: string;\n\n  /**\n   * Enable verbose logging\n   * @default false\n   */\n  verbose?: boolean;\n\n  /**\n   * Called when WASM module is ready\n   */\n  onReady?: () => void;\n\n  /**\n   * Called on initialization error\n   */\n  onError?: (error: Error) => void;\n\n  /**\n   * Called with progress updates during initialization\n   */\n  onProgress?: (progress: WasmLoadProgress) => void;\n}\n\n/**\n * Worker browser converter initialization options\n * All WASM paths are optional and default to /wasm/ via createWasmPaths()\n */\nexport interface WorkerBrowserConverterOptions extends BrowserConverterOptions {\n  /** URL to browser.worker.js - defaults to /dist/browser.worker.global.js */\n  browserWorkerJs?: string;\n}\n\n/**\n * Internal type for BrowserConverterOptions after defaults are applied\n * All WASM paths are guaranteed to be defined\n */\nexport type ResolvedBrowserConverterOptions = BrowserConverterOptions & BrowserWasmPaths;\n\n/**\n * Internal type for WorkerBrowserConverterOptions after defaults are applied\n * All WASM paths and browserWorkerJs are guaranteed to be defined\n */\nexport type ResolvedWorkerBrowserConverterOptions = WorkerBrowserConverterOptions & BrowserWasmPaths & {\n  browserWorkerJs: string;\n};\n\n/**\n * Default URL for WASM files - relative path for same-origin hosting\n * Users typically serve WASM files from their own server at /wasm/\n */\nexport const DEFAULT_WASM_BASE_URL = '/wasm/';\n\n/**\n * Create WASM file paths from a base URL\n * Convenience helper for users who keep all WASM files in one directory\n *\n * Note: WASM files are shipped as .gz compressed files by default.\n * Your server must serve these with Content-Encoding: gzip header,\n * or configure your CDN to handle gzip decompression transparently.\n *\n * @param baseUrl - Base URL ending with '/' (e.g., '/wasm/', 'https://cdn.example.com/wasm/')\n *                  Defaults to '/wasm/' for same-origin hosting\n * @returns Object with all WASM file paths (pointing to .gz files)\n *\n * @example\n * ```typescript\n * // Use default /wasm/ path (same-origin)\n * const converter = new WorkerBrowserConverter({\n *   ...createWasmPaths(),\n *   browserWorkerJs: '/dist/browser.worker.js',\n * });\n *\n * // Or use your own CDN\n * const converter = new WorkerBrowserConverter({\n *   ...createWasmPaths('https://cdn.example.com/wasm/'),\n *   browserWorkerJs: '/dist/browser.worker.js',\n * });\n * ```\n */\nexport function createWasmPaths(baseUrl: string = DEFAULT_WASM_BASE_URL): BrowserWasmPaths {\n  // Ensure baseUrl ends with /\n  const base = baseUrl.endsWith('/') ? baseUrl : `${baseUrl}/`;\n  return {\n    sofficeJs: `${base}soffice.js`,\n    sofficeWasm: `${base}soffice.wasm.gz`,\n    sofficeData: `${base}soffice.data.gz`,\n    sofficeWorkerJs: `${base}soffice.worker.js`,\n  };\n}\n\n/**\n * Loading phases for WASM initialization\n * Used to track detailed progress during the ~80 second browser startup\n */\nexport type WasmLoadPhase =\n  | 'download-wasm'    // Downloading soffice.wasm (~142MB)\n  | 'download-data'    // Downloading soffice.data (~96MB)\n  | 'compile'          // WebAssembly compilation\n  | 'filesystem'       // Emscripten filesystem setup\n  | 'lok-init'         // LibreOfficeKit initialization\n  | 'ready' | 'starting' | 'loading' | 'initializing' | 'converting' | 'complete';           // Complete\n\n/**\n * Extended progress information with download details\n * Backward compatible - existing code using percent/message continues to work\n */\nexport interface WasmLoadProgress {\n  /** Overall progress 0-100 */\n  percent: number;\n  /** Human-readable status message */\n  message: string;\n  /** Current loading phase */\n  phase: WasmLoadPhase;\n  /** Bytes downloaded (present during download phases) */\n  bytesLoaded?: number;\n  /** Total bytes to download (present during download phases) */\n  bytesTotal?: number;\n}\n\n/**\n * Progress information\n * @deprecated Use WasmLoadProgress for richer progress data\n */\nexport interface ProgressInfo {\n  phase: 'loading' | 'initializing' | 'converting' | 'complete';\n  percent: number;\n  message: string;\n}\n\n/**\n * Error codes for conversion failures\n */\nexport enum ConversionErrorCode {\n  UNKNOWN = 'UNKNOWN',\n  INVALID_INPUT = 'INVALID_INPUT',\n  UNSUPPORTED_FORMAT = 'UNSUPPORTED_FORMAT',\n  CORRUPTED_DOCUMENT = 'CORRUPTED_DOCUMENT',\n  PASSWORD_REQUIRED = 'PASSWORD_REQUIRED',\n  WASM_NOT_INITIALIZED = 'WASM_NOT_INITIALIZED',\n  CONVERSION_FAILED = 'CONVERSION_FAILED',\n  LOAD_FAILED = 'LOAD_FAILED',\n}\n\n/**\n * Custom error class for conversion errors\n */\nexport class ConversionError extends Error {\n  public readonly code: ConversionErrorCode;\n  public readonly details?: string;\n\n  constructor(code: ConversionErrorCode, message: string, details?: string) {\n    super(message);\n    this.name = 'ConversionError';\n    this.code = code;\n    this.details = details;\n  }\n}\n\n/**\n * Emscripten Module interface\n */\nexport interface EmscriptenModule {\n  // Core Emscripten functions\n  ccall: (\n    name: string,\n    returnType: string | null,\n    argTypes: string[],\n    args: unknown[]\n  ) => unknown;\n  cwrap: (\n    name: string,\n    returnType: string | null,\n    argTypes: string[]\n  ) => (...args: unknown[]) => unknown;\n\n  // Memory management\n  _malloc: (size: number) => number;\n  _free: (ptr: number) => void;\n  HEAPU8: Uint8Array;\n  HEAP32: Int32Array;\n  HEAPU32: Uint32Array;\n\n  // File system\n  FS: EmscriptenFS;\n\n  // Lifecycle\n  onRuntimeInitialized?: () => void;\n  calledRun?: boolean;\n\n  // LibreOfficeKit hooks (exported C functions)\n  _lok_preinit?: (path: number, args: number) => number;\n  _lok_preinit_2?: (path: number, args: number, callback: number) => number;\n  _libreofficekit_hook?: (path: number) => number;\n  _libreofficekit_hook_2?: (path: number, userProfile: number) => number;\n  _main?: (argc: number, argv: number) => number;\n\n  // WebAssembly function table for indirect calls\n  wasmTable?: WebAssembly.Table;\n\n  // Module locator\n  locateFile?: (path: string) => string;\n  print?: (text: string) => void;\n  printErr?: (text: string) => void;\n\n  // Runtime ready promise (some builds)\n  ready?: Promise<EmscriptenModule>;\n}\n\n/**\n * Emscripten virtual filesystem\n */\nexport interface EmscriptenFS {\n  mkdir: (path: string) => void;\n  writeFile: (path: string, data: Uint8Array | string, opts?: { encoding?: string }) => void;\n  readFile: (path: string, opts?: { encoding?: string }) => Uint8Array | string;\n  unlink: (path: string) => void;\n  readdir: (path: string) => string[];\n  stat: (path: string) => { size: number; isDirectory: () => boolean };\n  rmdir: (path: string) => void;\n  rename: (oldPath: string, newPath: string) => void;\n  open: (path: string, flags: unknown, mode?: unknown) => unknown;\n}\n\n/**\n * Filter name mapping for LibreOffice export\n * Note: For image exports, use getFilterForDocType() instead as filters are document-type specific\n */\nexport const FORMAT_FILTERS: Record<OutputFormat, string> = {\n  pdf: 'writer_pdf_Export',\n  docx: 'MS Word 2007 XML',\n  doc: 'MS Word 97',\n  odt: 'writer8',\n  rtf: 'Rich Text Format',\n  txt: 'Text',\n  html: 'HTML (StarWriter)',\n  xlsx: 'Calc MS Excel 2007 XML',\n  xls: 'MS Excel 97',\n  ods: 'calc8',\n  csv: 'Text - txt - csv (StarCalc)',\n  pptx: 'Impress MS PowerPoint 2007 XML',\n  ppt: 'MS PowerPoint 97',\n  odp: 'impress8',\n  png: 'writer_png_Export',\n  jpg: 'writer_jpg_Export',\n  svg: 'writer_svg_Export',\n};\n\n/**\n * LibreOfficeKit document types (from LibreOfficeKitEnums.h)\n */\nexport enum LOKDocumentType {\n  TEXT = 0,\n  SPREADSHEET = 1,\n  PRESENTATION = 2,\n  DRAWING = 3,\n  OTHER = 4,\n}\n\n/**\n * Document-type-specific filters for image and PDF exports\n * Each document type (Writer, Calc, Impress, Draw) has its own export filters\n */\nexport const DOC_TYPE_FILTERS: Record<LOKDocumentType, Partial<Record<OutputFormat, string>>> = {\n  [LOKDocumentType.TEXT]: {\n    pdf: 'writer_pdf_Export',\n    png: 'writer_png_Export',\n    jpg: 'writer_jpg_Export',\n    svg: 'writer_svg_Export',\n    html: 'HTML (StarWriter)',\n  },\n  [LOKDocumentType.SPREADSHEET]: {\n    pdf: 'calc_pdf_Export',\n    png: 'calc_png_Export',\n    jpg: 'calc_jpg_Export',\n    svg: 'calc_svg_Export',\n    html: 'HTML (StarCalc)',\n  },\n  [LOKDocumentType.PRESENTATION]: {\n    pdf: 'impress_pdf_Export',\n    png: 'impress_png_Export',\n    jpg: 'impress_jpg_Export',\n    svg: 'impress_svg_Export',\n    html: 'impress_html_Export',\n  },\n  [LOKDocumentType.DRAWING]: {\n    pdf: 'draw_pdf_Export',\n    png: 'draw_png_Export',\n    jpg: 'draw_jpg_Export',\n    svg: 'draw_svg_Export',\n    html: 'draw_html_Export',\n  },\n  [LOKDocumentType.OTHER]: {\n    pdf: 'writer_pdf_Export',\n    png: 'writer_png_Export',\n    jpg: 'writer_jpg_Export',\n    svg: 'writer_svg_Export',\n  },\n};\n\n/**\n * Get the correct export filter for a given output format and document type\n * @param outputFormat The desired output format\n * @param docType The LibreOfficeKit document type (use documentGetDocumentType())\n * @returns The filter name to use for saveAs\n */\nexport function getFilterForDocType(outputFormat: OutputFormat, docType: LOKDocumentType | number): string {\n  // Check if there's a document-type-specific filter\n  const docTypeFilters = DOC_TYPE_FILTERS[docType as LOKDocumentType];\n  if (docTypeFilters && docTypeFilters[outputFormat]) {\n    return docTypeFilters[outputFormat];\n  }\n  \n  // Fall back to the default filter\n  return FORMAT_FILTERS[outputFormat];\n}\n\n/**\n * MIME types for output formats\n */\nexport const FORMAT_MIME_TYPES: Record<OutputFormat, string> = {\n  pdf: 'application/pdf',\n  docx: 'application/vnd.openxmlformats-officedocument.wordprocessingml.document',\n  doc: 'application/msword',\n  odt: 'application/vnd.oasis.opendocument.text',\n  rtf: 'application/rtf',\n  txt: 'text/plain',\n  html: 'text/html',\n  xlsx: 'application/vnd.openxmlformats-officedocument.spreadsheetml.sheet',\n  xls: 'application/vnd.ms-excel',\n  ods: 'application/vnd.oasis.opendocument.spreadsheet',\n  csv: 'text/csv',\n  pptx: 'application/vnd.openxmlformats-officedocument.presentationml.presentation',\n  ppt: 'application/vnd.ms-powerpoint',\n  odp: 'application/vnd.oasis.opendocument.presentation',\n  png: 'image/png',\n  jpg: 'image/jpeg',\n  svg: 'image/svg+xml',\n};\n\n/**\n * File extension to format mapping\n */\nexport const EXTENSION_TO_FORMAT: Record<string, InputFormat> = {\n  doc: 'doc',\n  docx: 'docx',\n  xls: 'xls',\n  xlsx: 'xlsx',\n  ppt: 'ppt',\n  pptx: 'pptx',\n  odt: 'odt',\n  ods: 'ods',\n  odp: 'odp',\n  odg: 'odg',\n  odf: 'odf',\n  rtf: 'rtf',\n  txt: 'txt',\n  html: 'html',\n  htm: 'html',\n  csv: 'csv',\n  xml: 'xml',\n  epub: 'epub',\n  pdf: 'pdf',\n};\n\n/**\n * Map LOK document type to valid output formats\n * This is based on LibreOffice's actual extension maps in desktop/source/lib/init.cxx\n * \n * IMPORTANT: These are the formats that LibreOffice's saveAs() actually supports.\n * The extension maps in init.cxx determine what filters are available per document type.\n * \n * Writer (TEXT): doc, docx, odt, pdf, rtf, txt, html, png, epub\n * Calc (SPREADSHEET): csv, ods, pdf, xls, xlsx, html, png\n * Impress (PRESENTATION): odp, pdf, ppt, pptx, svg, html, png\n * Draw (DRAWING): odg, pdf, svg, html, png\n * \n * NOTE: jpg is NOT in any extension map! Only png is supported for image export.\n * NOTE: svg is only supported for Impress and Draw, not Writer or Calc.\n */\nexport const LOK_DOCTYPE_OUTPUT_FORMATS: Record<LOKDocumentType, OutputFormat[]> = {\n  [LOKDocumentType.TEXT]: ['pdf', 'docx', 'doc', 'odt', 'rtf', 'txt', 'html', 'png'],\n  [LOKDocumentType.SPREADSHEET]: ['pdf', 'xlsx', 'xls', 'ods', 'csv', 'html', 'png'],\n  [LOKDocumentType.PRESENTATION]: ['pdf', 'pptx', 'ppt', 'odp', 'png', 'svg', 'html'],\n  [LOKDocumentType.DRAWING]: ['pdf', 'png', 'svg', 'html'],\n  [LOKDocumentType.OTHER]: ['pdf'],\n};\n\n/**\n * Get valid output formats for a LOK document type\n * Use this after loading a document to get accurate conversion options\n * @param docType The LOK document type (from documentGetDocumentType)\n * @returns Array of valid output formats\n */\nexport function getOutputFormatsForDocType(docType: LOKDocumentType | number): OutputFormat[] {\n  return LOK_DOCTYPE_OUTPUT_FORMATS[docType as LOKDocumentType] || ['pdf'];\n}\n\n/**\n * Map output format to LOK format string\n * These are the format names used by LibreOfficeKit's saveAs\n */\nexport const OUTPUT_FORMAT_TO_LOK: Record<OutputFormat, string> = {\n  pdf: 'pdf',\n  docx: 'docx',\n  doc: 'doc',\n  odt: 'odt',\n  rtf: 'rtf',\n  txt: 'txt',\n  html: 'html',\n  xlsx: 'xlsx',\n  xls: 'xls',\n  ods: 'ods',\n  csv: 'csv',\n  pptx: 'pptx',\n  ppt: 'ppt',\n  odp: 'odp',\n  png: 'png',\n  jpg: 'jpg',\n  svg: 'svg',\n};\n\n/**\n * Filter options for specific format conversions\n * These are passed to LibreOfficeKit's saveAs as the filterOptions parameter\n */\nexport const FORMAT_FILTER_OPTIONS: Partial<Record<OutputFormat, string>> = {\n  // PDF options can include things like:\n  // - SelectPdfVersion (0=PDF 1.4, 1=PDF/A-1, 2=PDF/A-2, 3=PDF/A-3)\n  // - UseLosslessCompression\n  // - Quality\n  pdf: '',\n  // CSV can specify separator, encoding, etc.\n  csv: '44,34,76,1,,0,false,true,false,false,false,-1',\n  // Text encoding\n  txt: 'UTF8',\n};\n\n/**\n * Document type categories for determining valid conversions\n */\nexport type DocumentCategory = 'text' | 'spreadsheet' | 'presentation' | 'drawing' | 'other';\n\n/**\n * Map input formats to their document category\n * This determines which output formats are valid\n */\nexport const INPUT_FORMAT_CATEGORY: Record<InputFormat, DocumentCategory> = {\n  // Text/Writer documents\n  doc: 'text',\n  docx: 'text',\n  odt: 'text',\n  rtf: 'text',\n  txt: 'text',\n  html: 'text',\n  htm: 'text',\n  epub: 'text',\n  xml: 'text',\n  // Spreadsheet/Calc documents\n  xls: 'spreadsheet',\n  xlsx: 'spreadsheet',\n  ods: 'spreadsheet',\n  csv: 'spreadsheet',\n  // Presentation/Impress documents\n  ppt: 'presentation',\n  pptx: 'presentation',\n  odp: 'presentation',\n  // Drawing/Draw documents (PDF imports as Draw)\n  odg: 'drawing',\n  odf: 'drawing',\n  pdf: 'drawing', // PDFs are imported as Draw documents\n};\n\n/**\n * Valid output formats for each document category\n * Based on LibreOffice's actual filter capabilities\n */\nexport const CATEGORY_OUTPUT_FORMATS: Record<DocumentCategory, OutputFormat[]> = {\n  // Writer documents can export to (based on aWriterExtensionMap in init.cxx):\n  // NOTE: jpg and svg are NOT supported for Writer - only png for images\n  text: ['pdf', 'docx', 'doc', 'odt', 'rtf', 'txt', 'html', 'png'],\n  // Calc documents can export to (based on aCalcExtensionMap in init.cxx):\n  // NOTE: jpg and svg are NOT supported for Calc - only png for images\n  spreadsheet: ['pdf', 'xlsx', 'xls', 'ods', 'csv', 'html', 'png'],\n  // Impress documents can export to (based on aImpressExtensionMap in init.cxx):\n  // NOTE: jpg is NOT supported - only png and svg for images\n  presentation: ['pdf', 'pptx', 'ppt', 'odp', 'png', 'svg', 'html'],\n  // Draw documents (including imported PDFs) can export to (based on aDrawExtensionMap in init.cxx):\n  // NOTE: jpg is NOT supported - only png and svg for images\n  drawing: ['pdf', 'png', 'svg', 'html'],\n  // Other/unknown - try PDF only\n  other: ['pdf'],\n};\n\n/**\n * Get valid output formats for a given input format\n * @param inputFormat The input document format\n * @returns Array of valid output formats\n */\nexport function getValidOutputFormats(inputFormat: InputFormat | string): OutputFormat[] {\n  const format = inputFormat.toLowerCase() as InputFormat;\n  const category = INPUT_FORMAT_CATEGORY[format];\n  \n  if (!category) {\n    // Unknown format - allow PDF as a safe default\n    return ['pdf'];\n  }\n  \n  return CATEGORY_OUTPUT_FORMATS[category];\n}\n\n/**\n * Check if a conversion from input format to output format is valid\n * @param inputFormat The input document format\n * @param outputFormat The desired output format\n * @returns true if the conversion is supported\n */\nexport function isConversionValid(\n  inputFormat: InputFormat | string,\n  outputFormat: OutputFormat | string\n): boolean {\n  const validOutputs = getValidOutputFormats(inputFormat);\n  return validOutputs.includes(outputFormat.toLowerCase() as OutputFormat);\n}\n\n/**\n * Get a human-readable error message for invalid conversions\n * @param inputFormat The input document format\n * @param outputFormat The desired output format\n * @returns Error message explaining why the conversion is not supported\n */\nexport function getConversionErrorMessage(\n  inputFormat: InputFormat | string,\n  outputFormat: OutputFormat | string\n): string {\n  const input = inputFormat.toLowerCase();\n  const output = outputFormat.toLowerCase();\n  const validOutputs = getValidOutputFormats(input as InputFormat);\n  \n  const category = INPUT_FORMAT_CATEGORY[input as InputFormat] || 'unknown';\n  \n  let reason = '';\n  if (category === 'drawing' && ['docx', 'doc', 'xlsx', 'xls', 'pptx', 'ppt'].includes(output)) {\n    reason = `PDF files are imported as Draw documents and cannot be exported to Office formats. `;\n  } else if (category === 'spreadsheet' && ['docx', 'doc', 'pptx', 'ppt'].includes(output)) {\n    reason = `Spreadsheet documents cannot be converted to word processing or presentation formats. `;\n  } else if (category === 'presentation' && ['docx', 'doc', 'xlsx', 'xls'].includes(output)) {\n    reason = `Presentation documents cannot be converted to word processing or spreadsheet formats. `;\n  } else if (category === 'text' && ['xlsx', 'xls', 'pptx', 'ppt'].includes(output)) {\n    reason = `Text documents cannot be converted to spreadsheet or presentation formats. `;\n  }\n  \n  return `Cannot convert ${input.toUpperCase()} to ${output.toUpperCase()}. ${reason}Valid output formats for ${input.toUpperCase()}: ${validOutputs.join(', ')}`;\n}\n\n// ============================================\n// Shared Converter Interface\n// ============================================\n\n/**\n * Page preview data returned by renderPage/renderPagePreviews\n */\nexport interface PagePreview {\n  page: number;\n  data: Uint8Array;\n  width: number;\n  height: number;\n}\n\n/**\n * Document information returned by getDocumentInfo\n */\nexport interface DocumentInfo {\n  documentType: LOKDocumentType | number;\n  documentTypeName: string;\n  validOutputFormats: OutputFormat[];\n  pageCount: number;\n}\n\n/**\n * Options for rendering page previews\n */\nexport interface RenderOptions {\n  /** Width of rendered image in pixels */\n  width?: number;\n  /** Height of rendered image in pixels (0 = auto based on aspect ratio) */\n  height?: number;\n  /** Specific page indices to render (0-based). If empty, renders all pages */\n  pageIndices?: number[];\n  /**\n   * Render in edit mode (shows text input boxes, cursors, etc.)\n   * Default is false - presentations render in view/read mode for clean output\n   */\n  editMode?: boolean;\n}\n\n/**\n * Options for full quality page rendering\n */\nexport interface FullQualityRenderOptions {\n  /** DPI for rendering (default 150, use 300 for print quality) */\n  dpi?: number;\n  /** Maximum dimension (width or height) to prevent memory issues */\n  maxDimension?: number;\n  /**\n   * Render in edit mode (shows text input boxes, cursors, etc.)\n   * Default is false - presentations render in view/read mode for clean output\n   */\n  editMode?: boolean;\n}\n\n/**\n * Full quality page preview with DPI information\n */\nexport interface FullQualityPagePreview extends PagePreview {\n  /** Effective DPI (may differ from requested if capped) */\n  dpi: number;\n}\n\n/**\n * Editor session returned from openDocument\n */\nexport interface EditorSession {\n  sessionId: string;\n  documentType: string;\n  pageCount: number;\n}\n\n/**\n * Result from editor operations\n */\nexport interface EditorOperationResult<T = unknown> {\n  success: boolean;\n  verified?: boolean;\n  data?: T;\n  error?: string;\n  suggestion?: string;\n}\n\n/**\n * Options containing input format for document operations.\n */\nexport type InputFormatOptions = Pick<ConversionOptions, 'inputFormat'>;\n\n/**\n * Common interface for all LibreOffice converter implementations.\n * Ensures consistent API across different threading models (main thread, workers, child processes).\n *\n * All methods returning Promise are async in the interface to allow implementations\n * flexibility in whether they need actual async operations.\n */\nexport interface ILibreOfficeConverter {\n  // ============================================\n  // Lifecycle\n  // ============================================\n\n  /** Initialize the converter. Must be called before any other operations. */\n  initialize(): Promise<void>;\n\n  /** Destroy the converter and release all resources. */\n  destroy(): Promise<void>;\n\n  /** Check if the converter is ready for operations. */\n  isReady(): boolean;\n\n  // ============================================\n  // Core Conversion\n  // ============================================\n\n  /** Convert a document to a different format. */\n  convert(\n    input: Uint8Array | ArrayBuffer,\n    options: ConversionOptions,\n    filename?: string\n  ): Promise<ConversionResult>;\n\n  // ============================================\n  // Document Inspection\n  // ============================================\n\n  /** Get the number of pages in a document. */\n  getPageCount(\n    input: Uint8Array | ArrayBuffer,\n    options: InputFormatOptions\n  ): Promise<number>;\n\n  /** Get document information including type and valid output formats. */\n  getDocumentInfo(\n    input: Uint8Array | ArrayBuffer,\n    options: InputFormatOptions\n  ): Promise<DocumentInfo>;\n\n  // ============================================\n  // Page Rendering\n  // ============================================\n\n  /** Render a single page as an image. */\n  renderPage(\n    input: Uint8Array | ArrayBuffer,\n    options: InputFormatOptions,\n    pageIndex: number,\n    width: number,\n    height?: number\n  ): Promise<PagePreview>;\n\n  /** Render multiple pages as images. */\n  renderPagePreviews(\n    input: Uint8Array | ArrayBuffer,\n    options: InputFormatOptions,\n    renderOptions?: RenderOptions\n  ): Promise<PagePreview[]>;\n\n  /**\n   * Render a page at full quality (native resolution based on DPI).\n   * Unlike renderPage which scales to a fixed width, this renders at the\n   * document's native resolution converted to pixels at the specified DPI.\n   */\n  renderPageFullQuality(\n    input: Uint8Array | ArrayBuffer,\n    options: InputFormatOptions,\n    pageIndex: number,\n    renderOptions?: FullQualityRenderOptions\n  ): Promise<FullQualityPagePreview>;\n\n  // ============================================\n  // Editor Operations\n  // ============================================\n\n  /** Open a document for editing and return a session. */\n  openDocument(\n    input: Uint8Array | ArrayBuffer,\n    options: InputFormatOptions\n  ): Promise<EditorSession>;\n\n  /** Execute an editor operation on an open document. */\n  editorOperation<T = unknown>(\n    sessionId: string,\n    method: string,\n    args?: unknown[]\n  ): Promise<EditorOperationResult<T>>;\n\n  /** Close an editor session and optionally get the modified document. */\n  closeDocument(sessionId: string): Promise<Uint8Array | undefined>;\n}\n","// src/editor/base.ts\nimport type { LOKBindings } from '../lok-bindings.js';\nimport type { OutputFormat } from '../types.js';\nimport type {\n  OperationResult,\n  DocumentStructure,\n  OpenDocumentOptions,\n  SelectionRange,\n  FindOptions,\n  Position,\n  TruncationInfo,\n  CellRef,\n} from './types.js';\n\n/**\n * Abstract base class for all document editors\n */\nexport abstract class OfficeEditor {\n  protected lok: LOKBindings;\n  protected docPtr: number;\n  protected options: Required<Pick<OpenDocumentOptions, 'maxResponseChars'>> & OpenDocumentOptions;\n  protected inputPath: string = '';\n\n  constructor(lok: LOKBindings, docPtr: number, options: OpenDocumentOptions = {}) {\n    this.lok = lok;\n    this.docPtr = docPtr;\n    this.options = {\n      maxResponseChars: options.maxResponseChars ?? 8000,\n      ...options,\n    };\n  }\n\n  // ============================================\n  // Abstract methods (implemented by subclasses)\n  // ============================================\n\n  abstract getStructure(options?: { maxResponseChars?: number }): OperationResult<DocumentStructure>;\n  abstract getDocumentType(): 'writer' | 'calc' | 'impress' | 'draw';\n\n  // ============================================\n  // Accessor methods\n  // ============================================\n\n  /**\n   * Get the document pointer for low-level LOK operations\n   */\n  getDocPtr(): number {\n    return this.docPtr;\n  }\n\n  /**\n   * Get the LOK bindings for low-level operations\n   */\n  getLokBindings(): LOKBindings {\n    return this.lok;\n  }\n\n  // ============================================\n  // Lifecycle methods\n  // ============================================\n\n  save(): OperationResult<{ path: string }> {\n    try {\n      // Save to the original path\n      if (!this.inputPath) {\n        return this.createErrorResult('No input path set', 'Use saveAs() to specify a path');\n      }\n      // LibreOffice auto-saves on document operations, but we can force it\n      this.lok.postUnoCommand(this.docPtr, '.uno:Save');\n      return this.createResult({ path: this.inputPath });\n    } catch (error) {\n      return this.createErrorResult(`Save failed: ${String(error)}`);\n    }\n  }\n\n  saveAs(path: string, format: OutputFormat): OperationResult<{ path: string }> {\n    try {\n      this.lok.documentSaveAs(this.docPtr, path, format, '');\n      return this.createResult({ path });\n    } catch (error) {\n      return this.createErrorResult(`SaveAs failed: ${String(error)}`);\n    }\n  }\n\n  close(): OperationResult<void> {\n    try {\n      this.lok.documentDestroy(this.docPtr);\n      this.docPtr = 0;\n      return this.createResult(undefined);\n    } catch (error) {\n      return this.createErrorResult(`Close failed: ${String(error)}`);\n    }\n  }\n\n  /**\n   * Get the current edit mode of the document\n   * @returns 0 = view mode, 1 = edit mode\n   */\n  getEditMode(): number {\n    return this.lok.getEditMode(this.docPtr);\n  }\n\n  /**\n   * Attempt to enable edit mode for the document\n   * @returns OperationResult with success and verified fields\n   */\n  enableEditMode(): OperationResult<{ editMode: number }> {\n    try {\n      const beforeMode = this.lok.getEditMode(this.docPtr);\n      if (beforeMode === 1) {\n        // Already in edit mode\n        return this.createResult({ editMode: 1 });\n      }\n\n      // Try .uno:Edit command to switch to edit mode\n      this.lok.postUnoCommand(this.docPtr, '.uno:Edit');\n\n      const afterMode = this.lok.getEditMode(this.docPtr);\n      return {\n        success: true,\n        verified: afterMode === 1,\n        data: { editMode: afterMode },\n      };\n    } catch (error) {\n      return this.createErrorResult(`Failed to enable edit mode: ${String(error)}`);\n    }\n  }\n\n  // ============================================\n  // History methods\n  // ============================================\n\n  undo(): OperationResult<void> {\n    try {\n      this.lok.postUnoCommand(this.docPtr, '.uno:Undo');\n      return this.createResult(undefined);\n    } catch (error) {\n      return this.createErrorResult(`Undo failed: ${String(error)}`);\n    }\n  }\n\n  redo(): OperationResult<void> {\n    try {\n      this.lok.postUnoCommand(this.docPtr, '.uno:Redo');\n      return this.createResult(undefined);\n    } catch (error) {\n      return this.createErrorResult(`Redo failed: ${String(error)}`);\n    }\n  }\n\n  // ============================================\n  // Search methods\n  // ============================================\n\n  find(text: string, options?: FindOptions): OperationResult<{ matches: number; firstMatch?: Position }> {\n    try {\n      const searchArgs = JSON.stringify({\n        'SearchItem.SearchString': { type: 'string', value: text },\n        'SearchItem.Backward': { type: 'boolean', value: false },\n        'SearchItem.SearchAll': { type: 'boolean', value: true },\n        'SearchItem.MatchCase': { type: 'boolean', value: options?.caseSensitive ?? false },\n        'SearchItem.WordOnly': { type: 'boolean', value: options?.wholeWord ?? false },\n      });\n\n      this.lok.postUnoCommand(this.docPtr, '.uno:ExecuteSearch', searchArgs);\n\n      // Get search results - this is approximate as LOK doesn't return match count directly\n      const selection = this.lok.getTextSelection(this.docPtr, 'text/plain');\n      const hasMatch = selection !== null && selection.length > 0;\n\n      return this.createResult({\n        matches: hasMatch ? 1 : 0, // LOK doesn't provide count, we report if found\n        firstMatch: hasMatch ? { x: 0, y: 0 } : undefined,\n      });\n    } catch (error) {\n      return this.createErrorResult(`Find failed: ${String(error)}`);\n    }\n  }\n\n  findAndReplaceAll(find: string, replace: string, options?: FindOptions): OperationResult<{ replacements: number }> {\n    try {\n      const searchArgs = JSON.stringify({\n        'SearchItem.SearchString': { type: 'string', value: find },\n        'SearchItem.ReplaceString': { type: 'string', value: replace },\n        'SearchItem.Command': { type: 'long', value: 3 }, // Replace All\n        'SearchItem.MatchCase': { type: 'boolean', value: options?.caseSensitive ?? false },\n        'SearchItem.WordOnly': { type: 'boolean', value: options?.wholeWord ?? false },\n      });\n\n      this.lok.postUnoCommand(this.docPtr, '.uno:ExecuteSearch', searchArgs);\n\n      // LOK doesn't return replacement count, we assume success\n      return this.createResult({ replacements: -1 }); // -1 indicates unknown count\n    } catch (error) {\n      return this.createErrorResult(`Replace failed: ${String(error)}`);\n    }\n  }\n\n  // ============================================\n  // Callback-based state retrieval\n  // ============================================\n\n  /**\n   * Poll all STATE_CHANGED callback events and return as a map.\n   *\n   * LOK sends STATE_CHANGED events when formatting state changes (e.g., when\n   * the cursor moves over bold text, `.uno:Bold=true` is emitted).\n   *\n   * Pattern for getting current format state:\n   * 1. clearCallbackQueue() - clear any stale events\n   * 2. Perform action that triggers state change (e.g., SelectWord)\n   * 3. flushCallbacks(docPtr) - force LOK to process callbacks\n   * 4. pollStateChanges() - retrieve the events\n   *\n   * @returns Map of UNO command names to their state values\n   *          e.g., Map { '.uno:Bold' => 'true', '.uno:Italic' => 'false' }\n   */\n  getStateChanges(): OperationResult<Map<string, string>> {\n    try {\n      const states = this.lok.pollStateChanges();\n      return this.createResult(states);\n    } catch (error) {\n      return this.createErrorResult(`Failed to poll state changes: ${String(error)}`);\n    }\n  }\n\n  /**\n   * Flush pending LOK callbacks and then poll for state changes.\n   * Convenience method that combines flushCallbacks + pollStateChanges.\n   *\n   * @returns Map of UNO command names to their state values\n   */\n  flushAndPollState(): OperationResult<Map<string, string>> {\n    try {\n      this.lok.flushCallbacks(this.docPtr);\n      const states = this.lok.pollStateChanges();\n      return this.createResult(states);\n    } catch (error) {\n      return this.createErrorResult(`Failed to flush and poll state: ${String(error)}`);\n    }\n  }\n\n  /**\n   * Clear the callback queue, useful before performing operations\n   * where you want to capture only new state changes.\n   */\n  clearCallbackQueue(): void {\n    this.lok.clearCallbackQueue();\n  }\n\n  // ============================================\n  // Selection methods\n  // ============================================\n\n  select(_selection: SelectionRange): OperationResult<{ selected: string }> {\n    try {\n      // Implementation depends on selection type - subclasses may override\n      // Base implementation just returns current selection\n      const text = this.lok.getTextSelection(this.docPtr, 'text/plain');\n      return this.createResult({ selected: text || '' });\n    } catch (error) {\n      return this.createErrorResult(`Select failed: ${String(error)}`);\n    }\n  }\n\n  getSelection(): OperationResult<{ text: string; range: SelectionRange }> {\n    try {\n      const text = this.lok.getTextSelection(this.docPtr, 'text/plain');\n      return this.createResult({\n        text: text || '',\n        range: { type: 'text', start: { paragraph: 0, character: 0 } },\n      });\n    } catch (error) {\n      return this.createErrorResult(`GetSelection failed: ${String(error)}`);\n    }\n  }\n\n  clearSelection(): OperationResult<void> {\n    try {\n      this.lok.resetSelection(this.docPtr);\n      return this.createResult(undefined);\n    } catch (error) {\n      return this.createErrorResult(`ClearSelection failed: ${String(error)}`);\n    }\n  }\n\n  // ============================================\n  // Protected helper methods\n  // ============================================\n\n  protected createResult<T>(data: T): OperationResult<T> {\n    return {\n      success: true,\n      verified: true,\n      data,\n    };\n  }\n\n  protected createErrorResult<T>(error: string, suggestion?: string): OperationResult<T> {\n    return {\n      success: false,\n      verified: false,\n      error,\n      suggestion,\n    };\n  }\n\n  protected createResultWithTruncation<T>(data: T, truncation?: TruncationInfo): OperationResult<T> {\n    return {\n      success: true,\n      verified: true,\n      data,\n      truncated: truncation,\n    };\n  }\n\n  protected truncateContent(content: string, maxChars?: number): {\n    content: string;\n    truncated: boolean;\n    original: number;\n    returned: number;\n  } {\n    const limit = maxChars ?? this.options.maxResponseChars;\n    const original = content.length;\n\n    if (original <= limit) {\n      return { content, truncated: false, original, returned: original };\n    }\n\n    // Truncate at a word boundary if possible\n    let truncated = content.slice(0, limit);\n    const lastSpace = truncated.lastIndexOf(' ');\n    if (lastSpace > limit * 0.8) {\n      truncated = truncated.slice(0, lastSpace);\n    }\n\n    return {\n      content: truncated,\n      truncated: true,\n      original,\n      returned: truncated.length,\n    };\n  }\n\n  protected truncateArray<T>(items: T[], maxChars: number, itemToString: (item: T) => string): {\n    items: T[];\n    truncated: boolean;\n    original: number;\n    returned: number;\n  } {\n    const original = items.length;\n    let charCount = 0;\n    let includedCount = 0;\n\n    for (const item of items) {\n      const itemStr = itemToString(item);\n      if (charCount + itemStr.length > maxChars) {\n        break;\n      }\n      charCount += itemStr.length;\n      includedCount++;\n    }\n\n    return {\n      items: items.slice(0, includedCount),\n      truncated: includedCount < original,\n      original,\n      returned: includedCount,\n    };\n  }\n\n  // ============================================\n  // Cell address helpers\n  // ============================================\n\n  protected a1ToRowCol(a1: string): { row: number; col: number } {\n    const match = a1.match(/^([A-Z]+)(\\d+)$/i);\n    if (!match) {\n      throw new Error(`Invalid A1 notation: ${a1}`);\n    }\n\n    const colStr = match[1]!.toUpperCase();\n    const rowStr = match[2]!;\n\n    let col = 0;\n    for (let i = 0; i < colStr.length; i++) {\n      col = col * 26 + (colStr.charCodeAt(i) - 64);\n    }\n    col -= 1; // 0-indexed\n\n    const row = parseInt(rowStr, 10) - 1; // 0-indexed\n\n    return { row, col };\n  }\n\n  protected rowColToA1(row: number, col: number): string {\n    let colStr = '';\n    let c = col + 1; // 1-indexed for conversion\n\n    while (c > 0) {\n      const remainder = (c - 1) % 26;\n      colStr = String.fromCharCode(65 + remainder) + colStr;\n      c = Math.floor((c - 1) / 26);\n    }\n\n    return `${colStr}${row + 1}`;\n  }\n\n  protected normalizeCellRef(ref: CellRef): { row: number; col: number } {\n    if (typeof ref === 'string') {\n      return this.a1ToRowCol(ref);\n    }\n    return ref;\n  }\n\n  // ============================================\n  // Internal state\n  // ============================================\n\n  setInputPath(path: string): void {\n    this.inputPath = path;\n  }\n\n  isOpen(): boolean {\n    return this.docPtr !== 0;\n  }\n}\n","// src/editor/writer.ts\nimport { OfficeEditor } from './base.js';\nimport type {\n  OperationResult,\n  WriterStructure,\n  Paragraph,\n  TextPosition,\n  TextRange,\n  TextFormat,\n} from './types.js';\n\n/**\n * Editor for Writer (text) documents\n */\nexport class WriterEditor extends OfficeEditor {\n  private cachedParagraphs: string[] | null = null;\n\n  getDocumentType(): 'writer' {\n    return 'writer';\n  }\n\n  getStructure(options?: { maxResponseChars?: number }): OperationResult<WriterStructure> {\n    try {\n      const paragraphs = this.getParagraphsInternal();\n      const maxChars = options?.maxResponseChars ?? this.options.maxResponseChars;\n\n      const paragraphInfos = paragraphs.map((text, index) => ({\n        index,\n        preview: text.slice(0, 100) + (text.length > 100 ? '...' : ''),\n        style: 'Normal', // Would need UNO query to get actual style\n        charCount: text.length,\n      }));\n\n      // Truncate if needed\n      const truncResult = this.truncateArray(\n        paragraphInfos,\n        maxChars,\n        (p) => JSON.stringify(p)\n      );\n\n      const structure: WriterStructure = {\n        type: 'writer',\n        paragraphs: truncResult.items,\n        pageCount: this.lok.documentGetParts(this.docPtr),\n        wordCount: paragraphs.join(' ').split(/\\s+/).filter(w => w.length > 0).length,\n      };\n\n      if (truncResult.truncated) {\n        return this.createResultWithTruncation(structure, {\n          original: truncResult.original,\n          returned: truncResult.returned,\n          message: `Showing ${truncResult.returned} of ${truncResult.original} paragraphs. Use getParagraphs(start, count) to paginate.`,\n        });\n      }\n\n      return this.createResult(structure);\n    } catch (error) {\n      return this.createErrorResult(`Failed to get structure: ${String(error)}`);\n    }\n  }\n\n  getParagraph(index: number): OperationResult<Paragraph> {\n    try {\n      const paragraphs = this.getParagraphsInternal();\n\n      if (index < 0 || index >= paragraphs.length) {\n        return this.createErrorResult(\n          `Paragraph index ${index} out of range (0-${paragraphs.length - 1})`,\n          `Use getStructure() to see available paragraphs`\n        );\n      }\n\n      const text = paragraphs[index]!;\n      return this.createResult({\n        index,\n        text,\n        style: 'Normal',\n        charCount: text.length,\n      });\n    } catch (error) {\n      return this.createErrorResult(`Failed to get paragraph: ${String(error)}`);\n    }\n  }\n\n  getParagraphs(start: number, count: number): OperationResult<Paragraph[]> {\n    try {\n      const paragraphs = this.getParagraphsInternal();\n\n      if (start < 0 || start >= paragraphs.length) {\n        return this.createErrorResult(\n          `Start index ${start} out of range`,\n          `Valid range: 0-${paragraphs.length - 1}`\n        );\n      }\n\n      const end = Math.min(start + count, paragraphs.length);\n      const result = paragraphs.slice(start, end).map((text, i) => ({\n        index: start + i,\n        text,\n        style: 'Normal',\n        charCount: text.length,\n      }));\n\n      return this.createResult(result);\n    } catch (error) {\n      return this.createErrorResult(`Failed to get paragraphs: ${String(error)}`);\n    }\n  }\n\n  insertParagraph(text: string, options?: {\n    afterIndex?: number;\n    style?: 'Normal' | 'Heading 1' | 'Heading 2' | 'Heading 3' | 'List';\n  }): OperationResult<{ index: number }> {\n    try {\n      const paragraphs = this.getParagraphsInternal();\n      const insertIndex = options?.afterIndex !== undefined\n        ? options.afterIndex + 1\n        : paragraphs.length;\n\n      // Move to end of target paragraph or document end\n      if (insertIndex > 0 && insertIndex <= paragraphs.length) {\n        // Navigate to position\n        this.lok.postUnoCommand(this.docPtr, '.uno:GoToEndOfDoc');\n      }\n\n      // Insert paragraph break and text\n      this.lok.postUnoCommand(this.docPtr, '.uno:InsertPara');\n\n      // Insert the text\n      const textArgs = JSON.stringify({\n        Text: { type: 'string', value: text },\n      });\n      this.lok.postUnoCommand(this.docPtr, '.uno:InsertText', textArgs);\n\n      // Apply style if specified\n      if (options?.style && options.style !== 'Normal') {\n        const styleMap: Record<string, string> = {\n          'Heading 1': 'Heading 1',\n          'Heading 2': 'Heading 2',\n          'Heading 3': 'Heading 3',\n          'List': 'List',\n        };\n        const styleName = styleMap[options.style];\n        if (styleName) {\n          const styleArgs = JSON.stringify({\n            Template: { type: 'string', value: styleName },\n            Family: { type: 'short', value: 2 }, // Paragraph styles\n          });\n          this.lok.postUnoCommand(this.docPtr, '.uno:StyleApply', styleArgs);\n        }\n      }\n\n      // Invalidate cache\n      this.cachedParagraphs = null;\n\n      // Verify by re-reading\n      const newParagraphs = this.getParagraphsInternal();\n      const verified = newParagraphs.length > paragraphs.length;\n\n      return {\n        success: true,\n        verified,\n        data: { index: insertIndex },\n      };\n    } catch (error) {\n      return this.createErrorResult(`Failed to insert paragraph: ${String(error)}`);\n    }\n  }\n\n  replaceParagraph(index: number, text: string): OperationResult<{ oldText: string }> {\n    try {\n      const paragraphs = this.getParagraphsInternal();\n\n      if (index < 0 || index >= paragraphs.length) {\n        return this.createErrorResult(\n          `Paragraph index ${index} out of range`,\n          `Valid range: 0-${paragraphs.length - 1}`\n        );\n      }\n\n      const oldText = paragraphs[index]!;\n\n      // Select the paragraph and replace\n      // This is a simplified implementation - full implementation would use cursor positioning\n      const findReplaceArgs = JSON.stringify({\n        'SearchItem.SearchString': { type: 'string', value: oldText },\n        'SearchItem.ReplaceString': { type: 'string', value: text },\n        'SearchItem.Command': { type: 'long', value: 2 }, // Replace\n      });\n      this.lok.postUnoCommand(this.docPtr, '.uno:ExecuteSearch', findReplaceArgs);\n\n      // Invalidate cache\n      this.cachedParagraphs = null;\n\n      return this.createResult({ oldText });\n    } catch (error) {\n      return this.createErrorResult(`Failed to replace paragraph: ${String(error)}`);\n    }\n  }\n\n  deleteParagraph(index: number): OperationResult<{ deletedText: string }> {\n    try {\n      const paragraphs = this.getParagraphsInternal();\n\n      if (index < 0 || index >= paragraphs.length) {\n        return this.createErrorResult(\n          `Paragraph index ${index} out of range`,\n          `Valid range: 0-${paragraphs.length - 1}`\n        );\n      }\n\n      const deletedText = paragraphs[index]!;\n\n      // Replace with empty string\n      const result = this.replaceParagraph(index, '');\n      if (!result.success) {\n        return this.createErrorResult(result.error || 'Failed to delete');\n      }\n\n      return this.createResult({ deletedText });\n    } catch (error) {\n      return this.createErrorResult(`Failed to delete paragraph: ${String(error)}`);\n    }\n  }\n\n  insertText(text: string, _position: TextPosition): OperationResult<void> {\n    try {\n      // TODO: Navigate to position using cursor before inserting\n      const textArgs = JSON.stringify({\n        Text: { type: 'string', value: text },\n      });\n      this.lok.postUnoCommand(this.docPtr, '.uno:InsertText', textArgs);\n\n      this.cachedParagraphs = null;\n      return this.createResult(undefined);\n    } catch (error) {\n      return this.createErrorResult(`Failed to insert text: ${String(error)}`);\n    }\n  }\n\n  deleteText(_start: TextPosition, _end: TextPosition): OperationResult<{ deleted: string }> {\n    try {\n      // TODO: Use start/end to select text range before deleting\n      // Get current selection\n      const selection = this.lok.getTextSelection(this.docPtr, 'text/plain');\n\n      // Delete selection\n      this.lok.postUnoCommand(this.docPtr, '.uno:Delete');\n\n      this.cachedParagraphs = null;\n      return this.createResult({ deleted: selection || '' });\n    } catch (error) {\n      return this.createErrorResult(`Failed to delete text: ${String(error)}`);\n    }\n  }\n\n  replaceText(find: string, replace: string, options?: {\n    paragraph?: number;\n    all?: boolean;\n  }): OperationResult<{ replacements: number }> {\n    try {\n      const command = options?.all ? 3 : 2; // 3 = Replace All, 2 = Replace\n\n      const searchArgs = JSON.stringify({\n        'SearchItem.SearchString': { type: 'string', value: find },\n        'SearchItem.ReplaceString': { type: 'string', value: replace },\n        'SearchItem.Command': { type: 'long', value: command },\n      });\n\n      this.lok.postUnoCommand(this.docPtr, '.uno:ExecuteSearch', searchArgs);\n\n      this.cachedParagraphs = null;\n\n      // LOK doesn't return count, we indicate success\n      return this.createResult({ replacements: -1 });\n    } catch (error) {\n      return this.createErrorResult(`Failed to replace text: ${String(error)}`);\n    }\n  }\n\n  formatText(_range: TextRange, format: TextFormat): OperationResult<void> {\n    try {\n      // TODO: Use range to select text before applying format\n      // Apply formatting commands\n      if (format.bold !== undefined) {\n        this.lok.postUnoCommand(this.docPtr, '.uno:Bold');\n      }\n      if (format.italic !== undefined) {\n        this.lok.postUnoCommand(this.docPtr, '.uno:Italic');\n      }\n      if (format.underline !== undefined) {\n        this.lok.postUnoCommand(this.docPtr, '.uno:Underline');\n      }\n      if (format.fontSize !== undefined) {\n        const args = JSON.stringify({\n          FontHeight: { type: 'float', value: format.fontSize },\n        });\n        this.lok.postUnoCommand(this.docPtr, '.uno:FontHeight', args);\n      }\n      if (format.fontName !== undefined) {\n        const args = JSON.stringify({\n          CharFontName: { type: 'string', value: format.fontName },\n        });\n        this.lok.postUnoCommand(this.docPtr, '.uno:CharFontName', args);\n      }\n\n      return this.createResult(undefined);\n    } catch (error) {\n      return this.createErrorResult(`Failed to format text: ${String(error)}`);\n    }\n  }\n\n  /**\n   * Get the text formatting at the current selection or cursor position.\n   *\n   * Uses LOK callback mechanism to retrieve STATE_CHANGED events which contain\n   * formatting state like `.uno:Bold=true`, `.uno:Italic=false`, etc.\n   *\n   * @param _position - Text position (currently unused, uses current selection)\n   * @returns TextFormat with bold, italic, underline, fontSize, fontName properties\n   */\n  getFormat(_position?: TextPosition): OperationResult<TextFormat> {\n    try {\n      // Clear any existing callback events\n      this.lok.clearCallbackQueue();\n\n      // Trigger a selection change to get current formatting state\n      // Moving cursor slightly and back triggers STATE_CHANGED callbacks\n      this.lok.postUnoCommand(this.docPtr, '.uno:CharRightSel');\n      this.lok.flushCallbacks(this.docPtr);\n      this.lok.postUnoCommand(this.docPtr, '.uno:CharLeft');\n      this.lok.flushCallbacks(this.docPtr);\n\n      // Poll STATE_CHANGED events to get formatting state\n      const states = this.lok.pollStateChanges();\n\n      // Parse the state values into TextFormat\n      const format: TextFormat = {};\n\n      // Bold: .uno:Bold=true or .uno:Bold=false\n      const boldState = states.get('.uno:Bold');\n      if (boldState !== undefined) {\n        format.bold = boldState === 'true';\n      }\n\n      // Italic: .uno:Italic=true or .uno:Italic=false\n      const italicState = states.get('.uno:Italic');\n      if (italicState !== undefined) {\n        format.italic = italicState === 'true';\n      }\n\n      // Underline: .uno:Underline=true or .uno:Underline=false\n      const underlineState = states.get('.uno:Underline');\n      if (underlineState !== undefined) {\n        format.underline = underlineState === 'true';\n      }\n\n      // Font size: .uno:FontHeight=12\n      const fontSizeState = states.get('.uno:FontHeight');\n      if (fontSizeState !== undefined) {\n        const size = parseFloat(fontSizeState);\n        if (!isNaN(size)) {\n          format.fontSize = size;\n        }\n      }\n\n      // Font name: .uno:CharFontName=Arial\n      const fontNameState = states.get('.uno:CharFontName');\n      if (fontNameState !== undefined && fontNameState.length > 0) {\n        format.fontName = fontNameState;\n      }\n\n      return this.createResult(format);\n    } catch (error) {\n      return this.createErrorResult(`Failed to get format: ${String(error)}`);\n    }\n  }\n\n  /**\n   * Get formatting state for the current selection using the callback mechanism.\n   * This is the preferred way to get character formatting as it uses LOK's\n   * STATE_CHANGED callback events.\n   *\n   * @returns Map of UNO command names to their state values\n   */\n  getSelectionFormat(): OperationResult<Map<string, string>> {\n    try {\n      // Poll any existing STATE_CHANGED events (from previous operations)\n      const existingStates = this.lok.pollStateChanges();\n\n      if (existingStates.size === 0) {\n        // No existing states, trigger a selection to get current format\n        this.lok.clearCallbackQueue();\n        this.lok.postUnoCommand(this.docPtr, '.uno:SelectWord');\n        this.lok.flushCallbacks(this.docPtr);\n        const states = this.lok.pollStateChanges();\n        return this.createResult(states);\n      }\n\n      return this.createResult(existingStates);\n    } catch (error) {\n      return this.createErrorResult(`Failed to get selection format: ${String(error)}`);\n    }\n  }\n\n  // ============================================\n  // Private helpers\n  // ============================================\n\n  private getParagraphsInternal(): string[] {\n    if (this.cachedParagraphs) {\n      return this.cachedParagraphs;\n    }\n\n    const allText = this.lok.getAllText(this.docPtr);\n    if (!allText) {\n      return [];\n    }\n\n    // Split by double newlines (paragraph breaks) or single newlines\n    this.cachedParagraphs = allText\n      .split(/\\n\\n|\\r\\n\\r\\n/)\n      .map(p => p.trim())\n      .filter(p => p.length > 0);\n\n    return this.cachedParagraphs;\n  }\n}\n","// src/editor/calc.ts\nimport { OfficeEditor } from './base.js';\nimport type {\n  OperationResult,\n  CalcStructure,\n  CellRef,\n  RangeRef,\n  SheetRef,\n  ColRef,\n  CellData,\n  CellValue,\n  CellFormat,\n  SheetInfo,\n} from './types.js';\n\n/**\n * Editor for Calc (spreadsheet) documents\n */\nexport class CalcEditor extends OfficeEditor {\n  getDocumentType(): 'calc' {\n    return 'calc';\n  }\n\n  getStructure(_options?: { maxResponseChars?: number }): OperationResult<CalcStructure> {\n    try {\n      const numSheets = this.lok.documentGetParts(this.docPtr);\n      const sheets: SheetInfo[] = [];\n\n      for (let i = 0; i < numSheets; i++) {\n        const name = this.lok.getPartName(this.docPtr, i) || `Sheet${i + 1}`;\n        const dataArea = this.lok.getDataArea(this.docPtr, i);\n\n        sheets.push({\n          index: i,\n          name,\n          usedRange: dataArea.col > 0 && dataArea.row > 0\n            ? `A1:${this.rowColToA1(dataArea.row - 1, dataArea.col - 1)}`\n            : 'A1',\n          rowCount: dataArea.row,\n          colCount: dataArea.col,\n        });\n      }\n\n      const structure: CalcStructure = {\n        type: 'calc',\n        sheets,\n      };\n\n      return this.createResult(structure);\n    } catch (error) {\n      return this.createErrorResult(`Failed to get structure: ${String(error)}`);\n    }\n  }\n\n  getSheetNames(): OperationResult<string[]> {\n    try {\n      const numSheets = this.lok.documentGetParts(this.docPtr);\n      const names: string[] = [];\n\n      for (let i = 0; i < numSheets; i++) {\n        const name = this.lok.getPartName(this.docPtr, i) || `Sheet${i + 1}`;\n        names.push(name);\n      }\n\n      return this.createResult(names);\n    } catch (error) {\n      return this.createErrorResult(`Failed to get sheet names: ${String(error)}`);\n    }\n  }\n\n  // ============================================\n  // Cell reading\n  // ============================================\n\n  getCell(cell: CellRef, sheet?: SheetRef): OperationResult<CellData> {\n    try {\n      this.selectSheet(sheet);\n      const { row, col } = this.normalizeCellRef(cell);\n      const address = this.rowColToA1(row, col);\n\n      // Navigate to cell\n      this.goToCell(address);\n\n      // Get value\n      const value = this.getCellValueInternal();\n      const formula = this.getCellFormulaInternal();\n\n      return this.createResult({\n        address,\n        value,\n        formula: formula || undefined,\n      });\n    } catch (error) {\n      return this.createErrorResult(`Failed to get cell: ${String(error)}`);\n    }\n  }\n\n  getCells(range: RangeRef, sheet?: SheetRef, options?: {\n    maxResponseChars?: number;\n  }): OperationResult<CellData[][]> {\n    try {\n      this.selectSheet(sheet);\n      const { startRow, startCol, endRow, endCol } = this.normalizeRangeRef(range);\n      const maxChars = options?.maxResponseChars ?? this.options.maxResponseChars;\n\n      const cells: CellData[][] = [];\n      let charCount = 0;\n      let truncated = false;\n\n      for (let r = startRow; r <= endRow && !truncated; r++) {\n        const rowData: CellData[] = [];\n\n        for (let c = startCol; c <= endCol && !truncated; c++) {\n          const address = this.rowColToA1(r, c);\n          this.goToCell(address);\n\n          const value = this.getCellValueInternal();\n          const cellData: CellData = { address, value };\n\n          const cellStr = JSON.stringify(cellData);\n          if (charCount + cellStr.length > maxChars) {\n            truncated = true;\n            break;\n          }\n\n          charCount += cellStr.length;\n          rowData.push(cellData);\n        }\n\n        if (rowData.length > 0) {\n          cells.push(rowData);\n        }\n      }\n\n      if (truncated) {\n        return this.createResultWithTruncation(cells, {\n          original: (endRow - startRow + 1) * (endCol - startCol + 1),\n          returned: cells.reduce((sum, row) => sum + row.length, 0),\n          message: 'Range truncated due to size. Use smaller ranges to paginate.',\n        });\n      }\n\n      return this.createResult(cells);\n    } catch (error) {\n      return this.createErrorResult(`Failed to get cells: ${String(error)}`);\n    }\n  }\n\n  // ============================================\n  // Cell writing\n  // ============================================\n\n  setCellValue(cell: CellRef, value: string | number, sheet?: SheetRef): OperationResult<{\n    oldValue: CellValue;\n    newValue: CellValue;\n  }> {\n    try {\n      this.selectSheet(sheet);\n      const { row, col } = this.normalizeCellRef(cell);\n      const address = this.rowColToA1(row, col);\n\n      // Get old value first\n      this.goToCell(address);\n      const oldValue = this.getCellValueInternal();\n\n      // Enter the new value\n      const valueStr = typeof value === 'number' ? value.toString() : value;\n      const args = JSON.stringify({\n        StringName: { type: 'string', value: valueStr },\n      });\n      this.lok.postUnoCommand(this.docPtr, '.uno:EnterString', args);\n\n      // Verify by re-reading the cell\n      const newValue = this.getCellValueInternal();\n      const expectedStr = typeof value === 'number' ? value.toString() : value;\n      const verified = newValue === expectedStr || newValue === value;\n\n      return {\n        success: true,\n        verified,\n        data: { oldValue, newValue },\n      };\n    } catch (error) {\n      return this.createErrorResult(`Failed to set cell value: ${String(error)}`);\n    }\n  }\n\n  setCellFormula(cell: CellRef, formula: string, sheet?: SheetRef): OperationResult<{\n    calculatedValue: CellValue;\n  }> {\n    try {\n      this.selectSheet(sheet);\n      const { row, col } = this.normalizeCellRef(cell);\n      const address = this.rowColToA1(row, col);\n\n      // Navigate and enter formula\n      this.goToCell(address);\n\n      const args = JSON.stringify({\n        StringName: { type: 'string', value: formula },\n      });\n      this.lok.postUnoCommand(this.docPtr, '.uno:EnterString', args);\n\n      // Get calculated value\n      const calculatedValue = this.getCellValueInternal();\n\n      return this.createResult({ calculatedValue });\n    } catch (error) {\n      return this.createErrorResult(`Failed to set formula: ${String(error)}`);\n    }\n  }\n\n  setCells(range: RangeRef, values: CellValue[][], sheet?: SheetRef): OperationResult<{\n    cellsUpdated: number;\n  }> {\n    try {\n      this.selectSheet(sheet);\n      const { startRow, startCol } = this.normalizeRangeRef(range);\n      let cellsUpdated = 0;\n\n      for (let r = 0; r < values.length; r++) {\n        const rowValues = values[r];\n        if (!rowValues) continue;\n\n        for (let c = 0; c < rowValues.length; c++) {\n          const value = rowValues[c];\n          if (value === null || value === undefined) continue;\n\n          const address = this.rowColToA1(startRow + r, startCol + c);\n          this.goToCell(address);\n\n          const valueStr = typeof value === 'number' ? value.toString() : String(value);\n          const args = JSON.stringify({\n            StringName: { type: 'string', value: valueStr },\n          });\n          this.lok.postUnoCommand(this.docPtr, '.uno:EnterString', args);\n          cellsUpdated++;\n        }\n      }\n\n      return this.createResult({ cellsUpdated });\n    } catch (error) {\n      return this.createErrorResult(`Failed to set cells: ${String(error)}`);\n    }\n  }\n\n  // ============================================\n  // Clear operations\n  // ============================================\n\n  clearCell(cell: CellRef, sheet?: SheetRef): OperationResult<{ oldValue: CellValue }> {\n    try {\n      this.selectSheet(sheet);\n      const { row, col } = this.normalizeCellRef(cell);\n      const address = this.rowColToA1(row, col);\n\n      this.goToCell(address);\n      const oldValue = this.getCellValueInternal();\n\n      this.lok.postUnoCommand(this.docPtr, '.uno:ClearContents');\n\n      return this.createResult({ oldValue });\n    } catch (error) {\n      return this.createErrorResult(`Failed to clear cell: ${String(error)}`);\n    }\n  }\n\n  clearRange(range: RangeRef, sheet?: SheetRef): OperationResult<{ cellsCleared: number }> {\n    try {\n      this.selectSheet(sheet);\n      const rangeStr = this.normalizeRangeToString(range);\n\n      // Select range and clear\n      this.goToCell(rangeStr);\n      this.lok.postUnoCommand(this.docPtr, '.uno:ClearContents');\n\n      // Count is approximate\n      const { startRow, startCol, endRow, endCol } = this.normalizeRangeRef(range);\n      const cellsCleared = (endRow - startRow + 1) * (endCol - startCol + 1);\n\n      return this.createResult({ cellsCleared });\n    } catch (error) {\n      return this.createErrorResult(`Failed to clear range: ${String(error)}`);\n    }\n  }\n\n  // ============================================\n  // Row/Column operations\n  // ============================================\n\n  insertRow(afterRow: number, sheet?: SheetRef): OperationResult<void> {\n    try {\n      this.selectSheet(sheet);\n      this.goToCell(this.rowColToA1(afterRow + 1, 0));\n      this.lok.postUnoCommand(this.docPtr, '.uno:InsertRows');\n      return this.createResult(undefined);\n    } catch (error) {\n      return this.createErrorResult(`Failed to insert row: ${String(error)}`);\n    }\n  }\n\n  insertColumn(afterCol: ColRef, sheet?: SheetRef): OperationResult<void> {\n    try {\n      this.selectSheet(sheet);\n      const colNum = typeof afterCol === 'string'\n        ? this.a1ToRowCol(afterCol + '1').col + 1\n        : afterCol + 1;\n\n      this.goToCell(this.rowColToA1(0, colNum));\n      this.lok.postUnoCommand(this.docPtr, '.uno:InsertColumns');\n      return this.createResult(undefined);\n    } catch (error) {\n      return this.createErrorResult(`Failed to insert column: ${String(error)}`);\n    }\n  }\n\n  deleteRow(row: number, sheet?: SheetRef): OperationResult<void> {\n    try {\n      this.selectSheet(sheet);\n      this.goToCell(this.rowColToA1(row, 0));\n      this.lok.postUnoCommand(this.docPtr, '.uno:DeleteRows');\n      return this.createResult(undefined);\n    } catch (error) {\n      return this.createErrorResult(`Failed to delete row: ${String(error)}`);\n    }\n  }\n\n  deleteColumn(col: ColRef, sheet?: SheetRef): OperationResult<void> {\n    try {\n      this.selectSheet(sheet);\n      const colNum = typeof col === 'string'\n        ? this.a1ToRowCol(col + '1').col\n        : col;\n\n      this.goToCell(this.rowColToA1(0, colNum));\n      this.lok.postUnoCommand(this.docPtr, '.uno:DeleteColumns');\n      return this.createResult(undefined);\n    } catch (error) {\n      return this.createErrorResult(`Failed to delete column: ${String(error)}`);\n    }\n  }\n\n  // ============================================\n  // Formatting\n  // ============================================\n\n  formatCells(range: RangeRef, format: CellFormat, sheet?: SheetRef): OperationResult<void> {\n    try {\n      this.selectSheet(sheet);\n      const rangeStr = this.normalizeRangeToString(range);\n      this.goToCell(rangeStr);\n\n      if (format.bold !== undefined) {\n        this.lok.postUnoCommand(this.docPtr, '.uno:Bold');\n      }\n      if (format.numberFormat !== undefined) {\n        const args = JSON.stringify({\n          NumberFormatValue: { type: 'string', value: format.numberFormat },\n        });\n        this.lok.postUnoCommand(this.docPtr, '.uno:NumberFormatValue', args);\n      }\n      if (format.backgroundColor !== undefined) {\n        const args = JSON.stringify({\n          BackgroundColor: { type: 'long', value: this.hexToNumber(format.backgroundColor) },\n        });\n        this.lok.postUnoCommand(this.docPtr, '.uno:BackgroundColor', args);\n      }\n\n      return this.createResult(undefined);\n    } catch (error) {\n      return this.createErrorResult(`Failed to format cells: ${String(error)}`);\n    }\n  }\n\n  // ============================================\n  // Sheet management\n  // ============================================\n\n  addSheet(name: string): OperationResult<{ index: number }> {\n    try {\n      const args = JSON.stringify({\n        Name: { type: 'string', value: name },\n      });\n      this.lok.postUnoCommand(this.docPtr, '.uno:Insert', args);\n\n      const numSheets = this.lok.documentGetParts(this.docPtr);\n      return this.createResult({ index: numSheets - 1 });\n    } catch (error) {\n      return this.createErrorResult(`Failed to add sheet: ${String(error)}`);\n    }\n  }\n\n  renameSheet(sheet: SheetRef, newName: string): OperationResult<void> {\n    try {\n      this.selectSheet(sheet);\n      const args = JSON.stringify({\n        Name: { type: 'string', value: newName },\n      });\n      this.lok.postUnoCommand(this.docPtr, '.uno:RenameTable', args);\n      return this.createResult(undefined);\n    } catch (error) {\n      return this.createErrorResult(`Failed to rename sheet: ${String(error)}`);\n    }\n  }\n\n  deleteSheet(sheet: SheetRef): OperationResult<void> {\n    try {\n      this.selectSheet(sheet);\n      this.lok.postUnoCommand(this.docPtr, '.uno:Remove');\n      return this.createResult(undefined);\n    } catch (error) {\n      return this.createErrorResult(`Failed to delete sheet: ${String(error)}`);\n    }\n  }\n\n  // ============================================\n  // Private helpers\n  // ============================================\n\n  private selectSheet(sheet?: SheetRef): void {\n    if (sheet === undefined) return;\n\n    const index = typeof sheet === 'number'\n      ? sheet\n      : this.getSheetIndexByName(sheet);\n\n    if (index >= 0) {\n      this.lok.documentSetPart(this.docPtr, index);\n    }\n  }\n\n  private getSheetIndexByName(name: string): number {\n    const numSheets = this.lok.documentGetParts(this.docPtr);\n    for (let i = 0; i < numSheets; i++) {\n      if (this.lok.getPartName(this.docPtr, i) === name) {\n        return i;\n      }\n    }\n    return -1;\n  }\n\n  private goToCell(address: string): void {\n    const args = JSON.stringify({\n      ToPoint: { type: 'string', value: address },\n    });\n    this.lok.postUnoCommand(this.docPtr, '.uno:GoToCell', args);\n  }\n\n  private getCellValueInternal(): CellValue {\n    const text = this.lok.getTextSelection(this.docPtr, 'text/plain');\n    if (!text) return null;\n\n    // Try to parse as number\n    const num = parseFloat(text);\n    if (!isNaN(num) && text.trim() === num.toString()) {\n      return num;\n    }\n\n    // Check for boolean\n    if (text.toLowerCase() === 'true') return true;\n    if (text.toLowerCase() === 'false') return false;\n\n    return text;\n  }\n\n  private getCellFormulaInternal(): string | null {\n    const result = this.lok.getCommandValues(this.docPtr, '.uno:GetFormulaBarText');\n    if (!result) return null;\n\n    try {\n      const parsed = JSON.parse(result) as { value?: string };\n      return parsed.value ?? null;\n    } catch {\n      return null;\n    }\n  }\n\n  private normalizeRangeRef(range: RangeRef): {\n    startRow: number;\n    startCol: number;\n    endRow: number;\n    endCol: number;\n  } {\n    if (typeof range === 'string') {\n      const parts = range.split(':');\n      const start = this.a1ToRowCol(parts[0]!);\n      const end = parts[1] ? this.a1ToRowCol(parts[1]) : start;\n      return {\n        startRow: start.row,\n        startCol: start.col,\n        endRow: end.row,\n        endCol: end.col,\n      };\n    }\n\n    const start = this.normalizeCellRef(range.start);\n    const end = this.normalizeCellRef(range.end);\n    return {\n      startRow: start.row,\n      startCol: start.col,\n      endRow: end.row,\n      endCol: end.col,\n    };\n  }\n\n  private normalizeRangeToString(range: RangeRef): string {\n    if (typeof range === 'string') return range;\n\n    const start = this.normalizeCellRef(range.start);\n    const end = this.normalizeCellRef(range.end);\n    return `${this.rowColToA1(start.row, start.col)}:${this.rowColToA1(end.row, end.col)}`;\n  }\n\n  private hexToNumber(hex: string): number {\n    return parseInt(hex.replace('#', ''), 16);\n  }\n}\n","// src/editor/impress.ts\nimport { OfficeEditor } from './base.js';\nimport type {\n  OperationResult,\n  ImpressStructure,\n  SlideData,\n  SlideInfo,\n  SlideLayout,\n  TextFrame,\n} from './types.js';\n\n/**\n * Editor for Impress (presentation) documents\n */\nexport class ImpressEditor extends OfficeEditor {\n  getDocumentType(): 'impress' {\n    return 'impress';\n  }\n\n  getStructure(_options?: { maxResponseChars?: number }): OperationResult<ImpressStructure> {\n    try {\n      const numSlides = this.lok.documentGetParts(this.docPtr);\n      const slides: SlideInfo[] = [];\n\n      for (let i = 0; i < numSlides; i++) {\n        const slideData = this.getSlideInfoInternal(i);\n        slides.push(slideData);\n      }\n\n      const structure: ImpressStructure = {\n        type: 'impress',\n        slides,\n        slideCount: numSlides,\n      };\n\n      return this.createResult(structure);\n    } catch (error) {\n      return this.createErrorResult(`Failed to get structure: ${String(error)}`);\n    }\n  }\n\n  // ============================================\n  // Slide reading\n  // ============================================\n\n  getSlide(index: number): OperationResult<SlideData> {\n    try {\n      const numSlides = this.lok.documentGetParts(this.docPtr);\n\n      if (index < 0 || index >= numSlides) {\n        return this.createErrorResult(\n          `Invalid slide index: ${index}. Valid range: 0-${numSlides - 1}`,\n          'Use getStructure() to see available slides'\n        );\n      }\n\n      this.lok.documentSetPart(this.docPtr, index);\n      const text = this.lok.getAllText(this.docPtr) || '';\n      const textFrames = this.parseTextFrames(text);\n\n      const slideData: SlideData = {\n        index,\n        title: textFrames.find(f => f.type === 'title')?.text,\n        textFrames,\n        hasNotes: false, // Could detect from LOK if available\n      };\n\n      return this.createResult(slideData);\n    } catch (error) {\n      return this.createErrorResult(`Failed to get slide: ${String(error)}`);\n    }\n  }\n\n  getSlideCount(): OperationResult<number> {\n    try {\n      const count = this.lok.documentGetParts(this.docPtr);\n      return this.createResult(count);\n    } catch (error) {\n      return this.createErrorResult(`Failed to get slide count: ${String(error)}`);\n    }\n  }\n\n  // ============================================\n  // Slide management\n  // ============================================\n\n  addSlide(options?: { afterSlide?: number; layout?: SlideLayout }): OperationResult<{ index: number }> {\n    try {\n      const numSlides = this.lok.documentGetParts(this.docPtr);\n\n      // Navigate to position if specified\n      if (options?.afterSlide !== undefined) {\n        this.lok.documentSetPart(this.docPtr, options.afterSlide);\n      } else {\n        // Go to last slide\n        this.lok.documentSetPart(this.docPtr, numSlides - 1);\n      }\n\n      // Insert new slide\n      this.lok.postUnoCommand(this.docPtr, '.uno:InsertPage');\n\n      // Apply layout if specified\n      if (options?.layout) {\n        this.applySlideLayout(options.layout);\n      }\n\n      const newIndex = options?.afterSlide !== undefined\n        ? options.afterSlide + 1\n        : numSlides;\n\n      // Verify by checking slide count increased\n      const newNumSlides = this.lok.documentGetParts(this.docPtr);\n      const verified = newNumSlides > numSlides;\n\n      return {\n        success: true,\n        verified,\n        data: { index: newIndex },\n      };\n    } catch (error) {\n      return this.createErrorResult(`Failed to add slide: ${String(error)}`);\n    }\n  }\n\n  deleteSlide(index: number): OperationResult<void> {\n    try {\n      const numSlides = this.lok.documentGetParts(this.docPtr);\n\n      if (numSlides <= 1) {\n        return this.createErrorResult(\n          'Cannot delete the last slide',\n          'A presentation must have at least one slide'\n        );\n      }\n\n      if (index < 0 || index >= numSlides) {\n        return this.createErrorResult(\n          `Invalid slide index: ${index}`,\n          `Valid range: 0-${numSlides - 1}`\n        );\n      }\n\n      this.lok.documentSetPart(this.docPtr, index);\n      this.lok.postUnoCommand(this.docPtr, '.uno:DeletePage');\n\n      return this.createResult(undefined);\n    } catch (error) {\n      return this.createErrorResult(`Failed to delete slide: ${String(error)}`);\n    }\n  }\n\n  duplicateSlide(index: number): OperationResult<{ newIndex: number }> {\n    try {\n      const numSlides = this.lok.documentGetParts(this.docPtr);\n\n      if (index < 0 || index >= numSlides) {\n        return this.createErrorResult(\n          `Invalid slide index: ${index}`,\n          `Valid range: 0-${numSlides - 1}`\n        );\n      }\n\n      this.lok.documentSetPart(this.docPtr, index);\n      this.lok.postUnoCommand(this.docPtr, '.uno:DuplicatePage');\n\n      return this.createResult({ newIndex: index + 1 });\n    } catch (error) {\n      return this.createErrorResult(`Failed to duplicate slide: ${String(error)}`);\n    }\n  }\n\n  moveSlide(fromIndex: number, toIndex: number): OperationResult<void> {\n    try {\n      const numSlides = this.lok.documentGetParts(this.docPtr);\n\n      if (fromIndex < 0 || fromIndex >= numSlides || toIndex < 0 || toIndex >= numSlides) {\n        return this.createErrorResult(\n          `Invalid slide indices. Valid range: 0-${numSlides - 1}`,\n          'Check slide indices are within bounds'\n        );\n      }\n\n      if (fromIndex === toIndex) {\n        return this.createErrorResult(\n          'Source and destination are the same',\n          'Provide different indices to move'\n        );\n      }\n\n      // LOK doesn't have direct slide move - we simulate via cut/paste\n      this.lok.documentSetPart(this.docPtr, fromIndex);\n\n      const args = JSON.stringify({\n        Position: { type: 'long', value: toIndex },\n      });\n      this.lok.postUnoCommand(this.docPtr, '.uno:MovePageFirst', args);\n\n      return this.createResult(undefined);\n    } catch (error) {\n      return this.createErrorResult(`Failed to move slide: ${String(error)}`);\n    }\n  }\n\n  // ============================================\n  // Slide content editing\n  // ============================================\n\n  setSlideTitle(index: number, title: string): OperationResult<{ oldTitle?: string }> {\n    try {\n      const numSlides = this.lok.documentGetParts(this.docPtr);\n\n      if (index < 0 || index >= numSlides) {\n        return this.createErrorResult(`Invalid slide index: ${index}`);\n      }\n\n      this.lok.documentSetPart(this.docPtr, index);\n\n      // Get current title\n      const text = this.lok.getAllText(this.docPtr) || '';\n      const frames = this.parseTextFrames(text);\n      const oldTitle = frames.find(f => f.type === 'title')?.text;\n\n      // Select title placeholder and replace\n      this.lok.postUnoCommand(this.docPtr, '.uno:SelectAll');\n\n      // Enter title text (this replaces first text frame typically)\n      const args = JSON.stringify({\n        Text: { type: 'string', value: title },\n      });\n      this.lok.postUnoCommand(this.docPtr, '.uno:InsertText', args);\n\n      return this.createResult({ oldTitle });\n    } catch (error) {\n      return this.createErrorResult(`Failed to set slide title: ${String(error)}`);\n    }\n  }\n\n  setSlideBody(index: number, body: string): OperationResult<{ oldBody?: string }> {\n    try {\n      const numSlides = this.lok.documentGetParts(this.docPtr);\n\n      if (index < 0 || index >= numSlides) {\n        return this.createErrorResult(`Invalid slide index: ${index}`);\n      }\n\n      this.lok.documentSetPart(this.docPtr, index);\n\n      // Get current body\n      const text = this.lok.getAllText(this.docPtr) || '';\n      const frames = this.parseTextFrames(text);\n      const oldBody = frames.find(f => f.type === 'body')?.text;\n\n      // Navigate to body and replace\n      // Using Tab to move from title to body placeholder\n      this.lok.postUnoCommand(this.docPtr, '.uno:NextObject');\n\n      const args = JSON.stringify({\n        Text: { type: 'string', value: body },\n      });\n      this.lok.postUnoCommand(this.docPtr, '.uno:InsertText', args);\n\n      return this.createResult({ oldBody });\n    } catch (error) {\n      return this.createErrorResult(`Failed to set slide body: ${String(error)}`);\n    }\n  }\n\n  setSlideNotes(index: number, notes: string): OperationResult<void> {\n    try {\n      const numSlides = this.lok.documentGetParts(this.docPtr);\n\n      if (index < 0 || index >= numSlides) {\n        return this.createErrorResult(`Invalid slide index: ${index}`);\n      }\n\n      this.lok.documentSetPart(this.docPtr, index);\n\n      // Switch to notes view and insert text\n      this.lok.postUnoCommand(this.docPtr, '.uno:NotesMode');\n\n      const args = JSON.stringify({\n        Text: { type: 'string', value: notes },\n      });\n      this.lok.postUnoCommand(this.docPtr, '.uno:InsertText', args);\n\n      // Switch back to normal view\n      this.lok.postUnoCommand(this.docPtr, '.uno:NormalViewMode');\n\n      return this.createResult(undefined);\n    } catch (error) {\n      return this.createErrorResult(`Failed to set slide notes: ${String(error)}`);\n    }\n  }\n\n  // ============================================\n  // Slide layout\n  // ============================================\n\n  setSlideLayout(index: number, layout: SlideLayout): OperationResult<void> {\n    try {\n      const numSlides = this.lok.documentGetParts(this.docPtr);\n\n      if (index < 0 || index >= numSlides) {\n        return this.createErrorResult(`Invalid slide index: ${index}`);\n      }\n\n      this.lok.documentSetPart(this.docPtr, index);\n      this.applySlideLayout(layout);\n\n      return this.createResult(undefined);\n    } catch (error) {\n      return this.createErrorResult(`Failed to set slide layout: ${String(error)}`);\n    }\n  }\n\n  // ============================================\n  // Private helpers\n  // ============================================\n\n  private getSlideInfoInternal(index: number): SlideInfo {\n    this.lok.documentSetPart(this.docPtr, index);\n\n    const text = this.lok.getAllText(this.docPtr) || '';\n    const frames = this.parseTextFrames(text);\n    const titleFrame = frames.find(f => f.type === 'title');\n\n    return {\n      index,\n      title: titleFrame?.text,\n      layout: this.detectLayout(frames),\n      textFrameCount: frames.length,\n    };\n  }\n\n  private parseTextFrames(text: string): TextFrame[] {\n    // Parse text content into frames\n    // In Impress, text is typically separated by paragraph breaks\n    const paragraphs = text.split(/\\n\\n+/).filter(p => p.trim());\n    const frames: TextFrame[] = [];\n\n    paragraphs.forEach((para, idx) => {\n      const type = idx === 0 ? 'title' : (idx === 1 ? 'body' : 'other');\n      frames.push({\n        index: idx,\n        type: type as TextFrame['type'],\n        text: para.trim(),\n        bounds: { x: 0, y: 0, width: 0, height: 0 }, // Would need LOK API for actual bounds\n      });\n    });\n\n    return frames;\n  }\n\n  private detectLayout(frames: TextFrame[]): SlideLayout {\n    if (frames.length === 0) return 'blank';\n    if (frames.length === 1 && frames[0]?.type === 'title') return 'title';\n    if (frames.length >= 2) return 'titleContent';\n    return 'blank';\n  }\n\n  private applySlideLayout(layout: SlideLayout): void {\n    // Map layout names to LOK layout IDs\n    const layoutMap: Record<SlideLayout, number> = {\n      blank: 0,\n      title: 1,\n      titleContent: 2,\n      twoColumn: 3,\n    };\n\n    const layoutId = layoutMap[layout] ?? 0;\n    const args = JSON.stringify({\n      WhatLayout: { type: 'long', value: layoutId },\n    });\n    this.lok.postUnoCommand(this.docPtr, '.uno:AssignLayout', args);\n  }\n}\n","// src/editor/draw.ts\nimport { OfficeEditor } from './base.js';\nimport type {\n  OperationResult,\n  DrawStructure,\n  PageData,\n  PageInfo,\n  ShapeData,\n  ShapeType,\n  Rectangle,\n  Size,\n  Position,\n} from './types.js';\n\n/**\n * Editor for Draw (vector graphics) documents\n * Also handles imported PDFs opened for editing\n */\nexport class DrawEditor extends OfficeEditor {\n  private isImportedPdf: boolean = false;\n\n  getDocumentType(): 'draw' {\n    return 'draw';\n  }\n\n  setImportedPdf(value: boolean): void {\n    this.isImportedPdf = value;\n  }\n\n  getStructure(_options?: { maxResponseChars?: number }): OperationResult<DrawStructure> {\n    try {\n      const numPages = this.lok.documentGetParts(this.docPtr);\n      const pages: PageInfo[] = [];\n\n      for (let i = 0; i < numPages; i++) {\n        const pageInfo = this.getPageInfoInternal(i);\n        pages.push(pageInfo);\n      }\n\n      const structure: DrawStructure = {\n        type: 'draw',\n        pages,\n        pageCount: numPages,\n        isImportedPdf: this.isImportedPdf,\n      };\n\n      return this.createResult(structure);\n    } catch (error) {\n      return this.createErrorResult(`Failed to get structure: ${String(error)}`);\n    }\n  }\n\n  // ============================================\n  // Page reading\n  // ============================================\n\n  getPage(index: number): OperationResult<PageData> {\n    try {\n      const numPages = this.lok.documentGetParts(this.docPtr);\n\n      if (index < 0 || index >= numPages) {\n        return this.createErrorResult(\n          `Invalid page index: ${index}. Valid range: 0-${numPages - 1}`,\n          'Use getStructure() to see available pages'\n        );\n      }\n\n      this.lok.documentSetPart(this.docPtr, index);\n      const size = this.lok.documentGetDocumentSize(this.docPtr);\n      const shapes = this.getShapesOnPage();\n\n      const pageData: PageData = {\n        index,\n        shapes,\n        size: { width: size.width, height: size.height },\n      };\n\n      return this.createResult(pageData);\n    } catch (error) {\n      return this.createErrorResult(`Failed to get page: ${String(error)}`);\n    }\n  }\n\n  getPageCount(): OperationResult<number> {\n    try {\n      const count = this.lok.documentGetParts(this.docPtr);\n      return this.createResult(count);\n    } catch (error) {\n      return this.createErrorResult(`Failed to get page count: ${String(error)}`);\n    }\n  }\n\n  // ============================================\n  // Page management\n  // ============================================\n\n  addPage(options?: { afterPage?: number }): OperationResult<{ index: number }> {\n    try {\n      const numPages = this.lok.documentGetParts(this.docPtr);\n\n      // Navigate to position\n      if (options?.afterPage !== undefined) {\n        this.lok.documentSetPart(this.docPtr, options.afterPage);\n      } else {\n        this.lok.documentSetPart(this.docPtr, numPages - 1);\n      }\n\n      // Insert new page\n      this.lok.postUnoCommand(this.docPtr, '.uno:InsertPage');\n\n      const newIndex = options?.afterPage !== undefined\n        ? options.afterPage + 1\n        : numPages;\n\n      return this.createResult({ index: newIndex });\n    } catch (error) {\n      return this.createErrorResult(`Failed to add page: ${String(error)}`);\n    }\n  }\n\n  deletePage(index: number): OperationResult<void> {\n    try {\n      const numPages = this.lok.documentGetParts(this.docPtr);\n\n      if (numPages <= 1) {\n        return this.createErrorResult(\n          'Cannot delete the last page',\n          'A drawing document must have at least one page'\n        );\n      }\n\n      if (index < 0 || index >= numPages) {\n        return this.createErrorResult(\n          `Invalid page index: ${index}`,\n          `Valid range: 0-${numPages - 1}`\n        );\n      }\n\n      this.lok.documentSetPart(this.docPtr, index);\n      this.lok.postUnoCommand(this.docPtr, '.uno:DeletePage');\n\n      return this.createResult(undefined);\n    } catch (error) {\n      return this.createErrorResult(`Failed to delete page: ${String(error)}`);\n    }\n  }\n\n  duplicatePage(index: number): OperationResult<{ newIndex: number }> {\n    try {\n      const numPages = this.lok.documentGetParts(this.docPtr);\n\n      if (index < 0 || index >= numPages) {\n        return this.createErrorResult(\n          `Invalid page index: ${index}`,\n          `Valid range: 0-${numPages - 1}`\n        );\n      }\n\n      this.lok.documentSetPart(this.docPtr, index);\n      this.lok.postUnoCommand(this.docPtr, '.uno:DuplicatePage');\n\n      return this.createResult({ newIndex: index + 1 });\n    } catch (error) {\n      return this.createErrorResult(`Failed to duplicate page: ${String(error)}`);\n    }\n  }\n\n  // ============================================\n  // Shape operations\n  // ============================================\n\n  addShape(\n    pageIndex: number,\n    shapeType: ShapeType,\n    bounds: Rectangle,\n    options?: { text?: string; fillColor?: string; lineColor?: string }\n  ): OperationResult<{ shapeIndex: number }> {\n    try {\n      const numPages = this.lok.documentGetParts(this.docPtr);\n\n      if (pageIndex < 0 || pageIndex >= numPages) {\n        return this.createErrorResult(`Invalid page index: ${pageIndex}`);\n      }\n\n      this.lok.documentSetPart(this.docPtr, pageIndex);\n\n      // Map shape type to UNO command\n      const shapeCommand = this.getShapeCommand(shapeType);\n\n      // Set shape bounds\n      const boundsArgs = JSON.stringify({\n        X: { type: 'long', value: bounds.x },\n        Y: { type: 'long', value: bounds.y },\n        Width: { type: 'long', value: bounds.width },\n        Height: { type: 'long', value: bounds.height },\n      });\n\n      this.lok.postUnoCommand(this.docPtr, shapeCommand, boundsArgs);\n\n      // Set optional properties\n      if (options?.text) {\n        const textArgs = JSON.stringify({\n          Text: { type: 'string', value: options.text },\n        });\n        this.lok.postUnoCommand(this.docPtr, '.uno:InsertText', textArgs);\n      }\n\n      if (options?.fillColor) {\n        const colorArgs = JSON.stringify({\n          FillColor: { type: 'long', value: this.hexToNumber(options.fillColor) },\n        });\n        this.lok.postUnoCommand(this.docPtr, '.uno:FillColor', colorArgs);\n      }\n\n      if (options?.lineColor) {\n        const colorArgs = JSON.stringify({\n          LineColor: { type: 'long', value: this.hexToNumber(options.lineColor) },\n        });\n        this.lok.postUnoCommand(this.docPtr, '.uno:XLineColor', colorArgs);\n      }\n\n      // Return approximate index (would need LOK API to get actual)\n      return this.createResult({ shapeIndex: 0 });\n    } catch (error) {\n      return this.createErrorResult(`Failed to add shape: ${String(error)}`);\n    }\n  }\n\n  addLine(\n    pageIndex: number,\n    start: Position,\n    end: Position,\n    options?: { lineColor?: string; lineWidth?: number }\n  ): OperationResult<{ shapeIndex: number }> {\n    try {\n      const numPages = this.lok.documentGetParts(this.docPtr);\n\n      if (pageIndex < 0 || pageIndex >= numPages) {\n        return this.createErrorResult(`Invalid page index: ${pageIndex}`);\n      }\n\n      this.lok.documentSetPart(this.docPtr, pageIndex);\n\n      const args = JSON.stringify({\n        StartX: { type: 'long', value: start.x },\n        StartY: { type: 'long', value: start.y },\n        EndX: { type: 'long', value: end.x },\n        EndY: { type: 'long', value: end.y },\n      });\n\n      this.lok.postUnoCommand(this.docPtr, '.uno:Line', args);\n\n      if (options?.lineColor) {\n        const colorArgs = JSON.stringify({\n          LineColor: { type: 'long', value: this.hexToNumber(options.lineColor) },\n        });\n        this.lok.postUnoCommand(this.docPtr, '.uno:XLineColor', colorArgs);\n      }\n\n      if (options?.lineWidth) {\n        const widthArgs = JSON.stringify({\n          LineWidth: { type: 'long', value: options.lineWidth },\n        });\n        this.lok.postUnoCommand(this.docPtr, '.uno:LineWidth', widthArgs);\n      }\n\n      return this.createResult({ shapeIndex: 0 });\n    } catch (error) {\n      return this.createErrorResult(`Failed to add line: ${String(error)}`);\n    }\n  }\n\n  deleteShape(pageIndex: number, shapeIndex: number): OperationResult<void> {\n    try {\n      this.lok.documentSetPart(this.docPtr, pageIndex);\n\n      // Select shape by index (simplified - real impl would use object selection)\n      this.selectShape(shapeIndex);\n      this.lok.postUnoCommand(this.docPtr, '.uno:Delete');\n\n      return this.createResult(undefined);\n    } catch (error) {\n      return this.createErrorResult(`Failed to delete shape: ${String(error)}`);\n    }\n  }\n\n  setShapeText(pageIndex: number, shapeIndex: number, text: string): OperationResult<void> {\n    try {\n      this.lok.documentSetPart(this.docPtr, pageIndex);\n      this.selectShape(shapeIndex);\n\n      // Enter edit mode for the shape\n      this.lok.postUnoCommand(this.docPtr, '.uno:EnterGroup');\n\n      // Replace text\n      this.lok.postUnoCommand(this.docPtr, '.uno:SelectAll');\n      const args = JSON.stringify({\n        Text: { type: 'string', value: text },\n      });\n      this.lok.postUnoCommand(this.docPtr, '.uno:InsertText', args);\n\n      // Exit edit mode\n      this.lok.postUnoCommand(this.docPtr, '.uno:LeaveGroup');\n\n      return this.createResult(undefined);\n    } catch (error) {\n      return this.createErrorResult(`Failed to set shape text: ${String(error)}`);\n    }\n  }\n\n  moveShape(pageIndex: number, shapeIndex: number, newPosition: Position): OperationResult<void> {\n    try {\n      this.lok.documentSetPart(this.docPtr, pageIndex);\n      this.selectShape(shapeIndex);\n\n      const args = JSON.stringify({\n        X: { type: 'long', value: newPosition.x },\n        Y: { type: 'long', value: newPosition.y },\n      });\n      this.lok.postUnoCommand(this.docPtr, '.uno:SetObjectPosition', args);\n\n      return this.createResult(undefined);\n    } catch (error) {\n      return this.createErrorResult(`Failed to move shape: ${String(error)}`);\n    }\n  }\n\n  resizeShape(pageIndex: number, shapeIndex: number, newSize: Size): OperationResult<void> {\n    try {\n      this.lok.documentSetPart(this.docPtr, pageIndex);\n      this.selectShape(shapeIndex);\n\n      const args = JSON.stringify({\n        Width: { type: 'long', value: newSize.width },\n        Height: { type: 'long', value: newSize.height },\n      });\n      this.lok.postUnoCommand(this.docPtr, '.uno:Size', args);\n\n      return this.createResult(undefined);\n    } catch (error) {\n      return this.createErrorResult(`Failed to resize shape: ${String(error)}`);\n    }\n  }\n\n  // ============================================\n  // Private helpers\n  // ============================================\n\n  private getPageInfoInternal(index: number): PageInfo {\n    this.lok.documentSetPart(this.docPtr, index);\n    const size = this.lok.documentGetDocumentSize(this.docPtr);\n    const shapes = this.getShapesOnPage();\n\n    return {\n      index,\n      shapeCount: shapes.length,\n      size: { width: size.width, height: size.height },\n    };\n  }\n\n  private getShapesOnPage(): ShapeData[] {\n    // In a real implementation, we'd enumerate shapes via LOK\n    // For now, we parse text content as a simple proxy\n    const text = this.lok.getAllText(this.docPtr) || '';\n\n    if (!text.trim()) {\n      return [];\n    }\n\n    // Return a single text shape if there's content\n    return [{\n      index: 0,\n      type: 'text',\n      text,\n      bounds: { x: 0, y: 0, width: 0, height: 0 },\n    }];\n  }\n\n  private selectShape(shapeIndex: number): void {\n    // Navigate to shape - simplified implementation\n    // Real implementation would use object enumeration\n    const args = JSON.stringify({\n      Index: { type: 'long', value: shapeIndex },\n    });\n    this.lok.postUnoCommand(this.docPtr, '.uno:SelectObject', args);\n  }\n\n  private getShapeCommand(shapeType: ShapeType): string {\n    const commands: Record<ShapeType, string> = {\n      rectangle: '.uno:Rect',\n      ellipse: '.uno:Ellipse',\n      line: '.uno:Line',\n      text: '.uno:Text',\n      image: '.uno:InsertGraphic',\n      group: '.uno:FormatGroup',\n      other: '.uno:Rect', // Default to rectangle\n    };\n    return commands[shapeType];\n  }\n\n  private hexToNumber(hex: string): number {\n    return parseInt(hex.replace('#', ''), 16);\n  }\n}\n","// src/editor/index.ts\nimport type { LOKBindings } from '../lok-bindings.js';\nimport { OfficeEditor } from './base.js';\nimport { WriterEditor } from './writer.js';\nimport { CalcEditor } from './calc.js';\nimport { ImpressEditor } from './impress.js';\nimport { DrawEditor } from './draw.js';\nimport type { OpenDocumentOptions } from './types.js';\n\n// LOK document type constants (from LibreOfficeKit)\nconst LOK_DOCTYPE_TEXT = 0;\nconst LOK_DOCTYPE_SPREADSHEET = 1;\nconst LOK_DOCTYPE_PRESENTATION = 2;\nconst LOK_DOCTYPE_DRAWING = 3;\n\n/**\n * Factory function to create the appropriate editor based on document type\n *\n * @param lok - LibreOfficeKit bindings instance\n * @param docPtr - Document pointer from lok.documentLoad()\n * @param options - Editor options (maxResponseChars, etc.)\n * @returns Typed editor instance (WriterEditor, CalcEditor, ImpressEditor, or DrawEditor)\n * @throws Error if document type is unsupported\n *\n * @example\n * ```typescript\n * const docPtr = lok.documentLoad('/tmp/document.docx');\n * const editor = createEditor(lok, docPtr);\n *\n * if (isWriterEditor(editor)) {\n *   // TypeScript knows editor has WriterEditor methods\n *   const result = editor.insertParagraph('Hello World');\n * }\n * ```\n */\nexport function createEditor(\n  lok: LOKBindings,\n  docPtr: number,\n  options?: OpenDocumentOptions\n): OfficeEditor {\n  const docType = lok.documentGetDocumentType(docPtr);\n\n  switch (docType) {\n    case LOK_DOCTYPE_TEXT:\n      return new WriterEditor(lok, docPtr, options);\n\n    case LOK_DOCTYPE_SPREADSHEET:\n      return new CalcEditor(lok, docPtr, options);\n\n    case LOK_DOCTYPE_PRESENTATION:\n      return new ImpressEditor(lok, docPtr, options);\n\n    case LOK_DOCTYPE_DRAWING:\n      return new DrawEditor(lok, docPtr, options);\n\n    default:\n      throw new Error(`Unsupported document type: ${docType}`);\n  }\n}\n\n// ============================================\n// Type Guards\n// ============================================\n\n/**\n * Type guard for WriterEditor\n */\nexport function isWriterEditor(editor: OfficeEditor): editor is WriterEditor {\n  return editor.getDocumentType() === 'writer';\n}\n\n/**\n * Type guard for CalcEditor\n */\nexport function isCalcEditor(editor: OfficeEditor): editor is CalcEditor {\n  return editor.getDocumentType() === 'calc';\n}\n\n/**\n * Type guard for ImpressEditor\n */\nexport function isImpressEditor(editor: OfficeEditor): editor is ImpressEditor {\n  return editor.getDocumentType() === 'impress';\n}\n\n/**\n * Type guard for DrawEditor\n */\nexport function isDrawEditor(editor: OfficeEditor): editor is DrawEditor {\n  return editor.getDocumentType() === 'draw';\n}\n\n// ============================================\n// Re-exports\n// ============================================\n\n// Export all types\nexport type {\n  OperationResult,\n  TruncationInfo,\n  OpenDocumentOptions,\n  TextPosition,\n  TextRange,\n  TextFormat,\n  Paragraph,\n  WriterStructure,\n  CellRef,\n  RangeRef,\n  ColRef,\n  SheetRef,\n  CellValue,\n  CellData,\n  CellFormat,\n  SheetInfo,\n  CalcStructure,\n  SlideLayout,\n  TextFrame,\n  SlideData,\n  SlideInfo,\n  ImpressStructure,\n  ShapeType,\n  ShapeData,\n  PageData,\n  PageInfo,\n  DrawStructure,\n  Rectangle,\n  Size,\n  Position,\n  DocumentMetadata,\n  DocumentStructure,\n  DocumentType,\n  SelectionRange,\n  FindOptions,\n} from './types.js';\n\n// Export all editor classes\nexport { OfficeEditor } from './base.js';\nexport { WriterEditor } from './writer.js';\nexport { CalcEditor } from './calc.js';\nexport { ImpressEditor } from './impress.js';\nexport { DrawEditor } from './draw.js';\n\n// Export LLM tool definitions\nexport {\n  // Tool collections\n  allTools,\n  toolsByName,\n  commonTools,\n  writerTools,\n  calcTools,\n  impressTools,\n  drawTools,\n  documentTools,\n  // Utility functions\n  getToolsForDocumentType,\n  toOpenAIFunction,\n  toAnthropicTool,\n  getOpenAIFunctions,\n  getAnthropicTools,\n} from './tools.js';\n\nexport type {\n  ToolDefinition,\n  CommonToolName,\n  WriterToolName,\n  CalcToolName,\n  ImpressToolName,\n  DrawToolName,\n  DocumentToolName,\n  AllToolName,\n  ToolParameters,\n} from './tools.js';\n","/**\n * LibreOfficeKit Low-Level Bindings\n *\n * This module provides direct access to the LibreOfficeKit C API\n * through the WASM module using the stable lok_* shim exports.\n *\n * Shim functions (C side) should be defined as:\n *   - lok_documentLoad(pKit, pPath)\n *   - lok_documentLoadWithOptions(pKit, pPath, pOptions)\n *   - lok_documentSaveAs(pDoc, pUrl, pFormat, pFilterOptions)\n *   - lok_documentDestroy(pDoc)\n *   - lok_getError(pKit)\n *   - lok_destroy(pKit)          <-- RECOMMENDED to add\n */\n\nimport type { EmscriptenModule } from './types.js';\n\n// Extended module type with our LOK shim exports\ninterface LOKModule extends EmscriptenModule {\n  _lok_documentLoad?: (lok: number, path: number) => number;\n  _lok_documentLoadWithOptions?: (lok: number, path: number, options: number) => number;\n  _lok_documentSaveAs?: (doc: number, url: number, format: number, opts: number) => number;\n  _lok_documentDestroy?: (doc: number) => void;\n  _lok_getError?: (lok: number) => number;\n  _lok_destroy?: (lok: number) => void;\n  // Page rendering shims\n  _lok_documentGetParts?: (doc: number) => number;\n  _lok_documentGetPart?: (doc: number) => number;\n  _lok_documentSetPart?: (doc: number, part: number) => void;\n  _lok_documentGetDocumentType?: (doc: number) => number;\n  _lok_documentGetDocumentSize?: (doc: number, widthPtr: number, heightPtr: number) => void;\n  _lok_documentInitializeForRendering?: (doc: number, args: number) => void;\n  _lok_documentPaintTile?: (\n    doc: number,\n    buffer: number,\n    canvasWidth: number,\n    canvasHeight: number,\n    tilePosX: number,\n    tilePosY: number,\n    tileWidth: number,\n    tileHeight: number\n  ) => void;\n  _lok_documentGetTileMode?: (doc: number) => number;\n  // Text selection and content shims\n  _lok_documentGetTextSelection?: (doc: number, mimeType: number, usedMimeType: number) => number;\n  _lok_documentSetTextSelection?: (doc: number, type: number, x: number, y: number) => void;\n  _lok_documentGetSelectionType?: (doc: number) => number;\n  _lok_documentResetSelection?: (doc: number) => void;\n  // Mouse and keyboard event shims\n  _lok_documentPostMouseEvent?: (doc: number, type: number, x: number, y: number, count: number, buttons: number, modifier: number) => void;\n  _lok_documentPostKeyEvent?: (doc: number, type: number, charCode: number, keyCode: number) => void;\n  // UNO command shims\n  _lok_documentPostUnoCommand?: (doc: number, command: number, args: number, notifyWhenFinished: number) => void;\n  _lok_documentGetCommandValues?: (doc: number, command: number) => number;\n  // Page/Part information shims\n  _lok_documentGetPartPageRectangles?: (doc: number) => number;\n  _lok_documentGetPartInfo?: (doc: number, part: number) => number;\n  _lok_documentGetPartName?: (doc: number, part: number) => number;\n  // Clipboard shims\n  _lok_documentPaste?: (doc: number, mimeType: number, data: number, size: number) => number;\n  // View and zoom shims\n  _lok_documentSetClientZoom?: (doc: number, tilePixelWidth: number, tilePixelHeight: number, tileTwipWidth: number, tileTwipHeight: number) => void;\n  _lok_documentSetClientVisibleArea?: (doc: number, x: number, y: number, width: number, height: number) => void;\n  // Accessibility shims\n  _lok_documentGetA11yFocusedParagraph?: (doc: number) => number;\n  _lok_documentGetA11yCaretPosition?: (doc: number) => number;\n  _lok_documentSetAccessibilityState?: (doc: number, viewId: number, enabled: number) => void;\n  // Spreadsheet-specific shims\n  _lok_documentGetDataArea?: (doc: number, part: number, colPtr: number, rowPtr: number) => void;\n  // Edit mode shim\n  _lok_documentGetEditMode?: (doc: number) => number;\n  _lok_documentSetEditMode?: (doc: number, mode: number) => void;\n  // View management shims\n  _lok_documentCreateView?: (doc: number) => number;\n  _lok_documentCreateViewWithOptions?: (doc: number, options: number) => number;\n  _lok_documentDestroyView?: (doc: number, viewId: number) => void;\n  _lok_documentSetView?: (doc: number, viewId: number) => void;\n  _lok_documentGetView?: (doc: number) => number;\n  _lok_documentGetViewsCount?: (doc: number) => number;\n  // Event loop and callback shims\n  _lok_enableSyncEvents?: () => void;\n  _lok_disableSyncEvents?: () => void;\n  _lok_runLoop?: (lok: number, pollCallback: number, wakeCallback: number, data: number) => void;\n  // Callback queue shims\n  _lok_documentRegisterCallback?: (doc: number) => void;\n  _lok_documentUnregisterCallback?: (doc: number) => void;\n  _lok_hasCallbackEvents?: () => number;\n  _lok_getCallbackEventCount?: () => number;\n  _lok_pollCallback?: (payloadBuffer: number, bufferSize: number, payloadLengthPtr: number) => number;\n  _lok_clearCallbackQueue?: () => void;\n  _lok_flushCallbacks?: (doc: number) => void;\n}\n\n// LOK Mouse Event Types\nexport const LOK_MOUSEEVENT_BUTTONDOWN = 0;\nexport const LOK_MOUSEEVENT_BUTTONUP = 1;\nexport const LOK_MOUSEEVENT_MOVE = 2;\n\n// LOK Key Event Types\nexport const LOK_KEYEVENT_KEYINPUT = 0;\nexport const LOK_KEYEVENT_KEYUP = 1;\n\n// LOK Selection Types\nexport const LOK_SELTYPE_NONE = 0;\nexport const LOK_SELTYPE_TEXT = 1;\nexport const LOK_SELTYPE_CELL = 2;\n\n// LOK Text Selection Types\nexport const LOK_SETTEXTSELECTION_START = 0;\nexport const LOK_SETTEXTSELECTION_END = 1;\nexport const LOK_SETTEXTSELECTION_RESET = 2;\n\n// LOK Document Types\nexport const LOK_DOCTYPE_TEXT = 0;\nexport const LOK_DOCTYPE_SPREADSHEET = 1;\nexport const LOK_DOCTYPE_PRESENTATION = 2;\nexport const LOK_DOCTYPE_DRAWING = 3;\nexport const LOK_DOCTYPE_OTHER = 4;\n\n// LOK Callback Types (from LibreOfficeKitEnums.h)\nexport const LOK_CALLBACK_INVALIDATE_TILES = 0;\nexport const LOK_CALLBACK_INVALIDATE_VISIBLE_CURSOR = 1;\nexport const LOK_CALLBACK_TEXT_SELECTION = 2;\nexport const LOK_CALLBACK_TEXT_SELECTION_START = 3;\nexport const LOK_CALLBACK_TEXT_SELECTION_END = 4;\nexport const LOK_CALLBACK_CURSOR_VISIBLE = 5;\nexport const LOK_CALLBACK_GRAPHIC_SELECTION = 6;\nexport const LOK_CALLBACK_HYPERLINK_CLICKED = 7;\nexport const LOK_CALLBACK_STATE_CHANGED = 8;\nexport const LOK_CALLBACK_STATUS_INDICATOR_START = 9;\nexport const LOK_CALLBACK_STATUS_INDICATOR_SET_VALUE = 10;\nexport const LOK_CALLBACK_STATUS_INDICATOR_FINISH = 11;\nexport const LOK_CALLBACK_SEARCH_NOT_FOUND = 12;\nexport const LOK_CALLBACK_DOCUMENT_SIZE_CHANGED = 13;\nexport const LOK_CALLBACK_SET_PART = 14;\nexport const LOK_CALLBACK_SEARCH_RESULT_SELECTION = 15;\nexport const LOK_CALLBACK_UNO_COMMAND_RESULT = 16;\nexport const LOK_CALLBACK_CELL_CURSOR = 17;\nexport const LOK_CALLBACK_MOUSE_POINTER = 18;\nexport const LOK_CALLBACK_CELL_FORMULA = 19;\nexport const LOK_CALLBACK_DOCUMENT_PASSWORD = 20;\nexport const LOK_CALLBACK_DOCUMENT_PASSWORD_TO_MODIFY = 21;\nexport const LOK_CALLBACK_CONTEXT_MENU = 22;\nexport const LOK_CALLBACK_INVALIDATE_VIEW_CURSOR = 23;\nexport const LOK_CALLBACK_TEXT_VIEW_SELECTION = 24;\nexport const LOK_CALLBACK_CELL_VIEW_CURSOR = 25;\nexport const LOK_CALLBACK_GRAPHIC_VIEW_SELECTION = 26;\nexport const LOK_CALLBACK_VIEW_CURSOR_VISIBLE = 27;\nexport const LOK_CALLBACK_VIEW_LOCK = 28;\nexport const LOK_CALLBACK_REDLINE_TABLE_SIZE_CHANGED = 29;\nexport const LOK_CALLBACK_REDLINE_TABLE_ENTRY_MODIFIED = 30;\nexport const LOK_CALLBACK_COMMENT = 31;\nexport const LOK_CALLBACK_INVALIDATE_HEADER = 32;\nexport const LOK_CALLBACK_CELL_ADDRESS = 33;\n\n// Callback event interface\nexport interface LOKCallbackEvent {\n  type: number;\n  typeName: string;\n  payload: string;\n}\n\n// Map callback type to name\nexport function getCallbackTypeName(type: number): string {\n  const names: Record<number, string> = {\n    [LOK_CALLBACK_INVALIDATE_TILES]: 'INVALIDATE_TILES',\n    [LOK_CALLBACK_INVALIDATE_VISIBLE_CURSOR]: 'INVALIDATE_VISIBLE_CURSOR',\n    [LOK_CALLBACK_TEXT_SELECTION]: 'TEXT_SELECTION',\n    [LOK_CALLBACK_TEXT_SELECTION_START]: 'TEXT_SELECTION_START',\n    [LOK_CALLBACK_TEXT_SELECTION_END]: 'TEXT_SELECTION_END',\n    [LOK_CALLBACK_CURSOR_VISIBLE]: 'CURSOR_VISIBLE',\n    [LOK_CALLBACK_GRAPHIC_SELECTION]: 'GRAPHIC_SELECTION',\n    [LOK_CALLBACK_HYPERLINK_CLICKED]: 'HYPERLINK_CLICKED',\n    [LOK_CALLBACK_STATE_CHANGED]: 'STATE_CHANGED',\n    [LOK_CALLBACK_STATUS_INDICATOR_START]: 'STATUS_INDICATOR_START',\n    [LOK_CALLBACK_STATUS_INDICATOR_SET_VALUE]: 'STATUS_INDICATOR_SET_VALUE',\n    [LOK_CALLBACK_STATUS_INDICATOR_FINISH]: 'STATUS_INDICATOR_FINISH',\n    [LOK_CALLBACK_SEARCH_NOT_FOUND]: 'SEARCH_NOT_FOUND',\n    [LOK_CALLBACK_DOCUMENT_SIZE_CHANGED]: 'DOCUMENT_SIZE_CHANGED',\n    [LOK_CALLBACK_SET_PART]: 'SET_PART',\n    [LOK_CALLBACK_SEARCH_RESULT_SELECTION]: 'SEARCH_RESULT_SELECTION',\n    [LOK_CALLBACK_UNO_COMMAND_RESULT]: 'UNO_COMMAND_RESULT',\n    [LOK_CALLBACK_CELL_CURSOR]: 'CELL_CURSOR',\n    [LOK_CALLBACK_MOUSE_POINTER]: 'MOUSE_POINTER',\n    [LOK_CALLBACK_CELL_FORMULA]: 'CELL_FORMULA',\n    [LOK_CALLBACK_DOCUMENT_PASSWORD]: 'DOCUMENT_PASSWORD',\n    [LOK_CALLBACK_DOCUMENT_PASSWORD_TO_MODIFY]: 'DOCUMENT_PASSWORD_TO_MODIFY',\n    [LOK_CALLBACK_CONTEXT_MENU]: 'CONTEXT_MENU',\n    [LOK_CALLBACK_INVALIDATE_VIEW_CURSOR]: 'INVALIDATE_VIEW_CURSOR',\n    [LOK_CALLBACK_TEXT_VIEW_SELECTION]: 'TEXT_VIEW_SELECTION',\n    [LOK_CALLBACK_CELL_VIEW_CURSOR]: 'CELL_VIEW_CURSOR',\n    [LOK_CALLBACK_GRAPHIC_VIEW_SELECTION]: 'GRAPHIC_VIEW_SELECTION',\n    [LOK_CALLBACK_VIEW_CURSOR_VISIBLE]: 'VIEW_CURSOR_VISIBLE',\n    [LOK_CALLBACK_VIEW_LOCK]: 'VIEW_LOCK',\n    [LOK_CALLBACK_REDLINE_TABLE_SIZE_CHANGED]: 'REDLINE_TABLE_SIZE_CHANGED',\n    [LOK_CALLBACK_REDLINE_TABLE_ENTRY_MODIFIED]: 'REDLINE_TABLE_ENTRY_MODIFIED',\n    [LOK_CALLBACK_COMMENT]: 'COMMENT',\n    [LOK_CALLBACK_INVALIDATE_HEADER]: 'INVALIDATE_HEADER',\n    [LOK_CALLBACK_CELL_ADDRESS]: 'CELL_ADDRESS',\n  };\n  return names[type] || `UNKNOWN(${type})`;\n}\n\n// Fallback offsets for WASM32 (4-byte pointers) if shims not available\nconst LOK_CLASS = {\n  nSize: 0,\n  destroy: 4,\n  documentLoad: 8,\n  getError: 12,\n  documentLoadWithOptions: 16,\n  freeError: 20,\n};\n\nconst DOC_CLASS = {\n  nSize: 0,\n  destroy: 4,\n  saveAs: 8,\n};\n\n// Reuse encoder/decoder\nconst textEncoder = new TextEncoder();\nconst textDecoder = new TextDecoder();\n\nexport class LOKBindings {\n  private module: LOKModule;\n  private lokPtr = 0;\n  private verbose: boolean;\n  private useShims: boolean;\n\n  constructor(module: EmscriptenModule, verbose = false) {\n    this.module = module as LOKModule;\n    this.verbose = verbose;\n\n    this.useShims = typeof this.module._lok_documentLoad === 'function';\n    if (this.useShims) {\n      this.log('Using direct LOK shim exports');\n    } else {\n      this.log('Using vtable traversal (shims not available)');\n    }\n  }\n\n  private log(...args: unknown[]): void {\n    if (this.verbose) {\n      console.log('[LOK]', ...args);\n    }\n  }\n\n  /**\n   * Get fresh heap views (important after memory growth!)\n   */\n  private get HEAPU8(): Uint8Array {\n    return this.module.HEAPU8;\n  }\n\n  private get HEAPU32(): Uint32Array {\n    return this.module.HEAPU32;\n  }\n\n  private get HEAP32(): Int32Array {\n    return this.module.HEAP32;\n  }\n\n  /**\n   * Allocate a null-terminated string in WASM memory\n   */\n  allocString(str: string): number {\n    const bytes = textEncoder.encode(str + '\\0');\n    const ptr = this.module._malloc(bytes.length);\n    // Always get fresh heap view after malloc (might have grown memory)\n    this.HEAPU8.set(bytes, ptr);\n    return ptr;\n  }\n\n  /**\n   * Read a null-terminated string from WASM memory\n   */\n  readString(ptr: number): string | null {\n    if (ptr === 0) return null;\n    // Always get fresh heap view\n    const heap = this.HEAPU8;\n    let end = ptr;\n    while (heap[end] !== 0) end++;\n    // Copy the data to avoid SharedArrayBuffer issues in browsers\n    // TextDecoder.decode() doesn't accept SharedArrayBuffer views in some browsers\n    const slice = heap.slice(ptr, end);\n    return textDecoder.decode(slice);\n  }\n\n  /**\n   * Read a 32-bit pointer from memory (unsigned)\n   */\n  readPtr(addr: number): number {\n    // Always get fresh heap view\n    return this.HEAPU32[addr >> 2] || 0;\n  }\n\n  /**\n   * Get a function from the WASM table (fallback for vtable traversal)\n   */\n  private getFunc<T>(ptr: number): T {\n    const wasmTable = this.module.wasmTable as WebAssembly.Table;\n    return wasmTable.get(ptr) as T;\n  }\n\n  /**\n   * Initialize LibreOfficeKit\n   */\n  initialize(installPath: string = '/instdir/program'): void {\n    this.log('Initializing with path:', installPath);\n    const pathPtr = this.allocString(installPath);\n\n    try {\n      // eslint-disable-next-line @typescript-eslint/no-explicit-any, @typescript-eslint/no-unsafe-member-access\n      const hook = (this.module as any)._libreofficekit_hook as\n        | ((pathPtr: number) => number)\n        | undefined;\n\n      if (typeof hook !== 'function') {\n        throw new Error('libreofficekit_hook export not found on module');\n      }\n\n      this.lokPtr = hook(pathPtr);\n\n      if (this.lokPtr === 0) {\n        throw new Error('Failed to initialize LibreOfficeKit');\n      }\n\n      this.log('LOK initialized, ptr:', this.lokPtr);\n    } finally {\n      this.module._free(pathPtr);\n    }\n  }\n\n  /**\n   * Get the last error message\n   */\n  getError(): string | null {\n    if (this.lokPtr === 0) return null;\n\n    // Prefer shim\n    if (this.useShims && this.module._lok_getError) {\n      const errPtr = this.module._lok_getError(this.lokPtr);\n      return this.readString(errPtr);\n    }\n\n    // Fallback: vtable traversal\n    const lokClassPtr = this.readPtr(this.lokPtr);\n    const getErrorPtr = this.readPtr(lokClassPtr + LOK_CLASS.getError);\n    if (getErrorPtr === 0) return null;\n\n    const getError = this.getFunc<(lok: number) => number>(getErrorPtr);\n    const errPtr = getError(this.lokPtr);\n    return this.readString(errPtr);\n  }\n\n  /**\n   * Get version info\n   */\n  getVersionInfo(): string | null {\n    return 'LibreOffice WASM';\n  }\n\n  /**\n   * Convert a filesystem path to a file:// URL\n   * Required by LibreOffice's getAbsoluteURL() which uses rtl::Uri::convertRelToAbs()\n   */\n  private toFileUrl(path: string): string {\n    if (path.startsWith('file://')) return path;\n    const absolutePath = path.startsWith('/') ? path : '/' + path;\n    return 'file://' + absolutePath;\n  }\n\n  /**\n   * Load a document from the virtual filesystem\n   */\n  documentLoad(path: string): number {\n    if (this.lokPtr === 0) {\n      throw new Error('LOK not initialized');\n    }\n\n    const fileUrl = this.toFileUrl(path);\n    this.log('Loading document:', path, '->', fileUrl);\n    const pathPtr = this.allocString(fileUrl);\n\n    try {\n      const startTime = Date.now();\n      let docPtr: number;\n\n      if (this.useShims && this.module._lok_documentLoad) {\n        // Use direct shim export\n        docPtr = this.module._lok_documentLoad(this.lokPtr, pathPtr);\n      } else {\n        // Fallback: vtable traversal\n        const lokClassPtr = this.readPtr(this.lokPtr);\n        const documentLoadPtr = this.readPtr(lokClassPtr + LOK_CLASS.documentLoad);\n        const documentLoad = this.getFunc<(lok: number, path: number) => number>(documentLoadPtr);\n        docPtr = documentLoad(this.lokPtr, pathPtr);\n      }\n\n      this.log('Document loaded in', Date.now() - startTime, 'ms, ptr:', docPtr);\n\n      if (docPtr === 0) {\n        const error = this.getError();\n        throw new Error(`Failed to load document: ${error || 'unknown error'}`);\n      }\n\n      return docPtr;\n    } finally {\n      this.module._free(pathPtr);\n    }\n  }\n\n  /**\n   * Load a document with options\n   */\n  documentLoadWithOptions(path: string, options: string): number {\n    if (this.lokPtr === 0) {\n      throw new Error('LOK not initialized');\n    }\n\n    const fileUrl = this.toFileUrl(path);\n    this.log('Loading document with options:', path, '->', fileUrl, options);\n    const pathPtr = this.allocString(fileUrl);\n    const optsPtr = this.allocString(options);\n\n    try {\n      let docPtr: number;\n\n      if (this.useShims && this.module._lok_documentLoadWithOptions) {\n        // Use direct shim export\n        docPtr = this.module._lok_documentLoadWithOptions(this.lokPtr, pathPtr, optsPtr);\n      } else {\n        // Fallback: vtable traversal\n        const lokClassPtr = this.readPtr(this.lokPtr);\n        const loadWithOptsPtr = this.readPtr(lokClassPtr + LOK_CLASS.documentLoadWithOptions);\n\n        if (loadWithOptsPtr === 0) {\n          // No special method - fall back to plain load\n          return this.documentLoad(path);\n        }\n\n        const loadWithOpts = this.getFunc<\n          (lok: number, path: number, opts: number) => number\n        >(loadWithOptsPtr);\n        docPtr = loadWithOpts(this.lokPtr, pathPtr, optsPtr);\n      }\n\n      if (docPtr === 0) {\n        const error = this.getError();\n        throw new Error(`Failed to load document: ${error || 'unknown error'}`);\n      }\n\n      this.log('Document loaded, ptr:', docPtr);\n      return docPtr;\n    } finally {\n      this.module._free(pathPtr);\n      this.module._free(optsPtr);\n    }\n  }\n\n  /**\n   * Save a document to a different format\n   */\n  documentSaveAs(\n    docPtr: number,\n    outputPath: string,\n    format: string,\n    filterOptions: string = ''\n  ): void {\n    if (docPtr === 0) {\n      throw new Error('Invalid document pointer');\n    }\n\n    const fileUrl = this.toFileUrl(outputPath);\n    this.log('Saving document to:', outputPath, '->', fileUrl, 'format:', format);\n\n    const urlPtr = this.allocString(fileUrl);\n    const formatPtr = this.allocString(format);\n    const optsPtr = this.allocString(filterOptions);\n\n    try {\n      let result: number;\n\n      if (this.useShims && this.module._lok_documentSaveAs) {\n        // Use direct shim export\n        result = this.module._lok_documentSaveAs(docPtr, urlPtr, formatPtr, optsPtr);\n      } else {\n        // Fallback: vtable traversal\n        const docClassPtr = this.readPtr(docPtr);\n        const saveAsPtr = this.readPtr(docClassPtr + DOC_CLASS.saveAs);\n        const saveAs = this.getFunc<\n          (doc: number, url: number, format: number, opts: number) => number\n        >(saveAsPtr);\n        result = saveAs(docPtr, urlPtr, formatPtr, optsPtr);\n      }\n\n      this.log('Save result:', result);\n\n      if (result === 0) {\n        throw new Error('Failed to save document');\n      }\n    } finally {\n      this.module._free(urlPtr);\n      this.module._free(formatPtr);\n      this.module._free(optsPtr);\n    }\n  }\n\n  /**\n   * Destroy a document\n   */\n  documentDestroy(docPtr: number): void {\n    if (docPtr === 0) return;\n\n    if (this.useShims && this.module._lok_documentDestroy) {\n      // Use direct shim export\n      this.module._lok_documentDestroy(docPtr);\n      this.log('Document destroyed (via shim)');\n      return;\n    }\n\n    // Fallback: vtable traversal\n    const docClassPtr = this.readPtr(docPtr);\n    const destroyPtr = this.readPtr(docClassPtr + DOC_CLASS.destroy);\n\n    if (destroyPtr !== 0) {\n      const destroy = this.getFunc<(doc: number) => void>(destroyPtr);\n      destroy(docPtr);\n      this.log('Document destroyed (via vtable)');\n    }\n  }\n\n  /**\n   * Destroy the LOK instance\n   */\n  destroy(): void {\n    if (this.lokPtr === 0) return;\n\n    try {\n      // Prefer C shim if available\n      if (this.useShims && this.module._lok_destroy) {\n        this.module._lok_destroy(this.lokPtr);\n        this.log('LOK destroyed (via shim)');\n      } else {\n        // Fallback: vtable traversal\n        const lokClassPtr = this.readPtr(this.lokPtr);\n        const destroyPtr = this.readPtr(lokClassPtr + LOK_CLASS.destroy);\n\n        if (destroyPtr !== 0) {\n          const destroy = this.getFunc<(lok: number) => void>(destroyPtr);\n          destroy(this.lokPtr);\n          this.log('LOK destroyed (via vtable)');\n        }\n      }\n    } catch (error) {\n      this.log('LOK destroy error (ignored):', error);\n    }\n\n    this.lokPtr = 0;\n  }\n\n  /**\n   * Check if LOK is initialized\n   */\n  isInitialized(): boolean {\n    return this.lokPtr !== 0;\n  }\n\n  /**\n   * Check if using direct shim exports\n   */\n  isUsingShims(): boolean {\n    return this.useShims;\n  }\n\n  // ==========================================\n  // Page Rendering Methods\n  // ==========================================\n\n  /**\n   * Get the number of parts (pages/slides) in a document\n   */\n  documentGetParts(docPtr: number): number {\n    if (docPtr === 0) {\n      throw new Error('Invalid document pointer');\n    }\n\n    if (this.useShims && this.module._lok_documentGetParts) {\n      return this.module._lok_documentGetParts(docPtr);\n    }\n\n    // Fallback not implemented - would need vtable offsets\n    this.log('documentGetParts: shim not available');\n    return 0;\n  }\n\n  /**\n   * Get the current part (page/slide) index\n   */\n  documentGetPart(docPtr: number): number {\n    if (docPtr === 0) {\n      throw new Error('Invalid document pointer');\n    }\n\n    if (this.useShims && this.module._lok_documentGetPart) {\n      return this.module._lok_documentGetPart(docPtr);\n    }\n\n    this.log('documentGetPart: shim not available');\n    return 0;\n  }\n\n  /**\n   * Set the current part (page/slide) index\n   */\n  documentSetPart(docPtr: number, part: number): void {\n    if (docPtr === 0) {\n      throw new Error('Invalid document pointer');\n    }\n\n    if (this.useShims && this.module._lok_documentSetPart) {\n      this.module._lok_documentSetPart(docPtr, part);\n      return;\n    }\n\n    this.log('documentSetPart: shim not available');\n  }\n\n  /**\n   * Get document type (0=text, 1=spreadsheet, 2=presentation, 3=drawing)\n   */\n  documentGetDocumentType(docPtr: number): number {\n    if (docPtr === 0) {\n      throw new Error('Invalid document pointer');\n    }\n\n    if (this.useShims && this.module._lok_documentGetDocumentType) {\n      return this.module._lok_documentGetDocumentType(docPtr);\n    }\n\n    this.log('documentGetDocumentType: shim not available');\n    return 0;\n  }\n\n  /**\n   * Get document size in twips (1/1440 inch)\n   */\n  documentGetDocumentSize(docPtr: number): { width: number; height: number } {\n    this.log(`documentGetDocumentSize called with docPtr: ${docPtr}`);\n    if (docPtr === 0) {\n      throw new Error('Invalid document pointer');\n    }\n\n    if (this.useShims && this.module._lok_documentGetDocumentSize) {\n      // Allocate space for two longs (32-bit on WASM)\n      const sizePtr = this.module._malloc(8);\n      try {\n        this.module._lok_documentGetDocumentSize(docPtr, sizePtr, sizePtr + 4);\n        const width = this.HEAP32[sizePtr >> 2] ?? 0;\n        const height = this.HEAP32[(sizePtr + 4) >> 2] ?? 0;\n        this.log(`documentGetDocumentSize: ${width}x${height} twips`);\n        return { width, height };\n      } finally {\n        this.module._free(sizePtr);\n      }\n    }\n\n    this.log('documentGetDocumentSize: shim not available');\n    return { width: 0, height: 0 };\n  }\n\n  /**\n   * Initialize document for rendering\n   */\n  documentInitializeForRendering(docPtr: number, options: string = ''): void {\n    if (docPtr === 0) {\n      throw new Error('Invalid document pointer');\n    }\n\n    if (this.useShims && this.module._lok_documentInitializeForRendering) {\n      const optsPtr = this.allocString(options);\n      try {\n        this.module._lok_documentInitializeForRendering(docPtr, optsPtr);\n      } finally {\n        this.module._free(optsPtr);\n      }\n      return;\n    }\n\n    this.log('documentInitializeForRendering: shim not available');\n  }\n\n  /**\n   * Paint a tile of the document to a buffer\n   * @param docPtr Document pointer\n   * @param canvasWidth Output width in pixels\n   * @param canvasHeight Output height in pixels\n   * @param tilePosX X position in twips\n   * @param tilePosY Y position in twips\n   * @param tileWidth Width in twips\n   * @param tileHeight Height in twips\n   * @returns RGBA pixel data\n   */\n  documentPaintTile(\n    docPtr: number,\n    canvasWidth: number,\n    canvasHeight: number,\n    tilePosX: number,\n    tilePosY: number,\n    tileWidth: number,\n    tileHeight: number\n  ): Uint8Array {\n    if (docPtr === 0) {\n      throw new Error('Invalid document pointer');\n    }\n\n    if (this.useShims && this.module._lok_documentPaintTile) {\n      // Allocate RGBA buffer (4 bytes per pixel)\n      const bufferSize = canvasWidth * canvasHeight * 4;\n      const bufferPtr = this.module._malloc(bufferSize);\n\n      if (bufferPtr === 0) {\n        throw new Error(`Failed to allocate ${bufferSize} bytes for tile buffer`);\n      }\n\n      try {\n        this.module._lok_documentPaintTile(\n          docPtr,\n          bufferPtr,\n          canvasWidth,\n          canvasHeight,\n          tilePosX,\n          tilePosY,\n          tileWidth,\n          tileHeight\n        );\n\n        // Copy data out of WASM memory\n        const result = new Uint8Array(bufferSize);\n        result.set(this.HEAPU8.subarray(bufferPtr, bufferPtr + bufferSize));\n        return result;\n      } finally {\n        this.module._free(bufferPtr);\n      }\n    }\n\n    this.log('documentPaintTile: shim not available');\n    return new Uint8Array(0);\n  }\n\n  /**\n   * Get tile mode (0=RGBA, 1=BGRA)\n   */\n  documentGetTileMode(docPtr: number): number {\n    if (docPtr === 0) {\n      throw new Error('Invalid document pointer');\n    }\n\n    if (this.useShims && this.module._lok_documentGetTileMode) {\n      return this.module._lok_documentGetTileMode(docPtr);\n    }\n\n    this.log('documentGetTileMode: shim not available');\n    return 0; // Default to RGBA\n  }\n\n  /**\n   * Render a page/slide to an image\n   * @param docPtr Document pointer\n   * @param pageIndex Page/slide index (0-based)\n   * @param width Output width in pixels\n   * @param height Output height in pixels (0 = auto based on aspect ratio)\n   * @returns RGBA pixel data and dimensions\n   */\n  renderPage(\n    docPtr: number,\n    pageIndex: number,\n    width: number,\n    height: number = 0,\n    editMode: boolean = false\n  ): { data: Uint8Array; width: number; height: number } {\n    // Initialize for rendering if not already done\n    this.documentInitializeForRendering(docPtr);\n\n    // Get document type to determine rendering strategy\n    const docType = this.documentGetDocumentType(docPtr);\n\n    // For presentations and drawings, use setPart to select the slide/page\n    // For text documents, we need to use page rectangles\n    if (docType === 2 || docType === 3) { // PRESENTATION or DRAWING\n      console.log(`[LOK] Setting part to ${pageIndex} for presentation/drawing`);\n      this.documentSetPart(docPtr, pageIndex);\n      const currentPart = this.documentGetPart(docPtr);\n      console.log(`[LOK] Current part after setPart: ${currentPart}`);\n\n      // Set view mode (0) for presentations to avoid showing edit UI elements\n      // unless explicitly requested\n      if (!editMode) {\n        this.setEditMode(docPtr, 0);\n        console.log(`[LOK] Set edit mode to 0 (view mode) for presentation rendering`);\n      }\n    }\n\n    // Get document/page size in twips\n    const docSize = this.documentGetDocumentSize(docPtr);\n    this.log('Document size (twips):', docSize);\n\n    if (docSize.width === 0 || docSize.height === 0) {\n      throw new Error('Failed to get document size');\n    }\n\n    // For text documents, get page rectangles to find the specific page\n    let tilePosX = 0;\n    let tilePosY = 0;\n    let tileWidth = docSize.width;\n    let tileHeight = docSize.height;\n\n    if (docType === 0 || docType === 1) { // TEXT or SPREADSHEET\n      // Get page rectangles to find the Y offset for this page\n      const pageRectsStr = this.getPartPageRectangles(docPtr);\n      if (pageRectsStr) {\n        const pageRects = this.parsePageRectangles(pageRectsStr);\n        const pageRect = pageRects[pageIndex];\n        if (pageRect) {\n          tilePosX = pageRect.x;\n          tilePosY = pageRect.y;\n          tileWidth = pageRect.width;\n          tileHeight = pageRect.height;\n          this.log(`Page ${pageIndex} rectangle:`, pageRect);\n        }\n      }\n    }\n\n    // Calculate output dimensions maintaining aspect ratio\n    const aspectRatio = tileHeight / tileWidth;\n    const outputWidth = width;\n    const outputHeight = height > 0 ? height : Math.round(width * aspectRatio);\n\n    console.log(`[LOK] Calling paintTile: ${outputWidth}x${outputHeight} from tile pos (${tilePosX}, ${tilePosY}) size (${tileWidth}x${tileHeight})`);\n\n    // Paint the tile for this specific page\n    const data = this.documentPaintTile(\n      docPtr,\n      outputWidth,\n      outputHeight,\n      tilePosX,\n      tilePosY,\n      tileWidth,\n      tileHeight\n    );\n\n    console.log(`[LOK] paintTile returned ${data.length} bytes`);\n    return { data, width: outputWidth, height: outputHeight };\n  }\n\n  /**\n   * Render a page/slide at full quality (native resolution based on DPI)\n   *\n   * Unlike renderPage which scales to a fixed width, this method renders\n   * at the document's native resolution converted to pixels at the specified DPI.\n   *\n   * @param docPtr Document pointer\n   * @param pageIndex Page/slide index (0-based)\n   * @param dpi Dots per inch for rendering (default 150, use 300 for print quality)\n   * @param maxDimension Optional maximum dimension (width or height) to prevent memory issues\n   * @returns RGBA pixel data and dimensions\n   *\n   * @example\n   * // Render at 150 DPI (good for screen)\n   * const preview = lokBindings.renderPageFullQuality(docPtr, 0, 150);\n   *\n   * // Render at 300 DPI (print quality)\n   * const highRes = lokBindings.renderPageFullQuality(docPtr, 0, 300);\n   *\n   * // Render with max dimension cap to prevent memory issues\n   * const capped = lokBindings.renderPageFullQuality(docPtr, 0, 300, 4096);\n   */\n  renderPageFullQuality(\n    docPtr: number,\n    pageIndex: number,\n    dpi: number = 150,\n    maxDimension?: number,\n    editMode: boolean = false\n  ): { data: Uint8Array; width: number; height: number; dpi: number } {\n    // Initialize for rendering if not already done\n    this.documentInitializeForRendering(docPtr);\n\n    // Get document type to determine rendering strategy\n    const docType = this.documentGetDocumentType(docPtr);\n\n    // For presentations and drawings, use setPart to select the slide/page\n    if (docType === 2 || docType === 3) { // PRESENTATION or DRAWING\n      this.log(`Setting part to ${pageIndex} for presentation/drawing`);\n      this.documentSetPart(docPtr, pageIndex);\n\n      // Set view mode (0) for presentations to avoid showing edit UI elements\n      // unless explicitly requested\n      if (!editMode) {\n        this.setEditMode(docPtr, 0);\n        this.log(`Set edit mode to 0 (view mode) for presentation rendering`);\n      }\n    }\n\n    // Get document/page size in twips\n    const docSize = this.documentGetDocumentSize(docPtr);\n    this.log('Document size (twips):', docSize);\n\n    if (docSize.width === 0 || docSize.height === 0) {\n      throw new Error('Failed to get document size');\n    }\n\n    // For text documents, get page rectangles to find the specific page\n    let tilePosX = 0;\n    let tilePosY = 0;\n    let tileWidth = docSize.width;\n    let tileHeight = docSize.height;\n\n    if (docType === 0 || docType === 1) { // TEXT or SPREADSHEET\n      const pageRectsStr = this.getPartPageRectangles(docPtr);\n      if (pageRectsStr) {\n        const pageRects = this.parsePageRectangles(pageRectsStr);\n        const pageRect = pageRects[pageIndex];\n        if (pageRect) {\n          tilePosX = pageRect.x;\n          tilePosY = pageRect.y;\n          tileWidth = pageRect.width;\n          tileHeight = pageRect.height;\n          this.log(`Page ${pageIndex} rectangle:`, pageRect);\n        }\n      }\n    }\n\n    // Convert twips to pixels at the specified DPI\n    // 1 inch = 1440 twips, so pixels = twips * dpi / 1440\n    const TWIPS_PER_INCH = 1440;\n    let outputWidth = Math.round(tileWidth * dpi / TWIPS_PER_INCH);\n    let outputHeight = Math.round(tileHeight * dpi / TWIPS_PER_INCH);\n    let effectiveDpi = dpi;\n\n    // Apply max dimension cap if specified\n    if (maxDimension && (outputWidth > maxDimension || outputHeight > maxDimension)) {\n      const scale = maxDimension / Math.max(outputWidth, outputHeight);\n      outputWidth = Math.round(outputWidth * scale);\n      outputHeight = Math.round(outputHeight * scale);\n      effectiveDpi = Math.round(dpi * scale);\n      this.log(`Capped dimensions to ${outputWidth}x${outputHeight} (effective DPI: ${effectiveDpi})`);\n    }\n\n    console.log(`[LOK] renderPageFullQuality: ${outputWidth}x${outputHeight} at ${effectiveDpi} DPI from tile (${tilePosX}, ${tilePosY}) size (${tileWidth}x${tileHeight}) twips`);\n\n    // Paint the tile\n    const data = this.documentPaintTile(\n      docPtr,\n      outputWidth,\n      outputHeight,\n      tilePosX,\n      tilePosY,\n      tileWidth,\n      tileHeight\n    );\n\n    console.log(`[LOK] renderPageFullQuality returned ${data.length} bytes`);\n    return { data, width: outputWidth, height: outputHeight, dpi: effectiveDpi };\n  }\n\n  // ==========================================\n  // Text Selection and Content Methods\n  // ==========================================\n\n  /**\n   * Get currently selected text\n   * @param docPtr Document pointer\n   * @param mimeType Desired MIME type. Must include charset, e.g., 'text/plain;charset=utf-8'\n   *                 Note: 'text/plain' without charset is NOT supported by LOK\n   * @returns Selected text or null\n   */\n  getTextSelection(docPtr: number, mimeType: string = 'text/plain;charset=utf-8'): string | null {\n    if (docPtr === 0) throw new Error('Invalid document pointer');\n\n    if (this.useShims && this.module._lok_documentGetTextSelection) {\n      const mimePtr = this.allocString(mimeType);\n      const usedMimePtr = this.module._malloc(4); // pointer to char*\n      try {\n        const resultPtr = this.module._lok_documentGetTextSelection(docPtr, mimePtr, usedMimePtr);\n        if (resultPtr === 0) return null;\n        const result = this.readString(resultPtr);\n        this.module._free(resultPtr);\n        return result;\n      } finally {\n        this.module._free(mimePtr);\n        this.module._free(usedMimePtr);\n      }\n    }\n\n    this.log('getTextSelection: shim not available');\n    return null;\n  }\n\n  /**\n   * Set text selection at coordinates\n   * @param docPtr Document pointer\n   * @param type Selection type (LOK_SETTEXTSELECTION_START, END, or RESET)\n   * @param x X coordinate in twips\n   * @param y Y coordinate in twips\n   */\n  setTextSelection(docPtr: number, type: number, x: number, y: number): void {\n    if (docPtr === 0) throw new Error('Invalid document pointer');\n\n    if (this.useShims && this.module._lok_documentSetTextSelection) {\n      this.module._lok_documentSetTextSelection(docPtr, type, x, y);\n      return;\n    }\n\n    this.log('setTextSelection: shim not available');\n  }\n\n  /**\n   * Get current selection type\n   * @param docPtr Document pointer\n   * @returns Selection type (LOK_SELTYPE_NONE, TEXT, or CELL)\n   */\n  getSelectionType(docPtr: number): number {\n    if (docPtr === 0) throw new Error('Invalid document pointer');\n\n    if (this.useShims && this.module._lok_documentGetSelectionType) {\n      return this.module._lok_documentGetSelectionType(docPtr);\n    }\n\n    this.log('getSelectionType: shim not available');\n    return 0;\n  }\n\n  /**\n   * Reset/clear current selection\n   * @param docPtr Document pointer\n   */\n  resetSelection(docPtr: number): void {\n    if (docPtr === 0) throw new Error('Invalid document pointer');\n\n    if (this.useShims && this.module._lok_documentResetSelection) {\n      this.module._lok_documentResetSelection(docPtr);\n      return;\n    }\n\n    this.log('resetSelection: shim not available');\n  }\n\n  // ==========================================\n  // Mouse and Keyboard Event Methods\n  // ==========================================\n\n  /**\n   * Post a mouse event to the document\n   * @param docPtr Document pointer\n   * @param type Event type (LOK_MOUSEEVENT_BUTTONDOWN, BUTTONUP, MOVE)\n   * @param x X coordinate in twips\n   * @param y Y coordinate in twips\n   * @param count Click count (1 for single, 2 for double click)\n   * @param buttons Button mask (1=left, 2=middle, 4=right)\n   * @param modifier Modifier keys mask\n   */\n  postMouseEvent(\n    docPtr: number,\n    type: number,\n    x: number,\n    y: number,\n    count: number = 1,\n    buttons: number = 1,\n    modifier: number = 0\n  ): void {\n    if (docPtr === 0) throw new Error('Invalid document pointer');\n\n    if (this.useShims && this.module._lok_documentPostMouseEvent) {\n      this.module._lok_documentPostMouseEvent(docPtr, type, x, y, count, buttons, modifier);\n      return;\n    }\n\n    this.log('postMouseEvent: shim not available');\n  }\n\n  /**\n   * Post a keyboard event to the document\n   * @param docPtr Document pointer\n   * @param type Event type (LOK_KEYEVENT_KEYINPUT, KEYUP)\n   * @param charCode Character code\n   * @param keyCode Key code\n   */\n  postKeyEvent(docPtr: number, type: number, charCode: number, keyCode: number): void {\n    if (docPtr === 0) throw new Error('Invalid document pointer');\n\n    if (this.useShims && this.module._lok_documentPostKeyEvent) {\n      this.module._lok_documentPostKeyEvent(docPtr, type, charCode, keyCode);\n      return;\n    }\n\n    this.log('postKeyEvent: shim not available');\n  }\n\n  // ==========================================\n  // UNO Command Methods\n  // ==========================================\n\n  /**\n   * Execute a UNO command\n   * @param docPtr Document pointer\n   * @param command UNO command (e.g., '.uno:SelectAll', '.uno:Copy')\n   * @param args JSON arguments string\n   * @param notifyWhenFinished Whether to notify when command completes\n   */\n  postUnoCommand(\n    docPtr: number,\n    command: string,\n    args: string = '{}',\n    notifyWhenFinished: boolean = false\n  ): void {\n    if (docPtr === 0) throw new Error('Invalid document pointer');\n\n    if (this.useShims && this.module._lok_documentPostUnoCommand) {\n      const cmdPtr = this.allocString(command);\n      const argsPtr = this.allocString(args);\n      try {\n        this.module._lok_documentPostUnoCommand(docPtr, cmdPtr, argsPtr, notifyWhenFinished ? 1 : 0);\n      } finally {\n        this.module._free(cmdPtr);\n        this.module._free(argsPtr);\n      }\n      return;\n    }\n\n    this.log('postUnoCommand: shim not available');\n  }\n\n  /**\n   * Get command values (query document state)\n   * @param docPtr Document pointer\n   * @param command Command to query (e.g., '.uno:CharFontName')\n   * @returns JSON string with command values\n   */\n  getCommandValues(docPtr: number, command: string): string | null {\n    if (docPtr === 0) throw new Error('Invalid document pointer');\n\n    if (this.useShims && this.module._lok_documentGetCommandValues) {\n      const cmdPtr = this.allocString(command);\n      try {\n        const resultPtr = this.module._lok_documentGetCommandValues(docPtr, cmdPtr);\n        if (resultPtr === 0) return null;\n        const result = this.readString(resultPtr);\n        this.module._free(resultPtr);\n        return result;\n      } finally {\n        this.module._free(cmdPtr);\n      }\n    }\n\n    this.log('getCommandValues: shim not available');\n    return null;\n  }\n\n  // ==========================================\n  // Page/Part Information Methods\n  // ==========================================\n\n  /**\n   * Get bounding rectangles for all pages\n   * @param docPtr Document pointer\n   * @returns String with rectangles \"x,y,width,height;x,y,width,height;...\"\n   */\n  getPartPageRectangles(docPtr: number): string | null {\n    this.log(`getPartPageRectangles called with docPtr: ${docPtr}`);\n    if (docPtr === 0) throw new Error('Invalid document pointer');\n\n    if (this.useShims && this.module._lok_documentGetPartPageRectangles) {\n      this.log('getPartPageRectangles: using shim');\n      const resultPtr = this.module._lok_documentGetPartPageRectangles(docPtr);\n      this.log(`getPartPageRectangles: resultPtr=${resultPtr}`);\n      if (resultPtr === 0) return null;\n      const result = this.readString(resultPtr);\n      this.log(`getPartPageRectangles: result=\"${result?.slice(0, 100)}...\"`);\n      this.module._free(resultPtr);\n      return result;\n    }\n\n    this.log('getPartPageRectangles: shim not available');\n    return null;\n  }\n\n  /**\n   * Get information about a page/slide\n   * @param docPtr Document pointer\n   * @param part Part index\n   * @returns JSON string with part info\n   */\n  getPartInfo(docPtr: number, part: number): string | null {\n    if (docPtr === 0) throw new Error('Invalid document pointer');\n\n    if (this.useShims && this.module._lok_documentGetPartInfo) {\n      const resultPtr = this.module._lok_documentGetPartInfo(docPtr, part);\n      if (resultPtr === 0) return null;\n      const result = this.readString(resultPtr);\n      this.module._free(resultPtr);\n      return result;\n    }\n\n    this.log('getPartInfo: shim not available');\n    return null;\n  }\n\n  /**\n   * Get name of a page/slide\n   * @param docPtr Document pointer\n   * @param part Part index\n   * @returns Part name\n   */\n  getPartName(docPtr: number, part: number): string | null {\n    if (docPtr === 0) throw new Error('Invalid document pointer');\n\n    if (this.useShims && this.module._lok_documentGetPartName) {\n      const resultPtr = this.module._lok_documentGetPartName(docPtr, part);\n      if (resultPtr === 0) return null;\n      const result = this.readString(resultPtr);\n      this.module._free(resultPtr);\n      return result;\n    }\n\n    this.log('getPartName: shim not available');\n    return null;\n  }\n\n  // ==========================================\n  // Clipboard Methods\n  // ==========================================\n\n  /**\n   * Paste content at current cursor position\n   * @param docPtr Document pointer\n   * @param mimeType MIME type of data\n   * @param data Data to paste\n   * @returns true if successful\n   */\n  paste(docPtr: number, mimeType: string, data: string | Uint8Array): boolean {\n    if (docPtr === 0) throw new Error('Invalid document pointer');\n\n    if (this.useShims && this.module._lok_documentPaste) {\n      const mimePtr = this.allocString(mimeType);\n      let dataPtr: number;\n      let dataSize: number;\n\n      if (typeof data === 'string') {\n        const bytes = new TextEncoder().encode(data);\n        dataSize = bytes.length;\n        dataPtr = this.module._malloc(dataSize);\n        this.HEAPU8.set(bytes, dataPtr);\n      } else {\n        dataSize = data.length;\n        dataPtr = this.module._malloc(dataSize);\n        this.HEAPU8.set(data, dataPtr);\n      }\n\n      try {\n        return this.module._lok_documentPaste(docPtr, mimePtr, dataPtr, dataSize) !== 0;\n      } finally {\n        this.module._free(mimePtr);\n        this.module._free(dataPtr);\n      }\n    }\n\n    this.log('paste: shim not available');\n    return false;\n  }\n\n  // ==========================================\n  // View and Zoom Methods\n  // ==========================================\n\n  /**\n   * Set client zoom level\n   * @param docPtr Document pointer\n   * @param tilePixelWidth Tile width in pixels\n   * @param tilePixelHeight Tile height in pixels\n   * @param tileTwipWidth Tile width in twips\n   * @param tileTwipHeight Tile height in twips\n   */\n  setClientZoom(\n    docPtr: number,\n    tilePixelWidth: number,\n    tilePixelHeight: number,\n    tileTwipWidth: number,\n    tileTwipHeight: number\n  ): void {\n    if (docPtr === 0) throw new Error('Invalid document pointer');\n\n    if (this.useShims && this.module._lok_documentSetClientZoom) {\n      this.module._lok_documentSetClientZoom(docPtr, tilePixelWidth, tilePixelHeight, tileTwipWidth, tileTwipHeight);\n      return;\n    }\n\n    this.log('setClientZoom: shim not available');\n  }\n\n  /**\n   * Set visible area for the client\n   * @param docPtr Document pointer\n   * @param x X position in twips\n   * @param y Y position in twips\n   * @param width Width in twips\n   * @param height Height in twips\n   */\n  setClientVisibleArea(docPtr: number, x: number, y: number, width: number, height: number): void {\n    if (docPtr === 0) throw new Error('Invalid document pointer');\n\n    if (this.useShims && this.module._lok_documentSetClientVisibleArea) {\n      this.module._lok_documentSetClientVisibleArea(docPtr, x, y, width, height);\n      return;\n    }\n\n    this.log('setClientVisibleArea: shim not available');\n  }\n\n  // ==========================================\n  // Accessibility Methods\n  // ==========================================\n\n  /**\n   * Get the currently focused paragraph text\n   * @param docPtr Document pointer\n   * @returns Focused paragraph text\n   */\n  getA11yFocusedParagraph(docPtr: number): string | null {\n    if (docPtr === 0) throw new Error('Invalid document pointer');\n\n    if (this.useShims && this.module._lok_documentGetA11yFocusedParagraph) {\n      const resultPtr = this.module._lok_documentGetA11yFocusedParagraph(docPtr);\n      if (resultPtr === 0) return null;\n      const result = this.readString(resultPtr);\n      this.module._free(resultPtr);\n      return result;\n    }\n\n    this.log('getA11yFocusedParagraph: shim not available');\n    return null;\n  }\n\n  /**\n   * Get caret position in focused paragraph\n   * @param docPtr Document pointer\n   * @returns Caret position or -1\n   */\n  getA11yCaretPosition(docPtr: number): number {\n    if (docPtr === 0) throw new Error('Invalid document pointer');\n\n    if (this.useShims && this.module._lok_documentGetA11yCaretPosition) {\n      return this.module._lok_documentGetA11yCaretPosition(docPtr);\n    }\n\n    this.log('getA11yCaretPosition: shim not available');\n    return -1;\n  }\n\n  /**\n   * Enable/disable accessibility features\n   * @param docPtr Document pointer\n   * @param viewId View ID\n   * @param enabled Whether to enable accessibility\n   */\n  setAccessibilityState(docPtr: number, viewId: number, enabled: boolean): void {\n    if (docPtr === 0) throw new Error('Invalid document pointer');\n\n    if (this.useShims && this.module._lok_documentSetAccessibilityState) {\n      this.module._lok_documentSetAccessibilityState(docPtr, viewId, enabled ? 1 : 0);\n      return;\n    }\n\n    this.log('setAccessibilityState: shim not available');\n  }\n\n  // ==========================================\n  // Spreadsheet-Specific Methods\n  // ==========================================\n\n  /**\n   * Get data area for a spreadsheet (last used row/column)\n   * @param docPtr Document pointer\n   * @param part Sheet index\n   * @returns Object with col and row counts\n   */\n  getDataArea(docPtr: number, part: number): { col: number; row: number } {\n    if (docPtr === 0) throw new Error('Invalid document pointer');\n\n    if (this.useShims && this.module._lok_documentGetDataArea) {\n      const colPtr = this.module._malloc(8);\n      const rowPtr = this.module._malloc(8);\n      try {\n        this.module._lok_documentGetDataArea(docPtr, part, colPtr, rowPtr);\n        const col = this.HEAP32[colPtr >> 2] ?? 0;\n        const row = this.HEAP32[rowPtr >> 2] ?? 0;\n        return { col, row };\n      } finally {\n        this.module._free(colPtr);\n        this.module._free(rowPtr);\n      }\n    }\n\n    this.log('getDataArea: shim not available');\n    return { col: 0, row: 0 };\n  }\n\n  // ==========================================\n  // Edit Mode Methods\n  // ==========================================\n\n  /**\n   * Get current edit mode\n   * @param docPtr Document pointer\n   * @returns Edit mode value\n   */\n  getEditMode(docPtr: number): number {\n    if (docPtr === 0) throw new Error('Invalid document pointer');\n\n    if (this.useShims && this.module._lok_documentGetEditMode) {\n      return this.module._lok_documentGetEditMode(docPtr);\n    }\n\n    this.log('getEditMode: shim not available');\n    return 0;\n  }\n\n  /**\n   * Set edit mode for the document\n   * @param docPtr Document pointer\n   * @param mode 0 for view mode, 1 for edit mode\n   */\n  setEditMode(docPtr: number, mode: number): void {\n    if (docPtr === 0) throw new Error('Invalid document pointer');\n\n    if (this.useShims && this.module._lok_documentSetEditMode) {\n      this.log(`setEditMode: setting mode to ${mode}`);\n      this.module._lok_documentSetEditMode(docPtr, mode);\n      return;\n    }\n\n    this.log('setEditMode: shim not available');\n  }\n\n  // ==========================================\n  // View Management Methods\n  // ==========================================\n\n  /**\n   * Create a new view for the document\n   * @param docPtr Document pointer\n   * @returns View ID\n   */\n  createView(docPtr: number): number {\n    if (docPtr === 0) throw new Error('Invalid document pointer');\n\n    if (this.useShims && this.module._lok_documentCreateView) {\n      const viewId = this.module._lok_documentCreateView(docPtr);\n      this.log(`createView: created view ${viewId}`);\n      return viewId;\n    }\n\n    this.log('createView: shim not available');\n    return -1;\n  }\n\n  /**\n   * Create a new view with options\n   * @param docPtr Document pointer\n   * @param options Options string (JSON)\n   * @returns View ID\n   */\n  createViewWithOptions(docPtr: number, options: string): number {\n    if (docPtr === 0) throw new Error('Invalid document pointer');\n\n    if (this.useShims && this.module._lok_documentCreateViewWithOptions) {\n      const optionsPtr = this.allocString(options);\n      try {\n        const viewId = this.module._lok_documentCreateViewWithOptions(docPtr, optionsPtr);\n        this.log(`createViewWithOptions: created view ${viewId}`);\n        return viewId;\n      } finally {\n        this.module._free(optionsPtr);\n      }\n    }\n\n    this.log('createViewWithOptions: shim not available');\n    return -1;\n  }\n\n  /**\n   * Destroy a view\n   * @param docPtr Document pointer\n   * @param viewId View ID to destroy\n   */\n  destroyView(docPtr: number, viewId: number): void {\n    if (docPtr === 0) throw new Error('Invalid document pointer');\n\n    if (this.useShims && this.module._lok_documentDestroyView) {\n      this.log(`destroyView: destroying view ${viewId}`);\n      this.module._lok_documentDestroyView(docPtr, viewId);\n      return;\n    }\n\n    this.log('destroyView: shim not available');\n  }\n\n  /**\n   * Set the current active view\n   * @param docPtr Document pointer\n   * @param viewId View ID to make active\n   */\n  setView(docPtr: number, viewId: number): void {\n    if (docPtr === 0) throw new Error('Invalid document pointer');\n\n    if (this.useShims && this.module._lok_documentSetView) {\n      this.log(`setView: setting active view to ${viewId}`);\n      this.module._lok_documentSetView(docPtr, viewId);\n      return;\n    }\n\n    this.log('setView: shim not available');\n  }\n\n  /**\n   * Get the current active view ID\n   * @param docPtr Document pointer\n   * @returns Current view ID\n   */\n  getView(docPtr: number): number {\n    if (docPtr === 0) throw new Error('Invalid document pointer');\n\n    if (this.useShims && this.module._lok_documentGetView) {\n      return this.module._lok_documentGetView(docPtr);\n    }\n\n    this.log('getView: shim not available');\n    return -1;\n  }\n\n  /**\n   * Get the number of views\n   * @param docPtr Document pointer\n   * @returns Number of views\n   */\n  getViewsCount(docPtr: number): number {\n    if (docPtr === 0) throw new Error('Invalid document pointer');\n\n    if (this.useShims && this.module._lok_documentGetViewsCount) {\n      return this.module._lok_documentGetViewsCount(docPtr);\n    }\n\n    this.log('getViewsCount: shim not available');\n    return 0;\n  }\n\n  // ==========================================\n  // Event Loop and Callback Methods\n  // ==========================================\n\n  /**\n   * Enable synchronous event dispatch (Unipoll mode).\n   * This must be called before using postKeyEvent, postMouseEvent, etc.\n   * to ensure events are processed immediately instead of being queued.\n   *\n   * Without this, events posted via postKeyEvent/postMouseEvent are queued\n   * via Application::PostUserEvent() and never processed in headless mode.\n   */\n  enableSyncEvents(): void {\n    if (this.useShims && this.module._lok_enableSyncEvents) {\n      this.module._lok_enableSyncEvents();\n      this.log('enableSyncEvents: Unipoll mode enabled');\n    } else {\n      this.log('enableSyncEvents: shim not available');\n    }\n  }\n\n  /**\n   * Disable synchronous event dispatch.\n   * Call this when done with event-based operations.\n   */\n  disableSyncEvents(): void {\n    if (this.useShims && this.module._lok_disableSyncEvents) {\n      this.module._lok_disableSyncEvents();\n      this.log('disableSyncEvents: Unipoll mode disabled');\n    } else {\n      this.log('disableSyncEvents: shim not available');\n    }\n  }\n\n  // ==========================================\n  // Callback Queue Methods\n  // ==========================================\n\n  /**\n   * Register a callback handler for the document.\n   * Events are queued and can be retrieved via pollCallback().\n   * @param docPtr Document pointer\n   */\n  registerCallback(docPtr: number): void {\n    if (docPtr === 0) throw new Error('Invalid document pointer');\n\n    if (this.useShims && this.module._lok_documentRegisterCallback) {\n      this.module._lok_documentRegisterCallback(docPtr);\n      this.log('registerCallback: callback registered');\n    } else {\n      this.log('registerCallback: shim not available');\n    }\n  }\n\n  /**\n   * Unregister the callback handler for the document.\n   * @param docPtr Document pointer\n   */\n  unregisterCallback(docPtr: number): void {\n    if (docPtr === 0) throw new Error('Invalid document pointer');\n\n    if (this.useShims && this.module._lok_documentUnregisterCallback) {\n      this.module._lok_documentUnregisterCallback(docPtr);\n      this.log('unregisterCallback: callback unregistered');\n    } else {\n      this.log('unregisterCallback: shim not available');\n    }\n  }\n\n  /**\n   * Check if there are any pending callback events.\n   * @returns true if events are pending\n   */\n  hasCallbackEvents(): boolean {\n    if (this.useShims && this.module._lok_hasCallbackEvents) {\n      return this.module._lok_hasCallbackEvents() !== 0;\n    }\n    return false;\n  }\n\n  /**\n   * Get the number of pending callback events.\n   * @returns Number of events in the queue\n   */\n  getCallbackEventCount(): number {\n    if (this.useShims && this.module._lok_getCallbackEventCount) {\n      return this.module._lok_getCallbackEventCount();\n    }\n    return 0;\n  }\n\n  /**\n   * Poll and retrieve the next callback event from the queue.\n   * @returns The next event, or null if queue is empty\n   */\n  pollCallback(): LOKCallbackEvent | null {\n    if (!this.useShims || !this.module._lok_pollCallback) {\n      return null;\n    }\n\n    const bufferSize = 4096;\n    const payloadBuffer = this.module._malloc(bufferSize);\n    const payloadLengthPtr = this.module._malloc(4);\n\n    try {\n      const eventType = this.module._lok_pollCallback(payloadBuffer, bufferSize, payloadLengthPtr);\n\n      if (eventType === -1) {\n        return null; // Queue is empty\n      }\n\n      // Read the payload length\n      const payloadLength = this.module.HEAP32[payloadLengthPtr >> 2] ?? 0;\n\n      // Read the payload string\n      let payload = '';\n      if (payloadLength > 0) {\n        // Copy bytes from HEAPU8 to avoid SharedArrayBuffer issues in browsers\n        // TextDecoder.decode() doesn't accept SharedArrayBuffer views in some browsers\n        const len = Math.min(payloadLength, bufferSize - 1);\n        const bytes = this.module.HEAPU8.slice(payloadBuffer, payloadBuffer + len);\n        payload = textDecoder.decode(bytes);\n      }\n\n      return {\n        type: eventType,\n        typeName: getCallbackTypeName(eventType),\n        payload,\n      };\n    } finally {\n      this.module._free(payloadBuffer);\n      this.module._free(payloadLengthPtr);\n    }\n  }\n\n  /**\n   * Poll all pending callback events.\n   * @returns Array of all pending events\n   */\n  pollAllCallbacks(): LOKCallbackEvent[] {\n    const events: LOKCallbackEvent[] = [];\n    let event = this.pollCallback();\n    while (event !== null) {\n      events.push(event);\n      event = this.pollCallback();\n    }\n    return events;\n  }\n\n  /**\n   * Clear all pending callback events.\n   */\n  clearCallbackQueue(): void {\n    if (this.useShims && this.module._lok_clearCallbackQueue) {\n      this.module._lok_clearCallbackQueue();\n      this.log('clearCallbackQueue: queue cleared');\n    }\n  }\n\n  /**\n   * Force flush pending LOK callbacks for a document.\n   * This is needed in WASM because callbacks are queued via PostUserEvent\n   * but the event loop doesn't run automatically.\n   * Call this after operations that trigger callbacks (e.g., postUnoCommand)\n   * to ensure the callback queue is populated.\n   * @param docPtr Document pointer\n   */\n  flushCallbacks(docPtr: number): void {\n    if (docPtr === 0) throw new Error('Invalid document pointer');\n\n    const hasShim = !!this.module._lok_flushCallbacks;\n    this.log(`flushCallbacks: useShims=${this.useShims}, _lok_flushCallbacks exists=${hasShim}`);\n\n    if (this.useShims && this.module._lok_flushCallbacks) {\n      this.module._lok_flushCallbacks(docPtr);\n      this.log('flushCallbacks: callbacks flushed');\n    } else {\n      this.log('flushCallbacks: shim not available');\n    }\n  }\n\n  /**\n   * Poll for STATE_CHANGED callbacks and parse them into a map.\n   * STATE_CHANGED payloads are in format: \".uno:CommandName=value\"\n   * @returns Map of command names to values\n   */\n  pollStateChanges(): Map<string, string> {\n    const states = new Map<string, string>();\n    const events = this.pollAllCallbacks();\n\n    for (const event of events) {\n      if (event.type === LOK_CALLBACK_STATE_CHANGED) {\n        // Parse \".uno:Bold=true\" format\n        const eqIndex = event.payload.indexOf('=');\n        if (eqIndex !== -1) {\n          const key = event.payload.substring(0, eqIndex);\n          const value = event.payload.substring(eqIndex + 1);\n          states.set(key, value);\n        } else {\n          // Some state changes are just the command name (enabled/disabled toggle)\n          states.set(event.payload, '');\n        }\n      }\n    }\n\n    return states;\n  }\n\n  // ==========================================\n  // High-Level Convenience Methods\n  // ==========================================\n\n  /**\n   * Click at a position and get text at that location\n   * @param docPtr Document pointer\n   * @param x X coordinate in twips\n   * @param y Y coordinate in twips\n   * @returns Text at the clicked position\n   */\n  clickAndGetText(docPtr: number, x: number, y: number): string | null {\n    // Click down and up to select\n    this.postMouseEvent(docPtr, LOK_MOUSEEVENT_BUTTONDOWN, x, y, 1, 1, 0);\n    this.postMouseEvent(docPtr, LOK_MOUSEEVENT_BUTTONUP, x, y, 1, 1, 0);\n\n    // Get selected text\n    return this.getTextSelection(docPtr, 'text/plain;charset=utf-8');\n  }\n\n  /**\n   * Double-click to select a word and get it\n   * @param docPtr Document pointer\n   * @param x X coordinate in twips\n   * @param y Y coordinate in twips\n   * @returns Selected word\n   */\n  doubleClickAndGetWord(docPtr: number, x: number, y: number): string | null {\n    // Double click to select word\n    this.postMouseEvent(docPtr, LOK_MOUSEEVENT_BUTTONDOWN, x, y, 2, 1, 0);\n    this.postMouseEvent(docPtr, LOK_MOUSEEVENT_BUTTONUP, x, y, 2, 1, 0);\n\n    // Get selected text\n    return this.getTextSelection(docPtr, 'text/plain;charset=utf-8');\n  }\n\n  /**\n   * Select all content in the document\n   * @param docPtr Document pointer\n   */\n  selectAll(docPtr: number): void {\n    this.postUnoCommand(docPtr, '.uno:SelectAll');\n  }\n\n  /**\n   * Get all text content from the document\n   * @param docPtr Document pointer\n   * @returns All text content\n   */\n  getAllText(docPtr: number): string | null {\n    this.log(`getAllText called with docPtr: ${docPtr}`);\n    this.selectAll(docPtr);\n    const text = this.getTextSelection(docPtr, 'text/plain;charset=utf-8');\n    this.log(`getAllText: text=\"${text?.slice(0, 100)}...\"`);\n    this.resetSelection(docPtr);\n    return text;\n  }\n\n  /**\n   * Parse page rectangles string into array of objects\n   * @param rectanglesStr String from getPartPageRectangles\n   * @returns Array of rectangle objects\n   */\n  parsePageRectangles(rectanglesStr: string): Array<{ x: number; y: number; width: number; height: number }> {\n    if (!rectanglesStr) return [];\n    \n    return rectanglesStr.split(';').filter(s => s.trim()).map(rect => {\n      const parts = rect.split(',').map(Number);\n      return { \n        x: parts[0] ?? 0, \n        y: parts[1] ?? 0, \n        width: parts[2] ?? 0, \n        height: parts[3] ?? 0 \n      };\n    });\n  }\n}\n","/**\n * LibreOffice WASM Document Converter - Browser Version\n *\n * This is the browser-specific version that doesn't include Node.js dependencies.\n * For Node.js usage, use converter-node.ts instead (imported via /server entry point).\n */\n\nimport {\n  ConversionError,\n  ConversionErrorCode,\n  ConversionOptions,\n  ConversionResult,\n  DocumentInfo,\n  EditorOperationResult,\n  EditorSession,\n  EmscriptenModule,\n  EXTENSION_TO_FORMAT,\n  FORMAT_FILTERS,\n  FORMAT_MIME_TYPES,\n  FORMAT_FILTER_OPTIONS,\n  FullQualityPagePreview,\n  FullQualityRenderOptions,\n  ILibreOfficeConverter,\n  InputFormatOptions,\n  LibreOfficeWasmOptions,\n  LOKDocumentType,\n  OUTPUT_FORMAT_TO_LOK,\n  OutputFormat,\n  PagePreview,\n  ProgressInfo,\n  RenderOptions,\n  isConversionValid,\n  getConversionErrorMessage,\n  getValidOutputFormats,\n  InputFormat,\n  getOutputFormatsForDocType,\n} from './types.js';\nimport { LOKBindings } from './lok-bindings.js';\n\n// Declare the module factory type\ntype ModuleFactory = (config: Partial<EmscriptenModule>) => Promise<EmscriptenModule>;\n\n/** Emscripten worker interface */\ninterface EmscriptenWorker {\n  terminate?: () => void;\n}\n\n/** Emscripten PThread interface for pthread cleanup */\ninterface EmscriptenPThread {\n  terminateAllThreads?: () => void;\n  runningWorkers?: EmscriptenWorker[];\n  unusedWorkers?: EmscriptenWorker[];\n}\n\n/** Emscripten module with PThread support */\ninterface EmscriptenModuleWithPThread extends EmscriptenModule {\n  PThread?: EmscriptenPThread;\n}\n\n\n/**\n * LibreOffice WASM Document Converter\n *\n * A headless document conversion toolkit that uses LibreOffice\n * compiled to WebAssembly for browser and Node.js environments.\n */\nexport class LibreOfficeConverter implements ILibreOfficeConverter {\n  private module: EmscriptenModule | null = null;\n  private lokBindings: LOKBindings | null = null;\n  private initialized = false;\n  private initializing = false;\n  private options: LibreOfficeWasmOptions;\n  private corrupted = false;\n  private fsTracked = false;\n\n  constructor(options: LibreOfficeWasmOptions = {}) {\n    this.options = {\n      wasmPath: './wasm',\n      verbose: false,\n      ...options,\n    };\n  }\n\n  /**\n   * Check if an error indicates LOK corruption requiring reinitialization\n   */\n  private isCorruptionError(error: Error | string): boolean {\n    const msg = error instanceof Error ? error.message : error;\n    return msg.includes('memory access out of bounds') ||\n           msg.includes('ComponentContext is not avail') ||\n           msg.includes('unreachable') ||\n           msg.includes('table index is out of bounds') ||\n           msg.includes('null function');\n  }\n\n  /**\n   * Force reinitialization of the converter (for recovery from errors)\n   */\n  async reinitialize(): Promise<void> {\n    if (this.options.verbose) {\n      console.log('[LibreOfficeConverter] Reinitializing due to corruption...');\n    }\n\n    // Clean up existing state\n    if (this.lokBindings) {\n      try {\n        this.lokBindings.destroy();\n      } catch {\n        // Ignore errors during cleanup\n      }\n      this.lokBindings = null;\n    }\n    this.module = null;\n    this.initialized = false;\n    this.corrupted = false;\n\n    // Reinitialize\n    await this.initialize();\n  }\n\n  /**\n   * Initialize with a pre-loaded Emscripten module\n   * This is useful for environments like Web Workers that have their own\n   * WASM loading mechanism (e.g., importScripts with progress tracking)\n   */\n  async initializeWithModule(module: EmscriptenModule): Promise<void> {\n    if (this.initialized) {\n      return;\n    }\n\n    if (this.initializing) {\n      while (this.initializing) {\n        await new Promise((resolve) => setTimeout(resolve, 100));\n      }\n      return;\n    }\n\n    this.initializing = true;\n\n    try {\n      this.module = module;\n\n      // Set up filesystem\n      this.setupFileSystem();\n\n      // Initialize LibreOfficeKit\n      this.initializeLibreOfficeKit();\n\n      this.initialized = true;\n      this.options.onReady?.();\n    } catch (error) {\n      console.error('[LibreOfficeConverter] Initialization error:', error);\n      const convError =\n        error instanceof ConversionError\n          ? error\n          : new ConversionError(\n              ConversionErrorCode.WASM_NOT_INITIALIZED,\n              `Failed to initialize with module: ${String(error)}`\n            );\n      this.options.onError?.(convError);\n      throw convError;\n    } finally {\n      this.initializing = false;\n    }\n  }\n\n  /**\n   * Initialize the LibreOffice WASM module\n   */\n  async initialize(): Promise<void> {\n    if (this.initialized) {\n      return;\n    }\n\n    if (this.initializing) {\n      while (this.initializing) {\n        await new Promise((resolve) => setTimeout(resolve, 100));\n      }\n      return;\n    }\n\n    this.initializing = true;\n    this.emitProgress('loading', 0, 'Loading LibreOffice WASM module...');\n\n    try {\n      // Load WASM module (progress 0-45% handled by loader)\n      this.module = await this.loadModule();\n      \n      this.emitProgress('initializing', 50, 'Setting up virtual filesystem...');\n\n      // Create directories in virtual filesystem\n      this.setupFileSystem();\n      \n      this.emitProgress('initializing', 60, 'Initializing LibreOfficeKit...');\n\n      // Initialize LibreOfficeKit\n      this.initializeLibreOfficeKit();\n\n      this.emitProgress('initializing', 90, 'LibreOfficeKit ready');\n\n      this.initialized = true;\n      this.emitProgress('complete', 100, 'LibreOffice ready');\n      this.options.onReady?.();\n    } catch (error) {\n      console.error('[LibreOfficeConverter] Initialization error:', error);\n      const convError =\n        error instanceof ConversionError\n          ? error\n          : new ConversionError(\n              ConversionErrorCode.WASM_NOT_INITIALIZED,\n              `Failed to initialize WASM module: ${String(error)}`\n            );\n      this.options.onError?.(convError);\n      throw convError;\n    } finally {\n      this.initializing = false;\n    }\n  }\n\n  /**\n   * Load the Emscripten WASM module (browser only)\n   */\n  private async loadModule(): Promise<EmscriptenModule> {\n    const wasmPath = this.options.wasmPath || './wasm';\n    const moduleUrl = `${wasmPath}/soffice.js`;\n\n    const config: Partial<EmscriptenModule> = {\n      locateFile: (path: string) => {\n        if (path.endsWith('.wasm')) {\n          return `${wasmPath}/soffice.wasm`;\n        }\n        if (path.endsWith('.data')) {\n          return `${wasmPath}/soffice.data`;\n        }\n        return `${wasmPath}/${path}`;\n      },\n      print: this.options.verbose ? console.log : () => {},\n      printErr: this.options.verbose ? console.error : () => {},\n    };\n\n    // Create a script element to load the module\n    const script = document.createElement('script');\n    script.src = moduleUrl;\n\n    await new Promise<void>((resolve, reject) => {\n      script.onload = () => resolve();\n      script.onerror = () => reject(new Error(`Failed to load ${moduleUrl}`));\n      document.head.appendChild(script);\n    });\n\n    // The module factory should now be available globally\n    const createModule = (window as Window & { createSofficeModule?: ModuleFactory }).createSofficeModule;\n\n    if (!createModule) {\n      throw new ConversionError(\n        ConversionErrorCode.WASM_NOT_INITIALIZED,\n        'WASM module factory not found. Make sure soffice.js is loaded.'\n      );\n    }\n\n    return new Promise((resolve, reject) => {\n      const moduleWithCallback: Partial<EmscriptenModule> = {\n        ...config,\n        onRuntimeInitialized: () => {\n          resolve(moduleWithCallback as EmscriptenModule);\n        },\n      };\n\n      createModule(moduleWithCallback).catch(reject);\n    });\n  }\n\n  /**\n   * Set up the virtual filesystem\n   */\n  private setupFileSystem(): void {\n    if (!this.module?.FS) {\n      throw new ConversionError(\n        ConversionErrorCode.WASM_NOT_INITIALIZED,\n        'Filesystem not available'\n      );\n    }\n\n    const fs = this.module.FS;\n\n    const tryMkdir = (path: string) => {\n      try {\n        fs.mkdir(path);\n      } catch {\n        // Directory may already exist\n      }\n    };\n\n    tryMkdir('/tmp');\n    tryMkdir('/tmp/input');\n    tryMkdir('/tmp/output');\n  }\n\n  /**\n   * Initialize LibreOfficeKit\n   */\n  private initializeLibreOfficeKit(): void {\n    if (!this.module) {\n      throw new ConversionError(\n        ConversionErrorCode.WASM_NOT_INITIALIZED,\n        'Module not loaded'\n      );\n    }\n\n    // Debug filesystem contents before LOK init\n    if (this.options.verbose && this.module.FS) {\n      const fs = this.module.FS as typeof this.module.FS & {\n        trackingDelegate?: Record<string, unknown>;\n        open: (...args: unknown[]) => unknown;\n      };\n\n      if (!this.fsTracked) {\n        this.fsTracked = true;\n\n        if (!fs.trackingDelegate) {\n          fs.trackingDelegate = {\n            onOpen: (path: string) => {\n              console.log('[FS OPEN]', path);\n            },\n            onOpenFile: (path: string) => {\n              console.log('[FS OPEN FILE]', path);\n            },\n          };\n        }\n\n        if (typeof fs.open === 'function') {\n          const originalOpen = fs.open.bind(fs);\n          fs.open = ((path: string, flags?: unknown, mode?: unknown) => {\n            console.log('[FS OPEN CALL]', path);\n            try {\n              return originalOpen(path, flags as never, mode as never);\n            } catch (err) {\n              const error = err as { code?: string; message?: string };\n              if (error?.code === 'ENOENT') {\n                console.log('[FS ENOENT]', path);\n              }\n              throw err;\n            }\n          }) as typeof fs.open;\n        }\n      }\n\n      const logDir = (label: string, path: string) => {\n        try {\n          console.log(`[FS] ${label}:`, fs.readdir(path));\n        } catch (e) {\n          console.log(`[FS] ${label}: ERROR -`, (e as Error).message);\n        }\n      };\n\n      logDir('ROOT', '/');\n      logDir('PROGRAM DIR', '/instdir/program');\n      logDir('SHARE DIR', '/instdir/share');\n      logDir('REGISTRY DIR', '/instdir/share/registry');\n      logDir('FILTER DIR', '/instdir/share/filter');\n      logDir('CONFIG DIR', '/instdir/share/config/soffice.cfg');\n      logDir('CONFIG FILTER', '/instdir/share/config/soffice.cfg/filter');\n      logDir('IMPRESS MODULES', '/instdir/share/config/soffice.cfg/modules/simpress');\n    }\n\n    // Create LOK bindings wrapper\n    this.lokBindings = new LOKBindings(this.module, this.options.verbose);\n\n    try {\n      // Initialize LibreOfficeKit through the bindings\n      this.lokBindings.initialize('/instdir/program');\n\n      if (this.options.verbose) {\n        const versionInfo = this.lokBindings.getVersionInfo();\n        if (versionInfo) {\n          console.log('[LOK] Version:', versionInfo);\n        }\n      }\n    } catch (error) {\n      throw new ConversionError(\n        ConversionErrorCode.WASM_NOT_INITIALIZED,\n        `Failed to initialize LibreOfficeKit: ${String(error)}`\n      );\n    }\n  }\n\n  /**\n   * Convert a document to a different format\n   */\n  async convert(\n    input: Uint8Array | ArrayBuffer | Buffer,\n    options: ConversionOptions,\n    filename = 'document'\n  ): Promise<ConversionResult> {\n    // Check if we need to reinitialize due to previous corruption\n    if (this.corrupted) {\n      await this.reinitialize();\n    }\n\n    if (!this.initialized || !this.module) {\n      throw new ConversionError(\n        ConversionErrorCode.WASM_NOT_INITIALIZED,\n        'LibreOffice WASM not initialized. Call initialize() first.'\n      );\n    }\n\n    const startTime = Date.now();\n    const inputData = this.normalizeInput(input);\n\n    if (inputData.length === 0) {\n      throw new ConversionError(\n        ConversionErrorCode.INVALID_INPUT,\n        'Empty document provided'\n      );\n    }\n\n    const inputExt = options.inputFormat || this.getExtensionFromFilename(filename) || 'docx';\n    const outputExt = options.outputFormat;\n\n    if (!FORMAT_FILTERS[outputExt]) {\n      throw new ConversionError(\n        ConversionErrorCode.UNSUPPORTED_FORMAT,\n        `Unsupported output format: ${outputExt}`\n      );\n    }\n\n    // Validate that this conversion path is supported\n    if (!isConversionValid(inputExt, outputExt)) {\n      throw new ConversionError(\n        ConversionErrorCode.UNSUPPORTED_FORMAT,\n        getConversionErrorMessage(inputExt, outputExt)\n      );\n    }\n\n    const inputPath = `/tmp/input/doc.${inputExt}`;\n    const outputPath = `/tmp/output/doc.${outputExt}`;\n\n    try {\n      this.emitProgress('converting', 10, 'Writing input document...');\n\n      // Write input file to virtual filesystem\n      this.module.FS.writeFile(inputPath, inputData);\n\n      this.emitProgress('converting', 30, 'Converting document...');\n\n      // Perform conversion\n      const result = await this.performConversion(inputPath, outputPath, options);\n\n      this.emitProgress('complete', 100, 'Conversion complete');\n\n      const baseName = this.getBasename(filename);\n      const outputFilename = `${baseName}.${outputExt}`;\n\n      return {\n        data: result,\n        mimeType: FORMAT_MIME_TYPES[outputExt],\n        filename: outputFilename,\n        duration: Date.now() - startTime,\n      };\n    } catch (error) {\n      // Check if this error indicates corruption\n      if (error instanceof Error && this.isCorruptionError(error)) {\n        this.corrupted = true;\n        if (this.options.verbose) {\n          console.log('[LibreOfficeConverter] Corruption detected, will reinitialize on next convert');\n        }\n      }\n      throw error;\n    } finally {\n      // Cleanup temporary files\n      try {\n        this.module?.FS.unlink(inputPath);\n      } catch {\n        // Ignore\n      }\n      try {\n        this.module?.FS.unlink(outputPath);\n      } catch {\n        // Ignore\n      }\n    }\n  }\n\n  /**\n   * Perform the actual conversion using LibreOfficeKit\n   */\n  private async performConversion(\n    inputPath: string,\n    outputPath: string,\n    options: ConversionOptions\n  ): Promise<Uint8Array> {\n    if (!this.module || !this.lokBindings) {\n      throw new ConversionError(\n        ConversionErrorCode.WASM_NOT_INITIALIZED,\n        'Module not loaded'\n      );\n    }\n\n    this.emitProgress('converting', 40, 'Loading document...');\n\n    let docPtr = 0;\n\n    try {\n      // Build load options (e.g., for password-protected documents)\n      const loadOptions = options.password \n        ? `,Password=${options.password}` \n        : '';\n\n      // Debug: verify file exists before LOK load\n      if (this.options.verbose) {\n        try {\n          const stat = this.module.FS.stat(inputPath);\n          console.log('[Convert] File exists before LOK load:', inputPath, 'size:', stat.size);\n        } catch (e) {\n          console.log('[Convert] File NOT found before LOK load:', inputPath, (e as Error).message);\n        }\n      }\n\n      // Load the document using LibreOfficeKit\n      if (loadOptions) {\n        docPtr = this.lokBindings.documentLoadWithOptions(inputPath, loadOptions);\n      } else {\n        docPtr = this.lokBindings.documentLoad(inputPath);\n      }\n\n      if (docPtr === 0) {\n        throw new ConversionError(\n          ConversionErrorCode.LOAD_FAILED,\n          'Failed to load document'\n        );\n      }\n\n      this.emitProgress('converting', 60, 'Converting format...');\n\n      // Determine the output format string for LOK\n      const lokFormat = OUTPUT_FORMAT_TO_LOK[options.outputFormat];\n      \n      // Get filter options for the format\n      let filterOptions = FORMAT_FILTER_OPTIONS[options.outputFormat] || '';\n      \n      // Add PDF-specific options if applicable\n      if (options.outputFormat === 'pdf' && options.pdf) {\n        const pdfOpts: string[] = [];\n        if (options.pdf.pdfaLevel) {\n          const levelMap: Record<string, number> = {\n            'PDF/A-1b': 1,\n            'PDF/A-2b': 2,\n            'PDF/A-3b': 3,\n          };\n          pdfOpts.push(`SelectPdfVersion=${levelMap[options.pdf.pdfaLevel] || 0}`);\n        }\n        if (options.pdf.quality !== undefined) {\n          pdfOpts.push(`Quality=${options.pdf.quality}`);\n        }\n        if (pdfOpts.length > 0) {\n          filterOptions = pdfOpts.join(',');\n        }\n      }\n\n      // Add page selection for image exports (png, jpg, svg)\n      if (['png', 'jpg', 'svg'].includes(options.outputFormat) && options.image?.pageIndex !== undefined) {\n        // PageRange is 1-indexed\n        const pageNum = options.image.pageIndex + 1;\n        if (filterOptions) {\n          filterOptions += `;PageRange=${pageNum}-${pageNum}`;\n        } else {\n          filterOptions = `PageRange=${pageNum}-${pageNum}`;\n        }\n      }\n\n      this.emitProgress('converting', 70, 'Saving document...');\n\n      // Save the document in the new format\n      this.lokBindings.documentSaveAs(docPtr, outputPath, lokFormat, filterOptions);\n\n      this.emitProgress('converting', 90, 'Reading output...');\n\n      // Read the converted output file\n      try {\n        const outputData = this.module.FS.readFile(outputPath) as Uint8Array;\n        \n        if (outputData.length === 0) {\n          throw new ConversionError(\n            ConversionErrorCode.CONVERSION_FAILED,\n            'Conversion produced empty output'\n          );\n        }\n        \n        return outputData;\n      } catch (fsError) {\n        throw new ConversionError(\n          ConversionErrorCode.CONVERSION_FAILED,\n          `Failed to read converted file: ${String(fsError)}`\n        );\n      }\n    } catch (error) {\n      if (error instanceof ConversionError) {\n        throw error;\n      }\n      throw new ConversionError(\n        ConversionErrorCode.CONVERSION_FAILED,\n        `Conversion failed: ${String(error)}`\n      );\n    } finally {\n      // Always clean up the document\n      if (docPtr !== 0 && this.lokBindings) {\n        try {\n          this.lokBindings.documentDestroy(docPtr);\n        } catch {\n          // Ignore cleanup errors\n        }\n      }\n    }\n  }\n\n  /**\n   * Render page previews (thumbnails) for a document\n   * @param input Document data\n   * @param options Options with inputFormat\n   * @param renderOptions Render settings (width, height, pageIndices)\n   * @returns Array of page preview data with RGBA pixels\n   */\n  async renderPagePreviews(\n    input: Uint8Array | ArrayBuffer | Buffer,\n    options: InputFormatOptions,\n    renderOptions: RenderOptions = {}\n  ): Promise<PagePreview[]> {\n    if (!this.initialized || !this.module || !this.lokBindings) {\n      throw new ConversionError(\n        ConversionErrorCode.WASM_NOT_INITIALIZED,\n        'Converter not initialized'\n      );\n    }\n\n    const data = this.normalizeInput(input);\n    const inputFormat = (options.inputFormat || 'docx').toLowerCase();\n    const width = renderOptions.width ?? 256;\n    const height = renderOptions.height ?? 0;\n    const pageIndices = renderOptions.pageIndices ?? [];\n\n    // Write input file to virtual FS\n    const inputPath = `/tmp/preview/doc.${inputFormat}`;\n    const fs = this.module.FS;\n\n    try {\n      // Create directory\n      try {\n        fs.mkdir('/tmp/preview');\n      } catch {\n        // Directory might exist\n      }\n\n      // Write file\n      fs.writeFile(inputPath, data);\n\n      // Load document\n      const docPtr = this.lokBindings.documentLoad(inputPath);\n      if (docPtr === 0) {\n        throw new ConversionError(\n          ConversionErrorCode.LOAD_FAILED,\n          'Failed to load document for preview'\n        );\n      }\n\n      try {\n        // Get number of pages/parts\n        const numParts = this.lokBindings.documentGetParts(docPtr);\n        if (this.options.verbose) {\n          console.log(`[Preview] Document has ${numParts} pages/parts`);\n        }\n\n        // Determine which pages to render\n        const pagesToRender =\n          pageIndices.length > 0\n            ? pageIndices.filter((i) => i >= 0 && i < numParts)\n            : Array.from({ length: numParts }, (_, i) => i);\n\n        const results: PagePreview[] = [];\n\n        // Render each page (editMode defaults to false for clean presentation rendering)\n        const editMode = renderOptions.editMode ?? false;\n        for (const pageIndex of pagesToRender) {\n          if (this.options.verbose) {\n            console.log(`[Preview] Rendering page ${pageIndex + 1}/${numParts}`);\n          }\n\n          const preview = this.lokBindings.renderPage(docPtr, pageIndex, width, height, editMode);\n          results.push({\n            page: pageIndex,\n            data: preview.data,\n            width: preview.width,\n            height: preview.height,\n          });\n        }\n\n        return results;\n      } finally {\n        // Clean up document\n        this.lokBindings.documentDestroy(docPtr);\n      }\n    } finally {\n      // Clean up input file\n      try {\n        fs.unlink(inputPath);\n      } catch {\n        // Ignore\n      }\n      try {\n        fs.rmdir('/tmp/preview');\n      } catch {\n        // Ignore\n      }\n    }\n  }\n\n  /**\n   * Render a page at full quality (native resolution based on DPI)\n   * @param input Document data\n   * @param options Options with inputFormat\n   * @param pageIndex Zero-based page index to render\n   * @param renderOptions DPI and max dimension settings\n   * @returns Full quality page preview with RGBA data and DPI info\n   */\n  async renderPageFullQuality(\n    input: Uint8Array | ArrayBuffer | Buffer,\n    options: InputFormatOptions,\n    pageIndex: number,\n    renderOptions: FullQualityRenderOptions = {}\n  ): Promise<FullQualityPagePreview> {\n    if (!this.initialized || !this.module || !this.lokBindings) {\n      throw new ConversionError(\n        ConversionErrorCode.WASM_NOT_INITIALIZED,\n        'Converter not initialized'\n      );\n    }\n\n    const data = this.normalizeInput(input);\n    const inputFormat = (options.inputFormat || 'docx').toLowerCase();\n    const dpi = renderOptions.dpi ?? 150;\n    const maxDimension = renderOptions.maxDimension;\n\n    // Write input file to virtual FS\n    const inputPath = `/tmp/fullquality/doc.${inputFormat}`;\n    const fs = this.module.FS;\n\n    try {\n      // Create directory\n      try {\n        fs.mkdir('/tmp/fullquality');\n      } catch {\n        // Directory might exist\n      }\n\n      // Write file\n      fs.writeFile(inputPath, data);\n\n      // Load document\n      const docPtr = this.lokBindings.documentLoad(inputPath);\n      if (docPtr === 0) {\n        throw new ConversionError(\n          ConversionErrorCode.LOAD_FAILED,\n          'Failed to load document for full quality render'\n        );\n      }\n\n      try {\n        // Validate page index\n        const numParts = this.lokBindings.documentGetParts(docPtr);\n        if (pageIndex < 0 || pageIndex >= numParts) {\n          throw new ConversionError(\n            ConversionErrorCode.CONVERSION_FAILED,\n            `Page index ${pageIndex} out of range (0-${numParts - 1})`\n          );\n        }\n\n        if (this.options.verbose) {\n          console.log(`[FullQuality] Rendering page ${pageIndex + 1}/${numParts} at ${dpi} DPI`);\n        }\n\n        // Render at full quality (editMode defaults to false for clean presentation rendering)\n        const editMode = renderOptions.editMode ?? false;\n        const preview = this.lokBindings.renderPageFullQuality(docPtr, pageIndex, dpi, maxDimension, editMode);\n\n        return {\n          page: pageIndex,\n          data: preview.data,\n          width: preview.width,\n          height: preview.height,\n          dpi: preview.dpi,\n        };\n      } finally {\n        // Clean up document\n        this.lokBindings.documentDestroy(docPtr);\n      }\n    } finally {\n      // Clean up input file\n      try {\n        fs.unlink(inputPath);\n      } catch {\n        // Ignore\n      }\n      try {\n        fs.rmdir('/tmp/fullquality');\n      } catch {\n        // Ignore\n      }\n    }\n  }\n\n  /**\n   * Get the number of pages/parts in a document\n   */\n  async getPageCount(\n    input: Uint8Array | ArrayBuffer | Buffer,\n    options: InputFormatOptions\n  ): Promise<number> {\n    if (!this.initialized || !this.module || !this.lokBindings) {\n      throw new ConversionError(\n        ConversionErrorCode.WASM_NOT_INITIALIZED,\n        'Converter not initialized'\n      );\n    }\n\n    const data = this.normalizeInput(input);\n    const inputFormat = (options.inputFormat || 'docx').toLowerCase();\n\n    const inputPath = `/tmp/pagecount/doc.${inputFormat}`;\n    const fs = this.module.FS;\n\n    try {\n      try {\n        fs.mkdir('/tmp/pagecount');\n      } catch {\n        // Directory might exist\n      }\n\n      fs.writeFile(inputPath, data);\n      const docPtr = this.lokBindings.documentLoad(inputPath);\n\n      if (docPtr === 0) {\n        throw new ConversionError(\n          ConversionErrorCode.LOAD_FAILED,\n          'Failed to load document'\n        );\n      }\n\n      try {\n        return this.lokBindings.documentGetParts(docPtr);\n      } finally {\n        this.lokBindings.documentDestroy(docPtr);\n      }\n    } finally {\n      try {\n        fs.unlink(inputPath);\n      } catch {\n        // Ignore\n      }\n      try {\n        fs.rmdir('/tmp/pagecount');\n      } catch {\n        // Ignore\n      }\n    }\n  }\n\n  /**\n   * Get valid output formats for a document by loading it and checking its type\n   * This is more accurate than static validation as it uses LibreOffice's actual document type detection\n   * @param input Document data\n   * @param options Options with inputFormat\n   * @returns Object with document type and valid output formats\n   */\n  async getDocumentInfo(\n    input: Uint8Array | ArrayBuffer | Buffer,\n    options: InputFormatOptions\n  ): Promise<DocumentInfo> {\n    if (!this.initialized || !this.module || !this.lokBindings) {\n      throw new ConversionError(\n        ConversionErrorCode.WASM_NOT_INITIALIZED,\n        'Converter not initialized'\n      );\n    }\n\n    const data = this.normalizeInput(input);\n    const inputFormat = (options.inputFormat || 'docx').toLowerCase();\n\n    const inputPath = `/tmp/docinfo/doc.${inputFormat}`;\n    const fs = this.module.FS;\n\n    try {\n      try {\n        fs.mkdir('/tmp/docinfo');\n      } catch {\n        // Directory might exist\n      }\n\n      fs.writeFile(inputPath, data);\n      const docPtr = this.lokBindings.documentLoad(inputPath);\n\n      if (docPtr === 0) {\n        throw new ConversionError(\n          ConversionErrorCode.LOAD_FAILED,\n          'Failed to load document'\n        );\n      }\n\n      try {\n        const docType = this.lokBindings.documentGetDocumentType(docPtr) as LOKDocumentType;\n        const pageCount = this.lokBindings.documentGetParts(docPtr);\n        const validOutputFormats = getOutputFormatsForDocType(docType);\n\n        const docTypeNames: Record<LOKDocumentType, string> = {\n          [LOKDocumentType.TEXT]: 'Text Document',\n          [LOKDocumentType.SPREADSHEET]: 'Spreadsheet',\n          [LOKDocumentType.PRESENTATION]: 'Presentation',\n          [LOKDocumentType.DRAWING]: 'Drawing',\n          [LOKDocumentType.OTHER]: 'Other',\n        };\n\n        return {\n          documentType: docType,\n          documentTypeName: docTypeNames[docType] || 'Unknown',\n          validOutputFormats,\n          pageCount,\n        };\n      } finally {\n        this.lokBindings.documentDestroy(docPtr);\n      }\n    } finally {\n      try {\n        fs.unlink(inputPath);\n      } catch {\n        // Ignore\n      }\n      try {\n        fs.rmdir('/tmp/docinfo');\n      } catch {\n        // Ignore\n      }\n    }\n  }\n\n  // ============================================================\n  // Document Inspection Methods\n  // ============================================================\n\n  /**\n   * Get all text content from a document\n   * @param input Document data\n   * @param options Conversion options with inputFormat\n   * @returns All text content from the document\n   */\n  async getDocumentText(\n    input: Uint8Array | ArrayBuffer | Buffer,\n    options: ConversionOptions\n  ): Promise<string | null> {\n    if (!this.initialized || !this.module || !this.lokBindings) {\n      throw new ConversionError(\n        ConversionErrorCode.WASM_NOT_INITIALIZED,\n        'Converter not initialized'\n      );\n    }\n\n    const data = this.normalizeInput(input);\n    const inputFormat = options.inputFormat?.toLowerCase();\n\n    if (!inputFormat) {\n      throw new ConversionError(\n        ConversionErrorCode.INVALID_INPUT,\n        'Input format is required'\n      );\n    }\n\n    const inputPath = `/tmp/inspect/doc.${inputFormat}`;\n    const fs = this.module.FS;\n\n    try {\n      try {\n        fs.mkdir('/tmp/inspect');\n      } catch {\n        // Directory might exist\n      }\n\n      fs.writeFile(inputPath, data);\n      const docPtr = this.lokBindings.documentLoad(inputPath);\n\n      if (docPtr === 0) {\n        throw new ConversionError(\n          ConversionErrorCode.LOAD_FAILED,\n          'Failed to load document'\n        );\n      }\n\n      try {\n        return this.lokBindings.getAllText(docPtr);\n      } finally {\n        this.lokBindings.documentDestroy(docPtr);\n      }\n    } finally {\n      try {\n        fs.unlink(inputPath);\n      } catch {\n        // Ignore\n      }\n      try {\n        fs.rmdir('/tmp/inspect');\n      } catch {\n        // Ignore\n      }\n    }\n  }\n\n  /**\n   * Get page/slide names from a document\n   * @param input Document data\n   * @param options Conversion options with inputFormat\n   * @returns Array of page/slide names\n   */\n  async getPageNames(\n    input: Uint8Array | ArrayBuffer | Buffer,\n    options: ConversionOptions\n  ): Promise<string[]> {\n    if (!this.initialized || !this.module || !this.lokBindings) {\n      throw new ConversionError(\n        ConversionErrorCode.WASM_NOT_INITIALIZED,\n        'Converter not initialized'\n      );\n    }\n\n    const data = this.normalizeInput(input);\n    const inputFormat = options.inputFormat?.toLowerCase();\n\n    if (!inputFormat) {\n      throw new ConversionError(\n        ConversionErrorCode.INVALID_INPUT,\n        'Input format is required'\n      );\n    }\n\n    const inputPath = `/tmp/names/doc.${inputFormat}`;\n    const fs = this.module.FS;\n\n    try {\n      try {\n        fs.mkdir('/tmp/names');\n      } catch {\n        // Directory might exist\n      }\n\n      fs.writeFile(inputPath, data);\n      const docPtr = this.lokBindings.documentLoad(inputPath);\n\n      if (docPtr === 0) {\n        throw new ConversionError(\n          ConversionErrorCode.LOAD_FAILED,\n          'Failed to load document'\n        );\n      }\n\n      try {\n        const numParts = this.lokBindings.documentGetParts(docPtr);\n        const names: string[] = [];\n        \n        for (let i = 0; i < numParts; i++) {\n          const name = this.lokBindings.getPartName(docPtr, i);\n          names.push(name || `Page ${i + 1}`);\n        }\n        \n        return names;\n      } finally {\n        this.lokBindings.documentDestroy(docPtr);\n      }\n    } finally {\n      try {\n        fs.unlink(inputPath);\n      } catch {\n        // Ignore\n      }\n      try {\n        fs.rmdir('/tmp/names');\n      } catch {\n        // Ignore\n      }\n    }\n  }\n\n  /**\n   * Get page bounding rectangles from a document\n   * @param input Document data\n   * @param options Conversion options with inputFormat\n   * @returns Array of page rectangles in twips\n   */\n  async getPageRectangles(\n    input: Uint8Array | ArrayBuffer | Buffer,\n    options: ConversionOptions\n  ): Promise<Array<{ x: number; y: number; width: number; height: number }>> {\n    if (!this.initialized || !this.module || !this.lokBindings) {\n      throw new ConversionError(\n        ConversionErrorCode.WASM_NOT_INITIALIZED,\n        'Converter not initialized'\n      );\n    }\n\n    const data = this.normalizeInput(input);\n    const inputFormat = options.inputFormat?.toLowerCase();\n\n    if (!inputFormat) {\n      throw new ConversionError(\n        ConversionErrorCode.INVALID_INPUT,\n        'Input format is required'\n      );\n    }\n\n    const inputPath = `/tmp/rects/doc.${inputFormat}`;\n    const fs = this.module.FS;\n\n    try {\n      try {\n        fs.mkdir('/tmp/rects');\n      } catch {\n        // Directory might exist\n      }\n\n      fs.writeFile(inputPath, data);\n      const docPtr = this.lokBindings.documentLoad(inputPath);\n\n      if (docPtr === 0) {\n        throw new ConversionError(\n          ConversionErrorCode.LOAD_FAILED,\n          'Failed to load document'\n        );\n      }\n\n      try {\n        const rectsStr = this.lokBindings.getPartPageRectangles(docPtr);\n        return this.lokBindings.parsePageRectangles(rectsStr || '');\n      } finally {\n        this.lokBindings.documentDestroy(docPtr);\n      }\n    } finally {\n      try {\n        fs.unlink(inputPath);\n      } catch {\n        // Ignore\n      }\n      try {\n        fs.rmdir('/tmp/rects');\n      } catch {\n        // Ignore\n      }\n    }\n  }\n\n  /**\n   * Get spreadsheet data area (last used row/column)\n   * @param input Document data\n   * @param options Conversion options with inputFormat\n   * @param sheetIndex Sheet index (0-based)\n   * @returns Object with col and row counts\n   */\n  async getSpreadsheetDataArea(\n    input: Uint8Array | ArrayBuffer | Buffer,\n    options: ConversionOptions,\n    sheetIndex: number = 0\n  ): Promise<{ col: number; row: number }> {\n    if (!this.initialized || !this.module || !this.lokBindings) {\n      throw new ConversionError(\n        ConversionErrorCode.WASM_NOT_INITIALIZED,\n        'Converter not initialized'\n      );\n    }\n\n    const data = this.normalizeInput(input);\n    const inputFormat = options.inputFormat?.toLowerCase();\n\n    if (!inputFormat) {\n      throw new ConversionError(\n        ConversionErrorCode.INVALID_INPUT,\n        'Input format is required'\n      );\n    }\n\n    const inputPath = `/tmp/dataarea/doc.${inputFormat}`;\n    const fs = this.module.FS;\n\n    try {\n      try {\n        fs.mkdir('/tmp/dataarea');\n      } catch {\n        // Directory might exist\n      }\n\n      fs.writeFile(inputPath, data);\n      const docPtr = this.lokBindings.documentLoad(inputPath);\n\n      if (docPtr === 0) {\n        throw new ConversionError(\n          ConversionErrorCode.LOAD_FAILED,\n          'Failed to load document'\n        );\n      }\n\n      try {\n        return this.lokBindings.getDataArea(docPtr, sheetIndex);\n      } finally {\n        this.lokBindings.documentDestroy(docPtr);\n      }\n    } finally {\n      try {\n        fs.unlink(inputPath);\n      } catch {\n        // Ignore\n      }\n      try {\n        fs.rmdir('/tmp/dataarea');\n      } catch {\n        // Ignore\n      }\n    }\n  }\n\n  /**\n   * Execute a UNO command on a document\n   * @param input Document data\n   * @param options Conversion options with inputFormat\n   * @param command UNO command (e.g., '.uno:SelectAll')\n   * @param args JSON arguments string\n   * @returns Command result (if any)\n   */\n  async executeUnoCommand(\n    input: Uint8Array | ArrayBuffer | Buffer,\n    options: ConversionOptions,\n    command: string,\n    args: string = '{}'\n  ): Promise<void> {\n    if (!this.initialized || !this.module || !this.lokBindings) {\n      throw new ConversionError(\n        ConversionErrorCode.WASM_NOT_INITIALIZED,\n        'Converter not initialized'\n      );\n    }\n\n    const data = this.normalizeInput(input);\n    const inputFormat = options.inputFormat?.toLowerCase();\n\n    if (!inputFormat) {\n      throw new ConversionError(\n        ConversionErrorCode.INVALID_INPUT,\n        'Input format is required'\n      );\n    }\n\n    const inputPath = `/tmp/uno/doc.${inputFormat}`;\n    const fs = this.module.FS;\n\n    try {\n      try {\n        fs.mkdir('/tmp/uno');\n      } catch {\n        // Directory might exist\n      }\n\n      fs.writeFile(inputPath, data);\n      const docPtr = this.lokBindings.documentLoad(inputPath);\n\n      if (docPtr === 0) {\n        throw new ConversionError(\n          ConversionErrorCode.LOAD_FAILED,\n          'Failed to load document'\n        );\n      }\n\n      try {\n        this.lokBindings.postUnoCommand(docPtr, command, args);\n      } finally {\n        this.lokBindings.documentDestroy(docPtr);\n      }\n    } finally {\n      try {\n        fs.unlink(inputPath);\n      } catch {\n        // Ignore\n      }\n      try {\n        fs.rmdir('/tmp/uno');\n      } catch {\n        // Ignore\n      }\n    }\n  }\n\n  // ============================================\n  // ILibreOfficeConverter Interface Methods\n  // ============================================\n\n  /**\n   * Render a single page as an image\n   * @param input Document data\n   * @param options Options with inputFormat\n   * @param pageIndex Zero-based page index to render\n   * @param width Target width for rendered page\n   * @param height Optional target height (0 = auto based on aspect ratio)\n   * @returns Page preview with RGBA data\n   */\n  async renderPage(\n    input: Uint8Array | ArrayBuffer | Buffer,\n    options: InputFormatOptions,\n    pageIndex: number,\n    width: number,\n    height = 0\n  ): Promise<PagePreview> {\n    if (!this.initialized || !this.module || !this.lokBindings) {\n      throw new ConversionError(\n        ConversionErrorCode.WASM_NOT_INITIALIZED,\n        'Converter not initialized'\n      );\n    }\n\n    const data = this.normalizeInput(input);\n    const inputFormat = (options.inputFormat || 'docx').toLowerCase();\n\n    const inputPath = `/tmp/renderpage/doc.${inputFormat}`;\n    const fs = this.module.FS;\n\n    try {\n      try {\n        fs.mkdir('/tmp/renderpage');\n      } catch {\n        // Directory might exist\n      }\n\n      fs.writeFile(inputPath, data);\n      const docPtr = this.lokBindings.documentLoad(inputPath);\n\n      if (docPtr === 0) {\n        throw new ConversionError(\n          ConversionErrorCode.LOAD_FAILED,\n          'Failed to load document'\n        );\n      }\n\n      try {\n        const preview = this.lokBindings.renderPage(docPtr, pageIndex, width, height);\n        return {\n          page: pageIndex,\n          data: preview.data,\n          width: preview.width,\n          height: preview.height,\n        };\n      } finally {\n        this.lokBindings.documentDestroy(docPtr);\n      }\n    } finally {\n      try {\n        fs.unlink(inputPath);\n      } catch {\n        // Ignore\n      }\n      try {\n        fs.rmdir('/tmp/renderpage');\n      } catch {\n        // Ignore\n      }\n    }\n  }\n\n  /**\n   * Open a document for editing\n   * Note: This low-level converter does not support persistent editor sessions.\n   * Use WorkerConverter or WorkerBrowserConverter for editor operations.\n   * @throws ConversionError Always throws - editor sessions not supported\n   */\n  openDocument(\n    _input: Uint8Array | ArrayBuffer,\n    _options: InputFormatOptions\n  ): Promise<EditorSession> {\n    return Promise.reject(new ConversionError(\n      ConversionErrorCode.CONVERSION_FAILED,\n      'Editor sessions not supported by LibreOfficeConverter. Use WorkerConverter or WorkerBrowserConverter.'\n    ));\n  }\n\n  /**\n   * Execute an editor operation on an open document\n   * Note: This low-level converter does not support editor operations.\n   * @throws ConversionError Always throws - editor operations not supported\n   */\n  editorOperation<T = unknown>(\n    _sessionId: string,\n    _method: string,\n    _args?: unknown[]\n  ): Promise<EditorOperationResult<T>> {\n    return Promise.reject(new ConversionError(\n      ConversionErrorCode.CONVERSION_FAILED,\n      'Editor operations not supported by LibreOfficeConverter. Use WorkerConverter or WorkerBrowserConverter.'\n    ));\n  }\n\n  /**\n   * Close an editor session\n   * Note: This low-level converter does not support editor sessions.\n   * @throws ConversionError Always throws - editor sessions not supported\n   */\n  closeDocument(_sessionId: string): Promise<Uint8Array | undefined> {\n    return Promise.reject(new ConversionError(\n      ConversionErrorCode.CONVERSION_FAILED,\n      'Editor sessions not supported by LibreOfficeConverter. Use WorkerConverter or WorkerBrowserConverter.'\n    ));\n  }\n\n  /**\n   * Get LOK bindings for advanced operations\n   * Use with caution - this exposes low-level API\n   * @returns LOK bindings instance or null\n   */\n  getLokBindings(): typeof this.lokBindings {\n    return this.lokBindings;\n  }\n\n  /**\n   * Destroy the LibreOffice instance and free resources\n   */\n  destroy(): Promise<void> {\n    if (this.lokBindings) {\n      try {\n        this.lokBindings.destroy();\n      } catch {\n        // Ignore cleanup errors\n      }\n      this.lokBindings = null;\n    }\n\n    // Terminate Emscripten pthread workers\n    if (this.module) {\n      try {\n        const mod = this.module as EmscriptenModuleWithPThread;\n\n        // Try to terminate all pthread workers\n        if (mod.PThread?.terminateAllThreads) {\n          mod.PThread.terminateAllThreads();\n        }\n\n        // Terminate any running workers\n        if (mod.PThread?.runningWorkers) {\n          for (const worker of mod.PThread.runningWorkers) {\n            if (worker?.terminate) {\n              worker.terminate();\n            }\n          }\n          mod.PThread.runningWorkers = [];\n        }\n\n        // Also check unusedWorkers\n        if (mod.PThread?.unusedWorkers) {\n          for (const worker of mod.PThread.unusedWorkers) {\n            if (worker?.terminate) {\n              worker.terminate();\n            }\n          }\n          mod.PThread.unusedWorkers = [];\n        }\n      } catch {\n        // Ignore pthread cleanup errors\n      }\n    }\n\n    this.module = null;\n    this.initialized = false;\n    return Promise.resolve();\n  }\n\n  /**\n   * Check if the converter is ready\n   */\n  isReady(): boolean {\n    return this.initialized;\n  }\n\n  /**\n   * Get the Emscripten module for advanced operations\n   * This is useful for direct filesystem or module access\n   */\n  getModule(): EmscriptenModule | null {\n    return this.module;\n  }\n\n  /**\n   * Get supported input formats\n   */\n  static getSupportedInputFormats(): string[] {\n    return Object.keys(EXTENSION_TO_FORMAT);\n  }\n\n  /**\n   * Get supported output formats\n   */\n  static getSupportedOutputFormats(): OutputFormat[] {\n    return Object.keys(FORMAT_FILTERS) as OutputFormat[];\n  }\n\n  /**\n   * Get valid output formats for a given input format\n   * @param inputFormat The input document format (e.g., 'pdf', 'docx', 'xlsx')\n   * @returns Array of valid output formats for this input\n   */\n  static getValidOutputFormats(inputFormat: string): OutputFormat[] {\n    return getValidOutputFormats(inputFormat as InputFormat);\n  }\n\n  /**\n   * Check if a conversion from input format to output format is supported\n   * @param inputFormat The input document format\n   * @param outputFormat The desired output format\n   * @returns true if the conversion is supported\n   */\n  static isConversionSupported(inputFormat: string, outputFormat: string): boolean {\n    return isConversionValid(inputFormat, outputFormat);\n  }\n\n  // ============================================================\n  // Private helper methods\n  // ============================================================\n\n  private normalizeInput(input: Uint8Array | ArrayBuffer | Buffer): Uint8Array {\n    if (input instanceof Uint8Array) {\n      return input;\n    }\n    if (input instanceof ArrayBuffer) {\n      return new Uint8Array(input);\n    }\n    return new Uint8Array(input);\n  }\n\n  private getExtensionFromFilename(filename: string): string | null {\n    const parts = filename.split('.');\n    if (parts.length > 1) {\n      return parts.pop()?.toLowerCase() || null;\n    }\n    return null;\n  }\n\n  private getBasename(filename: string): string {\n    const lastDot = filename.lastIndexOf('.');\n    if (lastDot > 0) {\n      return filename.substring(0, lastDot);\n    }\n    return filename;\n  }\n\n  private emitProgress(\n    phase: ProgressInfo['phase'],\n    percent: number,\n    message: string\n  ): void {\n    this.options.onProgress?.({ phase, percent, message });\n  }\n}\n","/**\n * Browser Web Worker for LibreOffice WASM conversions\n *\n * This worker runs the WASM module off the main thread to avoid blocking the UI.\n * Communication is via postMessage.\n */\n\nimport type { EditorOperationResult, EmscriptenModule, WasmLoadPhase, WasmLoadProgress } from './types.js';\nimport { LOKBindings } from './lok-bindings.js';\nimport { FORMAT_FILTER_OPTIONS, OUTPUT_FORMAT_TO_LOK } from './types.js';\nimport { createEditor, OfficeEditor } from './editor/index.js';\nimport type { OperationResult } from './editor/types.js';\nimport { LibreOfficeConverter } from './converter.js';\n\n// ============================================\n// WASM Loading Progress System\n// ============================================\n\n/**\n * Cumulative progress tracking - each step adds to the total\n * This ensures progress always increases even if events arrive out of order\n *\n * Weight distribution (sums to 100):\n * - download-wasm: 50 points (largest file ~142MB)\n * - download-data: 30 points (~96MB)\n * - compile: 5 points\n * - filesystem: 7 points\n * - lok-init: 7 points\n * - ready: 1 point (final)\n */\nconst PHASE_WEIGHTS: Record<WasmLoadPhase, number> = {\n  'download-wasm': 50,\n  'download-data': 30,\n  'compile': 5,\n  'filesystem': 7,\n  'lok-init': 7,\n  'ready': 1,\n  'starting': 0,\n  'loading': 0,\n  'initializing': 0,\n  'converting': 0,\n  'complete': 0,\n};\n\n/** Track completed progress for each phase */\nconst phaseProgress: Record<WasmLoadPhase, number> = {\n  'download-wasm': 0,\n  'download-data': 0,\n  'compile': 0,\n  'filesystem': 0,\n  'lok-init': 0,\n  'ready': 0,\n  'starting': 0,\n  'loading': 0,\n  'initializing': 0,\n  'converting': 0,\n  'complete': 0,\n};\n\n/** Current request ID for progress messages */\nlet currentInitRequestId: number = 0;\n\n/** Last emitted percentage - ensures monotonic progress */\nlet lastEmittedPercent: number = 0;\n\n/** Calculate total progress as sum of all phase progress */\nfunction calculateTotalProgress(): number {\n  let total = 0;\n  for (const phase of Object.keys(phaseProgress) as WasmLoadPhase[]) {\n    total += phaseProgress[phase];\n  }\n  const percent = Math.min(100, Math.round(total));\n  // Ensure we never emit a lower percentage than before\n  if (percent > lastEmittedPercent) {\n    lastEmittedPercent = percent;\n  }\n  return lastEmittedPercent;\n}\n\n/** Format bytes as human-readable MB */\nfunction formatBytes(bytes: number): string {\n  const mb = bytes / (1024 * 1024);\n  return `${mb.toFixed(1)} MB`;\n}\n\n/** Emit download progress with bytes info */\nfunction emitDownloadProgress(phase: WasmLoadPhase, loaded: number, total: number) {\n  const weight = PHASE_WEIGHTS[phase];\n  const phasePercent = total > 0 ? loaded / total : 0;\n  const newProgress = weight * phasePercent;\n\n  // Only update if progress increased (never go backwards)\n  if (newProgress > phaseProgress[phase]) {\n    phaseProgress[phase] = newProgress;\n  }\n\n  const message = phase === 'download-wasm'\n    ? `Downloading WebAssembly... ${formatBytes(loaded)} / ${formatBytes(total)}`\n    : `Downloading filesystem... ${formatBytes(loaded)} / ${formatBytes(total)}`;\n\n  emitProgress({ percent: calculateTotalProgress(), message, phase, bytesLoaded: loaded, bytesTotal: total });\n}\n\n/** Emit phase progress (marks phase as complete) */\nfunction emitPhaseProgress(phase: WasmLoadPhase, message: string) {\n  // Only update if this is an increase\n  const newProgress = PHASE_WEIGHTS[phase];\n  if (newProgress > phaseProgress[phase]) {\n    phaseProgress[phase] = newProgress;\n  }\n  emitProgress({ percent: calculateTotalProgress(), message, phase });\n}\n\n/** Send progress to main thread */\nfunction emitProgress(progress: WasmLoadProgress) {\n  self.postMessage({ type: 'progress', id: currentInitRequestId, progress });\n}\n\n/**\n * Install fetch interceptor to track WASM file downloads\n * Must be called BEFORE importScripts() loads Emscripten\n *\n * Modern Emscripten uses fetch() API for downloading .wasm and .data files\n */\nfunction installProgressInterceptors() {\n  const originalFetch = self.fetch;\n\n  // Intercept fetch for progress tracking\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\n  (self).fetch = async function(input: RequestInfo | URL, init?: RequestInit): Promise<Response> {\n    const url = typeof input === 'string' ? input : input instanceof URL ? input.href : input.url;\n\n    // Identify which file is being downloaded\n    let phase: WasmLoadPhase | null = null;\n    if (url.includes('soffice.wasm')) {\n      phase = 'download-wasm';\n      console.log('[Worker] Starting fetch download: soffice.wasm');\n    } else if (url.includes('soffice.data')) {\n      phase = 'download-data';\n      console.log('[Worker] Starting fetch download: soffice.data');\n    }\n\n    const response = await originalFetch(input, init);\n\n    // If not a tracked file, return original response\n    if (!phase) {\n      return response;\n    }\n\n    // Get content length for progress calculation\n    const contentLength = response.headers.get('Content-Length');\n    const total = contentLength ? parseInt(contentLength, 10) : 0;\n\n    // If no content length or no body, return original response\n    if (!total || !response.body) {\n      console.log(`[Worker] No content-length for ${url}, skipping progress tracking`);\n      return response;\n    }\n\n    // Create a new response with progress tracking\n    const reader = response.body.getReader();\n    let loaded = 0;\n\n    const stream = new ReadableStream({\n      async start(controller) {\n        while (true) {\n          const { done, value } = await reader.read();\n\n          if (done) {\n            console.log(`[Worker] Finished fetch download: ${phase === 'download-wasm' ? 'soffice.wasm' : 'soffice.data'}`);\n            controller.close();\n            break;\n          }\n\n          loaded += value.length;\n          emitDownloadProgress(phase, loaded, total);\n          controller.enqueue(value);\n        }\n      }\n    });\n\n    return new Response(stream, {\n      headers: response.headers,\n      status: response.status,\n      statusText: response.statusText\n    });\n  };\n\n  console.log('[Worker] Installed progress-tracking fetch interceptor');\n\n  // Also intercept XHR as fallback (some Emscripten configurations use it)\n  const OriginalXHR = self.XMLHttpRequest;\n\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\n  const ProgressXMLHttpRequest = function(this: XMLHttpRequest) {\n    const xhr = new OriginalXHR();\n    let requestUrl = '';\n\n    const originalOpen = xhr.open.bind(xhr);\n    (xhr).open = function(method: string, url: string | URL, async?: boolean, username?: string | null, password?: string | null) {\n      requestUrl = String(url);\n      return originalOpen(method, url, async ?? true, username, password);\n    };\n\n    const originalSend = xhr.send.bind(xhr);\n    // eslint-disable-next-line @typescript-eslint/no-explicit-any\n    (xhr).send = function(body?: any) {\n      let phase: WasmLoadPhase | null = null;\n      if (requestUrl.includes('soffice.wasm')) {\n        phase = 'download-wasm';\n        console.log('[Worker] Starting XHR download: soffice.wasm');\n      } else if (requestUrl.includes('soffice.data')) {\n        phase = 'download-data';\n        console.log('[Worker] Starting XHR download: soffice.data');\n      }\n\n      if (phase) {\n        const downloadPhase = phase;\n        xhr.addEventListener('progress', (e: ProgressEvent) => {\n          if (e.lengthComputable) {\n            emitDownloadProgress(downloadPhase, e.loaded, e.total);\n          }\n        });\n\n        xhr.addEventListener('load', () => {\n          console.log(`[Worker] Finished XHR download: ${downloadPhase === 'download-wasm' ? 'soffice.wasm' : 'soffice.data'}`);\n        });\n      }\n\n      return originalSend(body);\n    };\n\n    return xhr;\n  };\n\n  Object.defineProperty(ProgressXMLHttpRequest, 'prototype', {\n    value: OriginalXHR.prototype,\n    writable: false,\n  });\n\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any, @typescript-eslint/no-unsafe-member-access\n  (self as any).XMLHttpRequest = ProgressXMLHttpRequest;\n\n  console.log('[Worker] Installed progress-tracking XHR interceptor');\n}\n\ninterface WorkerMessage {\n  type: 'init' | 'convert' | 'destroy' | 'getPageCount' | 'renderPreviews' | 'renderSinglePage' | 'renderPageViaConvert' | 'renderPageFullQuality' | 'getDocumentInfo' | 'getLokInfo' | 'editText' | 'renderPageRectangles' | 'testLokOperations' | 'openDocument' | 'editorOperation' | 'closeDocument';\n  id: number;\n  // Explicit WASM file paths (required for init)\n  sofficeJs?: string;\n  sofficeWasm?: string;\n  sofficeData?: string;\n  sofficeWorkerJs?: string;\n  verbose?: boolean;\n  inputData?: Uint8Array;\n  inputExt?: string;\n  outputFormat?: string;\n  filterOptions?: string;\n  password?: string;\n  maxWidth?: number;\n  pageIndex?: number; // For renderSinglePage / renderPageViaConvert / renderPageFullQuality\n  // Full quality rendering parameters\n  dpi?: number;           // DPI for renderPageFullQuality\n  maxDimension?: number;  // Max dimension cap for renderPageFullQuality\n  editMode?: boolean;     // Render in edit mode (shows placeholders, cursors) - default false\n  // Text editing parameters\n  findText?: string;      // Text to find for replacement\n  replaceText?: string;   // Text to replace with\n  insertText?: string;    // Text to insert at cursor\n  // LOK operations testing\n  operations?: string[];  // List of operations to test\n  // Editor session parameters\n  sessionId?: string;\n  editorMethod?: string;\n  editorArgs?: unknown[];\n}\n\ninterface PagePreview {\n  page: number;\n  data: Uint8Array;\n  width: number;\n  height: number;\n}\n\ninterface FullQualityPagePreview extends PagePreview {\n  dpi: number;\n}\n\ninterface DocumentInfo {\n  documentType: number;\n  documentTypeName: string;\n  validOutputFormats: string[];\n  pageCount: number;\n}\n\ninterface PartInfo {\n  visible: string;\n  selected: string;\n  masterPageCount?: string;\n  mode: string;\n}\n\ninterface A11yFocusedParagraph {\n  content: string;\n  position: string;\n  start: string;\n  end: string;\n}\n\ninterface LokInfo {\n  pageRectangles: string | null;\n  documentSize: { width: number; height: number };\n  partInfo: PartInfo | null;\n  a11yFocusedParagraph: A11yFocusedParagraph | null;\n  a11yCaretPosition: number;\n  editMode: number;\n  allText: string | null;\n}\n\ninterface EditResult {\n  success: boolean;\n  editMode: number;\n  message: string;\n  modifiedDocument?: Uint8Array;  // The modified document as a new file\n}\n\ninterface PageRectangle {\n  index: number;\n  x: number;      // X position in twips\n  y: number;      // Y position in twips\n  width: number;  // Width in twips\n  height: number; // Height in twips\n  imageData: Uint8Array;  // RGBA pixel data\n  imageWidth: number;     // Rendered width in pixels\n  imageHeight: number;    // Rendered height in pixels\n}\n\ninterface LokOperationResult {\n  operation: string;\n  success: boolean;\n  result?: unknown;\n  error?: string;\n}\n\ninterface TestLokOperationsResult {\n  operations: LokOperationResult[];\n  summary: string;\n}\n\n// Editor session info returned from openDocument\ninterface EditorSessionInfo {\n  sessionId: string;\n  documentType: 'writer' | 'calc' | 'impress' | 'draw';\n  pageCount: number;\n}\n\n\ninterface WorkerResponse {\n  type: 'ready' | 'progress' | 'result' | 'error' | 'pageCount' | 'previews' | 'singlePagePreview' | 'documentInfo' | 'lokInfo' | 'editResult' | 'pageRectangles' | 'testLokOperations' | 'editorSession' | 'editorOperationResult' | 'documentClosed';\n  id: number;\n  data?: Uint8Array;\n  error?: string;\n  progress?: { percent: number; message: string };\n  pageCount?: number;\n  previews?: PagePreview[];\n  preview?: PagePreview; // Single page preview\n  documentInfo?: DocumentInfo;\n  lokInfo?: LokInfo;\n  editResult?: EditResult;\n  pageRectangles?: PageRectangle[];\n  testLokOperationsResult?: TestLokOperationsResult;\n  editorSession?: EditorSessionInfo;\n  editorOperationResult?: EditorOperationResult;\n}\n\n/** Web Worker global scope with Module property */\n/** Extended EmscriptenModule with pthread worker config */\ninterface EmscriptenModuleConfig extends Partial<EmscriptenModule> {\n  mainScriptUrlOrBlob?: string;\n}\n\ninterface WorkerGlobalScopeWithModule {\n  Module?: EmscriptenModuleConfig;\n  XMLHttpRequest: typeof XMLHttpRequest;\n  fetch: typeof fetch;\n  postMessage: (message: unknown, transfer?: Transferable[]) => void;\n  onmessage: ((event: MessageEvent) => void) | null;\n  close: () => void;\n}\n\n// eslint-disable-next-line @typescript-eslint/no-explicit-any\ndeclare const self: WorkerGlobalScopeWithModule & Record<string, any>;\ndeclare function importScripts(...urls: string[]): void;\n\nlet module: EmscriptenModule | null = null;\nlet lokBindings: LOKBindings | null = null;\nlet converter: LibreOfficeConverter | null = null;\nlet initialized = false;\n\n// Document cache for efficient multi-page rendering\nlet cachedDoc: {\n  docPtr: number;\n  inputHash: string;\n  filePath: string;\n  pageCount: number;  // Cache page count since getting it requires a view\n} | null = null;\n\n// Editor session storage - keeps documents open for editing\ninterface EditorSession {\n  sessionId: string;\n  docPtr: number;\n  filePath: string;\n  editor: OfficeEditor;\n  documentType: 'writer' | 'calc' | 'impress' | 'draw';\n}\n\nconst editorSessions = new Map<string, EditorSession>();\nlet sessionCounter = 0;\n\n// Simple hash function for input data\nfunction hashInput(data: Uint8Array): string {\n  let hash = 0;\n  const step = Math.max(1, Math.floor(data.length / 1000)); // Sample ~1000 bytes\n  for (let i = 0; i < data.length; i += step) {\n    const byte = data[i];\n    if (byte !== undefined) {\n      hash = ((hash << 5) - hash + byte) | 0;\n    }\n  }\n  return `${hash}_${data.length}`;\n}\n\n// Get page count for a document, handling different document types correctly\nfunction getDocumentPageCount(docPtr: number): number {\n  const docType = lokBindings!.documentGetDocumentType(docPtr);\n\n  // For Text Documents (type 0), getParts returns 0 or 1 (representing \"parts\" not pages)\n  // We need to use getPartPageRectangles to get actual page count\n  if (docType === 0) { // TEXT document\n    const pageRectsStr = lokBindings!.getPartPageRectangles(docPtr);\n    if (pageRectsStr) {\n      const pageRects = lokBindings!.parsePageRectangles(pageRectsStr);\n      console.log(`[Worker] getDocumentPageCount: TEXT doc has ${pageRects.length} pages from rectangles`);\n      return pageRects.length;\n    }\n    // Fallback: if no page rectangles, assume at least 1 page\n    console.log(`[Worker] getDocumentPageCount: TEXT doc has no page rectangles, assuming 1 page`);\n    return 1;\n  }\n\n  // For Presentations, Drawings, Spreadsheets - getParts returns slide/page/sheet count\n  const parts = lokBindings!.documentGetParts(docPtr);\n  console.log(`[Worker] getDocumentPageCount: docType=${docType} has ${parts} parts`);\n  return parts;\n}\n\n// Get or load a document (reuses cached document if same input)\nfunction getOrLoadDocument(inputData: Uint8Array, inputExt: string): { docPtr: number; pageCount: number } {\n  const inputHash = hashInput(inputData);\n\n  // Check if we already have this document loaded\n  if (cachedDoc && cachedDoc.inputHash === inputHash && lokBindings) {\n    console.log(`[Worker] getOrLoadDocument: reusing cached doc ptr=${cachedDoc.docPtr}, pageCount=${cachedDoc.pageCount}`);\n    return { docPtr: cachedDoc.docPtr, pageCount: cachedDoc.pageCount };\n  }\n\n  // Close previous document if any\n  console.log(`[Worker] getOrLoadDocument: loading new document (hash=${inputHash})`);\n  closeCachedDocument();\n\n  // Load new document\n  const filePath = `/tmp/input/cached_doc.${inputExt || 'docx'}`;\n  module!.FS.writeFile(filePath, inputData);\n  const docPtr = lokBindings!.documentLoad(filePath);\n\n  if (docPtr === 0) {\n    const error = lokBindings!.getError();\n    throw new Error(error || 'Failed to load document');\n  }\n\n  const pageCount = getDocumentPageCount(docPtr);\n  console.log(`[Worker] getOrLoadDocument: loaded doc ptr=${docPtr}, pageCount=${pageCount}`);\n\n  // Cache the document with page count (page count requires a view to calculate correctly,\n  // so we cache it here when the document is first loaded)\n  cachedDoc = { docPtr, inputHash, filePath, pageCount };\n\n  return { docPtr, pageCount };\n}\n\n// Close cached document\nfunction closeCachedDocument() {\n  if (cachedDoc && lokBindings && module) {\n    console.log(`[Worker] closeCachedDocument: closing cached doc ptr=${cachedDoc.docPtr}`);\n    try { lokBindings.documentDestroy(cachedDoc.docPtr); } catch { /* ignore */ }\n    try { module.FS.unlink(cachedDoc.filePath); } catch { /* ignore */ }\n    cachedDoc = null;\n  }\n}\n\nfunction postResponse(response: WorkerResponse) {\n  if (response.data) {\n    // Transfer the ArrayBuffer for efficiency\n    self.postMessage(response, [response.data.buffer]);\n  } else {\n    self.postMessage(response);\n  }\n}\n\nfunction postProgress(id: number, percent: number, message: string) {\n  postResponse({ type: 'progress', id, progress: { percent, message } });\n}\n\nasync function handleInit(msg: WorkerMessage) {\n  if (initialized) {\n    postResponse({ type: 'ready', id: msg.id });\n    return;\n  }\n\n  // Require explicit paths\n  const { sofficeJs, sofficeWasm, sofficeData, sofficeWorkerJs } = msg;\n  if (!sofficeJs || !sofficeWasm || !sofficeData || !sofficeWorkerJs) {\n    postResponse({ type: 'error', id: msg.id, error: 'Missing required WASM paths (sofficeJs, sofficeWasm, sofficeData, sofficeWorkerJs)' });\n    return;\n  }\n\n  const verbose = msg.verbose || false;\n\n  // Store request ID for progress emission\n  currentInitRequestId = msg.id;\n\n  // Reset progress tracking for fresh initialization\n  for (const phase of Object.keys(phaseProgress) as WasmLoadPhase[]) {\n    phaseProgress[phase] = 0;\n  }\n  lastEmittedPercent = 0;\n\n  // Install XHR interceptor BEFORE any Emscripten code loads\n  // This intercepts soffice.wasm and soffice.data downloads\n  installProgressInterceptors();\n\n  // Emit initial progress\n  emitPhaseProgress('download-wasm', 'Preparing to download WebAssembly...');\n\n  try {\n    // Configure global Module for Emscripten\n    console.log('[Worker] Setting up Module with explicit paths:', { sofficeJs, sofficeWasm, sofficeData, sofficeWorkerJs });\n    self.Module = {\n      // Tell pthread workers where to load the main module from\n      mainScriptUrlOrBlob: sofficeJs,\n      locateFile: (path: string, _scriptDir?: string) => {\n        let result: string;\n        if (path.endsWith('.wasm')) result = sofficeWasm;\n        else if (path.endsWith('.data')) result = sofficeData;\n        // Handle both .worker.js and .worker.cjs requests\n        else if (path.includes('.worker.')) result = sofficeWorkerJs;\n        else {\n          // Fallback: derive from sofficeJs path for any other files\n          const baseUrl = sofficeJs.substring(0, sofficeJs.lastIndexOf('/') + 1);\n          result = `${baseUrl}${path}`;\n        }\n        console.log('[Worker] locateFile called:', path, 'scriptDir:', _scriptDir, '-> result:', result);\n        return result;\n      },\n      // Always print LibreOffice output to console for debugging\n      print: console.log,\n      printErr: console.error,\n    };\n\n    // Load the soffice.js script using importScripts\n    // This triggers the .wasm download (tracked by XHR interceptor)\n    importScripts(sofficeJs);\n\n    // Wait for runtime to be ready\n    // .data file download and WebAssembly compilation happen here\n    emitPhaseProgress('compile', 'Compiling WebAssembly module...');\n\n    await new Promise<void>((resolve, reject) => {\n      const checkReady = () => {\n        if (self.Module && self.Module.calledRun) {\n          resolve();\n        } else if (self.Module?.onRuntimeInitialized) {\n          // Already has a callback, chain it\n          const orig = self.Module.onRuntimeInitialized;\n          self.Module.onRuntimeInitialized = () => {\n            orig?.();\n            resolve();\n          };\n        } else if (self.Module) {\n          self.Module.onRuntimeInitialized = resolve;\n        }\n\n        // Timeout\n        setTimeout(() => reject(new Error('WASM initialization timeout')), 120000);\n      };\n\n      // Check if already ready\n      if (self.Module && self.Module.calledRun) {\n        resolve();\n      } else {\n        checkReady();\n      }\n    });\n\n    module = self.Module as EmscriptenModule;\n    emitPhaseProgress('filesystem', 'Setting up filesystem...');\n\n    // Set SAL_LOG environment variable for LibreOffice logging\n    // Must be done before LOK initialization\n    // Options: +ALL (everything), +lok (LibreOfficeKit), +vcl (rendering), +lok.shim (our shims)\n    try {\n      const mod = module as unknown as { ENV?: Record<string, string> };\n      if (mod.ENV) {\n        mod.ENV['SAL_LOG'] = '+ALL';\n        mod.ENV['MAX_CONCURRENCY'] = '1';\n        console.log('[Worker] Set SAL_LOG to +ALL');\n      } else {\n        console.log('[Worker] ENV not available');\n      }\n    } catch (e) {\n      console.log('[Worker] Could not set SAL_LOG:', e);\n    }\n\n    // Setup filesystem\n    const fs = module.FS;\n\n    // Add FS tracking for debugging (sends logs to main thread)\n    if (verbose) {\n      const originalOpen = fs.open.bind(fs);\n      fs.open = (path: string, flags: unknown, mode?: unknown) => {\n        console.log('[FS OPEN CALL]', path);\n        try {\n          return originalOpen(path, flags, mode);\n        } catch (err: unknown) {\n          const error = err as { code?: string };\n          if (error?.code === 'ENOENT') {\n            console.log('[FS ENOENT]', path);\n          }\n          throw err;\n        }\n      };\n    }\n    try { fs.mkdir('/tmp'); } catch { /* exists */ }\n    try { fs.mkdir('/tmp/input'); } catch { /* exists */ }\n    try { fs.mkdir('/tmp/output'); } catch { /* exists */ }\n\n    emitPhaseProgress('lok-init', 'Initializing LibreOfficeKit...');\n\n    // Initialize LibreOfficeConverter with the pre-loaded module\n    // This reuses the same LOK initialization logic as the Node.js converter\n    converter = new LibreOfficeConverter({ verbose });\n    await converter.initializeWithModule(module);\n\n    // Get LOK bindings from converter for direct access (needed for browser-specific features)\n    lokBindings = converter.getLokBindings();\n\n    if (!lokBindings) {\n      throw new Error('Failed to get LOK bindings from converter');\n    }\n\n    // Enable synchronous event dispatch (Unipoll mode) globally\n    // Without this, postKeyEvent/postMouseEvent events are queued but never processed\n    lokBindings.enableSyncEvents();\n    console.log('[LOK Worker] Enabled synchronous event dispatch (Unipoll mode)');\n\n    initialized = true;\n    emitPhaseProgress('ready', 'Ready');\n    postResponse({ type: 'ready', id: msg.id });\n\n  } catch (error) {\n    postResponse({\n      type: 'error',\n      id: msg.id,\n      error: error instanceof Error ? error.message : String(error)\n    });\n  }\n}\n\n// Image formats that need multi-page handling\nconst IMAGE_FORMATS = ['png', 'jpg', 'jpeg', 'svg'];\n\nfunction handleConvert(msg: WorkerMessage) {\n  if (!initialized || !module || !lokBindings) {\n    postResponse({ type: 'error', id: msg.id, error: 'Worker not initialized' });\n    return;\n  }\n\n  const { inputData, inputExt, outputFormat, filterOptions, password } = msg;\n\n  if (!inputData || !outputFormat) {\n    postResponse({ type: 'error', id: msg.id, error: 'Missing input data or output format' });\n    return;\n  }\n\n  // Check if this is an image format that might need multi-page export\n  const isImageFormat = IMAGE_FORMATS.includes(outputFormat.toLowerCase());\n\n  const inPath = `/tmp/input/doc.${inputExt || 'docx'}`;\n  const outPath = `/tmp/output/doc.${outputFormat}`;\n  let docPtr = 0;\n  const outputFiles: string[] = []; // Track files to clean up\n\n  try {\n    postProgress(msg.id, 10, 'Writing input file...');\n    module.FS.writeFile(inPath, inputData);\n\n    postProgress(msg.id, 30, 'Loading document...');\n    if (password) {\n      docPtr = lokBindings.documentLoadWithOptions(inPath, `,Password=${password}`);\n    } else {\n      docPtr = lokBindings.documentLoad(inPath);\n    }\n\n    if (docPtr === 0) {\n      const error = lokBindings.getError();\n      throw new Error(error || 'Failed to load document');\n    }\n\n    // Get page count for multi-page image export\n    const pageCount = lokBindings.documentGetParts(docPtr);\n    const docType = lokBindings.documentGetDocumentType(docPtr);\n\n    // For image formats with multiple pages, export each page separately and zip\n    if (isImageFormat && pageCount > 1) {\n      postProgress(msg.id, 40, `Exporting ${pageCount} pages as ${outputFormat.toUpperCase()}...`);\n\n      const lokFormat = OUTPUT_FORMAT_TO_LOK[outputFormat as keyof typeof OUTPUT_FORMAT_TO_LOK];\n      const baseOpts = filterOptions || FORMAT_FILTER_OPTIONS[outputFormat as keyof typeof FORMAT_FILTER_OPTIONS] || '';\n\n      // Export each page\n      const pageFiles: Array<{ name: string; data: Uint8Array }> = [];\n\n      // Get document size for calculating export dimensions (for image formats)\n      const { width: docWidth, height: docHeight } = lokBindings.documentGetDocumentSize(docPtr);\n      const aspectRatio = docHeight / docWidth;\n      const exportWidth = 1024; // High quality export\n      const exportHeight = Math.round(exportWidth * aspectRatio);\n\n      for (let i = 0; i < pageCount; i++) {\n        const progress = 40 + Math.round((i / pageCount) * 40);\n        postProgress(msg.id, progress, `Exporting page ${i + 1}/${pageCount}...`);\n\n        const pageOutPath = `/tmp/output/page_${i + 1}.${outputFormat}`;\n        outputFiles.push(pageOutPath);\n\n        // For presentations/drawings, we need to set the part AND use PixelWidth/PixelHeight\n        // for PNG/JPG export to work correctly (same approach as handleRenderPageViaConvert)\n        if (docType === 2 || docType === 3) { // PRESENTATION or DRAWING\n          lokBindings.documentSetPart(docPtr, i);\n\n          // For image formats, include pixel dimensions in filter options\n          let pageOpts = baseOpts;\n          if (outputFormat === 'png' || outputFormat === 'jpg' || outputFormat === 'jpeg') {\n            pageOpts = `PixelWidth=${exportWidth};PixelHeight=${exportHeight}`;\n            if (baseOpts) pageOpts = `${baseOpts};${pageOpts}`;\n          }\n\n          lokBindings.documentSaveAs(docPtr, pageOutPath, lokFormat, pageOpts);\n          console.log(`[Worker] Page ${i + 1} (presentation) exported with opts: ${pageOpts}`);\n        } else {\n          // For text documents, use PageRange filter option (1-indexed)\n          let pageOpts = `PageRange=${i + 1}-${i + 1}`;\n\n          // For image formats, also include pixel dimensions\n          if (outputFormat === 'png' || outputFormat === 'jpg' || outputFormat === 'jpeg') {\n            pageOpts += `;PixelWidth=${exportWidth};PixelHeight=${exportHeight}`;\n          }\n\n          if (baseOpts) pageOpts = `${baseOpts};${pageOpts}`;\n\n          lokBindings.documentSaveAs(docPtr, pageOutPath, lokFormat, pageOpts);\n          console.log(`[Worker] Page ${i + 1} (text) exported with opts: ${pageOpts}`);\n        }\n\n        const pageData = module.FS.readFile(pageOutPath) as Uint8Array;\n        console.log(`[Worker] Page ${i + 1} exported: ${pageData.length} bytes`);\n\n        if (pageData.length > 0) {\n          const pageCopy = new Uint8Array(pageData.length);\n          pageCopy.set(pageData);\n          pageFiles.push({ name: `page_${i + 1}.${outputFormat}`, data: pageCopy });\n        } else {\n          console.warn(`[Worker] Page ${i + 1} export produced empty file`);\n        }\n      }\n\n      postProgress(msg.id, 85, 'Creating ZIP archive...');\n\n      // Create a simple ZIP file (no compression for images)\n      const zipData = createSimpleZip(pageFiles);\n\n      postProgress(msg.id, 100, 'Complete');\n      postResponse({ type: 'result', id: msg.id, data: zipData });\n\n    } else {\n      // Single page or non-image format: standard export\n      postProgress(msg.id, 50, 'Converting...');\n\n      const lokFormat = OUTPUT_FORMAT_TO_LOK[outputFormat as keyof typeof OUTPUT_FORMAT_TO_LOK];\n      const opts = filterOptions || FORMAT_FILTER_OPTIONS[outputFormat as keyof typeof FORMAT_FILTER_OPTIONS] || '';\n\n      postProgress(msg.id, 70, 'Saving...');\n      lokBindings.documentSaveAs(docPtr, outPath, lokFormat, opts);\n      outputFiles.push(outPath);\n\n      postProgress(msg.id, 90, 'Reading output...');\n      const sharedResult = module.FS.readFile(outPath) as Uint8Array;\n\n      if (sharedResult.length === 0) {\n        throw new Error('Conversion produced empty output');\n      }\n\n      // Copy from SharedArrayBuffer to regular ArrayBuffer for transfer\n      const result = new Uint8Array(sharedResult.length);\n      result.set(sharedResult);\n\n      postProgress(msg.id, 100, 'Complete');\n      postResponse({ type: 'result', id: msg.id, data: result });\n    }\n\n  } catch (error) {\n    postResponse({\n      type: 'error',\n      id: msg.id,\n      error: error instanceof Error ? error.message : String(error)\n    });\n  } finally {\n    // Cleanup\n    if (docPtr !== 0) {\n      try { lokBindings.documentDestroy(docPtr); } catch { /* ignore */ }\n    }\n    try { module.FS.unlink(inPath); } catch { /* ignore */ }\n    for (const path of outputFiles) {\n      try { module.FS.unlink(path); } catch { /* ignore */ }\n    }\n  }\n}\n\n/**\n * Create a simple ZIP file from an array of files\n * This is a minimal ZIP implementation without compression (STORE method)\n */\nfunction createSimpleZip(files: Array<{ name: string; data: Uint8Array }>): Uint8Array {\n  const chunks: Uint8Array[] = [];\n  const centralDirectory: Uint8Array[] = [];\n  let offset = 0;\n\n  for (const file of files) {\n    const nameBytes = new TextEncoder().encode(file.name);\n\n    // Local file header\n    const localHeader = new Uint8Array(30 + nameBytes.length);\n    const view = new DataView(localHeader.buffer);\n\n    view.setUint32(0, 0x04034b50, true);  // Local file header signature\n    view.setUint16(4, 20, true);           // Version needed\n    view.setUint16(6, 0, true);            // General purpose flags\n    view.setUint16(8, 0, true);            // Compression method (STORE)\n    view.setUint16(10, 0, true);           // Mod time\n    view.setUint16(12, 0, true);           // Mod date\n    view.setUint32(14, crc32(file.data), true); // CRC-32\n    view.setUint32(18, file.data.length, true); // Compressed size\n    view.setUint32(22, file.data.length, true); // Uncompressed size\n    view.setUint16(26, nameBytes.length, true); // File name length\n    view.setUint16(28, 0, true);           // Extra field length\n    localHeader.set(nameBytes, 30);\n\n    chunks.push(localHeader);\n    chunks.push(file.data);\n\n    // Central directory entry\n    const cdEntry = new Uint8Array(46 + nameBytes.length);\n    const cdView = new DataView(cdEntry.buffer);\n\n    cdView.setUint32(0, 0x02014b50, true);  // Central directory signature\n    cdView.setUint16(4, 20, true);           // Version made by\n    cdView.setUint16(6, 20, true);           // Version needed\n    cdView.setUint16(8, 0, true);            // General purpose flags\n    cdView.setUint16(10, 0, true);           // Compression method\n    cdView.setUint16(12, 0, true);           // Mod time\n    cdView.setUint16(14, 0, true);           // Mod date\n    cdView.setUint32(16, crc32(file.data), true); // CRC-32\n    cdView.setUint32(20, file.data.length, true); // Compressed size\n    cdView.setUint32(24, file.data.length, true); // Uncompressed size\n    cdView.setUint16(28, nameBytes.length, true); // File name length\n    cdView.setUint16(30, 0, true);           // Extra field length\n    cdView.setUint16(32, 0, true);           // Comment length\n    cdView.setUint16(34, 0, true);           // Disk number start\n    cdView.setUint16(36, 0, true);           // Internal attributes\n    cdView.setUint32(38, 0, true);           // External attributes\n    cdView.setUint32(42, offset, true);      // Offset of local header\n    cdEntry.set(nameBytes, 46);\n\n    centralDirectory.push(cdEntry);\n    offset += localHeader.length + file.data.length;\n  }\n\n  const cdOffset = offset;\n  let cdSize = 0;\n  for (const entry of centralDirectory) {\n    chunks.push(entry);\n    cdSize += entry.length;\n  }\n\n  // End of central directory\n  const eocd = new Uint8Array(22);\n  const eocdView = new DataView(eocd.buffer);\n  eocdView.setUint32(0, 0x06054b50, true);  // EOCD signature\n  eocdView.setUint16(4, 0, true);            // Disk number\n  eocdView.setUint16(6, 0, true);            // Disk with CD\n  eocdView.setUint16(8, files.length, true); // Entries on this disk\n  eocdView.setUint16(10, files.length, true);// Total entries\n  eocdView.setUint32(12, cdSize, true);      // CD size\n  eocdView.setUint32(16, cdOffset, true);    // CD offset\n  eocdView.setUint16(20, 0, true);           // Comment length\n\n  chunks.push(eocd);\n\n  // Combine all chunks\n  const totalSize = chunks.reduce((sum, chunk) => sum + chunk.length, 0);\n  const result = new Uint8Array(totalSize);\n  let pos = 0;\n  for (const chunk of chunks) {\n    result.set(chunk, pos);\n    pos += chunk.length;\n  }\n\n  return result;\n}\n\n/**\n * CRC-32 calculation for ZIP files\n */\nfunction crc32(data: Uint8Array): number {\n  let crc = 0xFFFFFFFF;\n  for (let i = 0; i < data.length; i++) {\n    const byte = data[i]!;\n    crc ^= byte;\n    for (let j = 0; j < 8; j++) {\n      crc = (crc >>> 1) ^ (crc & 1 ? 0xEDB88320 : 0);\n    }\n  }\n  return (crc ^ 0xFFFFFFFF) >>> 0;\n}\n\nasync function handleGetPageCount(msg: WorkerMessage) {\n  if (!initialized || !module || !lokBindings) {\n    postResponse({ type: 'error', id: msg.id, error: 'Worker not initialized' });\n    return;\n  }\n\n  const { inputData, inputExt } = msg;\n\n  if (!inputData) {\n    postResponse({ type: 'error', id: msg.id, error: 'Missing input data' });\n    return;\n  }\n\n  try {\n    // Use cached document\n    const { pageCount } = getOrLoadDocument(inputData, inputExt || 'docx');\n    postResponse({ type: 'pageCount', id: msg.id, pageCount });\n    // Document stays cached\n\n  } catch (error) {\n    postResponse({\n      type: 'error',\n      id: msg.id,\n      error: error instanceof Error ? error.message : String(error)\n    });\n    closeCachedDocument();\n  }\n}\n\nasync function handleRenderPreviews(msg: WorkerMessage) {\n  if (!initialized || !module || !lokBindings) {\n    postResponse({ type: 'error', id: msg.id, error: 'Worker not initialized' });\n    return;\n  }\n\n  const { inputData, inputExt, maxWidth = 256 } = msg;\n\n  if (!inputData) {\n    postResponse({ type: 'error', id: msg.id, error: 'Missing input data' });\n    return;\n  }\n\n  try {\n    postProgress(msg.id, 10, 'Loading document for preview...');\n    \n    // Use cached document\n    const { docPtr, pageCount } = getOrLoadDocument(inputData, inputExt || 'docx');\n    postProgress(msg.id, 20, `Rendering ${pageCount} pages...`);\n\n    const previews: PagePreview[] = [];\n    \n    for (let i = 0; i < pageCount; i++) {\n      const progress = 20 + Math.round((i / pageCount) * 70);\n      postProgress(msg.id, progress, `Rendering page ${i + 1}/${pageCount}...`);\n      \n      // Render the page - let renderPage handle page selection and sizing\n      const rendered = lokBindings.renderPage(docPtr, i, maxWidth);\n      \n      // Copy from SharedArrayBuffer to regular ArrayBuffer\n      const dataCopy = new Uint8Array(rendered.data.length);\n      dataCopy.set(rendered.data);\n      \n      previews.push({\n        page: i + 1,\n        data: dataCopy,\n        width: rendered.width,\n        height: rendered.height\n      });\n    }\n\n    postProgress(msg.id, 100, 'Preview complete');\n    \n    // Transfer all preview buffers\n    const transfers = previews.map(p => p.data.buffer);\n    self.postMessage({ type: 'previews', id: msg.id, previews }, transfers);\n    // Document stays cached\n\n  } catch (error) {\n    postResponse({\n      type: 'error',\n      id: msg.id,\n      error: error instanceof Error ? error.message : String(error)\n    });\n    closeCachedDocument();\n  }\n}\n\n/**\n * Render a single page preview - reuses cached document for efficiency\n */\nasync function handleRenderSinglePage(msg: WorkerMessage) {\n  if (!initialized || !module || !lokBindings) {\n    postResponse({ type: 'error', id: msg.id, error: 'Worker not initialized' });\n    return;\n  }\n\n  const { inputData, inputExt, maxWidth = 256, pageIndex = 0 } = msg;\n\n  if (!inputData) {\n    postResponse({ type: 'error', id: msg.id, error: 'Missing input data' });\n    return;\n  }\n\n  let viewId = -1;\n  let docPtr = 0;\n\n  try {\n    // Get or reuse cached document\n    const result = getOrLoadDocument(inputData, inputExt || 'docx');\n    docPtr = result.docPtr;\n    const pageCount = result.pageCount;\n\n    if (pageIndex < 0 || pageIndex >= pageCount) {\n      throw new Error(`Page index ${pageIndex} out of range (0-${pageCount - 1})`);\n    }\n\n    // Create a view before rendering for all document types.\n    // Without a view, LOK returns empty page rectangles and incorrect document sizes,\n    // causing paintTile to crash with \"memory access out of bounds\".\n    // The warning \"No Frame-Controller created\" indicates no view exists.\n    const docType = lokBindings.documentGetDocumentType(docPtr);\n    const docTypeNames = ['TEXT', 'SPREADSHEET', 'PRESENTATION', 'DRAWING'];\n    console.log(`[Worker] handleRenderSinglePage: ${docTypeNames[docType] || 'UNKNOWN'} document - creating view for rendering`);\n    viewId = lokBindings.createView(docPtr);\n    if (viewId >= 0) {\n      lokBindings.setView(docPtr, viewId);\n      console.log(`[Worker] handleRenderSinglePage: Created and set view ${viewId}`);\n    }\n\n    // Render the page - let renderPage handle page-specific sizing\n    // We just pass maxWidth and let it calculate the correct height based on the page's aspect ratio\n    console.log(`[Worker] handleRenderSinglePage: calling renderPage for page ${pageIndex} at maxWidth=${maxWidth}...`);\n    const rendered = lokBindings.renderPage(docPtr, pageIndex, maxWidth);\n    console.log(`[Worker] handleRenderSinglePage: renderPage returned ${rendered.data.length} bytes (${rendered.width}x${rendered.height})`);\n    \n    // Copy from SharedArrayBuffer to regular ArrayBuffer\n    const dataCopy = new Uint8Array(rendered.data.length);\n    dataCopy.set(rendered.data);\n    \n    const preview: PagePreview = {\n      page: pageIndex + 1,\n      data: dataCopy,\n      width: rendered.width,\n      height: rendered.height\n    };\n\n    // Cleanup view if we created one (for Drawing documents)\n    if (viewId >= 0 && docPtr !== 0) {\n      try { lokBindings.destroyView(docPtr, viewId); } catch { /* ignore */ }\n      console.log(`[Worker] handleRenderSinglePage: Destroyed view ${viewId}`);\n    }\n\n    // Transfer the buffer\n    self.postMessage({ type: 'singlePagePreview', id: msg.id, preview }, [dataCopy.buffer]);\n\n  } catch (error) {\n    // Cleanup view if we created one (for Drawing documents)\n    if (viewId >= 0 && docPtr !== 0) {\n      try { lokBindings.destroyView(docPtr, viewId); } catch { /* ignore */ }\n      console.log(`[Worker] handleRenderSinglePage: Destroyed view ${viewId} (on error)`);\n    }\n\n    // Convert error message to a regular string (not SharedArrayBuffer-backed)\n    const errorMsg = error instanceof Error ? String(error.message) : String(error);\n    postResponse({\n      type: 'error',\n      id: msg.id,\n      error: errorMsg\n    });\n    // On error, close the cached document to allow retry\n    closeCachedDocument();\n  }\n  // Note: We don't close the document here - it stays cached for subsequent page renders\n}\n\n/**\n * Render a page preview by converting to PNG - fallback for Chrome/Edge\n * This uses the saveAs conversion path instead of paintTile which hangs in Chromium\n */\nasync function handleRenderPageViaConvert(msg: WorkerMessage) {\n  if (!initialized || !module || !lokBindings) {\n    postResponse({ type: 'error', id: msg.id, error: 'Worker not initialized' });\n    return;\n  }\n\n  const { inputData, inputExt, maxWidth = 256, pageIndex = 0 } = msg;\n\n  if (!inputData) {\n    postResponse({ type: 'error', id: msg.id, error: 'Missing input data' });\n    return;\n  }\n\n  const outPath = `/tmp/output/page_${pageIndex}.png`;\n\n  try {\n    // Use cached document\n    const { docPtr, pageCount } = getOrLoadDocument(inputData, inputExt || 'pdf');\n\n    // Get document type to determine how to handle page selection\n    const docType = lokBindings.documentGetDocumentType(docPtr);\n    \n    if (pageIndex < 0 || pageIndex >= pageCount) {\n      throw new Error(`Page index ${pageIndex} out of range (0-${pageCount - 1})`);\n    }\n\n    // For presentations/drawings, setPart works for page selection\n    // For text documents, we need to use PageRange filter option\n    if (docType === 2 || docType === 3) { // PRESENTATION or DRAWING\n      lokBindings.documentSetPart(docPtr, pageIndex);\n    }\n\n    // Get document size to calculate aspect ratio\n    const { width: docWidth, height: docHeight } = lokBindings.documentGetDocumentSize(docPtr);\n    const aspectRatio = docHeight / docWidth;\n    const outputWidth = Math.min(maxWidth, docWidth);\n    const outputHeight = Math.round(outputWidth * aspectRatio);\n\n    // Build filter options\n    // For Writer documents, use PageRange to export specific page (1-indexed)\n    // For presentations/drawings, the part is already set\n    let filterOpts = `PixelWidth=${outputWidth};PixelHeight=${outputHeight}`;\n    if (docType === 0) { // TEXT document\n      filterOpts += `;PageRange=${pageIndex + 1}-${pageIndex + 1}`;\n    }\n    \n    lokBindings.documentSaveAs(docPtr, outPath, 'png', filterOpts);\n\n    // Read the PNG file\n    const pngData = module.FS.readFile(outPath) as Uint8Array;\n    \n    if (pngData.length === 0) {\n      throw new Error('PNG export produced empty output');\n    }\n\n    // Copy from SharedArrayBuffer\n    const pngCopy = new Uint8Array(pngData.length);\n    pngCopy.set(pngData);\n\n    // Send as a special PNG preview (not RGBA like paintTile)\n    const preview = {\n      page: pageIndex + 1,\n      data: pngCopy,\n      width: outputWidth,\n      height: outputHeight,\n      format: 'png' as const\n    };\n\n    self.postMessage({ type: 'singlePagePreview', id: msg.id, preview, isPng: true }, [pngCopy.buffer]);\n    // Document stays cached\n\n    // Clean up output file only\n    try { module.FS.unlink(outPath); } catch { /* ignore */ }\n\n  } catch (error) {\n    postResponse({\n      type: 'error',\n      id: msg.id,\n      error: error instanceof Error ? error.message : String(error)\n    });\n    closeCachedDocument();\n    try { module.FS.unlink(outPath); } catch { /* ignore */ }\n  }\n}\n\n/**\n * Render a page at full quality (native resolution based on DPI)\n * Uses paintTile for accurate rendering of all content including text\n */\nasync function handleRenderPageFullQuality(msg: WorkerMessage) {\n  if (!initialized || !module || !lokBindings) {\n    postResponse({ type: 'error', id: msg.id, error: 'Worker not initialized' });\n    return;\n  }\n\n  const { inputData, inputExt, pageIndex = 0, dpi = 150, maxDimension, editMode = false } = msg;\n\n  if (!inputData) {\n    postResponse({ type: 'error', id: msg.id, error: 'Missing input data' });\n    return;\n  }\n\n  let viewId = -1;\n  let docPtr = 0;\n\n  try {\n    // Get or reuse cached document\n    const result = getOrLoadDocument(inputData, inputExt || 'docx');\n    docPtr = result.docPtr;\n    const pageCount = result.pageCount;\n\n    if (pageIndex < 0 || pageIndex >= pageCount) {\n      throw new Error(`Page index ${pageIndex} out of range (0-${pageCount - 1})`);\n    }\n\n    // Create a view before rendering for all document types\n    const docType = lokBindings.documentGetDocumentType(docPtr);\n    const docTypeNames = ['TEXT', 'SPREADSHEET', 'PRESENTATION', 'DRAWING'];\n    console.log(`[Worker] handleRenderPageFullQuality: ${docTypeNames[docType] || 'UNKNOWN'} document at ${dpi} DPI, editMode=${editMode}`);\n\n    viewId = lokBindings.createView(docPtr);\n    if (viewId >= 0) {\n      lokBindings.setView(docPtr, viewId);\n      console.log(`[Worker] handleRenderPageFullQuality: Created and set view ${viewId}`);\n    }\n\n    // Render at full quality using the new method (editMode defaults to false for clean presentation rendering)\n    const rendered = lokBindings.renderPageFullQuality(docPtr, pageIndex, dpi, maxDimension, editMode);\n    console.log(`[Worker] handleRenderPageFullQuality: rendered ${rendered.data.length} bytes (${rendered.width}x${rendered.height} at ${rendered.dpi} DPI)`);\n\n    // Copy from SharedArrayBuffer to regular ArrayBuffer\n    const dataCopy = new Uint8Array(rendered.data.length);\n    dataCopy.set(rendered.data);\n\n    const preview: FullQualityPagePreview = {\n      page: pageIndex + 1,\n      data: dataCopy,\n      width: rendered.width,\n      height: rendered.height,\n      dpi: rendered.dpi\n    };\n\n    // Cleanup view\n    if (viewId >= 0 && docPtr !== 0) {\n      try { lokBindings.destroyView(docPtr, viewId); } catch { /* ignore */ }\n    }\n\n    // Transfer the buffer\n    self.postMessage({ type: 'fullQualityPagePreview', id: msg.id, preview }, [dataCopy.buffer]);\n\n  } catch (error) {\n    // Cleanup view on error\n    if (viewId >= 0 && docPtr !== 0) {\n      try { lokBindings.destroyView(docPtr, viewId); } catch { /* ignore */ }\n    }\n\n    const errorMsg = error instanceof Error ? String(error.message) : String(error);\n    postResponse({\n      type: 'error',\n      id: msg.id,\n      error: errorMsg\n    });\n    closeCachedDocument();\n  }\n}\n\nasync function handleGetDocumentInfo(msg: WorkerMessage) {\n  if (!initialized || !module || !lokBindings) {\n    postResponse({ type: 'error', id: msg.id, error: 'Worker not initialized' });\n    return;\n  }\n\n  const { inputData, inputExt } = msg;\n\n  if (!inputData) {\n    postResponse({ type: 'error', id: msg.id, error: 'Missing input data' });\n    return;\n  }\n\n  try {\n    // Use cached document - this will load it if not already loaded\n    const { docPtr, pageCount } = getOrLoadDocument(inputData, inputExt || 'docx');\n\n    const docType = lokBindings.documentGetDocumentType(docPtr);\n\n    // Map document type to valid output formats (based on LibreOffice capabilities)\n    const docTypeOutputFormats: Record<number, string[]> = {\n      0: ['pdf', 'docx', 'doc', 'odt', 'rtf', 'txt', 'html', 'png', 'jpg', 'svg'], // TEXT\n      1: ['pdf', 'xlsx', 'xls', 'ods', 'csv', 'html', 'png', 'jpg', 'svg'],        // SPREADSHEET\n      2: ['pdf', 'pptx', 'ppt', 'odp', 'png', 'jpg', 'svg', 'html'],              // PRESENTATION\n      3: ['pdf', 'png', 'jpg', 'svg', 'html'],                                     // DRAWING\n      4: ['pdf'],                                                                   // OTHER\n    };\n\n    const docTypeNames: Record<number, string> = {\n      0: 'Text Document',\n      1: 'Spreadsheet',\n      2: 'Presentation',\n      3: 'Drawing',\n      4: 'Other',\n    };\n\n    const documentInfo: DocumentInfo = {\n      documentType: docType,\n      documentTypeName: docTypeNames[docType] || 'Unknown',\n      validOutputFormats: docTypeOutputFormats[docType] || ['pdf'],\n      pageCount,\n    };\n\n    postResponse({ type: 'documentInfo', id: msg.id, documentInfo });\n    // Note: Document stays cached for subsequent operations\n\n  } catch (error) {\n    postResponse({\n      type: 'error',\n      id: msg.id,\n      error: error instanceof Error ? error.message : String(error)\n    });\n    // On error, close the cached document to allow retry\n    closeCachedDocument();\n  }\n}\n\n/**\n * Get LOK information about a loaded document - bounding boxes, positions, etc.\n */\nasync function handleGetLokInfo(msg: WorkerMessage) {\n  console.log('[LOK Worker] handleGetLokInfo called');\n  if (!initialized || !module || !lokBindings) {\n    postResponse({ type: 'error', id: msg.id, error: 'Worker not initialized' });\n    return;\n  }\n\n  const { inputData, inputExt } = msg;\n\n  if (!inputData) {\n    postResponse({ type: 'error', id: msg.id, error: 'Missing input data' });\n    return;\n  }\n\n  try {\n    // Use cached document\n    console.log('[LOK Worker] Getting or loading document...');\n    const { docPtr } = getOrLoadDocument(inputData, inputExt || 'docx');\n    console.log(`[LOK Worker] Got docPtr: ${docPtr}`);\n\n    // Get all available LOK read information\n    console.log('[LOK Worker] Calling LOK methods...');\n    const pageRectangles = lokBindings.getPartPageRectangles(docPtr);\n    console.log(`[LOK Worker] pageRectangles: ${pageRectangles}`);\n\n    const documentSize = lokBindings.documentGetDocumentSize(docPtr);\n    console.log(`[LOK Worker] documentSize: ${documentSize.width}x${documentSize.height}`);\n\n    const partInfo = lokBindings.getPartInfo(docPtr, 0);\n    console.log(`[LOK Worker] partInfo: ${partInfo}`);\n\n    const a11yFocusedParagraph = lokBindings.getA11yFocusedParagraph(docPtr);\n    console.log(`[LOK Worker] a11yFocusedParagraph: ${a11yFocusedParagraph}`);\n\n    const a11yCaretPosition = lokBindings.getA11yCaretPosition(docPtr);\n    console.log(`[LOK Worker] a11yCaretPosition: ${a11yCaretPosition}`);\n\n    let editMode = lokBindings.getEditMode(docPtr);\n    console.log(`[LOK Worker] editMode (initial): ${editMode}`);\n\n    // Try to enable edit mode for text extraction\n    let allText: string | null = null;\n    let viewId = -1;\n\n    // 1. Get the existing view created during document load\n    viewId = lokBindings.getView(docPtr);\n    console.log(`[LOK Worker] Got existing view: ${viewId}`);\n\n    // 2. Make it active with setActiveFrame (triggers setActiveFrame internally)\n    if (viewId >= 0) {\n      lokBindings.setView(docPtr, viewId);\n      console.log(`[LOK Worker] Set active view to ${viewId}`);\n    }\n\n    // 3. Now try creating a NEW view (this might work now with active frame set)\n    const newViewId = lokBindings.createView(docPtr);\n    console.log(`[LOK Worker] Created new view: ${newViewId}`);\n\n    if (newViewId >= 0) {\n      lokBindings.setView(docPtr, newViewId);\n      console.log(`[LOK Worker] Switched to new view: ${newViewId}`);\n    }\n\n    // Now enable edit mode\n    lokBindings.setEditMode(docPtr, 1);\n    editMode = lokBindings.getEditMode(docPtr);\n    console.log(`[LOK Worker] editMode (after setEditMode): ${editMode}`);\n\n    // Now try to get all text\n    allText = lokBindings.getAllText(docPtr);\n    console.log(`[LOK Worker] allText: ${allText?.slice(0, 100) || 'null'}`);\n\n    // Cleanup the new view we created\n    if (newViewId >= 0) {\n      lokBindings.destroyView(docPtr, newViewId);\n      console.log(`[LOK Worker] Destroyed view: ${newViewId}`);\n    }\n\n    // Parse JSON strings into objects\n    let parsedPartInfo: PartInfo | null = null;\n    if (partInfo) {\n      try {\n        parsedPartInfo = JSON.parse(partInfo) as PartInfo;\n      } catch {\n        console.warn('[LOK Worker] Failed to parse partInfo JSON:', partInfo);\n      }\n    }\n\n    let parsedA11yParagraph: A11yFocusedParagraph | null = null;\n    if (a11yFocusedParagraph) {\n      try {\n        parsedA11yParagraph = JSON.parse(a11yFocusedParagraph) as A11yFocusedParagraph;\n      } catch {\n        console.warn('[LOK Worker] Failed to parse a11yFocusedParagraph JSON:', a11yFocusedParagraph);\n      }\n    }\n\n    const lokInfo: LokInfo = {\n      pageRectangles,\n      documentSize,\n      partInfo: parsedPartInfo,\n      a11yFocusedParagraph: parsedA11yParagraph,\n      a11yCaretPosition,\n      editMode,\n      allText,\n    };\n\n    console.log('[LOK Worker] Posting lokInfo response');\n    postResponse({ type: 'lokInfo', id: msg.id, lokInfo });\n    // Document stays cached\n\n  } catch (error) {\n    console.error('[LOK Worker] Error in handleGetLokInfo:', error);\n    postResponse({\n      type: 'error',\n      id: msg.id,\n      error: error instanceof Error ? error.message : String(error)\n    });\n    closeCachedDocument();\n  }\n}\n\n/**\n * Handle text editing operations - find/replace or insert text\n */\nasync function handleEditText(msg: WorkerMessage) {\n  console.log('[LOK Worker] handleEditText called');\n  if (!initialized || !module || !lokBindings) {\n    postResponse({ type: 'error', id: msg.id, error: 'Worker not initialized' });\n    return;\n  }\n\n  const { inputData, inputExt, findText, replaceText, insertText } = msg;\n\n  if (!inputData) {\n    postResponse({ type: 'error', id: msg.id, error: 'Missing input data' });\n    return;\n  }\n\n  // Close any cached document since we need a fresh load for editing\n  closeCachedDocument();\n\n  const filePath = `/tmp/input/edit_doc.${inputExt || 'docx'}`;\n  const outputPath = `/tmp/output/edited_doc.${inputExt || 'docx'}`;\n  let docPtr = 0;\n  let viewId = -1;\n\n  try {\n    // Write file and load document\n    console.log('[LOK Worker] Writing input file...');\n    module.FS.writeFile(filePath, inputData);\n\n    console.log('[LOK Worker] Loading document for editing...');\n    docPtr = lokBindings.documentLoad(filePath);\n\n    if (docPtr === 0) {\n      const error = lokBindings.getError();\n      throw new Error(error || 'Failed to load document');\n    }\n    console.log(`[LOK Worker] Document loaded, docPtr=${docPtr}`);\n\n    // Initialize for rendering (required for some operations)\n    lokBindings.documentInitializeForRendering(docPtr);\n    console.log('[LOK Worker] Document initialized for rendering');\n\n    // 1. Get the existing view created during document load\n    viewId = lokBindings.getView(docPtr);\n    console.log(`[LOK Worker] Got existing view: ${viewId}`);\n\n    // 2. Make it active with setActiveFrame (triggers xDesktop->setActiveFrame() in C++)\n    if (viewId >= 0) {\n      lokBindings.setView(docPtr, viewId);\n      console.log(`[LOK Worker] Set active view to ${viewId}`);\n    }\n\n    // 3. Create a NEW view - this helps establish proper editing context\n    const newViewId = lokBindings.createView(docPtr);\n    console.log(`[LOK Worker] Created new view: ${newViewId}`);\n\n    if (newViewId >= 0) {\n      lokBindings.setView(docPtr, newViewId);\n      console.log(`[LOK Worker] Switched to new view: ${newViewId}`);\n      viewId = newViewId; // Track new view for cleanup\n    }\n\n    // Now enable edit mode\n    lokBindings.setEditMode(docPtr, 1);\n    const editMode = lokBindings.getEditMode(docPtr);\n    console.log(`[LOK Worker] Edit mode after setEditMode(1): ${editMode}`);\n\n    let operationResult = '';\n\n    // Perform the requested operation\n    if (findText && replaceText !== undefined) {\n      // Find and replace\n      console.log(`[LOK Worker] Attempting find/replace: \"${findText}\" -> \"${replaceText}\"`);\n\n      // Use .uno:ExecuteSearch for find/replace\n      // Note: Command type should be \"unsigned short\" with string value\n      const searchArgs = JSON.stringify({\n        'SearchItem.SearchString': { type: 'string', value: findText },\n        'SearchItem.ReplaceString': { type: 'string', value: replaceText },\n        'SearchItem.Command': { type: 'unsigned short', value: '3' }, // 3 = Replace All\n      });\n\n      try {\n        lokBindings.postUnoCommand(docPtr, '.uno:ExecuteSearch', searchArgs);\n        operationResult = `Attempted replace all \"${findText}\" with \"${replaceText}\"`;\n        console.log(`[LOK Worker] ${operationResult}`);\n      } catch (searchErr) {\n        console.error(`[LOK Worker] ExecuteSearch threw:`, searchErr);\n        operationResult = `ExecuteSearch failed: ${String(searchErr)}`;\n      }\n    } else if (insertText) {\n      // Insert text at cursor\n      console.log(`[LOK Worker] Attempting to insert text: \"${insertText}\"`);\n      const results: string[] = [];\n\n      // First, click in the document to establish focus (position 1000, 1000 twips)\n      // LOK_MOUSEEVENT_BUTTONDOWN = 0, LOK_MOUSEEVENT_BUTTONUP = 1\n      try {\n        console.log(`[LOK Worker] Clicking in document to establish focus...`);\n        lokBindings.postMouseEvent(docPtr, 0, 1000, 1000, 1, 1, 0); // BUTTONDOWN\n        lokBindings.postMouseEvent(docPtr, 1, 1000, 1000, 1, 1, 0); // BUTTONUP\n        console.log(`[LOK Worker] Posted mouse events for focus`);\n        results.push('mouseEvents:ok');\n      } catch (e) {\n        console.error(`[LOK Worker] postMouseEvent threw:`, e);\n        results.push(`mouseEvents:err`);\n      }\n\n      // Go to end of document\n      try {\n        lokBindings.postUnoCommand(docPtr, '.uno:GoToEndOfDoc');\n        console.log(`[LOK Worker] Posted GoToEndOfDoc`);\n        results.push('GoToEndOfDoc:ok');\n      } catch (e) {\n        console.error(`[LOK Worker] GoToEndOfDoc threw:`, e);\n        results.push(`GoToEndOfDoc:err`);\n      }\n\n      // Approach 1: Try lok_documentPaste directly (bypasses event queue)\n      let pasteResult = false;\n      try {\n        console.log(`[LOK Worker] Trying paste() with text/plain...`);\n        pasteResult = lokBindings.paste(docPtr, 'text/plain;charset=utf-8', insertText);\n        console.log(`[LOK Worker] paste() returned: ${pasteResult}`);\n        results.push(`paste:${pasteResult}`);\n      } catch (e) {\n        console.error(`[LOK Worker] paste() threw:`, e);\n        results.push(`paste:err`);\n      }\n\n      // Approach 2: Try .uno:InsertText\n      try {\n        const insertArgs = JSON.stringify({\n          Text: { type: 'string', value: insertText },\n        });\n        lokBindings.postUnoCommand(docPtr, '.uno:InsertText', insertArgs);\n        console.log(`[LOK Worker] Posted InsertText`);\n        results.push('InsertText:ok');\n      } catch (e) {\n        console.error(`[LOK Worker] InsertText threw:`, e);\n        results.push(`InsertText:err`);\n      }\n\n      // Approach 3: Also try postKeyEvent to type each character\n      // LOK_KEYEVENT_KEYINPUT = 0, LOK_KEYEVENT_KEYUP = 1\n      try {\n        console.log(`[LOK Worker] Now trying postKeyEvent for each character...`);\n        for (let i = 0; i < insertText.length; i++) {\n          const charCode = insertText.charCodeAt(i);\n          lokBindings.postKeyEvent(docPtr, 0, charCode, 0); // KEY_PRESSED\n          lokBindings.postKeyEvent(docPtr, 1, charCode, 0); // KEY_RELEASED\n        }\n        console.log(`[LOK Worker] Posted ${insertText.length} key events`);\n        results.push(`keyEvents:${insertText.length}`);\n      } catch (e) {\n        console.error(`[LOK Worker] postKeyEvent threw:`, e);\n        results.push(`keyEvents:err`);\n      }\n\n      operationResult = `Insert attempts: ${results.join(', ')}`;\n      console.log(`[LOK Worker] ${operationResult}`);\n    } else {\n      operationResult = 'No edit operation specified (need findText+replaceText or insertText)';\n      console.log(`[LOK Worker] ${operationResult}`);\n    }\n\n    // Try to save the document back to a file\n    console.log('[LOK Worker] Attempting to save modified document...');\n\n    // Determine the format for saving\n    const ext = inputExt || 'docx';\n    const formatMap: Record<string, string> = {\n      'docx': 'docx',\n      'doc': 'doc',\n      'odt': 'odt',\n      'xlsx': 'xlsx',\n      'xls': 'xls',\n      'ods': 'ods',\n      'pptx': 'pptx',\n      'ppt': 'ppt',\n      'odp': 'odp',\n    };\n    const saveFormat = formatMap[ext] || ext;\n\n    try {\n      lokBindings.documentSaveAs(docPtr, outputPath, saveFormat, '');\n      console.log('[LOK Worker] Document saved');\n\n      // Read the modified document\n      const modifiedData = module.FS.readFile(outputPath) as Uint8Array;\n      console.log(`[LOK Worker] Modified document size: ${modifiedData.length} bytes`);\n\n      // Copy to regular ArrayBuffer\n      const modifiedCopy = new Uint8Array(modifiedData.length);\n      modifiedCopy.set(modifiedData);\n\n      const editResult: EditResult = {\n        success: true,\n        editMode,\n        message: operationResult + ` | Document saved (${modifiedCopy.length} bytes)`,\n        modifiedDocument: modifiedCopy,\n      };\n\n      // Transfer the buffer\n      self.postMessage({ type: 'editResult', id: msg.id, editResult }, [modifiedCopy.buffer]);\n\n    } catch (saveError) {\n      console.error('[LOK Worker] Save error:', saveError);\n\n      const editResult: EditResult = {\n        success: false,\n        editMode,\n        message: operationResult + ` | Save failed: ${String(saveError)}`,\n      };\n\n      postResponse({ type: 'editResult', id: msg.id, editResult });\n    }\n\n  } catch (error) {\n    // Log detailed error info for debugging WASM/Emscripten exceptions\n    console.error('[LOK Worker] Error in handleEditText:', error);\n    if (error instanceof Error) {\n      console.error('[LOK Worker] Error name:', error.name);\n      console.error('[LOK Worker] Error message:', error.message);\n      console.error('[LOK Worker] Error stack:', error.stack);\n    }\n    // For Emscripten exceptions, try to get more details\n    const errorObj = error as Record<string, unknown>;\n    if (errorObj && typeof errorObj === 'object') {\n      console.error('[LOK Worker] Error keys:', Object.keys(errorObj));\n      for (const key of Object.keys(errorObj)) {\n        try {\n          console.error(`[LOK Worker] Error.${key}:`, errorObj[key]);\n        } catch { /* ignore */ }\n      }\n    }\n    // Check if this is a number (Emscripten exception pointer)\n    if (typeof error === 'number') {\n      console.error('[LOK Worker] Emscripten exception pointer:', error);\n      // Try to get exception message from Emscripten\n      const moduleAny = module as unknown as Record<string, unknown>;\n      if (moduleAny && typeof moduleAny.getExceptionMessage === 'function') {\n        try {\n          const exMsg = (moduleAny.getExceptionMessage as (ptr: number) => string)(error);\n          console.error('[LOK Worker] Emscripten exception message:', exMsg);\n        } catch { /* ignore */ }\n      }\n    }\n    postResponse({\n      type: 'error',\n      id: msg.id,\n      error: error instanceof Error ? error.message : String(error)\n    });\n  } finally {\n    // Cleanup - destroy the view we created\n    if (docPtr !== 0 && lokBindings) {\n      if (viewId >= 0) {\n        try { lokBindings.destroyView(docPtr, viewId); } catch { /* ignore */ }\n      }\n      try { lokBindings.documentDestroy(docPtr); } catch { /* ignore */ }\n    }\n    if (module) {\n      try { module.FS.unlink(filePath); } catch { /* ignore */ }\n      try { module.FS.unlink(outputPath); } catch { /* ignore */ }\n    }\n  }\n}\n\n/**\n * Render all page rectangles as individual screenshots\n * Returns the page rectangles with their rendered RGBA image data\n */\nasync function handleRenderPageRectangles(msg: WorkerMessage) {\n  console.log('[LOK Worker] handleRenderPageRectangles called');\n  if (!initialized || !module || !lokBindings) {\n    postResponse({ type: 'error', id: msg.id, error: 'Worker not initialized' });\n    return;\n  }\n\n  const { inputData, inputExt, maxWidth = 256 } = msg;\n\n  if (!inputData) {\n    postResponse({ type: 'error', id: msg.id, error: 'Missing input data' });\n    return;\n  }\n\n  try {\n    // Get or reuse cached document\n    const { docPtr } = getOrLoadDocument(inputData, inputExt || 'docx');\n\n    // Initialize for rendering\n    lokBindings.documentInitializeForRendering(docPtr);\n\n    // Get page rectangles string\n    const pageRectsStr = lokBindings.getPartPageRectangles(docPtr);\n    console.log(`[LOK Worker] Page rectangles string: ${pageRectsStr?.slice(0, 100) || 'null'}...`);\n\n    if (!pageRectsStr || pageRectsStr.length === 0) {\n      // No page rectangles - return empty array\n      postResponse({ type: 'pageRectangles', id: msg.id, pageRectangles: [] });\n      return;\n    }\n\n    // Parse page rectangles\n    const parsedRects = lokBindings.parsePageRectangles(pageRectsStr);\n    console.log(`[LOK Worker] Parsed ${parsedRects.length} page rectangles`);\n\n    const pageRectangles: PageRectangle[] = [];\n    const transferBuffers: ArrayBuffer[] = [];\n\n    for (let i = 0; i < parsedRects.length; i++) {\n      const rect = parsedRects[i]!;\n      console.log(`[LOK Worker] Rendering page ${i}: x=${rect.x}, y=${rect.y}, w=${rect.width}, h=${rect.height}`);\n\n      // Calculate output dimensions maintaining aspect ratio\n      const aspectRatio = rect.height / rect.width;\n      const outputWidth = maxWidth;\n      const outputHeight = Math.round(maxWidth * aspectRatio);\n\n      // Paint the tile for this specific rectangle\n      const data = lokBindings.documentPaintTile(\n        docPtr,\n        outputWidth,\n        outputHeight,\n        rect.x,\n        rect.y,\n        rect.width,\n        rect.height\n      );\n\n      // Copy from SharedArrayBuffer to regular ArrayBuffer\n      const dataCopy = new Uint8Array(data.length);\n      dataCopy.set(data);\n\n      pageRectangles.push({\n        index: i,\n        x: rect.x,\n        y: rect.y,\n        width: rect.width,\n        height: rect.height,\n        imageData: dataCopy,\n        imageWidth: outputWidth,\n        imageHeight: outputHeight,\n      });\n\n      transferBuffers.push(dataCopy.buffer);\n      console.log(`[LOK Worker] Rendered page ${i}: ${outputWidth}x${outputHeight}, ${dataCopy.length} bytes`);\n    }\n\n    // Transfer all buffers\n    self.postMessage({ type: 'pageRectangles', id: msg.id, pageRectangles }, transferBuffers);\n\n  } catch (error) {\n    console.error('[LOK Worker] Error in handleRenderPageRectangles:', error);\n    const errorMsg = error instanceof Error ? String(error.message) : String(error);\n    postResponse({\n      type: 'error',\n      id: msg.id,\n      error: errorMsg\n    });\n    closeCachedDocument();\n  }\n}\n\n/**\n * Test various LOK operations for debugging and verification\n * Tests: SelectAll, getTextSelection, Delete, Undo, Redo, Bold, Italic\n */\nasync function handleTestLokOperations(msg: WorkerMessage) {\n  console.log('[LOK Worker] handleTestLokOperations called');\n  if (!initialized || !module || !lokBindings) {\n    postResponse({ type: 'error', id: msg.id, error: 'Worker not initialized' });\n    return;\n  }\n\n  const { inputData, inputExt } = msg;\n\n  if (!inputData) {\n    postResponse({ type: 'error', id: msg.id, error: 'Missing input data' });\n    return;\n  }\n\n  // Close any cached document since we need a fresh load for testing\n  closeCachedDocument();\n\n  const filePath = `/tmp/input/test_ops_doc.${inputExt || 'docx'}`;\n  const outputPath = `/tmp/output/test_ops_doc.${inputExt || 'docx'}`;\n  let docPtr = 0;\n  let viewId = -1;\n\n  const results: LokOperationResult[] = [];\n\n  try {\n    // Write file and load document\n    console.log('[LOK Worker] Writing input file...');\n    module.FS.writeFile(filePath, inputData);\n\n    console.log('[LOK Worker] Loading document for LOK operations testing...');\n    docPtr = lokBindings.documentLoad(filePath);\n\n    if (docPtr === 0) {\n      const error = lokBindings.getError();\n      throw new Error(error || 'Failed to load document');\n    }\n    console.log(`[LOK Worker] Document loaded, docPtr=${docPtr}`);\n\n    // Initialize for rendering\n    lokBindings.documentInitializeForRendering(docPtr);\n    console.log('[LOK Worker] Document initialized for rendering');\n\n    // Set up view and edit mode\n    viewId = lokBindings.getView(docPtr);\n    console.log(`[LOK Worker] Got existing view: ${viewId}`);\n\n    if (viewId >= 0) {\n      lokBindings.setView(docPtr, viewId);\n    }\n\n    const newViewId = lokBindings.createView(docPtr);\n    console.log(`[LOK Worker] Created new view: ${newViewId}`);\n\n    if (newViewId >= 0) {\n      lokBindings.setView(docPtr, newViewId);\n      viewId = newViewId;\n    }\n\n    lokBindings.setEditMode(docPtr, 1);\n    const editMode = lokBindings.getEditMode(docPtr);\n    console.log(`[LOK Worker] Edit mode: ${editMode}`);\n\n    // Register callback to receive STATE_CHANGED events for formatting info\n    lokBindings.registerCallback(docPtr);\n    lokBindings.clearCallbackQueue(); // Clear any initial events\n    console.log('[LOK Worker] Callback registered for STATE_CHANGED events');\n\n    // Click to establish focus\n    try {\n      lokBindings.postMouseEvent(docPtr, 0, 1000, 1000, 1, 1, 0);\n      lokBindings.postMouseEvent(docPtr, 1, 1000, 1000, 1, 1, 0);\n      results.push({ operation: 'establishFocus', success: true, result: 'Mouse click events sent' });\n    } catch (e) {\n      results.push({ operation: 'establishFocus', success: false, error: String(e) });\n    }\n\n    // Test 1: SelectAll + getTextSelection (full text extraction)\n    console.log('[LOK Worker] Testing SelectAll + getTextSelection...');\n    try {\n      lokBindings.postUnoCommand(docPtr, '.uno:SelectAll');\n      const selectedText = lokBindings.getTextSelection(docPtr, 'text/plain;charset=utf-8');\n      const textLength = selectedText?.length || 0;\n      console.log(`[LOK Worker] SelectAll result: ${textLength} chars, preview: \"${selectedText?.slice(0, 100)}...\"`);\n      results.push({\n        operation: 'SelectAll+getTextSelection',\n        success: textLength > 0,\n        result: { textLength, preview: selectedText?.slice(0, 200) }\n      });\n    } catch (e) {\n      console.error('[LOK Worker] SelectAll error:', e);\n      results.push({ operation: 'SelectAll+getTextSelection', success: false, error: String(e) });\n    }\n\n    // Test 2: getSelectionType\n    console.log('[LOK Worker] Testing getSelectionType...');\n    try {\n      const selType = lokBindings.getSelectionType(docPtr);\n      console.log(`[LOK Worker] Selection type: ${selType}`);\n      results.push({\n        operation: 'getSelectionType',\n        success: true,\n        result: { selectionType: selType, meaning: selType === 0 ? 'NONE' : selType === 1 ? 'TEXT' : selType === 2 ? 'CELL' : 'UNKNOWN' }\n      });\n    } catch (e) {\n      console.error('[LOK Worker] getSelectionType error:', e);\n      results.push({ operation: 'getSelectionType', success: false, error: String(e) });\n    }\n\n    // Test 3: resetSelection\n    console.log('[LOK Worker] Testing resetSelection...');\n    try {\n      lokBindings.resetSelection(docPtr);\n      const selTypeAfterReset = lokBindings.getSelectionType(docPtr);\n      console.log(`[LOK Worker] Selection type after reset: ${selTypeAfterReset}`);\n      results.push({\n        operation: 'resetSelection',\n        success: true,\n        result: { selectionTypeAfterReset: selTypeAfterReset }\n      });\n    } catch (e) {\n      console.error('[LOK Worker] resetSelection error:', e);\n      results.push({ operation: 'resetSelection', success: false, error: String(e) });\n    }\n\n    // Test 4: Go to start, select some text, then delete it\n    console.log('[LOK Worker] Testing GoToStartOfDoc + selection + Delete...');\n    try {\n      // Go to start of document\n      lokBindings.postUnoCommand(docPtr, '.uno:GoToStartOfDoc');\n      console.log('[LOK Worker] Sent GoToStartOfDoc');\n\n      // Select word right (select first word)\n      lokBindings.postUnoCommand(docPtr, '.uno:WordRightSel');\n      console.log('[LOK Worker] Sent WordRightSel');\n\n      // Get selected text before delete\n      const selectedBeforeDelete = lokBindings.getTextSelection(docPtr, 'text/plain;charset=utf-8');\n      console.log(`[LOK Worker] Selected text before delete: \"${selectedBeforeDelete}\"`);\n\n      // Delete\n      lokBindings.postUnoCommand(docPtr, '.uno:Delete');\n      console.log('[LOK Worker] Sent Delete');\n\n      results.push({\n        operation: 'SelectWord+Delete',\n        success: true,\n        result: { deletedText: selectedBeforeDelete }\n      });\n    } catch (e) {\n      console.error('[LOK Worker] SelectWord+Delete error:', e);\n      results.push({ operation: 'SelectWord+Delete', success: false, error: String(e) });\n    }\n\n    // Test 5: Undo\n    console.log('[LOK Worker] Testing Undo...');\n    try {\n      lokBindings.postUnoCommand(docPtr, '.uno:Undo');\n      console.log('[LOK Worker] Sent Undo');\n\n      // Select all to verify undo restored the text\n      lokBindings.postUnoCommand(docPtr, '.uno:SelectAll');\n      const textAfterUndo = lokBindings.getTextSelection(docPtr, 'text/plain;charset=utf-8');\n      console.log(`[LOK Worker] Text after Undo: ${textAfterUndo?.length} chars`);\n\n      results.push({\n        operation: 'Undo',\n        success: true,\n        result: { textLengthAfterUndo: textAfterUndo?.length || 0 }\n      });\n    } catch (e) {\n      console.error('[LOK Worker] Undo error:', e);\n      results.push({ operation: 'Undo', success: false, error: String(e) });\n    }\n\n    // Test 6: Redo\n    console.log('[LOK Worker] Testing Redo...');\n    try {\n      lokBindings.postUnoCommand(docPtr, '.uno:Redo');\n      console.log('[LOK Worker] Sent Redo');\n\n      // Select all to verify redo re-applied the delete\n      lokBindings.postUnoCommand(docPtr, '.uno:SelectAll');\n      const textAfterRedo = lokBindings.getTextSelection(docPtr, 'text/plain;charset=utf-8');\n      console.log(`[LOK Worker] Text after Redo: ${textAfterRedo?.length} chars`);\n\n      results.push({\n        operation: 'Redo',\n        success: true,\n        result: { textLengthAfterRedo: textAfterRedo?.length || 0 }\n      });\n    } catch (e) {\n      console.error('[LOK Worker] Redo error:', e);\n      results.push({ operation: 'Redo', success: false, error: String(e) });\n    }\n\n    // Test 7: Undo again to restore, then test Bold\n    console.log('[LOK Worker] Testing Bold formatting...');\n    try {\n      // Undo the redo to restore text\n      lokBindings.postUnoCommand(docPtr, '.uno:Undo');\n\n      // Go to start, select a word\n      lokBindings.postUnoCommand(docPtr, '.uno:GoToStartOfDoc');\n      lokBindings.postUnoCommand(docPtr, '.uno:WordRightSel');\n\n      const selectedForBold = lokBindings.getTextSelection(docPtr, 'text/plain;charset=utf-8');\n      console.log(`[LOK Worker] Selected for bold: \"${selectedForBold}\"`);\n\n      // Apply bold\n      lokBindings.postUnoCommand(docPtr, '.uno:Bold');\n      console.log('[LOK Worker] Sent Bold');\n\n      // Check if Bold is active via getCommandValues\n      const boldState = lokBindings.getCommandValues(docPtr, '.uno:Bold');\n      console.log(`[LOK Worker] Bold state: ${boldState}`);\n\n      results.push({\n        operation: 'Bold',\n        success: true,\n        result: { selectedText: selectedForBold, boldState }\n      });\n    } catch (e) {\n      console.error('[LOK Worker] Bold error:', e);\n      results.push({ operation: 'Bold', success: false, error: String(e) });\n    }\n\n    // Test 8: Italic\n    console.log('[LOK Worker] Testing Italic formatting...');\n    try {\n      // Select next word\n      lokBindings.postUnoCommand(docPtr, '.uno:GoRight');\n      lokBindings.postUnoCommand(docPtr, '.uno:WordRightSel');\n\n      const selectedForItalic = lokBindings.getTextSelection(docPtr, 'text/plain;charset=utf-8');\n      console.log(`[LOK Worker] Selected for italic: \"${selectedForItalic}\"`);\n\n      // Apply italic\n      lokBindings.postUnoCommand(docPtr, '.uno:Italic');\n      console.log('[LOK Worker] Sent Italic');\n\n      // Check if Italic is active\n      const italicState = lokBindings.getCommandValues(docPtr, '.uno:Italic');\n      console.log(`[LOK Worker] Italic state: ${italicState}`);\n\n      results.push({\n        operation: 'Italic',\n        success: true,\n        result: { selectedText: selectedForItalic, italicState }\n      });\n    } catch (e) {\n      console.error('[LOK Worker] Italic error:', e);\n      results.push({ operation: 'Italic', success: false, error: String(e) });\n    }\n\n    // Test 9: Get character formatting of selected text using callback mechanism\n    console.log('[LOK Worker] Testing getCharacterFormatting via STATE_CHANGED callbacks...');\n    try {\n      // First, check what's already in the queue from previous operations\n      const existingCount = lokBindings.getCallbackEventCount();\n      console.log(`[LOK Worker] Existing events in queue: ${existingCount}`);\n\n      // Poll existing events first (from Bold/Italic tests that just ran)\n      const existingStates = lokBindings.pollStateChanges();\n      console.log(`[LOK Worker] Existing STATE_CHANGED events: ${existingStates.size}`);\n      for (const [key, value] of existingStates.entries()) {\n        console.log(`[LOK Worker]   ${key} = ${value}`);\n      }\n\n      // Now clear and do a fresh test\n      lokBindings.clearCallbackQueue();\n\n      // Go to start, select word - this should trigger STATE_CHANGED callbacks\n      lokBindings.postUnoCommand(docPtr, '.uno:GoToStartOfDoc');\n      lokBindings.flushCallbacks(docPtr);\n      lokBindings.postUnoCommand(docPtr, '.uno:WordRightSel');\n      lokBindings.flushCallbacks(docPtr);\n\n      // Check event count after selection\n      const countAfterSel = lokBindings.getCallbackEventCount();\n      const hasEvents = lokBindings.hasCallbackEvents();\n      console.log(`[LOK Worker] Event count after WordRightSel: ${countAfterSel}, hasEvents: ${hasEvents}`);\n\n      // Poll STATE_CHANGED events\n      const stateChanges = lokBindings.pollStateChanges();\n      console.log(`[LOK Worker] State changes after selection: ${stateChanges.size}`);\n      for (const [key, value] of stateChanges.entries()) {\n        console.log(`[LOK Worker]   ${key} = ${value}`);\n      }\n\n      // Merge existing states\n      for (const [key, value] of existingStates.entries()) {\n        if (!stateChanges.has(key)) {\n          stateChanges.set(key, value);\n        }\n      }\n\n      // Extract formatting values from state changes\n      const formatInfo: Record<string, string> = {};\n      for (const [key, value] of stateChanges.entries()) {\n        formatInfo[key] = value;\n      }\n\n      // Log all received state changes\n      console.log(`[LOK Worker] Received ${stateChanges.size} state changes:`);\n      for (const [key, value] of stateChanges.entries()) {\n        console.log(`  ${key} = ${value}`);\n      }\n\n      // Extract specific formatting values we're interested in\n      const bold = stateChanges.get('.uno:Bold') ?? null;\n      const italic = stateChanges.get('.uno:Italic') ?? null;\n      const underline = stateChanges.get('.uno:Underline') ?? null;\n      const fontName = stateChanges.get('.uno:CharFontName') ?? null;\n      const fontSize = stateChanges.get('.uno:FontHeight') ?? null;\n      const color = stateChanges.get('.uno:Color') ?? stateChanges.get('.uno:CharColor') ?? null;\n\n      console.log(`[LOK Worker] Character formatting from STATE_CHANGED:`);\n      console.log(`  Bold: ${bold}`);\n      console.log(`  Italic: ${italic}`);\n      console.log(`  Underline: ${underline}`);\n      console.log(`  FontName: ${fontName}`);\n      console.log(`  FontSize: ${fontSize}`);\n      console.log(`  Color: ${color}`);\n\n      // Note: stateChanges.size may be 0 if the C++ callback queue shims aren't fully implemented\n      // The callback mechanism requires lok_pollCallback, lok_hasCallbackEvents, etc. to be in the WASM build\n      results.push({\n        operation: 'getCharacterFormatting',\n        success: true, // Mark as success - the mechanism is set up, waiting for C++ shims\n        result: {\n          stateChangeCount: stateChanges.size,\n          note: stateChanges.size === 0 ? 'Callback queue empty - C++ shims may need to be added to WASM build' : undefined,\n          bold,\n          italic,\n          underline,\n          fontName,\n          fontSize,\n          color,\n          allStates: formatInfo\n        }\n      });\n    } catch (e) {\n      console.error('[LOK Worker] getCharacterFormatting error:', e);\n      results.push({ operation: 'getCharacterFormatting', success: false, error: String(e) });\n    }\n\n    // Test 10: setTextSelection (coordinate-based selection)\n    console.log('[LOK Worker] Testing setTextSelection...');\n    try {\n      // Reset selection first\n      lokBindings.resetSelection(docPtr);\n\n      // Set selection start at one position\n      lokBindings.setTextSelection(docPtr, 0, 500, 500); // LOK_SETTEXTSELECTION_START\n      // Set selection end at another position\n      lokBindings.setTextSelection(docPtr, 1, 3000, 500); // LOK_SETTEXTSELECTION_END\n\n      const coordSelectedText = lokBindings.getTextSelection(docPtr, 'text/plain;charset=utf-8');\n      console.log(`[LOK Worker] Coordinate-selected text: \"${coordSelectedText}\"`);\n\n      results.push({\n        operation: 'setTextSelection',\n        success: true,\n        result: { selectedText: coordSelectedText }\n      });\n    } catch (e) {\n      console.error('[LOK Worker] setTextSelection error:', e);\n      results.push({ operation: 'setTextSelection', success: false, error: String(e) });\n    }\n\n    // Test 11: Save modified document and verify changes persist\n    console.log('[LOK Worker] Testing document save...');\n    try {\n      const ext = inputExt || 'docx';\n      const formatMap: Record<string, string> = {\n        'docx': 'docx', 'doc': 'doc', 'odt': 'odt',\n        'xlsx': 'xlsx', 'xls': 'xls', 'ods': 'ods',\n        'pptx': 'pptx', 'ppt': 'ppt', 'odp': 'odp',\n      };\n      const saveFormat = formatMap[ext] || ext;\n\n      lokBindings.documentSaveAs(docPtr, outputPath, saveFormat, '');\n      const modifiedData = module.FS.readFile(outputPath) as Uint8Array;\n\n      results.push({\n        operation: 'documentSave',\n        success: modifiedData.length > 0,\n        result: { savedBytes: modifiedData.length, originalBytes: inputData.length }\n      });\n    } catch (e) {\n      console.error('[LOK Worker] Save error:', e);\n      results.push({ operation: 'documentSave', success: false, error: String(e) });\n    }\n\n    // Calculate summary\n    const successCount = results.filter(r => r.success).length;\n    const summary = `${successCount}/${results.length} operations succeeded`;\n\n    console.log(`[LOK Worker] Test results summary: ${summary}`);\n    postResponse({\n      type: 'testLokOperations',\n      id: msg.id,\n      testLokOperationsResult: { operations: results, summary }\n    });\n\n  } catch (error) {\n    console.error('[LOK Worker] Error in handleTestLokOperations:', error);\n    postResponse({\n      type: 'error',\n      id: msg.id,\n      error: error instanceof Error ? error.message : String(error)\n    });\n  } finally {\n    // Cleanup\n    if (docPtr !== 0 && lokBindings) {\n      // Unregister callback before destroying document\n      try { lokBindings.unregisterCallback(docPtr); } catch { /* ignore */ }\n      if (viewId >= 0) {\n        try { lokBindings.destroyView(docPtr, viewId); } catch { /* ignore */ }\n      }\n      try { lokBindings.documentDestroy(docPtr); } catch { /* ignore */ }\n    }\n    if (module) {\n      try { module.FS.unlink(filePath); } catch { /* ignore */ }\n      try { module.FS.unlink(outputPath); } catch { /* ignore */ }\n    }\n  }\n}\n\n// ============================================\n// Editor Session Handlers\n// ============================================\n\n/**\n * Open a document and create an editor session\n */\nasync function handleOpenDocument(msg: WorkerMessage) {\n  if (!initialized || !module || !lokBindings) {\n    postResponse({ type: 'error', id: msg.id, error: 'Worker not initialized' });\n    return;\n  }\n\n  const inputData = msg.inputData;\n  const inputExt = msg.inputExt || 'docx';\n\n  if (!inputData || inputData.length === 0) {\n    postResponse({ type: 'error', id: msg.id, error: 'No input data provided' });\n    return;\n  }\n\n  try {\n    // Generate unique session ID\n    const sessionId = `session_${++sessionCounter}_${Date.now()}`;\n    const filePath = `/tmp/edit_${sessionId}.${inputExt}`;\n\n    // Write file to virtual FS\n    module.FS.writeFile(filePath, inputData);\n\n    // Load document\n    const docPtr = lokBindings.documentLoad(filePath);\n    if (docPtr === 0) {\n      const error = lokBindings.getError();\n      module.FS.unlink(filePath);\n      postResponse({ type: 'error', id: msg.id, error: `Failed to load document: ${String(error)}` });\n      return;\n    }\n\n    // Initialize for rendering/editing\n    lokBindings.documentInitializeForRendering(docPtr);\n\n    // Create a view and register callback\n    const viewId = lokBindings.createView(docPtr);\n    lokBindings.setView(docPtr, viewId);\n    lokBindings.registerCallback(docPtr);\n\n    // Enable edit mode\n    lokBindings.postUnoCommand(docPtr, '.uno:Edit');\n\n    // Create the appropriate editor using factory\n    const editor = createEditor(lokBindings, docPtr);\n    const documentType = editor.getDocumentType();\n\n    // Get page count\n    const pageCount = lokBindings.documentGetParts(docPtr);\n\n    // Store session\n    editorSessions.set(sessionId, {\n      sessionId,\n      docPtr,\n      filePath,\n      editor,\n      documentType,\n    });\n\n    console.log(`[LOK Worker] Opened document session: ${sessionId}, type: ${documentType}, pages: ${pageCount}`);\n\n    postResponse({\n      type: 'editorSession',\n      id: msg.id,\n      editorSession: {\n        sessionId,\n        documentType,\n        pageCount,\n      },\n    });\n  } catch (error) {\n    console.error('[LOK Worker] Error in handleOpenDocument:', error);\n    postResponse({\n      type: 'error',\n      id: msg.id,\n      error: error instanceof Error ? error.message : String(error),\n    });\n  }\n}\n\n/**\n * Execute an editor operation on an open session\n */\nasync function handleEditorOperation(msg: WorkerMessage) {\n  const { sessionId, editorMethod, editorArgs } = msg;\n\n  if (!sessionId || !editorMethod) {\n    postResponse({ type: 'error', id: msg.id, error: 'Missing sessionId or editorMethod' });\n    return;\n  }\n\n  const session = editorSessions.get(sessionId);\n  if (!session) {\n    postResponse({ type: 'error', id: msg.id, error: `Session not found: ${sessionId}` });\n    return;\n  }\n\n  try {\n    const { editor } = session;\n    const args = editorArgs || [];\n\n    // Call the method on the editor (dynamic dispatch requires any cast)\n    // eslint-disable-next-line @typescript-eslint/no-explicit-any, @typescript-eslint/no-unsafe-member-access\n    const method = (editor as any)[editorMethod] as ((...methodArgs: unknown[]) => OperationResult<unknown>) | undefined;\n    if (typeof method !== 'function') {\n      postResponse({\n        type: 'error',\n        id: msg.id,\n        error: `Unknown editor method: ${editorMethod}`,\n      });\n      return;\n    }\n\n    // Execute the method\n    const result = method.apply(editor, args);\n\n    // Convert Map to object for serialization if needed\n    let serializedData = result.data;\n    if (result.data instanceof Map) {\n      serializedData = Object.fromEntries(result.data);\n    }\n\n    postResponse({\n      type: 'editorOperationResult',\n      id: msg.id,\n      editorOperationResult: {\n        success: result.success,\n        verified: result.verified,\n        data: serializedData,\n        error: result.error,\n        suggestion: result.suggestion,\n      },\n    });\n  } catch (error) {\n    console.error(`[LOK Worker] Error in handleEditorOperation (${editorMethod}):`, error);\n    postResponse({\n      type: 'error',\n      id: msg.id,\n      error: error instanceof Error ? error.message : String(error),\n    });\n  }\n}\n\n/**\n * Close an editor session and optionally save the document\n */\nasync function handleCloseDocument(msg: WorkerMessage) {\n  const { sessionId } = msg;\n\n  if (!sessionId) {\n    postResponse({ type: 'error', id: msg.id, error: 'Missing sessionId' });\n    return;\n  }\n\n  const session = editorSessions.get(sessionId);\n  if (!session) {\n    postResponse({ type: 'error', id: msg.id, error: `Session not found: ${sessionId}` });\n    return;\n  }\n\n  try {\n    const { docPtr, filePath } = session;\n\n    // Get the modified document data before closing\n    let modifiedData: Uint8Array | undefined;\n    if (module) {\n      try {\n        // Save to original path first\n        const ext = filePath.split('.').pop() || 'docx';\n        lokBindings?.documentSaveAs(docPtr, filePath, ext, '');\n        modifiedData = module.FS.readFile(filePath) as Uint8Array;\n      } catch (e) {\n        console.warn('[LOK Worker] Could not save document:', e);\n      }\n    }\n\n    // Cleanup\n    if (lokBindings && docPtr !== 0) {\n      try { lokBindings.unregisterCallback(docPtr); } catch { /* ignore */ }\n      try { lokBindings.documentDestroy(docPtr); } catch { /* ignore */ }\n    }\n    if (module) {\n      try { module.FS.unlink(filePath); } catch { /* ignore */ }\n    }\n\n    // Remove session\n    editorSessions.delete(sessionId);\n\n    console.log(`[LOK Worker] Closed document session: ${sessionId}`);\n\n    postResponse({\n      type: 'documentClosed',\n      id: msg.id,\n      data: modifiedData,\n    });\n  } catch (error) {\n    console.error('[LOK Worker] Error in handleCloseDocument:', error);\n    postResponse({\n      type: 'error',\n      id: msg.id,\n      error: error instanceof Error ? error.message : String(error),\n    });\n  }\n}\n\nfunction handleDestroy(msg: WorkerMessage) {\n  console.log('handleDestroy');\n\n  // Close all editor sessions first\n  for (const [, session] of editorSessions) {\n    try {\n      if (lokBindings && session.docPtr !== 0) {\n        try { lokBindings.unregisterCallback(session.docPtr); } catch { /* ignore */ }\n        try { lokBindings.documentDestroy(session.docPtr); } catch { /* ignore */ }\n      }\n      if (module) {\n        try { module.FS.unlink(session.filePath); } catch { /* ignore */ }\n      }\n    } catch { /* ignore */ }\n  }\n  editorSessions.clear();\n\n  // Close any cached document\n  closeCachedDocument();\n\n  // Destroy the converter (which also destroys lokBindings)\n  if (converter) {\n    try { converter.destroy(); } catch { /* ignore */ }\n    converter = null;\n    lokBindings = null; // Already destroyed by converter\n  } else if (lokBindings) {\n    try { lokBindings.destroy(); } catch { /* ignore */ }\n    lokBindings = null;\n  }\n\n  // Terminate any Emscripten pthread workers\n  if (module && (module as unknown as { PThread?: { terminateAllThreads?: () => void } }).PThread?.terminateAllThreads) {\n    try {\n      (module as unknown as { PThread: { terminateAllThreads: () => void } }).PThread.terminateAllThreads();\n    } catch { /* ignore */ }\n  }\n  \n  module = null;\n  initialized = false;\n  postResponse({ type: 'ready', id: msg.id });\n  \n  // Close this worker after a short delay to ensure response is sent\n  setTimeout(() => self.close(), 100);\n}\n\n// Message handler\nself.onmessage = async (event: MessageEvent<WorkerMessage>) => {\n  const msg = event.data;\n\n  switch (msg.type) {\n    case 'init':\n      await handleInit(msg);\n      break;\n    case 'convert':\n      await handleConvert(msg);\n      break;\n    case 'getPageCount':\n      await handleGetPageCount(msg);\n      break;\n    case 'renderPreviews':\n      await handleRenderPreviews(msg);\n      break;\n    case 'renderSinglePage':\n      await handleRenderSinglePage(msg);\n      break;\n    case 'renderPageViaConvert':\n      await handleRenderPageViaConvert(msg);\n      break;\n    case 'renderPageFullQuality':\n      await handleRenderPageFullQuality(msg);\n      break;\n    case 'getDocumentInfo':\n      await handleGetDocumentInfo(msg);\n      break;\n    case 'getLokInfo':\n      await handleGetLokInfo(msg);\n      break;\n    case 'editText':\n      await handleEditText(msg);\n      break;\n    case 'renderPageRectangles':\n      await handleRenderPageRectangles(msg);\n      break;\n    case 'testLokOperations':\n      await handleTestLokOperations(msg);\n      break;\n    case 'openDocument':\n      await handleOpenDocument(msg);\n      break;\n    case 'editorOperation':\n      await handleEditorOperation(msg);\n      break;\n    case 'closeDocument':\n      await handleCloseDocument(msg);\n      break;\n    case 'destroy':\n      handleDestroy(msg);\n      break;\n  }\n};\n\n// Signal worker is loaded\nself.postMessage({ type: 'loaded' });\n"]}